<html><head><title>Server deployment</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="mmdocs.css?view=co">

</head>
<body class='pod'>
<!--
  generated by Metamod::Pod::Simple::HTML v,
  using Pod::Simple::PullParser v3.30,
  under Perl v5.014002 at Fri Feb 27 17:08:17 2015 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Metamod::Pod::Simple::HTML, and/or subclassing Metamod::Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Metamod::Pod::Simple::HTML for advice.
   See 'perldoc Metamod::Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<div id='banner'>METAMOD Documentation | <a name='___top' href='index.html'>main menu</a></div>
<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#Server_deployment'>Server deployment</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Installing_services'>Installing services</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Users_with_restricted_sudo_privileges'>Users with restricted sudo privileges</a>
      <li class='indexItem indexItem3'><a href='#Apache'>Apache</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Proxy_setup'>Proxy setup</a>
        <li class='indexItem indexItem4'><a href='#Testing'>Testing</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#METAMOD_services'>METAMOD services</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Server_deployment"
>Server deployment</a></h1>

<p>This part is not necessary unless you are setting up a server to run METAMOD as an online service.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installing_services"
>Installing services</a></h2>

<p>After installation and testing of the software and one or more configurations,
you should now install the application services where the operating system can find it.
Currently only Debian-based Linux systems are supported.</p>

<p>This script will create an Apache configuration file,
as well as init.d scripts for automatic starting and stopping of Catalyst and the various METAMOD services for the specific application.
These files are normally owned by root and will be placed in in <em>&#60;configuration dir&#62;/etc</em>,
and then symlinked into <em>/etc/apache2</em> and <em>/etc/init.d</em>.</p>

<pre>  $ cd /opt/metno-metamod-2.13 # or elsewhere if installed from source
  $ ./install_jobs.sh &#60;config&#62;</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Users_with_restricted_sudo_privileges"
>Users with restricted sudo privileges</a></h3>

<p>Some users may not have full sudo rights, and/or having PERL5LIB stripped out when running under sudo (see <a href="http://www.sudo.ws/sudo/alerts/perl_env.html" class="podlinkurl"
>http://www.sudo.ws/sudo/alerts/perl_env.html</a>). You will then typically get the following error message:</p>

<pre>  sudo: sorry, you are not allowed to set the following environment variables: PERL5LIB</pre>

<p>If so you may run install_jobs with the -u option (for unprivileged), in which case all files will be owned by yourself instead of root:</p>

<pre>  $ ./install_jobs.sh -u &#60;config&#62;</pre>

<p>Note that this is not recommended in production environments where several login users are administering the system.</p>

<p>You may then try to start it as a service:</p>

<pre>  $ sudo /etc/init.d/catalyst-APPLICATION_ID start</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Apache"
>Apache</a></h3>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Proxy_setup"
>Proxy setup</a></h4>

<p>Accessing METAMOD directly from Catalyst is usually not possible in production due to firewall and load balancing issues; instead a proxy server like Apache is recommended. <code>./install_jobs.sh</code> automatically generates the necessary Apache setup files for you.</p>

<p>If this has not already been done you need to enable the Apache proxy and rewrite modules. Look in /etc/apache2/mods-enabled to see if they have already been enabled.</p>

<pre>  $ sudo a2enmod proxy
  $ sudo a2enmod proxy_http
  $ sudo a2enmod rewrite</pre>

<p>Note that if you are <i>not</i> running METAMOD as a VirtualHost (i.e. VIRTUAL_HOST is not set in master_config), the default Apache config will block all proxy directives defined in conf.d. Therefore you must disable the default virtualhost:</p>

<pre>  $ sudo a2dissite 000-default</pre>

<p>A fix for this is hopefully coming in 2.14.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Testing"
>Testing</a></h4>

<p>Restart Apache:</p>

<pre>  $ sudo apache2ctl restart</pre>

<p>or if the site is busy:</p>

<pre>  $ sudo apache2ctl graceful</pre>

<p>which will wait until all connections are terminated before restarting.</p>

<p>The site should now hopefully be available on</p>

<pre>  http://localhost/APPLICATION_ID</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="METAMOD_services"
>METAMOD services</a></h3>

<p>Start METAMOD:</p>

<pre>  $ sudo /etc/init.d/metamodServices-APPLICATION_ID start</pre>

<p>This should start the required services daemons.</p>

<!-- end doc -->

</body></html>
