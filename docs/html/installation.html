<html><head><title>METAMOD software installation</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="mmdocs.css?view=co">

</head>
<body class='pod'>
<!--
  generated by Metamod::Pod::Simple::HTML v,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Thu Mar 13 13:19:39 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Metamod::Pod::Simple::HTML, and/or subclassing Metamod::Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Metamod::Pod::Simple::HTML for advice.
   See 'perldoc Metamod::Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#METAMOD_software_installation'>METAMOD software installation</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Introduction'>Introduction</a>
    <li class='indexItem indexItem2'><a href='#Required_software'>Required software</a>
    <li class='indexItem indexItem2'><a href='#Installation_from_Debian_packages'>Installation from Debian packages</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Adding_the_met.no_package_repository'>Adding the met.no package repository</a>
      <li class='indexItem indexItem3'><a href='#Installing_METAMOD_via_apt'>Installing METAMOD via apt</a>
      <li class='indexItem indexItem3'><a href='#Installing_FIMEX'>Installing FIMEX</a>
      <li class='indexItem indexItem3'><a href='#Installing_packages_manually'>Installing packages manually</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Installation_from_source'>Installation from source</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Download_the_METAMOD_source_code'>Download the METAMOD source code</a>
      <li class='indexItem indexItem3'><a href='#Installing_binary_dependencies'>Installing binary dependencies</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Installing_Perl_dependency_libraries'>Installing Perl dependency libraries</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#cpanminus'>cpanminus</a>
      <li class='indexItem indexItem3'><a href='#Carton'>Carton</a>
      <li class='indexItem indexItem3'><a href='#METAMOD_dependencies'>METAMOD dependencies</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Development'>Development</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#PERL5LIB'>PERL5LIB</a>
      <li class='indexItem indexItem3'><a href='#Alternate_installation_methods'>Alternate installation methods</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Installing_Apache'>Installing Apache</a>
    <li class='indexItem indexItem2'><a href='#Installing_the_PostgreSQL_database'>Installing the PostgreSQL database</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Required_software'>Required software</a>
      <li class='indexItem indexItem3'><a href='#Authentication_(FIXME)'>Authentication (FIXME)</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Conclusion'>Conclusion</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METAMOD_software_installation"
>METAMOD software installation</a></h1>

<p>Back to <a href="./index.html?view=co" class="podlinkpod"
>Index</a></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Introduction"
>Introduction</a></h2>

<p>This describes how to install the METAMOD software on a Linux server.
No services will be available until you configure and set up a METAMOD instance (see <a href="./deploying.html?view=co" class="podlinkpod"
>Deploying a METAMOD application</a>) as well as a database instance.</p>

<p>METAMOD is developed,
tested and used on Ubuntu LTS servers (Hardy,
Lucid,
Precise).
Debian packages are provided regularly for easy installation and upgrading.
Installation from source is also possible,
but somewhat more time-consuming.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Required_software"
>Required software</a></h2>

<dl>
<dt><a name="PostgreSQL_database_system"
>PostgreSQL database system</a></dt>

<dd>
<p>The current version requires PostgreSQL 9.1 or later.
It has also been tested on version 8.3 and 8.4,
but some features may not work (in particular some PostGIS projections required for dynamic map search may be missing).
If running a local database you need the PostgreSQL server,
otherwise only the client is required.</p>

<dt><a name="Apache_2.x_web_server"
>Apache 2.x web server</a></dt>

<dd>
<p>With mod_proxy,
mod_proxy_http and mod_rewrite installed</p>

<dt><a name="libxml_and_libxslt_library"
>libxml and libxslt library</a></dt>

<dd>
<p>From xmlsoft.org</p>

<dt><a name="Proj4_library"
>Proj4 library</a></dt>

<dd>
<p><a href="http://proj.maptools.org" class="podlinkurl"
>http://proj.maptools.org</a></p>

<dt><a name="NetCDF_software_3.5_or_later"
>NetCDF software 3.5 or later</a></dt>

<dd>
<p>libnetcdf,
ncdump and ncgen</p>

<dt><a name="FIMEX_(optional,_but_recommended)"
>FIMEX (optional,
but recommended)</a></dt>

<dd>
<p>While not stricly necessary,
FIMEX is required for functionality regarding transformation and OPeNDAP.
However,
since it is not available via official Ubuntu repositories it is not a required dependency.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installation_from_Debian_packages"
>Installation from Debian packages</a></h2>

<p>This requires you have sufficient sudo privileges to install packages and add repositories.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Adding_the_met.no_package_repository"
>Adding the met.no package repository</a></h3>

<p><b>Note: Currently this repo is not available outside met.no.
External users must download and install packages manually as described below.</b></p>

<p>Add the corresponding lines to your /etc/apt/sources.list depending on your version of Ubuntu:</p>

<pre>  # for precise
  deb http://repo.met.no/met.no precise main contrib
  deb-src http://repo.met.no/met.no precise main contrib

  # for lucid
  deb http://repo.met.no/met.no lucid main contrib
  deb-src http://repo.met.no/met.no lucid main contrib

  # for hardy
  deb http://repo.met.no/met.no hardy main contrib
  deb-src http://repo.met.no/met.no hardy main contrib</pre>

<p>If you want to run development versions (recommended), also add:</p>

<pre>  # for precise
  deb http://repo.met.no/devel precise main contrib
  deb-src http://repo.met.no/devel precise main contrib

  # for lucid
  deb http://repo.met.no/devel lucid main contrib
  deb-src http://repo.met.no/devel lucid main contrib

  # for hardy
  deb http://repo.met.no/devel hardy main contrib
  deb-src http://repo.met.no/devel hardy main contrib</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Installing_METAMOD_via_apt"
>Installing METAMOD via apt</a></h3>

<pre>  $ sudo apt-get install metno-metamod-2.13</pre>

<p>Note that the Perl dependencies package metno-perl-webdev-ver1 has been obsoleted from 2.13 onwards. Instead all Perl dependency libraries are now included in the Metamod package.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Installing_FIMEX"
>Installing FIMEX</a></h3>

<pre>  $ sudo apt-get install fimex-bin</pre>

<p>If repo.met.no is not available, please follow the instructions at <a href="https://launchpad.net/~heiko-klein/+archive/fimex" class="podlinkurl"
>Launchpad</a> on how to add a PPA to your system.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Installing_packages_manually"
>Installing packages manually</a></h3>

<p>Alternately you may download the .deb files and install manually. This is not recommended as you will lose automatic upgrading. The packages may be found on the following sites:</p>

<ul>
<li><a href="https://wiki.met.no/metamod/download" class="podlinkurl"
>https://wiki.met.no/metamod/download</a></li>

<li><a href="http://repo.met.no/devel/dists/precise/main/binary-amd64/web/" class="podlinkurl"
>http://repo.met.no/devel/dists/precise/main/binary-amd64/web/</a></li>

<li><a href="http://repo.met.no/devel/dists/lucid/main/binary-all/web/" class="podlinkurl"
>http://repo.met.no/devel/dists/lucid/main/binary-all/web/</a></li>
</ul>

<p>Installation is done using a GUI packet manager or via command line:</p>

<pre>  $ sudo dpkg -i metno-metamod-2.13_2.13.0-1_amd64.deb</pre>

<p>where 2.13.0-1 is the latest version in the repository.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installation_from_source"
>Installation from source</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Download_the_METAMOD_source_code"
>Download the METAMOD source code</a></h3>

<p>Check out the METAMOD source code from Subversion into a suitable directory:</p>

<pre>  $ mkdir metamod
  $ cd metamod
  $ svn co https://svn.met.no/metamod/trunk</pre>

<p>A tar.gz file may also be available at a later date.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Installing_binary_dependencies"
>Installing binary dependencies</a></h3>

<p>METAMOD depends on several non-Perl compiled utilities and libraries which must be installed separately, including:</p>

<ul>
<li>PostgreSQL client and optionally server (preferrable 9.1 or later), as well as the DBD driver for Perl DBI</li>

<li>the GNOME LibXML2 and LibXSLT libraries</li>

<li>the Expat XML library</li>

<li>the PROJ.4 Cartographic Projections library from osgeo.org</li>

<li>the OpenSSL Library</li>
</ul>

<p>Installing these via Debial packages using <code>apt-get</code> is recommended if possible. A complete list of the required Debian packages can be found in <em>debian/control</em> under &#39;Depends&#39; and &#39;Build-Depends&#39;.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installing_Perl_dependency_libraries"
>Installing Perl dependency libraries</a></h2>

<p>The METAMOD Debian package already includes all necessary Perl dependencies, and pulls in any required binary libries automatically. All you need to do is make sure <code>CATALYST_LIB</code> is unset in <em>master_config.txt</em>.</p>

<p>If installing from source, you must download and build the necessary Perl modules from CPAN. This used to be a major chore, but is now possible to do with a single command using the new Perl module dependency manager Carton.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="cpanminus"
>cpanminus</a></h3>

<p>First, you need to be able to install Perl modules from CPAN. There are several tools available for this, but we recommend using <b>cpanminus</b> which can be installed using either of the following commands:</p>

<pre>  $ apt-get install cpanminus                               # for Debian systems
  $ curl -L http://cpanmin.us | sudo perl - App::cpanminus  # from source</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Carton"
>Carton</a></h3>

<p>Carton can download and build the required METAMOD Perl dependency modules automatically. Unlike <code>cpan</code> it will install the exact same module versions every time, avoiding upgrade conflicts and making sure you have the same environment as have been tested. It even bundles all the source tarballs into the local source repo so you don&#39;t even need online access to deploy.</p>

<pre>  $ cpanm -S Carton</pre>

<p>This should install version 1.0.12 or later. Versions below 1.0.0 are not supported (they cannot read the cpanfile.snapshot file).</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="METAMOD_dependencies"
>METAMOD dependencies</a></h3>

<p>You are now ready to install the Perl dependency libraries:</p>

<pre>  $ cd ~/metamod/trunk
  $ make deployment</pre>

<p>Carton will then install the modules listed in <em>cpanfile.snapshot</em> into <em>~/metamod/trunk/local/lib</em>. No network connection is needed when using --cached as this uses the modules supplied in <em>~/metamod/trunk/vendor/cache</em>. This should not generate any errors as long as you have installed all the necessary binary libraries as listed above.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Development"
>Development</a></h4>

<p>If you are editing METAMOD and want to add more Perl modules, add the required name and version to <em>cpanfile</em>, then run</p>

<pre>  $ make deps
  $ make bundle</pre>

<p>This will download and compile the necessary modules, and put the source into the vendor/cache directory.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="PERL5LIB"
>PERL5LIB</a></h3>

<p>Make sure that <code>CATALYST_LIB</code> is not set in <em>master_config.txt</em>, and your <code>PERL5LIB</code> environment variable is set to point to your local/lib/perl5 directory. This is handled automatically by <code>activate</code> and <em>init.d</em> scripts.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Alternate_installation_methods"
>Alternate installation methods</a></h3>

<p>As usual you could always install the required modules directly from CPAN. However, if you decided to install them outside your normal @INC path you need to specify the location in <code>CATALYST_LIB</code> in master_config.txt, as well as in PERL5LIB when running from the command line (activate_env doesn&#39;t handle this special case yet).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installing_Apache"
>Installing Apache</a></h2>

<p>Apache is probably installed by default on most servers, however to work with Catalyst you also need the proxy and rewrite modules. Look in /etc/apache2/mods-enabled to see if they have already been enabled.</p>

<pre>  $ sudo a2enmod proxy
  $ sudo a2enmod proxy_http
  $ sudo a2enmod rewrite</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installing_the_PostgreSQL_database"
>Installing the PostgreSQL database</a></h2>

<p>METAMOD requires two databases, one for metadata (which is just an index and can be recreated from the XML files) and one for user credentials (which is authorative and must be backed up).</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Required_software"
>Required software</a></h3>

<p>The following Debian packets must be installed on the server:</p>

<ul>
<li>postgresql
<p>(Defaults to the current version)</p>
</li>

<li>postgresql-9.1-postgis
<p>(Replace the version number with the current version)</p>
</li>
</ul>

<p>In addition, the following files must be copied to the METAMOD application server and configured in <code>PG_POSTGIS_SCRIPT</code> and <code>PG_POSTGIS_SYSREF_SCRIPT</code> so that createdb.sh can read them:</p>

<pre>  /usr/share/postgresql/9.1/contrib/postgis-1.5/postgis.sql
  /usr/share/postgresql/9.1/contrib/postgis-1.5/spatial_ref_sys.sql</pre>

<p>This will hopefully be resolved more elegantly in a later version.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Authentication_(FIXME)"
>Authentication (FIXME)</a></h3>

<p>If running PostgreSQL on the same server as METAMOD, password authentication is not necessary for local connections. Instead you can configure PostgreSQL to automatically accept connections using sockets instead of TCP/IP by editing pg_hba.conf (replace 9.1 with correct version):</p>

<pre>  $ sudo $EDITOR /etc/postgresql/9.1/main/pg_hba.conf</pre>

<p>Then go to the end of the file and change <code>local</code> from &#34;peer&#34; to &#34;trust&#34; at the two places indicated below:</p>

<pre>  # DO NOT DISABLE!
  # If you change this first entry you will need to make sure that the
  # database superuser can access the database using some other method.
  # Noninteractive access to all databases is required during automatic
  # maintenance (custom daily cronjobs, replication, and similar tasks).
  #
  # Database administrative login by Unix domain socket
  #local   all             postgres                                peer  &#60;--- *** CHANGE THIS ***
  local   all             postgres                                trust

  # TYPE  DATABASE        USER            ADDRESS                 METHOD

  # &#34;local&#34; is for Unix domain socket connections only
  #local   all             all                                     peer  &#60;--- *** AND THIS ***
  local   all             all                                     trust
  # IPv4 local connections:
  host    all             all             127.0.0.1/32            md5
  # IPv6 local connections:
  host    all             all             ::1/128                 md5
  # Allow replication connections from localhost, by a user with the
  # replication privilege.
  #local   replication     postgres                                peer
  #host    replication     postgres        127.0.0.1/32            md5
  #host    replication     postgres        ::1/128                 md5</pre>

<p>Then restart PostgreSQL:</p>

<pre>  /etc/init.d/postgresql stop
  /etc/init.d/postgresql start</pre>

<p>Alternatively, use .pgpass (FIXME)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Conclusion"
>Conclusion</a></h2>

<p>You will now have the necessary software installed, however it will not run until you configure and set up a METAMOD application. See <a href="./configuration.html?view=co" class="podlinkpod"
>configuration</a> and <a href="./deploying.html?view=co" class="podlinkpod"
>deploying</a> for further instructions.</p>

<!-- end doc -->

</body></html>
