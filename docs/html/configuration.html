<html><head><title>METAMOD Configuration</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="mmdocs.css?view=co">

</head>
<body class='pod'>
<!--
  generated by Metamod::Pod::Simple::HTML v,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Wed May 29 13:59:36 2013 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Metamod::Pod::Simple::HTML, and/or subclassing Metamod::Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Metamod::Pod::Simple::HTML for advice.
   See 'perldoc Metamod::Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#METAMOD_Configuration'>METAMOD Configuration</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Introduction'>Introduction</a>
    <li class='indexItem indexItem2'><a href='#Example_app'>Example app</a>
    <li class='indexItem indexItem2'><a href='#The_master_config.txt_file'>The master_config.txt file</a>
    <li class='indexItem indexItem2'><a href='#Configuration_defaults'>Configuration defaults</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Config_file_format'>Config file format</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Metadata_sources'>Metadata sources</a>
    <li class='indexItem indexItem2'><a href='#Configuration_of_the_base_application'>Configuration of the base application</a>
    <li class='indexItem indexItem2'><a href='#Configuration_for_the_UPLOAD_module'>Configuration for the UPLOAD module</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#etc%2Fconf_digest_nc.xml'>etc/conf_digest_nc.xml</a>
      <li class='indexItem indexItem3'><a href='#etc%2Fusererrors.conf'>etc/usererrors.conf</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#XSLT'>XSLT</a>
    <li class='indexItem indexItem2'><a href='#Stylesheets_and_other_web_configuration'>Stylesheets and other web configuration</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Overriding_texts'>Overriding texts</a>
      <li class='indexItem indexItem3'><a href='#Overriding_the_CSS'>Overriding the CSS</a>
      <li class='indexItem indexItem3'><a href='#Path_to_images'>Path to images</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METAMOD_Configuration"
>METAMOD Configuration</a></h1>

<p>Back to <a href="./index.html?view=co" class="podlinkpod"
>Index</a></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Introduction"
>Introduction</a></h2>

<p>Each METAMOD application needs a <b>configuration directory</b> where specific properties for the application are decribed.
These properties will include:</p>

<ul>
<li>Which modules are activated for the application</li>

<li>Basic information like domain name and URLs for accessing the web portal,
identification of the application,
directory path for storing runtime information and XML archive,
etc.</li>

<li>Stylesheets and other web configuration</li>

<li>Which search methods available in the metadata data base will be exposed in the web search interface,
and how metadata are presented to the user.</li>

<li>For the base application,
overall information on the metadata categories that are searchable in the matadata data base.</li>

<li>For applications using the UPLOAD module,
which metadata will be extracted from the uploaded netCDF files.</li>
</ul>

<p>The application configuration directory contains a very important file,
the <b>master_config.txt</b> file.
This file governs how METAMOD will run.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Example_app"
>Example app</a></h2>

<p>The EXAMPLE application that is included in this source tree (app/example) can be used to test the software.
The following steps describes how to do this.
Copy the app/example directory to somewhere local,
preferably renaming it to whatever your METAMOD application is called.
Then you are ready to edit the master configuration file.</p>

<pre>  $ cp -r /opt/metno-metamod-2.13/app/example .
  $ mv example myapp</pre>

<p>Then edit <em>myapp/master_config.txt</em> as needed.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_master_config.txt_file"
>The <em>master_config.txt</em> file</a></h2>

<p>Several variables in this file must be adjusted according to the local computer environment. The most important are:</p>

<dl>
<dt><a name="APPLICATION_ID"
>APPLICATION_ID</a></dt>

<dd>
<p>Each application delivering data to a database (an application with the METAMODUPLOAD, METAMODHARVEST and/or the METAMODQUEST module) must have a short name (typical an acronym) that uniquely identify the application for the database. Only upper case letters and numbers are allowed.</p>

<p>For local testing, set APPLICATION_USER to your own login.</p>

<dt><a name="SERVER"
>SERVER</a></dt>

<dd>
<p>The server name on which the software should run (something like mycomputer.mydomain.com).</p>

<dt><a name="ADMIN_DOMAIN"
>ADMIN_DOMAIN</a></dt>

<dd>
<p>This will typically be the domain found in the SERVER variable (like mydomain.com).</p>

<dt><a name="BASE_PART_OF_EXTERNAL_URL"
>BASE_PART_OF_EXTERNAL_URL</a></dt>

<dd>
<p>This is the initial part of URLs that external links to the web applications are to use. It will typically be <a href="http://mycomputer.mydomain.com" class="podlinkurl"
>http://mycomputer.mydomain.com</a> or <a href="http://mycomputer.mydomain.com:8080" class="podlinkurl"
>http://mycomputer.mydomain.com:8080</a> if you are using an unusual port (note: not to be confused with the Catalyst port - usually 3000).</p>

<dt><a name="LOCAL_URL"
>LOCAL_URL</a></dt>

<dd>
<p>Appended to BASE_PART_OF_EXTERNAL_URL, this represents the top URL for the web applications. URLs for the individual applications are constructed by appending directory names for each of the applications to this top URL.</p>

<dt><a name="WEBRUN_DIRECTORY"
>WEBRUN_DIRECTORY</a></dt>

<dd>
<p>The top directory for runtime files, which also contain the XML archive.</p>

<dt><a name="OPENDAP_DIRECTORY"
>OPENDAP_DIRECTORY</a></dt>

<dd>
<p>The top directory of the data repository. This directory is assumed to be accessible through an OPeNDAP server (usually TDS/THREDDS) which has to be installed as a separate package (not part of METAMOD 2.x). If no OPeNDAP server is installed, some of the METAMOD 2.x software will not work. For example, links to OPeNDAP presentation of data files set up automatically by the UPLOAD module will not work.</p>

<dt><a name="OPENDAP_URL"
>OPENDAP_URL</a></dt>

<dd>
<p>The URL used to access the data files. If no OPeNDAP server is installed, use an URL for HTTP download.</p>

<dt><a name="OPERATOR_EMAIL"
>OPERATOR_EMAIL</a></dt>

<dd>
<p>E-mail address for the person responsible for operating the METAMOD 2.x installation.</p>

<dt><a name="SMTP_RELAY"
>SMTP_RELAY</a></dt>

<dd>
<p>If you wish to send email via an external MTA, enter the qualified hostname here. Otherwise it is assumed you are running a local (sendmail-compatible) MTA which is configured correctly (firewall will often block this). See <a href="./deploying.html?view=co" class="podlinkpod"
>Deploying a METAMOD application</a></p>
</dd>
</dl>

<p>The following variables are used to select the modules that will comprise the application. Whereas they previously indicated the absolute path of the source directory for each module, they are now only used as booleans (where any non-empty string means true).</p>

<pre>    METAMODBASE_DIRECTORY
    METAMODUPLOAD_DIRECTORY
    METAMODPMH_DIRECTORY
    METAMODHARVEST_DIRECTORY
    METAMODTHREDDS_DIRECTORY</pre>

<p>If any of these variables are missing, the corresponding module will not be part of the application.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Configuration_defaults"
>Configuration defaults</a></h2>

<p>A complete inventory of the variables that could be part of the <em>master_config.txt</em> file is found in the <em>app/default/default_config.txt</em> file in the installation directory. This also lists default values wherever applicable.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Config_file_format"
>Config file format</a></h3>

<p>The <em>master_config.txt</em> file (and the default and example versions of this file) contain lines as follows:</p>

<pre>    VARNAME = VALUE</pre>

<p><code>VARNAME</code> must start from the first character on the line, and be all uppercase letters [A-Z], underscore or digits. Any number of white space characters may separate <code>VARNAME</code> and &#39;=&#39;, and also &#39;=&#39; and <code>VALUE</code>. <code>VALUE</code> starts with the first non-whitespace character and ends with the last non-whitespace character on the line.</p>

<p>Additional lines may be appended to <code>VALUE</code> immediately after the initial <code>&#34;VARNAME = ...&#34;</code> line. Such lines must start with a space character. No whitespace are removed from such appended lines.</p>

<p>Multi-line directives may also be used to construct key-value-pair lists. In this case the first column contains the key and the rest a value (or list of value). Value containing spaces can be inclosed in quotes (single or double):</p>

<pre>  WMS_PROJECTIONS =
      EPSG:32661      &#39;WGS 84 / UPS North&#39;
      EPSG:32761      &#39;WGS 84 / UPS South&#39;</pre>

<p><code>VALUEs</code> may be empty, which sometimes indicate that some aspect of the software is turned off. An empty value is indicated by having no characters (or only whitespace characters) after the &#39;=&#39; character.</p>

<p>In addition, comment lines, starting with <code>&#39;#&#39;</code>, may be found. Blank lines are ignored (apart from terminating a multi-line directive).</p>

<p>In the source files, all text strings like <code>[==VARNAME==]</code> will be substituted with the corresponding value at runtime when the variable is accessed. Such text strings may also be found within <code>VALUE</code> strings, and they will be substituted as appropriate.</p>

<p>To check current configuration settings, use the <code>lsconf</code> utility, or login to the Admin web interface.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Metadata_sources"
>Metadata sources</a></h2>

<p>METAMOD is able to handle a large range of metadata frameworks. For metadata generated through the UPLOAD module (by parsing netCDF files), METAMOD has defined its own XML format, called MM2. This format has a similar structure as Dublin core; it is a flat structure with freely selected metadata keywords. For each keyword one or more values may be found.</p>

<p>Other metadata frameworks, like DIF or ISO19115, are also accepted, and such frameworks will typically emerge when harvesting from other metadata providers through OAI-PMH. While such frameworks (DIF, ISO19115) are hierarchical in nature, a flattening of these structures takes place when they are imported to the SQL database and presented through the METAMOD search interface.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Configuration_of_the_base_application"
>Configuration of the base application</a></h2>

<p>The base application in a cluster of METAMOD applications has the special responsibility of setting up the static tables in the SQL metadata data base that govern which metadata are available for search in the WEB search interface. This is done through the <b>staticdata/searchdata.xml</b> file in the configuration directory.</p>

<p>This XML file contains metadata vocabularies that are imported into the SQL database, and used in the SEARCH module for setting up the interactive forms for web users searching the database.</p>

<p>Note that this file establish which categories of metadata will be available in the SQL data base. Each application will contain additional configuration that will taylor these possibilities to the needs of that application.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Configuration_for_the_UPLOAD_module"
>Configuration for the UPLOAD module</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="etc/conf_digest_nc.xml"
><em>etc/conf_digest_nc.xml</em></a></h3>

<p>This XML file describes the parsing of netCDF files in the UPLOAD module. Specifically how attributes and variable values in a netCDF file are translated into keyword - value pairs and stored into an MM2 XML file. The <code>conf_digest_nc.xml</code> file will contain rules regarding which metadata are required in the netCDF files. The <code>app/example/etc/conf_digest_nc.xml</code> file represents a well commented example of such a file that can be used as a starting point for a version tailored to specific needs.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="etc/usererrors.conf"
><em>etc/usererrors.conf</em></a></h3>

<p>This file contain html templates that are used in error reports sent to data providers that have uploaded netCDF files using the UPLOAD module. Each template corresponds to an error condition defined in the etc/conf_digest_nc.xml file. An example file in the <code>app/example/etc</code> directory corresponds to the <code>conf_digest_nc.xml</code> in the same directory.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="XSLT"
>XSLT</a></h2>

<p>Files for translating from foreign metadata formats. Currently not in use.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Stylesheets_and_other_web_configuration"
>Stylesheets and other web configuration</a></h2>

<p>METAMOD can be configured with custom texts and stylesheets. To modify the styles of the application add the following directories to your application configuration directory.</p>

<dl>
<dt><a name="custom/templates"
><em>custom/templates</em></a></dt>

<dd>
<p>This directory contains the Template::Toolkit templates that you want to override in your configuration. It is generally never a good idea to override anything other than the <code>custom.tt</code> file.</p>

<dt><a name="custom/static/css"
><em>custom/static/css</em></a></dt>

<dd>
<p>This directory contains the CSS files that you want to override in your configuration. It is generally never a good idea to override anything but the <code>custom.css</code> file in this folder.</p>

<dt><a name="custom/static/images"
><em>custom/static/images</em></a></dt>

<dd>
<p>This folder contains the images that you use in your style configuration.</p>
</dd>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Overriding_texts"
>Overriding texts</a></h3>

<p>To override texts in the application you use the <em>custom.tt</em> file. <em>custom.tt</em> is a file in <i>Template::Toolkit</i> format.</p>

<p>The way it is used is that it re-defines the default texts found in <em>defaults.tt</em>.</p>

<p>For instance the following would re-define the HTML used for the header of the application.</p>

<pre>  [% # get a safe path to the header image that works in both Apache and outside of Apache
     SET header_image_url = c.uri_for(&#39;/static/images/logo.png&#39;);
     app.common.header_html = &#39;&#60;img src=&#34;&#39; _ header_image_url _ &#39;&#34; /&#62;&#39;;
  %]</pre>

<p>In the same way you can re-define any of the variables found in <em>defaults.tt</em></p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Overriding_the_CSS"
>Overriding the CSS</a></h3>

<p>In METAMOD you can override any of the CSS styles in the application using <em>custom.css</em> since this stylesheet will be the last one loaded by the application. It is however wise to <code>only</code> modify properties such as background colors, foreground colors, borders and font size. Modifying the height, width, padding, margins, display type etc. of elements can lead to the application not displaying properly in different browsers. Also modifying these properties can break between different versions of METAMOD.</p>

<p>The style for any element can be modified, but only a few are usually needed. For an example of the common ones see <em>app/example/custom/css/custom.css</em></p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Path_to_images"
>Path to images</a></h3>

<p>One of the most common customisations are adding a logo image to the header and the footer of the page. When adding images to the style it is important to get the path to the image right.</p>

<dl>
<dt><a name="custom.tt"
><em>custom.tt</em></a></dt>

<dd>
<p>To get the path correct in the <em>custom.tt</em> file you can use the following helper function.</p>

<pre> SET image_url = c.uri_for(&#39;/static/images/&#60;your image name here&#62;&#39;);</pre>

<p>This makes a variable <code>image_url</code> that contains the correct URL to the image file.</p>

<dt><a name="custom.css"
><em>custom.css</em></a></dt>

<dd>
<p>To get the path correct in the <em>custom.css</em> file you can use the following path.</p>

<pre>  url(&#34;../images/aboutheader.gif&#34;);</pre>

<p>as in</p>

<pre>  background-image: url(&#34;../images/aboutheader.gif&#34;);</pre>
</dd>
</dl>

<!-- end doc -->

</body></html>
