<html><head><title>Building the METAMOD software</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="mmdocs.css?view=co">

</head>
<body class='pod'>
<!--
  generated by Metamod::Pod::Simple::HTML vv2.0.1,
  using Pod::Simple::PullParser v3.30,
  under Perl v5.014002 at Thu Nov  5 18:43:11 2015 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Metamod::Pod::Simple::HTML, and/or subclassing Metamod::Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Metamod::Pod::Simple::HTML for advice.
   See 'perldoc Metamod::Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<div id='banner'>METAMOD Documentation | <a name='___top' href='index.html'>main menu</a></div>
<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#Building_the_METAMOD_software'>Building the METAMOD software</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Introduction'>Introduction</a>
    <li class='indexItem indexItem2'><a href='#Required_software'>Required software</a>
    <li class='indexItem indexItem2'><a href='#Installation_from_source'>Installation from source</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Download_the_METAMOD_source_code'>Download the METAMOD source code</a>
      <li class='indexItem indexItem3'><a href='#Installing_binary_dependencies'>Installing binary dependencies</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Building_the_Perl_CPAN_libraries'>Building the Perl CPAN libraries</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#METAMOD_dependencies'>METAMOD dependencies</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Building_for_unit_testing_and_normal_development'>Building for unit testing and normal development</a>
        <li class='indexItem indexItem4'><a href='#Adding_new_dependencies'>Adding new dependencies</a>
        <li class='indexItem indexItem4'><a href='#Updating_all_dependencies_to_the_latest_version'>Updating all dependencies to the latest version</a>
        <li class='indexItem indexItem4'><a href='#Running_programs_with_Carton'>Running programs with Carton</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#PERL5LIB'>PERL5LIB</a>
      <li class='indexItem indexItem3'><a href='#Alternate_installation_methods'>Alternate installation methods</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Testing_notes_(TODO)'>Testing notes (TODO)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#How_to_run_unit_tests_from_source'>How to run unit tests from source</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Building_the_METAMOD_software"
>Building the METAMOD software</a></h1>

<p>Back to <a href="./index.html?view=co" class="podlinkpod"
>Index</a></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Introduction"
>Introduction</a></h2>

<p>This describes how to build the METAMOD software on a Linux server.
No services will be available until you configure and set up a METAMOD instance (see <a href="./deploying.html?view=co" class="podlinkpod"
>Deploying a METAMOD application</a>) as well as a database instance.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Required_software"
>Required software</a></h2>

<dl>
<dt><a name="PostgreSQL_database_system"
>PostgreSQL database system</a></dt>

<dd>
<p>The current version requires PostgreSQL 9.1 or later.
It has also been tested on version 8.3 and 8.4,
but some features may not work (in particular some PostGIS projections required for dynamic map search may be missing).
If running a local database you need the PostgreSQL server,
otherwise only the client is required.</p>

<dt><a name="libxml_and_libxslt_library"
>libxml and libxslt library</a></dt>

<dd>
<p>From xmlsoft.org</p>

<dt><a name="Proj4_library"
>Proj4 library</a></dt>

<dd>
<p><a href="http://proj.maptools.org" class="podlinkurl"
>http://proj.maptools.org</a></p>

<dt><a name="NetCDF_software_3.5_or_later"
>NetCDF software 3.5 or later</a></dt>

<dd>
<p>libnetcdf,
ncdump and ncgen</p>

<dt><a name="Apache_2.x_web_server_(optional)"
>Apache 2.x web server (optional)</a></dt>

<dd>
<p>With mod_proxy,
mod_proxy_http and mod_rewrite installed</p>

<dt><a name="FIMEX_(optional,_but_recommended)"
>FIMEX (optional,
but recommended)</a></dt>

<dd>
<p>While not stricly necessary,
FIMEX is required for functionality regarding transformation and OPeNDAP,
as well as running the unit tests.
However,
since it is not available via official Ubuntu repositories it is not a required dependency.
You can find it on <a href="https://launchpad.net/~heiko-klein/+archive/ubuntu/fimex" class="podlinkurl"
>Launchpad</a> (binaries) and in <a href="https://svn.met.no/viewvc/fimex/" class="podlinkurl"
>Subversion</a> (source).</p>

<pre>  $ sudo add-apt-repository ppa:heiko-klein/fimex
  $ sudo apt-get update
  $ sudo apt-get install fimex-bin</pre>
</dd>
</dl>

<p>A complete list of required software can be found in <a href="../../debian/control?view=co" class="podlinkpod"
>&#34;debian/control&#34;</a>. If not running Ubuntu you must figure out the package names in your distro for yourself. As of 2.13, the Build dependency packages for Ubuntu 12.4 are:</p>

<blockquote>
<pre>    postgresql, postgresql-contrib, postgis, postgresql-9.1-postgis,
    debhelper (&#62;=5), perl, make, fakeroot, cpanminus, libproj-dev,
    libgdbm-dev, libpng-dev, libnetcdf-dev, libexpat1-dev, libxml2-dev,
    libxslt1-dev, libssl-dev</pre>
</blockquote>

<p><b>Note:</b> <code>proj</code> seems to have been renamed <code>proj-bin</code> in Ubuntu 14.4. Also you need <code>postgresql-9.3-postgis-2.1</code> instead of <code>postgresql-9.1-postgis</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Installation_from_source"
>Installation from source</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Download_the_METAMOD_source_code"
>Download the METAMOD source code</a></h3>

<p>Check out the METAMOD source code from Subversion into a suitable directory:</p>

<pre>  $ mkdir metamod
  $ cd metamod
  $ svn co https://svn.met.no/metamod/trunk</pre>

<p>A tar.gz file may also be available at a later date.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Installing_binary_dependencies"
>Installing binary dependencies</a></h3>

<p>METAMOD depends on several non-Perl compiled utilities and libraries which must be installed separately, including:</p>

<ul>
<li>PostgreSQL client and optionally server (preferrable 9.1 or later), as well as the DBD driver for Perl DBI</li>

<li>the GNOME LibXML2 and LibXSLT libraries</li>

<li>the Expat XML library</li>

<li>the PROJ.4 Cartographic Projections library from osgeo.org</li>

<li>the OpenSSL Library</li>
</ul>

<p>Installing these via Debial packages using <code>apt-get</code> is recommended if possible. A complete list of the required Debian packages can be found in <em>debian/control</em> under &#39;Depends&#39; and &#39;Build-Depends&#39;.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Building_the_Perl_CPAN_libraries"
>Building the Perl CPAN libraries</a></h2>

<p>When installing from source, you must build the necessary Perl modules from CPAN. This used to be a major chore, but is now possible to do with a single command using the new Perl module dependency manager Carton. You don&#39;t even need to download the tarballs from CPAN as they are already included in the Subversion repo. From 2.14 Carton is even bundled with METAMOD in the <em>vendor/bin</em> directory.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="METAMOD_dependencies"
>METAMOD dependencies</a></h3>

<p>You are now ready to build the Perl dependency libraries. There are two different possible ways, one for unit testing, packaging and deployment when you want an identical environment, and another for development (usually only done when updating modules).</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Building_for_unit_testing_and_normal_development"
>Building for unit testing and normal development</a></h4>

<pre>  $ cd ~/metamod/trunk
  $ make deployment</pre>

<p>Carton will then install the modules listed in <em>cpanfile.snapshot</em> (actually one file per OS version) into <em>~/metamod/trunk/local/lib</em>. No network connection is needed when using <code>make deployment</code> as this uses the modules supplied in <em>~/metamod/trunk/vendor/cache</em>. This should not generate any errors as long as you have installed all the necessary binary libraries as listed above.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Adding_new_dependencies"
>Adding new dependencies</a></h4>

<p>If you are a METAMOD developer and want to add more Perl modules, add the required name and version to <em>cpanfile</em>, then run:</p>

<pre>  $ make deps
  $ make bundle
  $ svn ci</pre>

<p>This will first download and compile the newly added modules, and put the source tarballs into the vendor/cache directory to simplify building later, as well as updating the snapshot file. This must be done for every OS version you want to support.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Updating_all_dependencies_to_the_latest_version"
>Updating all dependencies to the latest version</a></h4>

<p>If you want to update every module to the latest version (or a hardcoded version in cpanfile), delete the <em>local</em> directory and run the previous commands again. Then all version numbers in the snapshot file (for your OS version) will be updated. This should be done only in the beginning of a new METAMOD major version (2.x).</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Running_programs_with_Carton"
>Running programs with Carton</a></h4>

<p>It is possible to run scripts using Carton so you don&#39;t have to set PERL5LIB:</p>

<pre>  ~/metamod/trunk$ vendor/bin/carton exec perl catalyst/script/metamodweb_server.pl --config &#60;dir&#62;</pre>

<p>This is however not necessary when using <code>virtualenv.pl</code>.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="PERL5LIB"
>PERL5LIB</a></h3>

<p>Make sure that <code>CATALYST_LIB</code> is not set in <em>master_config.txt</em>, and your <code>PERL5LIB</code> environment variable is set to point to your local/lib/perl5 directory. This is handled automatically by <code>activate</code> and <em>init.d</em> scripts.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Alternate_installation_methods"
>Alternate installation methods</a></h3>

<p>As usual you could always install the required modules directly from CPAN, although this is a major hassle and you have no way of ensuring you get a working set of libraries (since cpan always pulls down the latest version). However, if you decided to install them outside your normal @INC path you need to specify the location in <code>CATALYST_LIB</code> in master_config.txt, as well as in PERL5LIB when running from the command line (activate_env doesn&#39;t handle this special case yet).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Testing_notes_(TODO)"
>Testing notes (TODO)</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="How_to_run_unit_tests_from_source"
>How to run unit tests from source</a></h3>

<p>First, change Postgres authorization settings as described in &#34;Authentication&#34; in <a href="./installation.html?view=co" class="podlinkpod"
>installation</a>. Then:</p>

<pre>  $ ./common/prepare_runtime_env.sh test/applic/
  $ ./test/short_test_application.sh &#38;&#38; make debian_package</pre>

<p>If uploading package to repo:</p>

<pre>  $ # dupload --to precise-devel --no</pre>

<!-- end doc -->

</body></html>
