<html><head><title>Upgrading to METAMOD 2.8</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="../mmdocs.css?view=co">

</head>
<body class='pod'>
<!--
  generated by Metamod::Pod::Simple::HTML v,
  using Pod::Simple::PullParser v2.02,
  under Perl v5.010001 at Fri Jan 11 13:07:06 2013 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Metamod::Pod::Simple::HTML, and/or subclassing Metamod::Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Metamod::Pod::Simple::HTML for advice.
   See 'perldoc Metamod::Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#Upgrading_to_METAMOD_2.8'>Upgrading to METAMOD 2.8</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#From_version_2.7'>From version 2.7</a>
    <li class='indexItem indexItem2'><a href='#From_version_2.6'>From version 2.6</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Staticdata'>Staticdata</a>
      <li class='indexItem indexItem3'><a href='#Master_configuration'>Master configuration</a>
      <li class='indexItem indexItem3'><a href='#Database'>Database</a>
      <li class='indexItem indexItem3'><a href='#XML_metadata_files'>XML metadata files</a>
      <li class='indexItem indexItem3'><a href='#Installation'>Installation</a>
      <li class='indexItem indexItem3'><a href='#Starting_and_testing'>Starting and testing</a>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_to_METAMOD_2.8"
>Upgrading to METAMOD 2.8</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="From_version_2.7"
>From version 2.7</a></h2>

<p>METAMOD 2.7 was an internal release only,
using Catalyst for the search interface.
Upgrading is mostly the same as 2.6.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="From_version_2.6"
>From version 2.6</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Staticdata"
>Staticdata</a></h3>

<dl>
<dt><a name="staticdata/searchdata.xml"
>staticdata/searchdata.xml</a></dt>

<dd>
<p>All &#60;sc id=&#34;x&#34; type=&#34;x&#34;...&#62; have change to &#60;sc id=&#34;1&#34; idname=&#34;activity_types&#34; type=&#34;basickey&#34;...&#62; (named ids + named rather than numeric types),
see app/example for names and types.</p>

<p>Add dataset_file_location and dataset_file_size (see app/example):</p>

<pre>  &#60;mt name=&#34;data_file_location&#34; share=&#34;FALSE&#34;
   def=&#34;The location of the dataset on disk. Only for level 2 datasets&#34; /&#62;
  &#60;mt name=&#34;data_file_size&#34; share=&#34;FALSE&#34;
   def=&#34;The size of the file in bytes. Only for level 2 datasets&#34; /&#62;</pre>
</dd>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Master_configuration"
>Master configuration</a></h3>

<p>There are several new directives which must be set in master_config. Some examples:</p>

<pre>    APPLICATION_USER - owner of webrun directory and Apache/Catalyst processes
    CATALYST_PORT    - run Catalyst on this port (normally 3000)
    PG_CONTRIB       - Directory for PostgreSQL contrib libs
    LDAP_SERVER      - LDAP server used for authentication
    LDAP_BASE_DN     - base DN for LDAP
    PMH_SYNCHRONIZE_ISO_IDENTIFIER - make OAI-PMH identifier the same as ISO-identifier
    APPLICATION_USER

    WMS_BACKGROUND_MAPSERVER - URL to background map server delivering coastlines and reticules
    WMS_NORTHPOLE_MAP - map names for different projections
    WMS_SOUTHPOLE_MAP - &#34; &#34;
    WMS_WORLD_MAP     - &#34; &#34;</pre>

<p>Site-specific texts are no longer configured in master_config, but instead in a custom Template Toolkit file (applic/custom/templates/custom.tt). Custom images and CSS styles are similarly specified in applic/custom/static. Note that applic/filelist.txt must be updated for the files being copied to target. This concerns the following directives</p>

<pre>    APP_HEADER_HTML
    APP_FOOTER_HTML
    SEARCH_APP_NAME
    SEARCH_APP_TITLE
    SEARCH_APP_HEADER_HTML
    SEARCH_APP_DESCRIPTION
    SEARCH_APP_PRESENTATION_HTML
    UPLOAD_APP_TITLE
    UPLOAD_APP_LOGIN_TEXT
    UPLOAD_APP_INLOGGED_TEXT
    UPLOAD_APP_COMMON_TEXT
    QUEST_TITLE
    QUEST_FORM_DEFINITON_FILE
    QUEST_METADATA_UPLOAD_FORM
    QUEST_SENDER_ADDRESS
    QUEST_RECIPIENTS
    QUEST_OKMESSAGE
    QUEST_ADM_BACKGROUND
    QUEST_ADM_TOPDIR</pre>

<p>The following other directives are also no longer in use and should be removed:</p>

<pre>    ADMIN_DOMAIN
    ADMIN_WEBUSER
    CATALINA_HOME
    CATALYST_SITE_CONFIG
    WMS_URL
    WMS_ONLINE_RESOURCE
    METADATA_SEARCH_URL
    UPLOAD_URL</pre>

<p>SEARCH_CATEGORY_SEQUENCE must now use the alphabetical idnames from searchdata.xml (as modified in previous section) instead of numeric ids. Also, remove dataref from SEARCH_APP_SHOW_COLUMNS.</p>

<p>APP_MENU should no longer include links to the standard sections of the site (METADATA_SEARCH_URL, UPLOAD_URL) since these are now generated by Catalyst. See app/example for more information.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Database"
>Database</a></h3>

<p>Some minor changes to the metadata database. Suggest recreating the database and reimporting the metadata files:</p>

<pre>  cd target/init
  ./create_and_load_all.sh</pre>

<p>The userdatabase has been extensively modified, including support for login roles and SHA1-hashed passwords. Upgrade by running this script:</p>

<pre>  target/userinit/upgradeuserdb_26-28.sh</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="XML_metadata_files"
>XML metadata files</a></h3>

<p>The XML files must be updated to include the attribute &#39;data_file_location&#39;, otherwise collection basket will not work. To update, run the script write_data_file_location.pl against the XML file directory, making sure you have access to the data files (NetCDF) since they must be read simultaneously.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Installation"
>Installation</a></h3>

<p>Generation of Apache config and init scripts are now fully automated. After running update_target.pl you will find the following files in your target directory:</p>

<dl>
<dt><a name="etc/httpd.conf"
>etc/httpd.conf</a></dt>

<dd>
<p>Apache configuration, destined either for /etc/apache2/sites-available (if using DNS-based virtual hosts) or /etc/apache2/conf.d (otherwise).</p>

<dt><a name="etc/init.d/catalyst-myapp"
>etc/init.d/catalyst-myapp</a></dt>

<dd>
<p>Init.d script to start/stop Catalyst.</p>

<dt><a name="metamodInit.sh"
>metamodInit.sh</a></dt>

<dd>
<p>Script to start/stop the main METAMOD services.</p>
</dd>
</dl>

<p>To install these scripts systemwide, run install_jobs.sh from the target directory. You will need sudo permissions to execute it properly (the sudo commands are inside the script). This will place the following symlinks to the target directory:</p>

<dl>
<dt><a name="etc/apache2/conf.d/APPLICATION_ID"
>etc/apache2/conf.d/APPLICATION_ID
<dt><a name="etc/apache2/sites-available/APPLICATION_ID"
>etc/apache2/sites-available/APPLICATION_ID</a></dt>

<dd>
<p>Apache configuration, using either URL-based or DNS-based hosting. For the latter it will also run a2ensite to enable it.</p>

<dt><a name="/etc/init.d/catalyst-APPLICATION_ID"
>/etc/init.d/catalyst-APPLICATION_ID</a></dt>

<dd>
<p>Init.d script to start/stop Catalyst.</p>

<dt><a name="/etc/init.d/metamodServices-APPLICATION_ID"
>/etc/init.d/metamodServices-APPLICATION_ID</a></dt>

<dd>
<p>Actually not a symlink, but a one-line script to run metamodInit.sh as the correct user.</p>
</dd>
</dl>

<p><b>Note:</b> The configuration system is designed to work on a freshly installed Linux. Take care if you have already configured a site manually that it will not conflict with the newly generated config. Installation will abort if there are existing files in /etc with the same names. However, it is still possible if you have configured Apache manually in /etc/apache2/sites-enabled/default that the new directives in conf.d will never be applied. If so please remove your manual configuration to see if METAMOD will run, then reapply your custom config one bit at a time.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Starting_and_testing"
>Starting and testing</a></h3>

<p>See the Deploying manual on how to start/stop METAMOD.</p>

<!-- end doc -->

</body></html>
