<html><head><title>Upgrading to METAMOD 2.13 from 2.12</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="../mmdocs.css?view=co">

</head>
<body class='pod'>
<!--
  generated by Metamod::Pod::Simple::HTML v,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue May 28 12:12:12 2013 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Metamod::Pod::Simple::HTML, and/or subclassing Metamod::Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Metamod::Pod::Simple::HTML for advice.
   See 'perldoc Metamod::Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#Upgrading_to_METAMOD_2.13_from_2.12'>Upgrading to METAMOD 2.13 from 2.12</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#PostgreSQL_9.1'>PostgreSQL 9.1</a>
    <li class='indexItem indexItem2'><a href='#Dependency_libraries'>Dependency libraries</a>
    <li class='indexItem indexItem2'><a href='#WMS_configuration_settings'>WMS configuration settings</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#WMS_background_map_configuration'>WMS background map configuration</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Deprecated_configuration_settings'>Deprecated configuration settings</a>
      </ul>
      <li class='indexItem indexItem3'><a href='#Dynamic_map_search'>Dynamic map search</a>
      <ul   class='indexList indexList4'>
        <li class='indexItem indexItem4'><a href='#Running_under_older_PostgreSQL_version_(8.x)'>Running under older PostgreSQL version (8.x)</a>
      </ul>
    </ul>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_to_METAMOD_2.13_from_2.12"
>Upgrading to METAMOD 2.13 from 2.12</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="PostgreSQL_9.1"
>PostgreSQL 9.1</a></h2>

<p>METAMOD now supports initializing databases on servers running PostgreSQL 9.1.
Previous versions only supported running v.9 clients against v.8 servers.</p>

<p>Support for PostgreSQL 8.2 and earlier have been disabled to avoid unneccessary errors,
but may be reenabled by editing <em>base/init/createdb.sh</em> (ca.
line 80).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Dependency_libraries"
>Dependency libraries</a></h2>

<p>Metamod now contains all necessary Perl dependencies in the Debian package.</p>

<p>If installing from source,
you must build the necessary Perl modulues using Carton.
Unfortunately Carton is currently in heavy development and not available on CPAN in a usable version.
Instead download and install the latest version from <a href="http://search.cpan.org/dist/carton/" class="podlinkurl"
>http://search.cpan.org/dist/carton/</a> using <em>cpanm</em> or whatever.
Then install the dependencies like this:</p>

<pre>  $ cd ~/metamod/trunk
  $ carton install --deployment</pre>

<p>You must also set your PERL5LIB to point to <em>metamod/trunk/local/lib</em> in your environment, or change CATALYST_LIB in master_config (defaults to the Debian install directory):</p>

<pre>  CATALYST_LIB = /opt/metno-metamod-2.13/local/lib/perl5</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="WMS_configuration_settings"
>WMS configuration settings</a></h2>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="WMS_background_map_configuration"
>WMS background map configuration</a></h3>

<p>The WMS background map configuration, which due to technical difficulties was hardcoded in earlier versions is now fully configurable. In addition, several WMS maps have been made available as a public service and are ready configured in default_config:</p>

<p>WMS_MAPS = &#39;EPSG:32661&#39; &#39;http://public-wms.met.no/backgroundmaps/northpole.map&#39; &#39;EPSG:32761&#39; &#39;http://public-wms.met.no/backgroundmaps/southpole.map&#39; &#39;EPSG:4326&#39; &#39;http://public-wms.met.no/backgroundmaps/world.map&#39; &#39;EPSG:3408&#39; &#34;http://public-wms.met.no/backgroundmaps/northpole.map&#34; &#39;EPSG:3409&#39; &#34;http://public-wms.met.no/backgroundmaps/southpole.map&#34; &#39;EPSG:3410&#39; &#39;http://public-wms.met.no/backgroundmaps/world.map&#39; &#39;EPSG:3411&#39; &#34;http://public-wms.met.no/backgroundmaps/northpole.map&#34; &#39;EPSG:3412&#39; &#34;http://public-wms.met.no/backgroundmaps/southpole.map&#34; &#39;EPSG:3413&#39; &#34;http://public-wms.met.no/backgroundmaps/northpole.map&#34; &#39;EPSG:3995&#39; &#34;http://public-wms.met.no/backgroundmaps/northpole.map&#34; &#39;EPSG:3031&#39; &#34;http://public-wms.met.no/backgroundmaps/southpole.map&#34; &#39;EPSG:32633&#39; &#39;http://public-wms.met.no/backgroundmaps/world.map&#39;</p>

<p>To change this, copy the list to master_config and edit as desired.</p>

<p>Names and bounding boxes are also defined in default_config.txt under WMS_PROJECTIONS and WMS_BOUNDING_BOXES, but may be overridden in master_config.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Deprecated_configuration_settings"
>Deprecated configuration settings</a></h4>

<p>The following directives have been deprecated and should be removed from master_config (they are now defined in default_config and only used in case WMS_MAPS should happen to be unset):</p>

<dl>
<dt><a name="WMS_BACKGROUND_MAPSERVER"
>WMS_BACKGROUND_MAPSERVER</a></dt>

<dd>
<dt><a name="WMS_NORTHPOLE_MAP"
>WMS_NORTHPOLE_MAP</a></dt>

<dd>
<dt><a name="WMS_SOUTHPOLE_MAP"
>WMS_SOUTHPOLE_MAP</a></dt>

<dd>
<dt><a name="WMS_WORLD_MAP"
>WMS_WORLD_MAP</a></dt>
</dl>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Dynamic_map_search"
>Dynamic map search</a></h3>

<p>The static maps in the search interface for the non-standard projections EPSG:93031 and 93995 have now been deprecated, in favour of dynamic WMS maps. These will automatically be enabled if any of your search projections (defined in SRID_ID_COLUMNS) have a corresponding URL defined in WMS_MAPS as described above.</p>

<p>From 2.13 the default SRID_ID_COLUMNS are:</p>

<pre>  SRID_ID_COLUMNS = 93995 93031 3995 3031 4326</pre>

<p>The first two are only used for stored searches. The last three are available for dynamic map search using the maps at public-wms.met.no.</p>

<p>To enable new SRIDs you need to re-initialize the metadata database and re-import all datasets (preferably by running <em>create_and_load_all.sh</em>). <b>Make sure to remove/edit any SRID_ID_COLUMNS in master_config so it doesn&#39;t override the default configuration.</b></p>

<p>Since it is not possible to mix static and dynamic maps (and the previous projections EPSG:93031 and 93995 are difficult to support in WMS) you must set up WMS maps for all the additional SRIDS you want to support searching in. Existing stored searches (as in Subscriptions) will continue to run as long as the projections are included in SRID_ID_COLUMNS, but they cannot be edited.</p>

<h4><a class='u' href='#___top' title='click to go to top of document'
name="Running_under_older_PostgreSQL_version_(8.x)"
>Running under older PostgreSQL version (8.x)</a></h4>

<p>WMS map search is officially only supported using PostgreSQL 9.x. For older versions, make sure the new SRIDs are supported in your current version of PostGIS:</p>

<pre>  # select auth_srid from spatial_ref_sys where auth_name=&#39;EPSG&#39; and auth_srid in(3995, 3031, 4326);
   auth_srid
  -----------
        4326
        3031
        3995
  (3 rows)</pre>

<p>In case any of these projections are missing you must either install support for them using data from <a href="http://spatialreference.org/" class="podlinkurl"
>http://spatialreference.org/</a> or remove them from SRID_ID_COLUMNS, otherwise <em>createdb.sh</em> will probably fail.</p>

<!-- end doc -->

</body></html>
