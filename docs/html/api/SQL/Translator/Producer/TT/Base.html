<html><head><title>SQL::Translator::Producer::TT::Base</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:26 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#SUB_CLASS_HOOKS'>SUB CLASS HOOKS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#tt_config'>tt_config</a>
    <li class='indexItem indexItem2'><a href='#tt_schema'>tt_schema</a>
    <li class='indexItem indexItem2'><a href='#tt_vars'>tt_vars</a>
    <li class='indexItem indexItem2'><a href='#tt_default_vars'>tt_default_vars</a>
    <li class='indexItem indexItem2'><a href='#pre_process_schema'>pre_process_schema</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PRODUCER_OBJECT'>PRODUCER OBJECT</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new'>new</a>
    <li class='indexItem indexItem2'><a href='#translator'>translator</a>
    <li class='indexItem indexItem2'><a href='#schema'>schema</a>
    <li class='indexItem indexItem2'><a href='#run'>run</a>
    <li class='indexItem indexItem2'><a href='#args'>args</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#TODO'>TODO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>SQL::Translator::Producer::TT::Base - TT (Template Toolkit) based Producer base class.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre> # Create a producer using a template in the __DATA__ section.
 package SQL::Translator::Producer::Foo;

 use base qw/SQL::Translator::Producer::TT::Base/;

 # Convert produce call into a method call on our new class
 sub produce { return __PACKAGE__-&#62;new( translator =&#62; shift )-&#62;run; };

 # Configure the Template object.
 sub tt_config { ( INTERPOLATE =&#62; 1 ); }

 # Extra vars to add to the template
 sub tt_vars { ( foo =&#62; &#34;bar&#34; ); }

 # Put template in DATA section (or use file with ttfile producer arg)
 __DATA__
 Schema

 Database: [% schema.database %]
 Foo: $foo
 ...</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>A base class producer designed to be sub-classed to create new TT based producers cheaply - by simply giving the template to use and sprinkling in some extra template variables and config.</p>

<p>You can find an introduction to this module in <a href="../../../../SQL/Translator/Manual.html" class="podlinkpod"
>SQL::Translator::Manual</a>.</p>

<p>The 1st thing the module does is convert the produce sub routine call we get from SQL::Translator into a method call on an object, which we can then sub-class. This is done with the following code which needs to appear in <b>all</b> sub classes.</p>

<pre> # Convert produce call into an object method call
 sub produce { return __PACKAGE__-&#62;new( translator =&#62; shift )-&#62;run; };</pre>

<p>See <a href="#PRODUCER_OBJECT" class="podlinkpod"
>&#34;PRODUCER OBJECT&#34;</a> below for details.</p>

<p>The upshot of this is we can make new template producers by sub classing this base class, adding the above snippet and a template. The module also provides a number of hooks into the templating process, see <a href="#SUB_CLASS_HOOKS" class="podlinkpod"
>&#34;SUB CLASS HOOKS&#34;</a> for details.</p>

<p>See the <a href="../../../../SYNOPSIS.html" class="podlinkpod"
>SYNOPSIS</a> above for an example of creating a simple producer using a single template stored in the producers DATA section.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SUB_CLASS_HOOKS"
>SUB CLASS HOOKS</a></h1>

<p>Sub-classes can override these methods to control the templating by giving the template source, adding variables and giving config to the Tempate object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="tt_config"
>tt_config</a></h2>

<pre> sub tt_config { ( INTERPOLATE =&#62; 1 ); }</pre>

<p>Return hash of Template config to add to that given to the <a href="../../../../Template.html" class="podlinkpod"
>Template</a> <code>new</code> method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="tt_schema"
>tt_schema</a></h2>

<pre> sub tt_schema { &#34;foo.tt&#34;; }
 sub tt_schema { local $/ = undef; \&#60;DATA&#62;; }</pre>

<p>The template to use, return a file name or a scalar ref of TT source, or an <a href="../../../../IO/Handle.html" class="podlinkpod"
>IO::Handle</a>. See <a href="../../../../Template.html" class="podlinkpod"
>Template</a> for details, as the return from this is passed on to it&#39;s <code>produce</code> method.</p>

<p>The default implimentation uses the producer arg <code>ttfile</code> as a filename to read the template from. If the arg isn&#39;t there it will look for a <code>__DATA__</code> section in the class, reading it as template source if found. Returns undef if both these fail, causing the produce call to fail with a &#39;no template!&#39; error.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="tt_vars"
>tt_vars</a></h2>

<pre> sub tt_vars { ( foo =&#62; &#34;bar&#34; ); }</pre>

<p>Return hash of template vars to use in the template. Nothing added here by default, but see <a href="../../../../tt_default_vars.html" class="podlinkpod"
>tt_default_vars</a> for the variables you get for free.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="tt_default_vars"
>tt_default_vars</a></h2>

<p>Return a hash-ref of the default vars given to the template. You wouldn&#39;t normally over-ride this, just inherit the default implimentation, to get the <code>translator</code> &#38; <code>schema</code> variables, then over-ride <a href="../../../../tt_vars.html" class="podlinkpod"
>tt_vars</a> to add your own.</p>

<p>The current default variables are:</p>

<dl>
<dt><a name="schema"
>schema</a></dt>

<dd>
<p>The schema to template.</p>

<dt><a name="translator"
>translator</a></dt>

<dd>
<p>The <a href="../../../../SQL/Translator.html" class="podlinkpod"
>SQL::Translator</a> object.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="pre_process_schema"
>pre_process_schema</a></h2>

<p>WARNING: This method is Experimental so may change!</p>

<p>Called with the <a href="../../../../SQL/Translator/Schema.html" class="podlinkpod"
>SQL::Translator::Schema</a> object and should return one (it doesn&#39;t have to be the same one) that will become the <code>schema</code> varibale used in the template.</p>

<p>Gets called from tt_default_vars.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PRODUCER_OBJECT"
>PRODUCER OBJECT</a></h1>

<p>The rest of the methods in the class set up a sub-classable producer object. You normally just inherit them.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new"
>new</a></h2>

<pre> my $tt_producer = TT::Base-&#62;new( translator =&#62; $translator );</pre>

<p>Construct a new TT Producer object. Takes a single, named arg of the <a href="../../../../SQL/Translator.html" class="podlinkpod"
>SQL::Translator</a> object running the translation. Dies if this is not given.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="translator"
>translator</a></h2>

<p>Return the <a href="../../../../SQL/Translator.html" class="podlinkpod"
>SQL::Translator</a> object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="schema"
>schema</a></h2>

<p>Return the <a href="../../../../SQL/Translator/Schema.html" class="podlinkpod"
>SQL::Translator::Schema</a> we are translating. This is equivilent to <code>$tt_producer-&#62;translator-&#62;schema</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="run"
>run</a></h2>

<p>Called to actually produce the output, calling the sub class hooks. Returns the produced text.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="args"
>args</a></h2>

<p>Util wrapper method around <code>TT::Base-&#62;translator-&#62;producer_args</code> for (mostley) readonly access to the producer args. How it works depends on the number of arguments you give it and the context.</p>

<pre> No args - Return hashref (the actual hash in Translator) or hash of args.
 1 arg   - Return value of the arg with the passed name.
 2+ args - List of names. In list context returns values of the given arg
           names, returns as a hashref in scalar context. Any names given
           that don&#39;t exist in the args are returned as undef.</pre>

<p>This is still a bit messy but is a handy way to access the producer args when you use your own to drive the templating.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../../../perl.html" class="podlinkpod"
>perl</a>, <a href="../../../../SQL/Translator.html" class="podlinkpod"
>SQL::Translator</a>, <a href="../../../../Template.html" class="podlinkpod"
>Template</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TODO"
>TODO</a></h1>

<p>- Add support for a sqlf template repository, set as an INCLUDE_PATH, so that sub-classes can easily include file based templates using relative paths.</p>

<p>- Pass in template vars from the producer args and command line.</p>

<p>- Merge in TT::Table.</p>

<p>- Hooks to pre-process the schema and post-process the output.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Mark Addison &#60;grommit@users.sourceforge.net&#62;.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
