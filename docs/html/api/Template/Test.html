<html><head><title>Template::Test</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:27 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#PACKAGE_SUBROUTINES'>PACKAGE SUBROUTINES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#text_expect()'>text_expect()</a>
    <li class='indexItem indexItem2'><a href='#ntests()'>ntests()</a>
    <li class='indexItem indexItem2'><a href='#ok(%24test)'>ok($test)</a>
    <li class='indexItem indexItem2'><a href='#not_ok(%24test)'>not_ok($test)</a>
    <li class='indexItem indexItem2'><a href='#callsign()'>callsign()</a>
    <li class='indexItem indexItem2'><a href='#banner()'>banner()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PACKAGE_VARIABLES'>PACKAGE VARIABLES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%24DEBUG'>$DEBUG</a>
    <li class='indexItem indexItem2'><a href='#%24PRESERVE'>$PRESERVE</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#HISTORY'>HISTORY</a>
  <li class='indexItem indexItem1'><a href='#BUGS_%2F_KNOWN_%22FEATURES%22'>BUGS / KNOWN &#34;FEATURES&#34;</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Template::Test - Module for automating TT2 test scripts</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    use Template::Test;
   
    $Template::Test::DEBUG = 0;   # set this true to see each test running
    $Template::Test::EXTRA = 2;   # 2 extra tests follow test_expect()...
    
    # ok() can be called any number of times before test_expect
    ok( $true_or_false )
    
    # test_expect() splits $input into individual tests, processes each 
    # and compares generated output against expected output
    test_expect($input, $template, \%replace );
    
    # $input is text or filehandle (e.g. DATA section after __END__)
    test_expect( $text );
    test_expect( \*DATA );
    
    # $template is a Template object or configuration hash
    my $template_cfg = { ... };
    test_expect( $input, $template_cfg );
    my $template_obj = Template-&#62;new($template_cfg);
    test_expect( $input, $template_obj );
    
    # $replace is a hash reference of template variables
    my $replace = {
        a =&#62; &#39;alpha&#39;,
        b =&#62; &#39;bravo&#39;
    };
    test_expect( $input, $template, $replace );
    
    # ok() called after test_expect should be declared in $EXTRA (2)
    ok( $true_or_false )   
    ok( $true_or_false )   </pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The <code>Template::Test</code> module defines the <a href="../test_expect().html" class="podlinkpod"
>test_expect()</a> and other related subroutines which can be used to automate test scripts for the Template Toolkit. See the numerous tests in the <em>t</em> sub-directory of the distribution for examples of use.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PACKAGE_SUBROUTINES"
>PACKAGE SUBROUTINES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="text_expect()"
>text_expect()</a></h2>

<p>The <code>test_expect()</code> subroutine splits an input document into a number of separate tests, processes each one using the Template Toolkit and then compares the generated output against an expected output, also specified in the input document. It generates the familiar <code>ok</code>/<code>not ok</code> output compatible with <code>Test::Harness</code>.</p>

<p>The test input should be specified as a text string or a reference to a filehandle (e.g. <code>GLOB</code> or <code>IO::Handle</code>) from which it can be read. In particular, this allows the test input to be placed after the <code>__END__</code> marker and read via the <code>DATA</code> filehandle.</p>

<pre>    use Template::Test;
    
    test_expect(\*DATA);
    
    __END__
    # this is the first test (this is a comment)
    -- test --
    blah blah blah [% foo %]
    -- expect --
    blah blah blah value_of_foo
    
    # here&#39;s the second test (no surprise, so is this)
    -- test --
    more blah blah [% bar %]
    -- expect --
    more blah blah value_of_bar</pre>

<p>Blank lines between test sections are generally ignored. Any line starting with <code>#</code> is treated as a comment and is ignored.</p>

<p>The second and third parameters to <code>test_expect()</code> are optional. The second may be either a reference to a Template object which should be used to process the template fragments, or a reference to a hash array containing configuration values which should be used to instantiate a new Template object.</p>

<pre>    # pass reference to config hash
    my $config = {
        INCLUDE_PATH =&#62; &#39;/here/there:/every/where&#39;,
        POST_CHOMP   =&#62; 1,
    };
    test_expect(\*DATA, $config);
    
    # or create Template object explicitly
    my $template = Template-&#62;new($config);
    test_expect(\*DATA, $template);</pre>

<p>The third parameter may be used to reference a hash array of template variable which should be defined when processing the tests. This is passed to the <a href="../Template.html" class="podlinkpod"
>Template</a> <a href="../Template%23process().html" class="podlinkpod"
>process()</a> method.</p>

<pre>    my $replace = {
        a =&#62; &#39;alpha&#39;,
        b =&#62; &#39;bravo&#39;,
    };
    
    test_expect(\*DATA, $config, $replace);</pre>

<p>The second parameter may be left undefined to specify a default <a href="../Template.html" class="podlinkpod"
>Template</a> configuration.</p>

<pre>    test_expect(\*DATA, undef, $replace);</pre>

<p>For testing the output of different <a href="../Template.html" class="podlinkpod"
>Template</a> configurations, a reference to a list of named <a href="../Template.html" class="podlinkpod"
>Template</a> objects also may be passed as the second parameter.</p>

<pre>    my $tt1 = Template-&#62;new({ ... });
    my $tt2 = Template-&#62;new({ ... });
    my @tts = [ one =&#62; $tt1, two =&#62; $tt1 ];</pre>

<p>The first object in the list is used by default. Other objects may be switched in with a &#39;<code>-- use $name --</code>&#39; marker. This should immediately follow a &#39;<code>-- test --</code>&#39; line. That object will then be used for the rest of the test, or until a different object is selected.</p>

<pre>    -- test --
    -- use one --
    [% blah %]
    -- expect --
    blah, blah
    
    -- test --
    still using one...
    -- expect --
    ...
    
    -- test --
    -- use two --
    [% blah %]
    -- expect --
    blah, blah, more blah</pre>

<p>The <code>test_expect()</code> sub counts the number of tests, and then calls <a href="../ntests().html" class="podlinkpod"
>ntests()</a> to generate the familiar &#34;<code>1..$ntests\n</code>&#34; test harness line. Each test defined generates two test numbers. The first indicates that the input was processed without error, and the second that the output matches that expected.</p>

<p>Additional test may be run before <code>test_expect()</code> by calling <a href="../ok().html" class="podlinkpod"
>ok()</a>. These test results are cached until <a href="../ntests().html" class="podlinkpod"
>ntests()</a> is called and the final number of tests can be calculated. Then, the &#34;<code>1..$ntests</code>&#34; line is output, along with &#34;<code>ok $n</code>&#34; / &#34;<code>not ok $n</code>&#34; lines for each of the cached test result. Subsequent calls to <a href="../ok().html" class="podlinkpod"
>ok()</a> then generate an output line immediately.</p>

<pre>    my $something = SomeObject-&#62;new();
    ok( $something );
    
    my $other = AnotherThing-&#62;new();
    ok( $other );
    
    test_expect(\*DATA);</pre>

<p>If any tests are to follow after <code>test_expect()</code> is called then these should be pre-declared by setting the <code>$EXTRA</code> package variable. This value (default: <code>0</code>) is added to the grand total calculated by <a href="../ntests().html" class="podlinkpod"
>ntests()</a>. The results of the additional tests are also registered by calling <a href="../ok().html" class="podlinkpod"
>ok()</a>.</p>

<pre>    $Template::Test::EXTRA = 2;
    
    # can call ok() any number of times before test_expect()
    ok( $did_that_work );             
    ok( $make_sure );
    ok( $dead_certain ); 
    
    # &#60;some&#62; number of tests...
    test_expect(\*DATA, $config, $replace);
    
    # here&#39;s those $EXTRA tests
    ok( defined $some_result &#38;&#38; ref $some_result eq &#39;ARRAY&#39; );
    ok( $some_result-&#62;[0] eq &#39;some expected value&#39; );</pre>

<p>If you don&#39;t want to call <code>test_expect()</code> at all then you can call <code>ntests($n)</code> to declare the number of tests and generate the test header line. After that, simply call <a href="../ok().html" class="podlinkpod"
>ok()</a> for each test passing a true or false values to indicate that the test passed or failed.</p>

<pre>    ntests(2);
    ok(1);
    ok(0);</pre>

<p>If you&#39;re really lazy, you can just call <a href="../ok().html" class="podlinkpod"
>ok()</a> and not bother declaring the number of tests at all. All tests results will be cached until the end of the script and then printed in one go before the program exits.</p>

<pre>    ok( $x );
    ok( $y );</pre>

<p>You can identify only a specific part of the input file for testing using the &#39;<code>-- start --</code>&#39; and &#39;<code>-- stop --</code>&#39; markers. Anything before the first &#39;<code>-- start --</code>&#39; is ignored, along with anything after the next &#39;<code>-- stop --</code>&#39; marker.</p>

<pre>    -- test --
    this is test 1 (not performed)
    -- expect --
    this is test 1 (not performed)
    
    -- start --
    
    -- test --
    this is test 2
    -- expect --
    this is test 2
        
    -- stop --
    
    ...</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ntests()"
>ntests()</a></h2>

<p>Subroutine used to specify how many tests you&#39;re expecting to run.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ok($test)"
>ok($test)</a></h2>

<p>Generates an &#34;<code>ok $n</code>&#34; or &#34;<code>not ok $n</code>&#34; message if <code>$test</code> is true or false.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="not_ok($test)"
>not_ok($test)</a></h2>

<p>The logical inverse of <a href="../ok().html" class="podlinkpod"
>ok()</a>. Prints an &#34;<code>ok $n</code>&#34; message is <code>$test</code> is <i>false</i> and vice-versa.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="callsign()"
>callsign()</a></h2>

<p>For historical reasons and general utility, the module also defines a <code>callsign()</code> subroutine which returns a hash mapping the letters <code>a</code> to <code>z</code> to their phonetic alphabet equivalent (e.g. radio callsigns). This is used by many of the test scripts as a known source of variable values.</p>

<pre>    test_expect(\*DATA, $config, callsign());</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="banner()"
>banner()</a></h2>

<p>This subroutine prints a simple banner including any text passed as parameters. The <code>$DEBUG</code> variable must be set for it to generate any output.</p>

<pre>    banner(&#39;Testing something-or-other&#39;);</pre>

<p>example output:</p>

<pre>    #------------------------------------------------------------
    # Testing something-or-other (27 tests completed)
    #------------------------------------------------------------</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PACKAGE_VARIABLES"
>PACKAGE VARIABLES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$DEBUG"
>$DEBUG</a></h2>

<p>The $DEBUG package variable can be set to enable debugging mode.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$PRESERVE"
>$PRESERVE</a></h2>

<p>The $PRESERVE package variable can be set to stop the test_expect() from converting newlines in the output and expected output into the literal strings &#39;\n&#39;.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="HISTORY"
>HISTORY</a></h1>

<p>This module started its butt-ugly life as the <code>t/texpect.pl</code> script. It was cleaned up to became the <code>Template::Test</code> module some time around version 0.29. It underwent further cosmetic surgery for version 2.00 but still retains some remarkable rear-end resemblances.</p>

<p>Since then the <code>Test::More</code> and related modules have appeared on CPAN making this module mostly, but not entirely, redundant.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS_/_KNOWN_&#34;FEATURES&#34;"
>BUGS / KNOWN &#34;FEATURES&#34;</a></h1>

<p>Imports all methods by default. This is generally a Bad Thing, but this module is only used in test scripts (i.e. at build time) so a) we don&#39;t really care and b) it saves typing.</p>

<p>The line splitter may be a bit dumb, especially if it sees lines like <code>-- this --</code> that aren&#39;t supposed to be special markers. So don&#39;t do that.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Andy Wardley &#60;abw@wardley.org&#62; <a href="http://wardley.org/" class="podlinkurl"
>http://wardley.org/</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright (C) 1996-2007 Andy Wardley. All Rights Reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../Template.html" class="podlinkpod"
>Template</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
