<html><head><title>POE::Resource::Clock</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:26 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#USE_POSIXRT'>USE_POSIXRT</a>
    <li class='indexItem indexItem2'><a href='#USE_STATIC_EPOCH'>USE_STATIC_EPOCH</a>
    <li class='indexItem indexItem2'><a href='#USE_EXACT_EPOCH'>USE_EXACT_EPOCH</a>
    <li class='indexItem indexItem2'><a href='#USE_HIRES'>USE_HIRES</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#EXPORTS'>EXPORTS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#mono2wall'>mono2wall</a>
    <li class='indexItem indexItem2'><a href='#monotime'>monotime</a>
    <li class='indexItem indexItem2'><a href='#sleep'>sleep</a>
    <li class='indexItem indexItem2'><a href='#time'>time</a>
    <li class='indexItem indexItem2'><a href='#wall2mono'>wall2mono</a>
    <li class='indexItem indexItem2'><a href='#walltime'>walltime</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS_%26_COPYRIGHTS'>AUTHORS &#38; COPYRIGHTS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>POE::Resource::Clock - internal clock used for ordering the queue</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    sub POE::Kernel::USE_POSIXRT { 0 }
    use POE;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>POE::Resource::Clock is a helper module for POE::Kernel. It provides the features to keep an internal monotonic clock and a wall clock. It also converts between this monotonic clock and the wall clock.</p>

<p>The monotonic clock is used to keep an ordered queue of events. The wall clock is used to comunicate the time with user code (<a href="../../POE/Kernel.html#alarm_set" class="podlinkpod"
>&#34;alarm_set&#34; in POE::Kernel</a>, <a href="../../POE/Kernel.html#alarm_remove" class="podlinkpod"
>&#34;alarm_remove&#34; in POE::Kernel</a>).</p>

<p>There are 3 possible clock sources in order of preference: <a href="../../POSIX/RT/Clock.html" class="podlinkpod"
>POSIX::RT::Clock</a>, <a href="../../Time/HiRes.html" class="podlinkpod"
>Time::HiRes</a> and <a href="../../perlfunc.html#time" class="podlinkpod"
>&#34;time&#34; in perlfunc</a>. Only <code>POSIX::RT::Clock</code> has a seperate monotonic and wall clock; the other two use the same source for both clocks.</p>

<p>Clock selection and behaviour is controled with the following:</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="USE_POSIXRT"
>USE_POSIXRT</a></h2>

<pre>    export POE_USE_POSIXRT=0
        or
    sub POE::Kernel::USE_POSIXRT { 0 }</pre>

<p>Uses the <code>monotonic</code> clock source for queue priority and the <code>realtime</code> clock source for wall clock. Not used if POSIX::RT::Clock is not installed or your system does not have a <code>monotonic</code> clock.</p>

<p>Defaults to true. If you want the old POE behaviour, set this to 0.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="USE_STATIC_EPOCH"
>USE_STATIC_EPOCH</a></h2>

<pre>    export POE_USE_STATIC_EPOCH=0
        or
    sub POE::Kernel::USE_STATIC_EPOCH { 0 }</pre>

<p>The epoch of the POSIX::RT::Clock monotonic is different from that of the realtime clock. For instance on Linux 2.6.18, the monotonic clock is the number of seconds since system boot. This epoch is used to convert from walltime into monotonic time for <a href="../../POE/Kernel.html#alarm" class="podlinkpod"
>&#34;alarm&#34; in POE::Kernel</a>, <a href="../../POE/Kernel.html#alarm_add" class="podlinkpod"
>&#34;alarm_add&#34; in POE::Kernel</a> and <a href="../../POE/Kernel.html#alarm_set" class="podlinkpod"
>&#34;alarm_set&#34; in POE::Kernel</a>. If <code>USE_STATIC_EPOCH</code> is true (the default), then the epoch is calculated at load time. If false, the epoch is calculated each time it is needed.</p>

<p>Defaults to true. Only relevant for if using POSIX::RT::Clock. Long-running POE servers should have this set to false so that system clock skew does mess up the queue.</p>

<p>It is important to point out that without a static epoch, the ordering of the following two alarms is undefined.</p>

<pre>    $poe_kernel-&#62;alarm_set( a1 =&#62; $time );
    $poe_kernel-&#62;alarm_set( a2 =&#62; $time );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="USE_EXACT_EPOCH"
>USE_EXACT_EPOCH</a></h2>

<pre>    export POE_USE_EXACT_EPOCH=1
        or
    sub POE::Kernel::USE_EACT_EPOCH { 1 }</pre>

<p>There currently no way to exactly get the monotonic clock&#39;s epoch. Instead the difference between the current monotonic clock value to the realtime clock&#39;s value is used. This is obviously inexact because there is a slight delay between the 2 system calls. Setting USE_EXACT_EPOCH to true will calculate an average of this difference over 250 ms or at least 20 samples. What&#39;s more, the system calls are done in both orders (monotonic then realtime, realtime then monotonic) to try and get a more eact value.</p>

<p>Defaults to false. Only relevant if <a href="#USE_STATIC_EPOCH" class="podlinkpod"
>&#34;USE_STATIC_EPOCH&#34;</a> is true.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="USE_HIRES"
>USE_HIRES</a></h2>

<pre>    export POE_USE_HIRES=0
        or
    sub POE::Kernel::USE_HIRES { 0 }</pre>

<p>Use <a href="../../Time/HiRes.html" class="podlinkpod"
>Time::HiRes</a> as both monotonic and wall clock source. This was POE&#39;s previous default clock.</p>

<p>Defaults to true. Only relevant if <a href="#USE_POSIXRT" class="podlinkpod"
>&#34;USE_POSIXRT&#34;</a> is false. Set this to false to use <a href="../../perlfunc.html#time" class="podlinkpod"
>&#34;time&#34; in perlfunc</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXPORTS"
>EXPORTS</a></h1>

<p>This module optionally exports a few timekeeping helper functions.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="mono2wall"
>mono2wall</a></h2>

<p>mono2wall() converts a monotonic time to an epoch wall time.</p>

<pre>  my $wall = mono2wall( $monotonic );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="monotime"
>monotime</a></h2>

<p>monotime() makes a best-effort attempt to return the time from a monotonic system clock. It may fall back to non-monotonic time if there are no monotonic clocks available.</p>

<pre>  my $monotonic = monotime();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="sleep"
>sleep</a></h2>

<p>sleep() makes a best-effort attempt to sleep a particular amount of high-resolution time using a monotonic clock. This feature will degrade gracefully to non-monotonic high-resolution clocks, then low-resolution clocks, depending on available libraries.</p>

<pre>  sleep( 3.141 );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="time"
>time</a></h2>

<p>time() is a backwards compatible alias for walltime(). Please see walltime()&#39;s documentation for details.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="wall2mono"
>wall2mono</a></h2>

<p>wall2mono() makes a best-effort attempt to convert wall time to its equivalent monotonic-clock time. Its feature degrades gracefully depending on clock availability.</p>

<pre>  my $monotonic = wall2mono( $epoch );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="walltime"
>walltime</a></h2>

<p>time() makes a best-effort attempt to return non-monotonic wall time at the highest available resolution known.</p>

<pre>  my $epoch = walltime();</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p>See <a href="../../POE/Resource.html" class="podlinkpod"
>POE::Resource</a> for general discussion about resources and the classes that manage them.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<p>None known.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS_&#38;_COPYRIGHTS"
>AUTHORS &#38; COPYRIGHTS</a></h1>

<p>Please see <a href="../../POE.html" class="podlinkpod"
>POE</a> for more information about authors and contributors.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
