<html><head><title>POE::Queue</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:25 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#POE%3A%3AQueue_Items'>POE::Queue Items</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Public_Methods'>Public Methods</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new'>new</a>
    <li class='indexItem indexItem2'><a href='#enqueue_PRIORITY%2C_PAYLOAD'>enqueue PRIORITY, PAYLOAD</a>
    <li class='indexItem indexItem2'><a href='#dequeue_next'>dequeue_next</a>
    <li class='indexItem indexItem2'><a href='#get_next_priority'>get_next_priority</a>
    <li class='indexItem indexItem2'><a href='#get_item_count'>get_item_count</a>
    <li class='indexItem indexItem2'><a href='#remove_item_ITEM_ID%2C_FILTER_FUNCTION'>remove_item ITEM_ID, FILTER_FUNCTION</a>
    <li class='indexItem indexItem2'><a href='#remove_items_FILTER_FUNCTION_%5B%2C_MAX_ITEM_COUNT_%5D'>remove_items FILTER_FUNCTION [, MAX_ITEM_COUNT ]</a>
    <li class='indexItem indexItem2'><a href='#peek_items_FILTER_FUNCTION_%5B%2C_MAX_ITEM_COUNT_%5D'>peek_items FILTER_FUNCTION [, MAX_ITEM_COUNT ]</a>
    <li class='indexItem indexItem2'><a href='#adjust_priority_ITEM_ID%2C_FILTER_FUNCTION%2C_DELTA'>adjust_priority ITEM_ID, FILTER_FUNCTION, DELTA</a>
    <li class='indexItem indexItem2'><a href='#set_priority_ITEM_ID%2C_FILTER_FUNCTION%2C_ABSOLUTE_PRIORITY'>set_priority ITEM_ID, FILTER_FUNCTION, ABSOLUTE_PRIORITY</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS_%26_COPYRIGHTS'>AUTHORS &#38; COPYRIGHTS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>POE::Queue - a flexible,
generic priority queue API</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>POE::Queue specifies additional methods not illustrated here.</p>

<pre>  #!perl

  use warnings;
  use strict;
  use POE::Queue::Array;

  my $pqa = POE::Queue::Array-&#62;new();

  # Enqueue a few items.

  foreach my $priority (505, 404, 303, 202, 101) {
    $pqa-&#62;enqueue($priority, &#34;payload $priority&#34;);
  }

  # Dequeue until the queue is drained.

  while (1) {
    my ($priority, $queue_id, $payload) = $pqa-&#62;dequeue_next();
    last unless defined $priority;

    print(
      &#34;dequeued id($queue_id) &#34;,
      &#34;priority($priority) &#34;,
      &#34;payload($payload)\n&#34;,
    );
  }</pre>

<p>Sample output:</p>

<pre>  dequeued id(5) priority(101) payload(payload 101)
  dequeued id(4) priority(202) payload(payload 202)
  dequeued id(3) priority(303) payload(payload 303)
  dequeued id(2) priority(404) payload(payload 404)
  dequeued id(1) priority(505) payload(payload 505)</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Priority queues may be implemented a number of ways, but they tend to behave similar to lists that are kept in order by some kind of &#34;priority&#34;. Enqueued items are stored such that the &#34;next&#34; item to be retrieved is the one with the highest priority. Subsequent fetches return the next lowest priority, and so on, until the queue is emptied.</p>

<p>Priority queues (also known as priority heaps) attempt to do this while consuming the fewest resources. Go read about it! It&#39;s fascinating stuff!</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="POE::Queue_Items"
>POE::Queue Items</a></h2>

<p>POE::Queue items consist of three fields: A priority, a unique ID assigned at enqueue time, and a payload. The priority and payload are specified by the caller, and the unique ID is generated by POE::Queue when an item is enqueued.</p>

<p>POE::Queue imposes two limitations on priorities: Priorities must be numeric, and lower numbers indicate higher priorities. Aside from that, POE::Queue doesn&#39;t care what the numbers mean.</p>

<p>Unique IDs are handles into the queue. POE::Queue generates and returns them as new items are enqueued. Some methods manipulate items, and they take IDs to identify the items to alter.</p>

<p>Item payloads are arbitrary application data. POE::Queue does not examine or alter payloads itself. Any methods that need to examine payloads will accept a filter function. Filter functions examine payloads so POE::Queue need not.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Public_Methods"
>Public Methods</a></h1>

<p>POE::Queue is an API specification. Subclasses like <a href="../POE/Queue/Array.html" class="podlinkpod"
>POE::Queue::Array</a> provide actual implementations.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new"
>new</a></h2>

<p>Creates a new priority queue. Returns a reference to the queue.</p>

<pre>  my $queue = POE::Queue::Array-&#62;new();</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="enqueue_PRIORITY,_PAYLOAD"
>enqueue PRIORITY, PAYLOAD</a></h2>

<p>Enqueues a PAYLOAD, which can be just about anything that will fit into a Perl scalar, at a particular PRIORITY level. enqueue() returns a unique ID which can be used to manipulate the payload or its priority directly.</p>

<p>Following the UNIX tradition, lower priority numbers indicate higher priorities. The payload with the lowest priority number will be dequeued first. If two payloads have the same PRIORITY, then they will be dequeued in the order in which they were enqueued.</p>

<p>In this example, a queue is used to manage a number of alarms. The &#34;next&#34; alarm will be the one due soonest.</p>

<pre>  my $payload_id = $queue-&#62;enqueue($alarm_time, [ &#34;stuff&#34; ]);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="dequeue_next"
>dequeue_next</a></h2>

<p>Removes the next item from the queue, returning it as three fields: priority, ID and payload.</p>

<p>The &#34;next&#34; item is the one with the lowest priority number. If multiple items exist with the same priority, dequeue_next() will return the one that was given the priority first.</p>

<pre>  ITEM: while (1) {
    my ($priority, $id, $payload) = $queue-&#62;dequeue_next();
    last ITEM unless defined $priority;
    ...;
  }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_next_priority"
>get_next_priority</a></h2>

<p>Returns the priority of the item at the head of the queue. This is the lowest numeric priority in the queue.</p>

<p>get_next_priority() can be useful for checking the queue to see if it&#39;s time to dequeue some items. In this case, the queue manages multiple alarms, and there&#39;s nothing to do if the next alarm isn&#39;t due yet.</p>

<pre>  ALARM: while (1) {
    my $next_alarm_time = $queue-&#62;get_next_priority();
    last ALARM unless defined $next_alarm_time;

    if ($next_alarm_time - time() &#62; 0) {
      sleep($next_alarm_time - time());
    }

    my ($priority, $id, $payload) = $queue-&#62;dequeue_next();
    ...;
  }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_item_count"
>get_item_count</a></h2>

<p>Returns the number of items in the queue. It&#39;s another way to tell whether the queue has been fully drained. Here&#39;s an alternative version of the example for get_next_priority().</p>

<pre>  ALARM: while ($queue-&#62;get_item_count()) {
    my $next_alarm_time = $queue-&#62;get_next_priority();
    if ($next_alarm_time - time() &#62; 0) {
      sleep($next_alarm_time - time());
    }

    my ($priority, $id, $payload) = $queue-&#62;dequeue_next();
    ...;
  }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_item_ITEM_ID,_FILTER_FUNCTION"
>remove_item ITEM_ID, FILTER_FUNCTION</a></h2>

<p>Removes a single item by its ID, but only if a FILTER_FUNCTION approves of the item&#39;s payload.</p>

<p>If a payload is found with the given ITEM_ID, it is passed to FILTER_FUNCTION for examination. If FILTER_FUNCTION returns true, the item is removed from the queue and is returned as three fields.</p>

<pre>  my ($priority, $id, $payload) = $queue-&#62;remove_item(
    $target_id, \&#38;monkeys
  );

  sub monkeys {
    my $payload = shift;
    $payload-&#62;{type} eq &#34;monkey&#34;;
  }</pre>

<p>The returned $priority will be undef on failure, and $! will be set to the reason why the item couldn&#39;t be removed. That will be ESRCH if the ITEM_ID was not found in the queue, or EPERM if the filter function returned false.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="remove_items_FILTER_FUNCTION_[,_MAX_ITEM_COUNT_]"
>remove_items FILTER_FUNCTION [, MAX_ITEM_COUNT ]</a></h2>

<p>Removes and returns items from the queue that match a FILTER_FUNCTION. remove_items() will return immediately if MAX_ITEM_COUNT items is specified and that many items have been removed from the queue. MAX_ITEM_COUNT is a bit of optimization if the application knows in advance how many items will match the FILTER_FUNCTION.</p>

<p>Returns a list of items that were removed. Each item is an array reference containing a priority, item ID, and payload. Returns nothing if FILTER_FUNCTION matched nothing.</p>

<pre>  # Remove up to 12 monkeys.
  my @monkeys = $queue-&#62;remove_items(\&#38;monkeys, 12);
  foreach my $monkey (@monkeys) {
    my ($priority, $id, $payload) = @$monkey;
    print(
      &#34;Removed monkey:\n&#34;,
      &#34;  priority = $priority\n&#34;,
      &#34;  queue id = $id\n&#34;,
      &#34;  payload  = $payload\n&#34;,
    );
  }</pre>

<p>There is no guarantee which items will be removed if MAX_ITEM_COUNT is specified too low.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="peek_items_FILTER_FUNCTION_[,_MAX_ITEM_COUNT_]"
>peek_items FILTER_FUNCTION [, MAX_ITEM_COUNT ]</a></h2>

<p>peek_items() returns up to MAX_ITEM_COUNT items that match a given FILTER_FUNCTION without removing them from the queue.</p>

<pre>  my @entire_queue = $queue-&#62;peek_items(sub { 1 });
  foreach my $item (@entire_queue) {
    my ($priority, $id, $payload) = @$item;
    print(
      &#34;Item:\n&#34;,
      &#34;  priority = $priority\n&#34;,
      &#34;  queue id = $id\n&#34;,
      &#34;  payload  = $payload\n&#34;,
    );
  }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="adjust_priority_ITEM_ID,_FILTER_FUNCTION,_DELTA"
>adjust_priority ITEM_ID, FILTER_FUNCTION, DELTA</a></h2>

<p>Changes the priority of an item by DELTA. The item is identified by its ITEM_ID, and the change will only happen if the item&#39;s payload satisfies a FILTER_FUNCTION. Returns the new priority, which is the previous priority + DELTA. DELTA may be negative.</p>

<pre>  my $new_priority = $queue-&#62;adjust_priority(
    $item_id, \&#38;one_of_mine, 100
  );

  sub one_of_mine {
    my $payload = shift;
    return $payload-&#62;{owner} == $me;
  }</pre>

<p>Returns undef if the item&#39;s priority could not be adjusted, and sets $! to explain why: ESRCH means that the ITEM_ID could not be found, and EPERM means that the FILTER_FUNCTION was not satisfied.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_priority_ITEM_ID,_FILTER_FUNCTION,_ABSOLUTE_PRIORITY"
>set_priority ITEM_ID, FILTER_FUNCTION, ABSOLUTE_PRIORITY</a></h2>

<p>Sets an item&#39;s priority to a new ABSOLUTE_PRIORITY. The item is identified by its ITEM_ID, and the change will only be allowed to happen if the item&#39;s payload satisfies a FILTER_FUNCTION. Returns the new priority, which should match ABSOLUTE_PRIORITY.</p>

<p>Returns undef if the item&#39;s priority could not be set, and sets $! to explain why: ESRCH means that the ITEM_ID could not be found, and EPERM means that the FILTER_FUNCTION was not satisfied.</p>

<pre>  my $new_priority = $queue-&#62;set_priority(
    $item_id, \&#38;one_of_mine, time() + 60
  );

  unless (defined $new_priority) {
    die &#34;one of our submarines is missing: $item_id&#34; if $! == ESRCH;
    die &#34;set_priority disallowed for item $item_id&#34; if $! == EPERM;
    die $!;
  }

  sub one_of_mine {
    $_[0]{owner} == $me;
  }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../POE.html" class="podlinkpod"
>POE</a>, <a href="../POE/Queue/Array.html" class="podlinkpod"
>POE::Queue::Array</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<p>None known.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS_&#38;_COPYRIGHTS"
>AUTHORS &#38; COPYRIGHTS</a></h1>

<p>Please see <a href="../POE.html" class="podlinkpod"
>POE</a> for more information about authors, contributors, and POE&#39;s licensing.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
