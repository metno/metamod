<html><head><title>POE::Wheel::FollowTail</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:26 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#PUBLIC_METHODS'>PUBLIC METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new'>new</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Driver'>Driver</a>
      <li class='indexItem indexItem3'><a href='#Filter'>Filter</a>
      <li class='indexItem indexItem3'><a href='#PollInterval'>PollInterval</a>
      <li class='indexItem indexItem3'><a href='#Seek'>Seek</a>
      <li class='indexItem indexItem3'><a href='#SeekBack'>SeekBack</a>
      <li class='indexItem indexItem3'><a href='#Handle'>Handle</a>
      <li class='indexItem indexItem3'><a href='#Filename'>Filename</a>
      <li class='indexItem indexItem3'><a href='#InputEvent'>InputEvent</a>
      <li class='indexItem indexItem3'><a href='#ResetEvent'>ResetEvent</a>
      <li class='indexItem indexItem3'><a href='#ErrorEvent'>ErrorEvent</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#event'>event</a>
    <li class='indexItem indexItem2'><a href='#ID'>ID</a>
    <li class='indexItem indexItem2'><a href='#tell'>tell</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#PUBLIC_EVENTS'>PUBLIC EVENTS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#InputEvent'>InputEvent</a>
    <li class='indexItem indexItem2'><a href='#ResetEvent'>ResetEvent</a>
    <li class='indexItem indexItem2'><a href='#ErrorEvent'>ErrorEvent</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS_%26_COPYRIGHTS'>AUTHORS &#38; COPYRIGHTS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>POE::Wheel::FollowTail - follow the tail of an ever-growing file</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  #!perl

  use POE qw(Wheel::FollowTail);

  POE::Session-&#62;create(
    inline_states =&#62; {
      _start =&#62; sub {
        $_[HEAP]{tailor} = POE::Wheel::FollowTail-&#62;new(
          Filename =&#62; &#34;/var/log/system.log&#34;,
          InputEvent =&#62; &#34;got_log_line&#34;,
          ResetEvent =&#62; &#34;got_log_rollover&#34;,
        );
      },
      got_log_line =&#62; sub {
        print &#34;Log: $_[ARG0]\n&#34;;
      },
      got_log_rollover =&#62; sub {
        print &#34;Log rolled over.\n&#34;;
      },
    }
  );

  POE::Kernel-&#62;run();
  exit;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>POE::Wheel::FollowTail objects watch for new data at the end of a file and generate new events when things happen to the file. Its <code>Filter</code> parameter defines how to parse data from the file. Each new item is sent to the creator&#39;s session as an <code>InputEvent</code> event. Log rotation will trigger a <code>ResetEvent</code>.</p>

<p>POE::Wheel::FollowTail only reads from a file, so it doesn&#39;t implement a put() method.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PUBLIC_METHODS"
>PUBLIC METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new"
>new</a></h2>

<p>new() returns a new POE::Wheel::FollowTail object. As long as this object exists, it will generate events when the corresponding file&#39;s status changes.</p>

<p>new() accepts a small set of named parameters:</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Driver"
>Driver</a></h3>

<p>The optional <code>Driver</code> parameter specifies which driver to use when reading from the tailed file. If omitted, POE::Wheel::FollowTail will use POE::Driver::SysRW. This is almost always the right thing to do.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Filter"
>Filter</a></h3>

<p><code>Filter</code> is an optional constructor parameter that specifies how to parse data from the followed file. By default, POE::Wheel::FollowTail will use POE::Filter::Line to parse files as plain, newline-separated text.</p>

<pre>  $_[HEAP]{tailor} = POE::Wheel::FollowTail-&#62;new(
    Filename =&#62; &#34;/var/log/snort/alert&#34;,
    Filter =&#62; POE::Filter::Snort-&#62;new(),
    InputEvent =&#62; &#34;got_snort_alert&#34;,
  );</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="PollInterval"
>PollInterval</a></h3>

<p>POE::Wheel::FollowTail needs to periodically check for new data on the followed file. <code>PollInterval</code> specifies the number of seconds to wait between checks. Applications that need to poll once per second may omit <code>PollInterval</code>, as it defaults to 1.</p>

<p>Longer poll intervals may be used to reduce the polling overhead for infrequently updated files.</p>

<pre>  $_[HEAP]{tailor} = POE::Wheel::FollowTail-&#62;new(
    ...,
    PollInterval =&#62; 10,
  );</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Seek"
>Seek</a></h3>

<p>If specified, <code>Seek</code> instructs POE::Wheel::FollowTail to seek to a specific spot in the tailed file before beginning to read from it. A positive <code>Seek</code> value is interpreted as the number of octets to seek from the start of the file. Negative <code>Seek</code> will, like negative array indices, seek backwards from the end of the file. Zero <code>Seek</code> starts reading from the beginning of the file.</p>

<p>Be careful when using <code>Seek</code>, as it&#39;s quite easy to seek into the middle of a record. When in doubt, and when beginning at the end of the file, omit <code>Seek</code> entirely. POE::Wheel::FollowTail will seek 4 kilobytes back from the end of the file, then parse and discard all records unto EOF. As long as the file&#39;s records are smaller than 4 kilobytes, this will guarantee that the first record returned will be complete.</p>

<p><code>Seek</code> may also be used with the wheel&#39;s tell() method to restore the file position after a program restart. Save the tell() value prior to exiting, and load and <code>Seek</code> back to it on subsequent start-up.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="SeekBack"
>SeekBack</a></h3>

<p><code>SeekBack</code> behaves like the inverse of <code>Seek</code>. A positive value acts like a negative <code>Seek</code>. A negative value acts like a positive <code>Seek</code>. A zero <code>SeekBack</code> instructs POE::Wheel::FollowTail to begin at the very end of the file.</p>

<p><code>Seek</code> and <code>SeekBack</code> are mutually exclusive.</p>

<p>See <a href="#Seek" class="podlinkpod"
>&#34;Seek&#34;</a> for caveats, techniques, and an explanation of the magic that happens when neither <code>Seek</code> nor <code>SeekBack</code> is specified.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Handle"
>Handle</a></h3>

<p>POE::Wheel::FollowTail may follow a previously opened file <code>Handle</code>. Unfortunately it cannot follow log resets this way, as it won&#39;t be able to reopen the file once it has been reset. Applications that must follow resets should use <code>Filename</code> instead.</p>

<p><code>Handle</code> is still useful for files that will never be reset, or for devices that require setup outside of POE::Wheel::FollowTail&#39;s purview.</p>

<p><code>Handle</code> and <code>Filename</code> are mutually exclusive. One of them is required, however.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Filename"
>Filename</a></h3>

<p>Specify the <code>Filename</code> to watch. POE::Wheel::FollowTail will wait for the file to appear if it doesn&#39;t exist. The wheel will also reopen the file if it disappears, such as when it has been reset or rolled over. In the case of a reset, POE::Wheel::FollowTail will also emit a <code>ResetEvent</code>, if one has been requested.</p>

<p><code>Handle</code> and <code>Filename</code> are mutually exclusive. One of them is required, however.</p>

<p>See the <a href="#SYNOPSIS" class="podlinkpod"
>&#34;SYNOPSIS&#34;</a> for an example.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="InputEvent"
>InputEvent</a></h3>

<p>The <code>InputEvent</code> parameter is required, and it specifies the event to emit when new data arrives in the watched file. <code>InputEvent</code> is described in detail in <a href="#PUBLIC_EVENTS" class="podlinkpod"
>&#34;PUBLIC EVENTS&#34;</a>.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ResetEvent"
>ResetEvent</a></h3>

<p><code>ResetEvent</code> is an optional. It specifies the name of the event that indicates file rollover or reset. Please see <a href="#PUBLIC_EVENTS" class="podlinkpod"
>&#34;PUBLIC EVENTS&#34;</a> for more details.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="ErrorEvent"
>ErrorEvent</a></h3>

<p>POE::Wheel::FollowTail may emit optional <code>ErrorEvent</code>s whenever it runs into trouble. The data that comes with this event is explained in <a href="#PUBLIC_EVENTS" class="podlinkpod"
>&#34;PUBLIC EVENTS&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="event"
>event</a></h2>

<p>event() allows a session to change the events emitted by a wheel without destroying and re-creating the object. It accepts one or more of the events listed in <a href="#PUBLIC_EVENTS" class="podlinkpod"
>&#34;PUBLIC EVENTS&#34;</a>. Undefined event names disable those events.</p>

<p>Stop handling log resets:</p>

<pre>  sub some_event_handler {
    $_[HEAP]{tailor}-&#62;event( ResetEvent =&#62; undef );
  }</pre>

<p>The events are described in more detail in <a href="#PUBLIC_EVENTS" class="podlinkpod"
>&#34;PUBLIC EVENTS&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ID"
>ID</a></h2>

<p>The ID() method returns the wheel&#39;s unique ID. It&#39;s useful for storing the wheel in a hash. All POE::Wheel events should be accompanied by a wheel ID, which allows the wheel to be referenced in their event handlers.</p>

<pre>  sub setup_tailor {
    my $wheel = POE::Wheel::FollowTail-&#62;new(... incomplete ...);
    $_[HEAP]{tailors}{$wheel-&#62;ID} = $wheel;
  }</pre>

<p>See the example in <a href="#ErrorEvent" class="podlinkpod"
>&#34;ErrorEvent&#34;</a> for a handler that will find this wheel again.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="tell"
>tell</a></h2>

<p>tell() returns the current position for the file being watched by POE::Wheel::FollowTail. It may be useful for saving the position program termination. new()&#39;s <code>Seek</code> parameter may be used to resume watching the file where tell() left off.</p>

<pre>  sub handle_shutdown {
    # Not robust.  Do better in production.
    open my $save, &#34;&#62;&#34;, &#34;position.save&#34; or die $!;
    print $save $_[HEAP]{tailor}-&#62;tell(), &#34;\n&#34;;
    close $save;
  }

  sub handle_startup {
    open my $save, &#34;&#60;&#34;, &#34;position.save&#34; or die $!;
    chomp(my $seek = &#60;$save&#62;);
    $_[HEAP]{tailor} = POE::Wheel::FollowTail-&#62;new(
      ...,
      Seek =&#62; $seek,
    );
  }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PUBLIC_EVENTS"
>PUBLIC EVENTS</a></h1>

<p>POE::Wheel::FollowTail emits a small number of events.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="InputEvent"
>InputEvent</a></h2>

<p><code>InputEvent</code> sets the name of the event to emit when new data arrives into the tailed file. The event will be accompanied by two parameters:</p>

<p><code>$_[ARG0]</code> contains the data that was read from the file, after being parsed by the current <code>Filter</code>.</p>

<p><code>$_[ARG1]</code> contains the wheel&#39;s ID, which may be used as a key into a data structure tracking multiple wheels. No assumption should be made about the nature or format of this ID, as it may change at any time. Therefore, track your wheels in a hash.</p>

<p>See the <a href="#SYNOPSIS" class="podlinkpod"
>&#34;SYNOPSIS&#34;</a> for an example.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ResetEvent"
>ResetEvent</a></h2>

<p><code>ResetEvent</code> names the event to be emitted whenever the wheel detects that the followed file has been reset. It&#39;s only available when watching files by name, as POE::Wheel::FollowTail must reopen the file after it has been reset.</p>

<p><code>ResetEvent</code> comes with only one parameter, <code>$_[ARG0]</code>, which contains the wheel&#39;s ID. See <a href="#InputEvent" class="podlinkpod"
>&#34;InputEvent&#34;</a> for some notes about what may be done with wheel IDs.</p>

<p>See the <a href="#SYNOPSIS" class="podlinkpod"
>&#34;SYNOPSIS&#34;</a> for an example.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ErrorEvent"
>ErrorEvent</a></h2>

<p><code>ErrorEvent</code> names the event emitted when POE::Wheel::FollowTail encounters a problem. Every <code>ErrorEvent</code> comes with four parameters that describe the error and its situation:</p>

<p><code>$_[ARG0]</code> describes the operation that failed. This is usually &#34;read&#34;, since POE::Wheel::FollowTail spends most of its time reading from a file.</p>

<p><code>$_[ARG1]</code> and <code>$_[ARG2]</code> contain the numeric and stringified values of <code>$!</code>, respectively. They will never contain EAGAIN (or its local equivalent) since POE::Wheel::FollowTail handles that error itself.</p>

<p><code>$_[ARG3]</code> contains the wheel&#39;s ID, which has been discussed in <a href="#InputEvent" class="podlinkpod"
>&#34;InputEvent&#34;</a>.</p>

<p>This error handler logs a message to STDERR and then shuts down the wheel. It assumes that the session is watching multiple files.</p>

<pre>  sub handle_tail_error {
    my ($operation, $errnum, $errstr, $wheel_id) = @_[ARG0..ARG3];
    warn &#34;Wheel $wheel_id: $operation error $errnum: $errstr\n&#34;;
    delete $_[HEAP]{tailors}{$wheel_id};
  }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../POE/Wheel.html" class="podlinkpod"
>POE::Wheel</a> describes the basic operations of all wheels in more depth. You need to know this.</p>

<p>The SEE ALSO section in <a href="../../POE.html" class="podlinkpod"
>POE</a> contains a table of contents covering the entire POE distribution.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<p>This wheel can&#39;t tail pipes and consoles on some operating systems.</p>

<p>POE::Wheel::FollowTail generally reads ahead of the data it returns, so the tell() position may be later in the file than the data an application has already received.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS_&#38;_COPYRIGHTS"
>AUTHORS &#38; COPYRIGHTS</a></h1>

<p>Please see <a href="../../POE.html" class="podlinkpod"
>POE</a> for more information about authors and contributors.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
