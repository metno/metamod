<html><head><title>Class::Trigger</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:03 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <li class='indexItem indexItem1'><a href='#TRIGGER_POINTS'>TRIGGER POINTS</a>
  <li class='indexItem indexItem1'><a href='#FAQ'>FAQ</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Class::Trigger - Mixin to add / call inheritable triggers</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  package Foo;
  use Class::Trigger;

  sub foo {
      my $self = shift;
      $self-&#62;call_trigger(&#39;before_foo&#39;);
      # some code ...
      $self-&#62;call_trigger(&#39;middle_of_foo&#39;);
      # some code ...
      $self-&#62;call_trigger(&#39;after_foo&#39;);
  }

  package main;
  Foo-&#62;add_trigger(before_foo =&#62; \&#38;sub1);
  Foo-&#62;add_trigger(after_foo =&#62; \&#38;sub2);

  my $foo = Foo-&#62;new;
  $foo-&#62;foo;            # then sub1, sub2 called

  # triggers are inheritable
  package Bar;
  use base qw(Foo);

  Bar-&#62;add_trigger(before_foo =&#62; \&#38;sub);

  # triggers can be object based
  $foo-&#62;add_trigger(after_foo =&#62; \&#38;sub3);
  $foo-&#62;foo;            # sub3 would appply only to this object</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Class::Trigger is a mixin class to add / call triggers (or hooks) that get called at some points you specify.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<p>By using this module, your class is capable of following methods.</p>

<dl>
<dt><a name="add_trigger"
>add_trigger</a></dt>

<dd>
<pre>  Foo-&#62;add_trigger($triggerpoint =&#62; $sub);
  $foo-&#62;add_trigger($triggerpoint =&#62; $sub);


  Foo-&#62;add_trigger( name =&#62; $triggerpoint,
                    callback =&#62; sub {return undef},
                    abortable =&#62; 1); 

  # no further triggers will be called. Undef will be returned.</pre>

<p>Adds triggers for trigger point. You can have any number of triggers for each point. Each coderef will be passed a reference to the calling object, as well as arguments passed in via <a href="../call_trigger.html" class="podlinkpod"
>call_trigger</a>. Return values will be captured in <i>list context</i>.</p>

<p>If add_trigger is called with named parameters and the <code>abortable</code> parameter is passed a true value, a false return value from trigger code will stop processing of this trigger point and return a <code>false</code> value to the calling code.</p>

<p>If <code>add_trigger</code> is called without the <code>abortable</code> flag, return values will be captured by call_trigger, but failures will be ignored.</p>

<p>If <code>add_trigger</code> is called as object method, whole current trigger table will be copied onto the object and the new trigger added to that. (The object must be implemented as hash.)</p>

<pre>  my $foo = Foo-&#62;new;

  # this trigger ($sub_foo) would apply only to $foo object
  $foo-&#62;add_trigger($triggerpoint =&#62; $sub_foo);
  $foo-&#62;foo;

  # And not to another $bar object
  my $bar = Foo-&#62;new;
  $bar-&#62;foo;</pre>

<dt><a name="call_trigger"
>call_trigger</a></dt>

<dd>
<pre>  $foo-&#62;call_trigger($triggerpoint, @args);</pre>

<p>Calls triggers for trigger point, which were added via <code>add_trigger</code> method. Each triggers will be passed a copy of the object as the first argument. Remaining arguments passed to <code>call_trigger</code> will be passed on to each trigger. Triggers are invoked in the same order they were defined.</p>

<p>If there are no <code>abortable</code> triggers or no <code>abortable</code> trigger point returns a false value, <code>call_trigger</code> will return the number of triggers processed.</p>

<p>If an <code>abortable</code> trigger returns a false value, call trigger will stop execution of the trigger point and return undef.</p>

<dt><a name="last_trigger_results"
>last_trigger_results</a></dt>

<dd>
<pre>    my @results = @{ $foo-&#62;last_trigger_results };</pre>

<p>Returns a reference to an array of the return values of all triggers called for the last trigger point. Results are ordered in the same order the triggers were run.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TRIGGER_POINTS"
>TRIGGER POINTS</a></h1>

<p>By default you can make any number of trigger points, but if you want to declare names of trigger points explicitly, you can do it via <code>import</code>.</p>

<pre>  package Foo;
  use Class::Trigger qw(foo bar baz);

  package main;
  Foo-&#62;add_trigger(foo  =&#62; \&#38;sub1); # okay
  Foo-&#62;add_trigger(hoge =&#62; \&#38;sub2); # exception</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FAQ"
>FAQ</a></h1>

<p><b>Acknowledgement:</b> Thanks to everyone at POOP mailing-list (http://poop.sourceforge.net/).</p>

<dl>
<dt><a name="Q."
>Q.</a></dt>

<dd>
<p>This module lets me add subs to be run before/after a specific subroutine is run. Yes?</p>

<dt><a name="A."
>A.</a></dt>

<dd>
<p>You put various call_trigger() method in your class. Then your class users can call add_trigger() method to add subs to be run in points just you specify (exactly where you put call_trigger()).</p>

<dt><a name="Q."
>Q.</a></dt>

<dd>
<p>Are you aware of the perl-aspects project and the Aspect module? Very similar to Class::Trigger by the look of it, but its not nearly as explicit. Its not necessary for foo() to actually say &#34;triggers go *here*&#34;, you just add them.</p>

<dt><a name="A."
>A.</a></dt>

<dd>
<p>Yep ;)</p>

<p>But the difference with Aspect would be that Class::Trigger is so simple that it&#39;s easy to learn, and doesn&#39;t require 5.6 or over.</p>

<dt><a name="Q."
>Q.</a></dt>

<dd>
<p>How does this compare to Sub::Versive, or Hook::LexWrap?</p>

<dt><a name="A."
>A.</a></dt>

<dd>
<p>Very similar. But the difference with Class::Trigger would be the explicitness of trigger points.</p>

<p>In addition, you can put hooks in any point, rather than pre or post of a method.</p>

<dt><a name="Q."
>Q.</a></dt>

<dd>
<p>It looks interesting, but I just can&#39;t think of a practical example of its use...</p>

<dt><a name="A."
>A.</a></dt>

<dd>
<p>(by Tony Bowden)</p>

<p>I originally added code like this to Class::DBI to cope with one particular case: auto-upkeep of full-text search indices.</p>

<p>So I added functionality in Class::DBI to be able to trigger an arbitary subroutine every time something happened - then it was a simple matter of setting up triggers on INSERT and UPDATE to reindex that row, and on DELETE to remove that index row.</p>

<p>See <a href="../Class/DBI/mysql/FullTextSearch.html" class="podlinkpod"
>Class::DBI::mysql::FullTextSearch</a> and its source code to see it in action.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Original idea by Tony Bowden &#60;tony@kasei.com&#62; in Class::DBI.</p>

<p>Code by Tatsuhiko Miyagawa &#60;miyagawa@bulknews.net&#62;.</p>

<p>Jesse Vincent added a code to get return values from triggers and abortable flag.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../Class/DBI.html" class="podlinkpod"
>Class::DBI</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
