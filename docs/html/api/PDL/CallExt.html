<html><head><title>PDL::CallExt</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:23 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#API'>API</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS'>FUNCTIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#callext'>callext</a>
    <li class='indexItem indexItem2'><a href='#callext_cc'>callext_cc</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>PDL::CallExt - call functions in external shared libraries</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre> use PDL::CallExt;
 callext(&#39;file.so&#39;, &#39;foofunc&#39;, $x, $y); # pass piddles to foofunc()

 % perl -MPDL::CallExt -e callext_cc file.c</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>callext() loads in a shareable object (i.e. compiled code) using Perl&#39;s dynamic loader, calls the named function and passes a list of piddle arguments to it.</p>

<p>It provides a reasonably portable way of doing this, including compiling the code with the right flags, though it requires simple perl and C wrapper routines to be written. You may prefer to use PP, which is much more portable. See <a href="../PDL/PP.html" class="podlinkpod"
>PDL::PP</a>. You should definitely use the latter for a &#39;proper&#39; PDL module, or if you run in to the limitations of this module.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="API"
>API</a></h1>

<p>callext_cc() allows one to compile the shared objects using Perl&#39;s knowledge of compiler flags.</p>

<p>The named function (e.g. &#39;foofunc&#39;) must take a list of piddle structures as arguments, there is now way of doing portable general argument construction hence this limitation.</p>

<p>In detail the code in the original file.c would look like this:</p>

<pre> #include &#34;pdlsimple.h&#34; /* Declare simple piddle structs - note this .h file
                           contains NO perl/PDL dependencies so can be used
                           standalone */

 int foofunc(int nargs, pdlsimple **args); /* foofunc prototype */</pre>

<p>i.e. foofunc() takes an array of pointers to pdlsimple structs. The use is similar to that of <code>main(int nargs, char **argv)</code> in UNIX C applications.</p>

<p>pdlsimple.h defines a simple N-dimensional data structure which looks like this:</p>

<pre>  struct pdlsimple {
     int    datatype;  /* whether byte/int/float etc. */
     void  *data;      /* Generic pointer to the data block */
     int    nvals;     /* Number of data values */
     PDL_Long *dims;   /* Array of data dimensions */
     int    ndims;     /* Number of data dimensions */
  };</pre>

<p>(PDL_Long is always a 4 byte int and is defined in pdlsimple.h)</p>

<p>This is a simplification of the internal reprensation of piddles in PDL which is more complicated because of threading, dataflow, etc. It will usually be found somewhere like /usr/local/lib/perl5/site_perl/PDL/pdlsimple.h</p>

<p>Thus to actually use this to call real functions one would need to right a wrapper. e.g. to call a 2D image processing routine:</p>

<pre> void myimage_processer(double* image, int nx, int ny);

 int foofunc(int nargs, pdlsimple **args) {
    pdlsimple* image = pdlsimple[0];
    myimage_processer( image-&#62;data, *(image-&#62;dims), *(image-&#62;dims+1) );
    ...
 }</pre>

<p>Obviously a real wrapper would include more error and argument checking.</p>

<p>This might be compiled (e.g. Linux):</p>

<pre> cc -shared -o mycode.so mycode.c</pre>

<p>In general Perl knows how to do this, so you should be able to get away with:</p>

<pre> perl -MPDL::CallExt -e callext_cc file.c</pre>

<p>callext_cc() is a function defined in PDL::CallExt to generate the correct compilation flags for shared objects.</p>

<p>If their are problems you will need to refer to you C compiler manual to find out how to generate shared libraries.</p>

<p>See t/callext.t in the distribution for a working example.</p>

<p>It is up to the caller to ensure datatypes of piddles are correct - if not peculiar results or SEGVs will result.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS"
>FUNCTIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="callext"
>callext</a></h2>

<p>Call a function in an external library using Perl dynamic loading</p>

<pre>  callext(&#39;file.so&#39;, &#39;foofunc&#39;, $x, $y); # pass piddles to foofunc()</pre>

<p>The file must be compiled with dynamic loading options (see <code>callext_cc</code>). See the module docs <code>PDL::Callext</code> for a description of the API.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="callext_cc"
>callext_cc</a></h2>

<p>Compile external C code for dynamic loading</p>

<p>Usage:</p>

<pre> % perl -MPDL::CallExt -e callext_cc file.c -o file.so</pre>

<p>This works portably because when Perl has built in knowledge of how to do dynamic loading on the system on which it was installed. See the module docs <code>PDL::Callext</code> for a description of the API.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Copyright (C) Karl Glazebrook 1997. All rights reserved. There is no warranty. You are allowed to redistribute this software / documentation under certain conditions. For details, see the file COPYING in the PDL distribution. If this file is separated from the PDL distribution, the copyright notice should be included in the file.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
