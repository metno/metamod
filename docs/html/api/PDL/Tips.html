<html><head><title>PDL::Tips</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:24 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Help'>Help</a>
    <li class='indexItem indexItem2'><a href='#Indexing_idioms'>Indexing idioms</a>
    <li class='indexItem indexItem2'><a href='#What_is_actually_happening%3F'>What is actually happening?</a>
    <li class='indexItem indexItem2'><a href='#Memory_savings'>Memory savings</a>
    <li class='indexItem indexItem2'><a href='#PP_speed'>PP speed</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>PDL::Tips - Small tidbits of useful arcana.
Programming tidbits and such.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>        use PDL;

        # Whatever happens here.</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This page documents useful idioms, helpful hints and tips for using Perl Data Language v2.0.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Help"
>Help</a></h2>

<p>Use <code>help help</code> within <i>perldl</i> or <i>pdl2</i> or use the <code>pdldoc</code> program from the command line for access to the PerlDL documentation. HTML versions of the pages should also be present, in the <em>HtmlDocs/PDL</em> directory of the PDL distribution. To find this directory, try the following</p>

<pre> pdl&#62; foreach ( map{&#34;$_/PDL/HtmlDocs&#34;}@INC ) { p &#34;$_\n&#34; if -d $_ }  </pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Indexing_idioms"
>Indexing idioms</a></h2>

<p>The following code normalizes a bunch of vectors in $a. This works regardless of the dimensionality of $a.</p>

<pre>        $a /= $a-&#62;sumover-&#62;dummy(0);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="What_is_actually_happening?"
>What is actually happening?</a></h2>

<p>If you want to see what the code is actually doing, try the command</p>

<pre>        PDL::Core::set_debugging(1);</pre>

<p>somewhere. This spews out a huge amount of debug info for PDL into STDOUT. Plans for the future include making it possible to redirect the output, and also making it possible to select mesages with more precision.</p>

<p>Many of the messages come from <code>Basic/Core/pdlapi.c</code> and you can look at the source to see what is going on.</p>

<p>If you have any extra time to work on these mechanisms, inform the pdl-porters mailing list.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Memory_savings"
>Memory savings</a></h2>

<p>If you are running recursively something that selects certain indices of a large piddle, like</p>

<pre>        while(1) {
                $inds = where($a&#62;0);
                $a = $a-&#62;index($inds);
                $b = $b-&#62;index($inds);
                func($b,$a);
        }</pre>

<p>If you are not writing to $b, it saves a lot of memory to change this to</p>

<pre>                $b = $b-&#62;index($inds)-&#62;sever;</pre>

<p>The new method <code>sever</code> is a causes the write-back relation to be forgotten. It is like copy except it changes the original piddle and returns it).</p>

<p>Of course, the probably best way to do the above is</p>

<pre>        $inds = xvals ($a-&#62;long);
        while(1) {
                $inds0 = where($a&#62;0);
                $inds1 = $inds-&#62;index($inds)-&#62;sever;
                $a = $a0-&#62;index($inds1);
                $b = $b-&#62;index($inds1)-&#62;sever;
                func($b,$a);
        }</pre>

<p>which doesn&#39;t save all the temporary instances of $a in memory. See <code>mandel.pl</code> in the Demos subdirectory of the PerlDL distribution for an example.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="PP_speed"
>PP speed</a></h2>

<p>If you really want to write speedy PP code, the first thing you need to do is to make sure that your C compiler is allowed to do the necessary optimizations.</p>

<p>What this means is that you have to allow as many variables as possible to go into registers:</p>

<pre>        loop(a) %{
                $a() += $COMP(foo_member) * $b()
        %}</pre>

<p>expands to</p>

<pre>        for(i=0; i&#60;10000; i++) {
                a[i] += __privtrans-&#62;foo_member * b[i];
        }</pre>

<p>is about the worst you can do, since your C compiler is not allowed to assume that <code>a</code> doesn&#39;t clobber <code>foo_member</code> which completely inhibits vectorization. Instead, do</p>

<pre>        float foo = $COMP(foo_member);
        loop(a) %{
                $a() += foo * $b();
        %}</pre>

<p>This is not a restriction caused by PP but by ANSI C semantics. Of course, we could copy the struct into local variables and back but that could cause very strange things sometimes.</p>

<p>There are many other issues on organizing loops.</p>

<p>We are currently planning to make PP able to do fixed-width things as well as physical piddles (where looping over the first dimensions would be cheaper as there are less distinct increments, which might make a difference on machines with a small number of registers).</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Copyright (C) Tuomas J. Lukka 1997. All rights reserved. Duplication in the same form and printing a copy for yourself allowed.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
