<html><head><title>XML::LibXML::XPathContext</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:29 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#EXAMPLES'>EXAMPLES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Namespaces'>Namespaces</a>
    <li class='indexItem indexItem2'><a href='#Custom_XPath_functions'>Custom XPath functions</a>
    <li class='indexItem indexItem2'><a href='#Variables'>Variables</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <li class='indexItem indexItem1'><a href='#BUGS_AND_CAVEATS'>BUGS AND CAVEATS</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#HISTORICAL_REMARK'>HISTORICAL REMARK</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>XML::LibXML::XPathContext - XPath Evaluation</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  my $xpc = XML::LibXML::XPathContext-&#62;new();
  my $xpc = XML::LibXML::XPathContext-&#62;new($node);
  $xpc-&#62;registerNs($prefix, $namespace_uri)
  $xpc-&#62;unregisterNs($prefix)
  $uri = $xpc-&#62;lookupNs($prefix)
  $xpc-&#62;registerVarLookupFunc($callback, $data)
  $data = $xpc-&#62;getVarLookupData();
  $callback = $xpc-&#62;getVarLookupFunc();
  $xpc-&#62;unregisterVarLookupFunc($name);
  $xpc-&#62;registerFunctionNS($name, $uri, $callback)
  $xpc-&#62;unregisterFunctionNS($name, $uri)
  $xpc-&#62;registerFunction($name, $callback)
  $xpc-&#62;unregisterFunction($name)
  @nodes = $xpc-&#62;findnodes($xpath)
  @nodes = $xpc-&#62;findnodes($xpath, $context_node )
  $nodelist = $xpc-&#62;findnodes($xpath, $context_node )
  $object = $xpc-&#62;find($xpath )
  $object = $xpc-&#62;find($xpath, $context_node )
  $value = $xpc-&#62;findvalue($xpath )
  $value = $xpc-&#62;findvalue($xpath, $context_node )
  $bool = $xpc-&#62;exists( $xpath_expression, $context_node );
  $xpc-&#62;setContextNode($node)
  my $node = $xpc-&#62;getContextNode;
  $xpc-&#62;setContextPosition($position)
  my $position = $xpc-&#62;getContextPosition;
  $xpc-&#62;setContextSize($size)
  my $size = $xpc-&#62;getContextSize;
  $xpc-&#62;setContextNode($node)
The XML::LibXML::XPathContext class provides an almost complete interface to
libxml2&#39;s XPath implementation. With XML::LibXML::XPathContext is is possible
to evaluate XPath expressions in the context of arbitrary node, context size,
and context position, with a user-defined namespace-prefix mapping, custom
XPath functions written in Perl, and even a custom XPath variable resolver.</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXAMPLES"
>EXAMPLES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Namespaces"
>Namespaces</a></h2>

<p>This example demonstrates <code>registerNs()</code> method. It finds all paragraph nodes in an XHTML document.</p>

<pre>  my $xc = XML::LibXML::XPathContext-&#62;new($xhtml_doc);
  $xc-&#62;registerNs(&#39;xhtml&#39;, &#39;http://www.w3.org/1999/xhtml&#39;);
  my @nodes = $xc-&#62;findnodes(&#39;//xhtml:p&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Custom_XPath_functions"
>Custom XPath functions</a></h2>

<p>This example demonstrates <code>registerFunction()</code> method by defining a function filtering nodes based on a Perl regular expression:</p>

<pre>  sub grep_nodes {
    my ($nodelist,$regexp) =  @_;
    my $result = XML::LibXML::NodeList-&#62;new;
    for my $node ($nodelist-&#62;get_nodelist()) {
      $result-&#62;push($node) if $node-&#62;textContent =~ $regexp;
    }
    return $result;
  };

  my $xc = XML::LibXML::XPathContext-&#62;new($node);
  $xc-&#62;registerFunction(&#39;grep_nodes&#39;, \&#38;grep_nodes);
  my @nodes = $xc-&#62;findnodes(&#39;//section[grep_nodes(para,&#34;\bsearch(ing|es)?\b&#34;)]&#39;);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Variables"
>Variables</a></h2>

<p>This example demonstrates <code>registerVarLookup()</code> method. We use XPath variables to recycle results of previous evaluations:</p>

<pre>  sub var_lookup {
    my ($varname,$ns,$data)=@_;
    return $data-&#62;{$varname};
  }

  my $areas = XML::LibXML-&#62;new-&#62;parse_file(&#39;areas.xml&#39;);
  my $empl = XML::LibXML-&#62;new-&#62;parse_file(&#39;employees.xml&#39;);

  my $xc = XML::LibXML::XPathContext-&#62;new($empl);

  my %variables = (
    A =&#62; $xc-&#62;find(&#39;/employees/employee[@salary&#62;10000]&#39;),
    B =&#62; $areas-&#62;find(&#39;/areas/area[district=&#39;Brooklyn&#39;]/street&#39;),
  );

  # get names of employees from $A working in an area listed in $B
  $xc-&#62;registerVarLookupFunc(\&#38;var_lookup, \%variables);
  my @nodes = $xc-&#62;findnodes(&#39;$A[work_area/street = $B]/name&#39;);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<dl>
<dt><a name="new"
>new</a></dt>

<dd>
<pre>  my $xpc = XML::LibXML::XPathContext-&#62;new();</pre>

<p>Creates a new XML::LibXML::XPathContext object without a context node.</p>

<pre>  my $xpc = XML::LibXML::XPathContext-&#62;new($node);</pre>

<p>Creates a new XML::LibXML::XPathContext object with the context node set to <code>$node</code>.</p>

<dt><a name="registerNs"
>registerNs</a></dt>

<dd>
<pre>  $xpc-&#62;registerNs($prefix, $namespace_uri)</pre>

<p>Registers namespace <code>$prefix</code> to <code>$namespace_uri</code>.</p>

<dt><a name="unregisterNs"
>unregisterNs</a></dt>

<dd>
<pre>  $xpc-&#62;unregisterNs($prefix)</pre>

<p>Unregisters namespace <code>$prefix</code>.</p>

<dt><a name="lookupNs"
>lookupNs</a></dt>

<dd>
<pre>  $uri = $xpc-&#62;lookupNs($prefix)</pre>

<p>Returns namespace URI registered with <code>$prefix</code>. If <code>$prefix</code> is not registered to any namespace URI returns <code>undef</code>.</p>

<dt><a name="registerVarLookupFunc"
>registerVarLookupFunc</a></dt>

<dd>
<pre>  $xpc-&#62;registerVarLookupFunc($callback, $data)</pre>

<p>Registers variable lookup function <code>$prefix</code>. The registered function is executed by the XPath engine each time an XPath variable is evaluated. It takes three arguments: <code>$data</code>, variable name, and variable ns-URI and must return one value: a number or string or any <code>XML::LibXML::</code> object that can be a result of findnodes: Boolean, Literal, Number, Node (e.g. Document, Element, etc.), or NodeList. For convenience, simple (non-blessed) array references containing only <a href="../../XML/LibXML/Node.html" class="podlinkpod"
>XML::LibXML::Node</a> objects can be used instead of an <a href="../../XML/LibXML/NodeList.html" class="podlinkpod"
>XML::LibXML::NodeList</a>.</p>

<dt><a name="getVarLookupData"
>getVarLookupData</a></dt>

<dd>
<pre>  $data = $xpc-&#62;getVarLookupData();</pre>

<p>Returns the data that have been associated with a variable lookup function during a previous call to <code>registerVarLookupFunc</code>.</p>

<dt><a name="getVarLookupFunc"
>getVarLookupFunc</a></dt>

<dd>
<pre>  $callback = $xpc-&#62;getVarLookupFunc();</pre>

<p>Returns the variable lookup function previously registered with <code>registerVarLookupFunc</code>.</p>

<dt><a name="unregisterVarLookupFunc"
>unregisterVarLookupFunc</a></dt>

<dd>
<pre>  $xpc-&#62;unregisterVarLookupFunc($name);</pre>

<p>Unregisters variable lookup function and the associated lookup data.</p>

<dt><a name="registerFunctionNS"
>registerFunctionNS</a></dt>

<dd>
<pre>  $xpc-&#62;registerFunctionNS($name, $uri, $callback)</pre>

<p>Registers an extension function <code>$name</code> in <code>$uri</code> namespace. <code>$callback</code> must be a CODE reference. The arguments of the callback function are either simple scalars or <code>XML::LibXML::*</code> objects depending on the XPath argument types. The function is responsible for checking the argument number and types. Result of the callback code must be a single value of the following types: a simple scalar (number, string) or an arbitrary <code>XML::LibXML::*</code> object that can be a result of findnodes: Boolean, Literal, Number, Node (e.g. Document, Element, etc.), or NodeList. For convenience, simple (non-blessed) array references containing only <a href="../../XML/LibXML/Node.html" class="podlinkpod"
>XML::LibXML::Node</a> objects can be used instead of a <a href="../../XML/LibXML/NodeList.html" class="podlinkpod"
>XML::LibXML::NodeList</a>.</p>

<dt><a name="unregisterFunctionNS"
>unregisterFunctionNS</a></dt>

<dd>
<pre>  $xpc-&#62;unregisterFunctionNS($name, $uri)</pre>

<p>Unregisters extension function <code>$name</code> in <code>$uri</code> namespace. Has the same effect as passing <code>undef</code> as <code>$callback</code> to registerFunctionNS.</p>

<dt><a name="registerFunction"
>registerFunction</a></dt>

<dd>
<pre>  $xpc-&#62;registerFunction($name, $callback)</pre>

<p>Same as <code>registerFunctionNS</code> but without a namespace.</p>

<dt><a name="unregisterFunction"
>unregisterFunction</a></dt>

<dd>
<pre>  $xpc-&#62;unregisterFunction($name)</pre>

<p>Same as <code>unregisterFunctionNS</code> but without a namespace.</p>

<dt><a name="findnodes"
>findnodes</a></dt>

<dd>
<pre>  @nodes = $xpc-&#62;findnodes($xpath)

  @nodes = $xpc-&#62;findnodes($xpath, $context_node )

  $nodelist = $xpc-&#62;findnodes($xpath, $context_node )</pre>

<p>Performs the xpath statement on the current node and returns the result as an array. In scalar context, returns an <a href="../../XML/LibXML/NodeList.html" class="podlinkpod"
>XML::LibXML::NodeList</a> object. Optionally, a node may be passed as a second argument to set the context node for the query.</p>

<p>The xpath expression can be passed either as a string or or as a <a href="../../XML/LibXML/XPathExpression.html" class="podlinkpod"
>XML::LibXML::XPathExpression</a> object.</p>

<dt><a name="find"
>find</a></dt>

<dd>
<pre>  $object = $xpc-&#62;find($xpath )

  $object = $xpc-&#62;find($xpath, $context_node )</pre>

<p>Performs the xpath expression using the current node as the context of the expression, and returns the result depending on what type of result the XPath expression had. For example, the XPath <code>1 * 3 + 52</code> results in an <a href="../../XML/LibXML/Number.html" class="podlinkpod"
>XML::LibXML::Number</a> object being returned. Other expressions might return a <a href="../../XML/LibXML/Boolean.html" class="podlinkpod"
>XML::LibXML::Boolean</a> object, or a <a href="../../XML/LibXML/Literal.html" class="podlinkpod"
>XML::LibXML::Literal</a> object (a string). Each of those objects uses Perl&#39;s overload feature to ``do the right thing&#39;&#39; in different contexts. Optionally, a node may be passed as a second argument to set the context node for the query.</p>

<p>The xpath expression can be passed either as a string or or as a <a href="../../XML/LibXML/XPathExpression.html" class="podlinkpod"
>XML::LibXML::XPathExpression</a> object.</p>

<dt><a name="findvalue"
>findvalue</a></dt>

<dd>
<pre>  $value = $xpc-&#62;findvalue($xpath )

  $value = $xpc-&#62;findvalue($xpath, $context_node )</pre>

<p>Is exactly equivalent to:</p>

<pre>  $xpc-&#62;find( $xpath, $context_node )-&#62;to_literal;</pre>

<p>That is, it returns the literal value of the results. This enables you to ensure that you get a string back from your search, allowing certain shortcuts. This could be used as the equivalent of &#60;xsl:value-of select=``some_xpath&#39;&#39;/&#62;. Optionally, a node may be passed in the second argument to set the context node for the query.</p>

<p>The xpath expression can be passed either as a string or or as a <a href="../../XML/LibXML/XPathExpression.html" class="podlinkpod"
>XML::LibXML::XPathExpression</a> object.</p>

<dt><a name="exists"
>exists</a></dt>

<dd>
<pre>  $bool = $xpc-&#62;exists( $xpath_expression, $context_node );</pre>

<p>This method behaves like <i>findnodes</i>, except that it only returns a boolean value (1 if the expression matches a node, 0 otherwise) and may be faster than <i>findnodes</i>, because the XPath evaluation may stop early on the first match (this is true for libxml2 &#62;= 2.6.27).</p>

<p>For XPath expressions that do not return node-set, the method returns true if the returned value is a non-zero number or a non-empty string.</p>

<dt><a name="setContextNode"
>setContextNode</a></dt>

<dd>
<pre>  $xpc-&#62;setContextNode($node)</pre>

<p>Set the current context node.</p>

<dt><a name="getContextNode"
>getContextNode</a></dt>

<dd>
<pre>  my $node = $xpc-&#62;getContextNode;</pre>

<p>Get the current context node.</p>

<dt><a name="setContextPosition"
>setContextPosition</a></dt>

<dd>
<pre>  $xpc-&#62;setContextPosition($position)</pre>

<p>Set the current context position. By default, this value is -1 (and evaluating XPath function <code>position()</code> in the initial context raises an XPath error), but can be set to any value up to context size. This usually only serves to cheat the XPath engine to return given position when <code>position()</code> XPath function is called. Setting this value to -1 restores the default behavior.</p>

<dt><a name="getContextPosition"
>getContextPosition</a></dt>

<dd>
<pre>  my $position = $xpc-&#62;getContextPosition;</pre>

<p>Get the current context position.</p>

<dt><a name="setContextSize"
>setContextSize</a></dt>

<dd>
<pre>  $xpc-&#62;setContextSize($size)</pre>

<p>Set the current context size. By default, this value is -1 (and evaluating XPath function <code>last()</code> in the initial context raises an XPath error), but can be set to any non-negative value. This usually only serves to cheat the XPath engine to return the given value when <code>last()</code> XPath function is called. If context size is set to 0, position is automatically also set to 0. If context size is positive, position is automatically set to 1. Setting context size to -1 restores the default behavior.</p>

<dt><a name="getContextSize"
>getContextSize</a></dt>

<dd>
<pre>  my $size = $xpc-&#62;getContextSize;</pre>

<p>Get the current context size.</p>

<dt><a name="setContextNode"
>setContextNode</a></dt>

<dd>
<pre>  $xpc-&#62;setContextNode($node)</pre>

<p>Set the current context node.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS_AND_CAVEATS"
>BUGS AND CAVEATS</a></h1>

<p>XML::LibXML::XPathContext objects <i>are</i> reentrant, meaning that you can call methods of an XML::LibXML::XPathContext even from XPath extension functions registered with the same object or from a variable lookup function. On the other hand, you should rather avoid registering new extension functions, namespaces and a variable lookup function from within extension functions and a variable lookup function, unless you want to experience untested behavior.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Ilya Martynov and Petr Pajas, based on XML::LibXML and XML::LibXSLT code by Matt Sergeant and Christian Glahn.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="HISTORICAL_REMARK"
>HISTORICAL REMARK</a></h1>

<p>Prior to XML::LibXML 1.61 this module was distributed separately for maintenance reasons.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Matt Sergeant, Christian Glahn, Petr Pajas</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>2.0014</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>2001-2007, AxKit.com Ltd.</p>

<p>2002-2006, Christian Glahn.</p>

<p>2006-2009, Petr Pajas.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
