<html><head><title>Module::AutoInstall</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:20 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Prerequisites_and_Features'>Prerequisites and Features</a>
    <li class='indexItem indexItem2'><a href='#The_Installation_Process'>The Installation Process</a>
    <li class='indexItem indexItem2'><a href='#User-Defined_Hooks'>User-Defined Hooks</a>
    <li class='indexItem indexItem2'><a href='#Customized_MY%3A%3Apostamble'>Customized MY::postamble</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CAVEATS'>CAVEATS</a>
  <li class='indexItem indexItem1'><a href='#ENVIRONMENT'>ENVIRONMENT</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#IF_THIS_BREAKS'>IF THIS BREAKS</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Module::AutoInstall - Automatic install of dependencies via CPAN</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>In <em>Makefile.PL</em>,
with <a href="../Module/Install.html" class="podlinkpod"
>Module::Install</a> available on the author&#39;s system:</p>

<pre>    use inc::Module::Install;
    
    name        &#39;Joe-Hacker&#39;;
    abstract    &#39;Perl Interface to Joe Hacker&#39;;
    author      &#39;Joe Hacker &#60;joe@hacker.org&#62;&#39;;
    include     &#39;Module::AutoInstall&#39;;
    
    requires    &#39;Module0&#39;;          # mandatory modules
    
    feature     &#39;Feature1&#39;,
        -default    =&#62; 0,
        &#39;Module2&#39;   =&#62; &#39;0.1&#39;;
    
    feature     &#39;Feature2&#39;,
        -default    =&#62; 0,
        &#39;Module3&#39;   =&#62; &#39;1.0&#39;;
    
    auto_install(
        make_args   =&#62; &#39;--hello&#39;,   # option(s) for CPAN::Config
        force       =&#62; 1,           # pseudo-option to force install
        do_once     =&#62; 1,           # skip previously failed modules
    );
    
    WriteAll;</pre>

<p>Invoking the resulting <em>Makefile.PL</em>:</p>

<pre>    % perl Makefile.PL                  # interactive behaviour
    % perl Makefile.PL --defaultdeps    # accept default value on prompts
    % perl Makefile.PL --checkdeps      # check only, no Makefile produced
    % perl Makefile.PL --skipdeps       # ignores all dependencies
    % perl Makefile.PL --testonly       # don&#39;t write installation targets</pre>

<p>Note that the trailing &#39;deps&#39; of arguments may be omitted, too.</p>

<p>Using <code>--defaultdeps</code> will make <em>Makefile.PL</em> behave similarly to a regular Makefile.PL file with <code>PREREQ_PM</code> dependencies.</p>

<p>One can use environment variables (see &#34;ENVIRONMENT&#34;) below to set a default behavior instead of specifying it in the command line for every invocation of <em>Makefile.PL</em>.</p>

<p>Using <em>make</em> (or <em>nmake</em>):</p>

<pre>    % make [all|test|install]           # install dependencies first
    % make checkdeps                    # same as the --checkdeps above
    % make installdeps                  # install dependencies only
    % make installdeps_notest           # same without running tests
    % make upgradedeps                  # upgrade all deps, even if installed
    % make upgradedeps_notest           # same without running tests
    % make listdeps                     # print unsatisifed deps, one per line
    % make listalldeps                  # print all deps, one per line</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p><b>Module::AutoInstall</b> lets module writers to specify a more sophisticated form of dependency information than the <code>PREREQ_PM</code> option offered by <b>ExtUtils::MakeMaker</b>.</p>

<p>This module works best with the <b>Module::Install</b> framework, a drop-in replacement for MakeMaker. However, this module also supports <em>Makefile.PL</em> files based on MakeMaker; see <a href="#EXAMPLES" class="podlinkpod"
>&#34;EXAMPLES&#34;</a> for instructions.</p>

<p>Specifying <code>installdeps_target;</code> instead of <code>auto_install;</code> will not try to install dependencies when running <code>make</code>, but only when running <code>make installdeps</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Prerequisites_and_Features"
>Prerequisites and Features</a></h2>

<p>Prerequisites are grouped into <b>features</b>, and the user could choose yes/no on each one&#39;s dependencies; the module writer may also supply a boolean value via <code>-default</code> to specify the default choice.</p>

<p>The <b>Core Features</b> marked by the name <code>-core</code> will double-check with the user, if the user chooses not to install the mandatory modules. This differs from the pre-0.26 &#39;silent install&#39; behaviour.</p>

<p>Starting from version 0.27, if <code>-core</code> is set to the string <code>all</code> (case-insensitive), every feature will be considered mandatory.</p>

<p>The dependencies are expressed as pairs of <code>Module</code> =&#62; <code>version</code> inside an array reference. If the order does not matter, and there are no <code>-default</code>, <code>-tests</code> or <code>-skiptests</code> directives for that feature, you may also use a hash reference.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_Installation_Process"
>The Installation Process</a></h2>

<p>Once <b>Module::AutoInstall</b> has determined which module(s) are needed, it checks whether it&#39;s running under the <b>CPAN</b> shell and should therefore let <b>CPAN</b> handle the dependency.</p>

<p>Finally, the <code>WriteMakefile()</code> is overridden to perform some additional checks, as well as skips tests associated with disabled features by the <code>-tests</code> option.</p>

<p>The actual installation happens at the end of the <code>make config</code> target; both <code>make test</code> and <code>make install</code> will trigger the installation of required modules.</p>

<p>If it&#39;s not running under <b>CPAN</b>, the installer will probe for an active connection by trying to resolve the domain <code>cpan.org</code>, and check for the user&#39;s permission to use <b>CPAN</b>. If all went well, a separate <b>CPAN</b> instance is created to install the required modules.</p>

<p>If you have the <b>CPANPLUS</b> package installed in your system, it is preferred by default over <b>CPAN</b>; it also accepts some extra options (e.g. <code>-target =&#62; &#39;skiptest&#39;, -skiptest =&#62; 1</code> to skip testing).</p>

<p>All modules scheduled to be installed will be deleted from <code>%INC</code> first, so <b>ExtUtils::MakeMaker</b> will check the newly installed modules.</p>

<p>Additionally, you could use the <code>make installdeps</code> target to install the modules, and the <code>make checkdeps</code> target to check dependencies without actually installing them; the <code>perl Makefile.PL --checkdeps</code> command has an equivalent effect.</p>

<p>If the <em>Makefile.PL</em> itself needs to use an independent module (e.g. <b>Acme::KillarApp</b>, v1.21 or greater), then use something like below:</p>

<pre>    BEGIN {
        require Module::AutoInstall;
        # the first argument is an arrayref of the -config flags
        Module::AutoInstall-&#62;install([], &#39;Acme::KillerApp&#39; =&#62; 1.21);
    }
    use Acme::KillerApp 1.21;

    Module::AutoInstall-&#62;import(
        # ... arguments as usual ...
    );</pre>

<p>Note the version test in the use clause; if you are so close to the cutting edge that <b>Acme::KillerApp</b> 1.20 is the latest version on CPAN, this will prevent your module from going awry.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="User-Defined_Hooks"
>User-Defined Hooks</a></h2>

<p>User-defined <i>pre-installation</i> and <i>post-installation</i> hooks are available via <code>MY::preinstall</code> and <code>MY::postinstall</code> subroutines, as shown below:</p>

<pre>    # pre-install handler; takes $module_name and $version
    sub MY::preinstall  { return 1; } # return false to skip install

    # post-install handler; takes $module_name, $version, $success
    sub MY::postinstall { return; }   # the return value doesn&#39;t matter</pre>

<p>Note that since <b>Module::AutoInstall</b> performs installation at the time of <code>use</code> (i.e. before perl parses the remainder of <em>Makefile.PL</em>), you have to declare those two handlers <i>before</i> the <code>use</code> statement for them to take effect.</p>

<p>If the user did not choose to install a module or it already exists on the system, neither of the handlers is invoked. Both handlers are invoked exactly once for each module when installation is attempted.</p>

<p><code>MY::preinstall</code> takes two arguments, <code>$module_name</code> and <code>$version</code>; if it returns a false value, installation for that module will be skipped, and <code>MY::postinstall</code> won&#39;t be called at all.</p>

<p><code>MY::postinstall</code> takes three arguments, <code>$module_name</code>, <code>$version</code> and <code>$success</code>. The last one denotes whether the installation succeeded or not: <code>1</code> means installation completed successfully, <code>0</code> means failure during install, and <code>undef</code> means that the installation was not attempted at all, possibly due to connection problems, or that module does not exist on CPAN at all.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Customized_MY::postamble"
>Customized <code>MY::postamble</code></a></h2>

<p>Starting from version 0.43, <b>Module::AutoInstall</b> supports modules that require a <code>MY::postamble</code> subroutine in their <em>Makefile.PL</em>. The user-defined <code>MY::postamble</code>, if present, is responsible for calling <code>Module::AutoInstall::postamble</code> and include the output in its return value.</p>

<p>For example, the <b>DBD::*</b> (database driver) modules for the Perl DBI are required to include the postamble generated by the function <code>dbd_postamble</code>, so their <em>Makefile.PL</em> may contain lines like this:</p>

<pre>    sub MY::postamble {
        return &#38;Module::AutoInstall::postamble . &#38;dbd_postamble;
    }</pre>

<p>Note that the <b>Module::AutoInstall</b> module does not export the <code>postamble</code> function, so the name should always be fully qualified.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAVEATS"
>CAVEATS</a></h1>

<p><b>Module::AutoInstall</b> will add <code>UNINST=1</code> to your <b>make install</b> flags if your effective uid is 0 (root), unless you explicitly disable it by setting <b>CPAN</b>&#39;s <code>make_install_arg</code> configuration option (or the <code>makeflags</code> option of <b>CPANPLUS</b>) to include <code>UNINST=0</code>. This <i>may</i> cause dependency problems if you are using a fine-tuned directory structure for your site. Please consult <a href="../CPAN.html#FAQ" class="podlinkpod"
>&#34;FAQ&#34; in CPAN</a> for an explanation in detail.</p>

<p>If either <b>version</b> or <b>Sort::Versions</b> is available, they will be used to compare the required version with the existing module&#39;s version and the CPAN module&#39;s. Otherwise it silently falls back to use <i>cmp</i>. This may cause inconsistent behaviours in pathetic situations.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ENVIRONMENT"
>ENVIRONMENT</a></h1>

<p><b>Module::AutoInstall</b> uses a single environment variable, <code>PERL_AUTOINSTALL</code>. It is taken as the command line argument passed to <em>Makefile.PL</em>; you could set it to <code>--alldeps</code>, <code>--defaultdeps</code> or <code>--skipdeps</code> to avoid all interactive behaviour.</p>

<p><code>--alldeps</code> will install all features, while <code>--defaultdeps</code> will only install features for which the default answer is &#39;y&#39;.</p>

<p><code>--skipdeps</code> will refrain from loading <a href="../CPAN.html" class="podlinkpod"
>CPAN</a> and not install anything, unless you&#39;re running under <a href="../CPAN.html" class="podlinkpod"
>CPAN</a> or <a href="../CPANPLUS.html" class="podlinkpod"
>CPANPLUS</a>, in which case required dependencies will be installed.</p>

<p>It is also read from the <code>PERL_EXTUTILS_AUTOINSTALL</code> environment variable if <code>PERL_AUTOINSTALL</code> is not defined.</p>

<p>You can also set <code>PERL_AUTOINSTALL_PREFER_CPAN</code> to use CPAN to install dependencies. By default CPANPLUS is used.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../Module/Install.html" class="podlinkpod"
>Module::Install</a></p>

<p><a href="../perlmodlib.html" class="podlinkpod"
>perlmodlib</a>, <a href="../ExtUtils/MakeMaker.html" class="podlinkpod"
>ExtUtils::MakeMaker</a>, <a href="../Sort/Versions.html" class="podlinkpod"
>Sort::Versions</a>, <a href="../CPAN.html" class="podlinkpod"
>CPAN</a>, <a href="../CPANPLUS.html" class="podlinkpod"
>CPANPLUS</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Audrey Tang &#60;autrijus@autrijus.org&#62;</p>

<p>Adam Kennedy &#60;adamk@cpan.org&#62;</p>

<p>Matt S Trout &#60;mst@shadowcat.co.u&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="IF_THIS_BREAKS"
>IF THIS BREAKS</a></h1>

<p>Report a ticket to bugs-Module-Install &#60;at&#62; rt.cpan.org and cc Matt - I appear to have volunteered as primary maintainer for this stuff so if you run into any problems please tell me</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright 2001, 2002, 2003, 2004, 2005, 2006 by Audrey Tang</p>

<p>Some parts copyright 2006 Adam Kennedy</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<p>See <a href="http://www.perl.com/perl/misc/Artistic.html" class="podlinkurl"
>http://www.perl.com/perl/misc/Artistic.html</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
