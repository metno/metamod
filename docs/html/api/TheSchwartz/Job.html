<html><head><title>TheSchwartz::Job</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:28 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FIELDS'>FIELDS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#jobid'>jobid</a>
    <li class='indexItem indexItem2'><a href='#funcid'>funcid</a>
    <li class='indexItem indexItem2'><a href='#arg'>arg</a>
    <li class='indexItem indexItem2'><a href='#uniqkey'>uniqkey</a>
    <li class='indexItem indexItem2'><a href='#insert_time'>insert_time</a>
    <li class='indexItem indexItem2'><a href='#run_after'>run_after</a>
    <li class='indexItem indexItem2'><a href='#grabbed_until'>grabbed_until</a>
    <li class='indexItem indexItem2'><a href='#priority'>priority</a>
    <li class='indexItem indexItem2'><a href='#coalesce'>coalesce</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#USAGE'>USAGE</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#TheSchwartz%3A%3AJob-%3Enew(_%25args_)'>TheSchwartz::Job-&#62;new( %args )</a>
    <li class='indexItem indexItem2'><a href='#TheSchwartz%3A%3AJob-%3Enew_from_array(_%24funcname%2C_%24arg_)'>TheSchwartz::Job-&#62;new_from_array( $funcname, $arg )</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Efuncname(%5B_%24funcname_%5D)'>$job-&#62;funcname([ $funcname ])</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Ehandle(%5B_%24handle_%5D)'>$job-&#62;handle([ $handle ])</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Edriver()'>$job-&#62;driver()</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Eadd_failure(_%24msg_)'>$job-&#62;add_failure( $msg )</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Eexit_status()'>$job-&#62;exit_status()</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Efailure_log()'>$job-&#62;failure_log()</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Efailures()'>$job-&#62;failures()</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Eset_exit_status(_%24status_)'>$job-&#62;set_exit_status( $status )</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Edid_something(%5B_%24value_%5D)'>$job-&#62;did_something([ $value ])</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Ewas_declined()'>$job-&#62;was_declined()</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Edebug(_%24msg_)'>$job-&#62;debug( $msg )</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Eset_as_current()'>$job-&#62;set_as_current()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#WORKING'>WORKING</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%24job-%3Ecompleted()'>$job-&#62;completed()</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Efailed(_%24msg%2C_%24exit_status_)'>$job-&#62;failed( $msg, $exit_status )</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Epermanent_failure(_%24msg%2C_%24exit_status_)'>$job-&#62;permanent_failure( $msg, $exit_status )</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Edeclined()'>$job-&#62;declined()</a>
    <li class='indexItem indexItem2'><a href='#%24job-%3Ereplace_with(_%40jobs_)'>$job-&#62;replace_with( @jobs )</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>TheSchwartz::Job - jobs for the reliable job queue</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    my $client = TheSchwartz-&#62;new( databases =&#62; $DATABASE_INFO );

    my $job = TheSchwartz::Job-&#62;new_from_array(&#39;MyWorker&#39;, [ foo =&#62; &#39;bar&#39; ]);
    $client-&#62;insert($job);

    $job = TheSchwartz::Job-&#62;new(
        funcname =&#62; &#39;MyWorker&#39;,
        uniqkey  =&#62; 7,
        arg      =&#62; [ foo =&#62; &#39;bar&#39; ],
    );
    $client-&#62;insert($job);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p><code>TheSchwartz::Job</code> models the jobs that are posted to the job queue by your application, then grabbed and performed by your worker processes.</p>

<p><code>TheSchwartz::Job</code> is a <code>Data::ObjectDriver</code> model class. See <a href="../Data/ObjectDriver/BaseObject.html" class="podlinkpod"
>Data::ObjectDriver::BaseObject</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FIELDS"
>FIELDS</a></h1>

<p><code>TheSchwartz::Job</code> objects have these possible fields:</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="jobid"
><code>jobid</code></a></h2>

<p>The unique numeric identifier for this job. Set automatically when saved.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="funcid"
><code>funcid</code></a></h2>

<p>The numeric identifier for the type of job to perform. <code>TheSchwartz</code> clients map function names (also known as abilities and worker class names) to these numbers using <code>TheSchwartz::FuncMap</code> records.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="arg"
><code>arg</code></a></h2>

<p>Arbitrary state data to supply to the worker process for this job. If specified as a reference, the data is frozen to a blob with the <code>Storable</code> module.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="uniqkey"
><code>uniqkey</code></a></h2>

<p>An arbitrary string identifier used to prevent applications from posting duplicate jobs. At most one with the same <code>uniqkey</code> value can be posted to a single <code>TheSchwartz</code> database.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="insert_time"
><code>insert_time</code></a></h2>

<p>The <code>insert_time</code> field is not used.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="run_after"
><code>run_after</code></a></h2>

<p>The UNIX system time after which the job can next be attempted by a worker process. This timestamp is set when a job is first created or is released after a failure.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="grabbed_until"
><code>grabbed_until</code></a></h2>

<p>The UNIX system time after which the job can next be available by a worker process. This timestamp is set when a job is grabbed by a worker process, and reset to <code>0</code> when is released due to failure to complete the job.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="priority"
><code>priority</code></a></h2>

<p>An integer value to specify the priority of the job to be executed; larger numbers mean higher priority. See <code>prioritize</code> property of <a href="../TheSchwartz.html" class="podlinkpod"
>TheSchwartz</a> for details.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="coalesce"
><code>coalesce</code></a></h2>

<p>A string used to discover jobs that can be efficiently pipelined with a given job due to some shared resource. For example, for email delivery jobs, the domain of an email address could be used as the <code>coalesce</code> value. A worker process could then deliver all the mail queued for a given mail host after connecting to it once.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="USAGE"
>USAGE</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="TheSchwartz::Job-&#62;new(_%args_)"
><code>TheSchwartz::Job-&#62;new( %args )</code></a></h2>

<p>Returns a new job object with the given data. Members of <code>%args</code> can be keyed on any of the fields described above, or <code>funcname</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="TheSchwartz::Job-&#62;new_from_array(_$funcname,_$arg_)"
><code>TheSchwartz::Job-&#62;new_from_array( $funcname, $arg )</code></a></h2>

<p>Returns a new job with the given function name (also called <i>ability</i> or <i>worker class</i>), and the scalar or reference <code>$arg</code> for an argument.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;funcname([_$funcname_])"
><code>$job-&#62;funcname([ $funcname ])</code></a></h2>

<p>Returns the function name for the given job, after setting it to <code>$funcname</code>, if specified.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;handle([_$handle_])"
><code>$job-&#62;handle([ $handle ])</code></a></h2>

<p>Returns the <code>TheSchwartz::JobHandle</code> object describing this job, after setting it to <code>$handle</code>, if specified. A <i>job handle</i> is a convenience class for accessing other records related to jobs; as its convenience methods are also available directly from <code>TheSchwartz::Job</code> instances, you will usually not need to work directly with job handles.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;driver()"
><code>$job-&#62;driver()</code></a></h2>

<p>Returns the <code>Data::ObjectDriver</code> object driver for accessing the database in which <code>$job</code> is stored. See <a href="../Data/ObjectDriver.html" class="podlinkpod"
>Data::ObjectDriver</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;add_failure(_$msg_)"
><code>$job-&#62;add_failure( $msg )</code></a></h2>

<p>Records and returns a new <code>TheSchwartz::Error</code> object representing a failure to perform <code>$job</code>, for reason <code>$msg</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;exit_status()"
><code>$job-&#62;exit_status()</code></a></h2>

<p>Returns the <i>exit status</i> specified by the worker that either completed the job or declared it failed permanently. The exit status for a job will be available for a period of time after the job has exited the queue. That time is defined in the job&#39;s worker class&#39;s <code>keep_exit_status_for()</code> method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;failure_log()"
><code>$job-&#62;failure_log()</code></a></h2>

<p>Returns a list of the error messages specified to <code>add_failure()</code> when a worker failed to perform the given job.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;failures()"
><code>$job-&#62;failures()</code></a></h2>

<p>Returns the number of times a worker has grabbed this job, only to fail to complete it.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;set_exit_status(_$status_)"
><code>$job-&#62;set_exit_status( $status )</code></a></h2>

<p>Records the exit status of the given job as <code>$status</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;did_something([_$value_])"
><code>$job-&#62;did_something([ $value ])</code></a></h2>

<p>Returns whether the given job has been completed or failed since it was created or loaded, setting whether it has to <code>$value</code> first, if specified.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;was_declined()"
><code>$job-&#62;was_declined()</code></a></h2>

<p>Sets (if given an argument) and returns the value of the was_declined flag for a job object. See also <code>$job-&#62;declined()</code></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;debug(_$msg_)"
><code>$job-&#62;debug( $msg )</code></a></h2>

<p>Sends the given message to the job&#39;s <code>TheSchwartz</code> client as debug output.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;set_as_current()"
><code>$job-&#62;set_as_current()</code></a></h2>

<p>Set <code>$job</code> as the current job being performed by its associated <code>TheSchwartz</code> client.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="WORKING"
>WORKING</a></h1>

<p><code>TheSchwartz::Worker</code> classes should use these methods to update the status of their jobs:</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;completed()"
><code>$job-&#62;completed()</code></a></h2>

<p>Records that the given job has been fully performed and removes it from the job queue. Completing a job records its exit status as <code>0</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;failed(_$msg,_$exit_status_)"
><code>$job-&#62;failed( $msg, $exit_status )</code></a></h2>

<p>Records that the worker performing this job failed to complete it, for reason <code>$msg</code>.</p>

<p>If workers have not failed to complete the job more times than the maximum number of retries for that type of job, the job will be reattempted after its retry delay has elapsed. The maximum number of retries and the delay before a retry are defined in the job&#39;s worker class definition as <code>max_retries()</code> and <code>retry_delay()</code> respectively.</p>

<p>If workers <i>have</i> exceeded the maximum number of reattempts for this job, the job&#39;s exit status is recorded as <code>$exit_status</code>, and the job is removed from the queue. If <code>$exit_status</code> is not defined or <code>0</code>, the job will be recorded with an exit status of <code>1</code>, to indicate a failure.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;permanent_failure(_$msg,_$exit_status_)"
><code>$job-&#62;permanent_failure( $msg, $exit_status )</code></a></h2>

<p>Records that the worker performing this job failed to complete it, as in <code>failed()</code>, but that the job should <i>not</i> be reattempted, no matter how many times the job has been attempted before. The job&#39;s exit status is thus recorded as <code>$exit_status</code> (or <code>1</code>), and the job is removed from the queue.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;declined()"
><code>$job-&#62;declined()</code></a></h2>

<p>Report that the job has been declined for handling at this time, which means that the job will be retried after the next grabbed_until interval, and does not count against the max_retries count.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$job-&#62;replace_with(_@jobs_)"
><code>$job-&#62;replace_with( @jobs )</code></a></h2>

<p>Atomically replaces the single job <code>$job</code> with the given set of jobs.</p>

<p>This can be used to decompose one &#34;metajob&#34; posted by your application into a set of jobs workers can perform, or to post a job or jobs required to complete the process already partly performed.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../Data/ObjectDriver.html" class="podlinkpod"
>Data::ObjectDriver</a>, <a href="../Data/ObjectDriver/BaseObject.html" class="podlinkpod"
>Data::ObjectDriver::BaseObject</a>, <a href="../Storable.html" class="podlinkpod"
>Storable</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
