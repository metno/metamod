<html><head><title>HTML::FormHandler::Manual::Catalyst</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:18 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#A_Controller_Example'>A Controller Example</a>
    <li class='indexItem indexItem2'><a href='#Another_way_to_set_up_your_form'>Another way to set up your form</a>
    <li class='indexItem indexItem2'><a href='#Putting_a_form_in_a_Moose_attribute'>Putting a form in a Moose attribute</a>
    <li class='indexItem indexItem2'><a href='#Using_HTML%3A%3AFillInForm'>Using HTML::FillInForm</a>
    <li class='indexItem indexItem2'><a href='#The_Catalyst_context'>The Catalyst context</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>HTML::FormHandler::Manual::Catalyst - using HFH forms in Catalyst</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 0.40028</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p><a href="../../../HTML/FormHandler/Manual.html" class="podlinkpod"
>Manual Index</a></p>

<p>This part of the FormHandler Manual describes the use of the <a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a> package in Catalyst controllers.</p>

<p>See the other FormHandler documentation at <a href="../../../HTML/FormHandler/Manual.html" class="podlinkpod"
>HTML::FormHandler::Manual</a>,
or the base class at <a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Although <a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a> can be used in any Perl web application,
module,
or script,
one of its most common uses is in <a href="../../../Catalyst.html" class="podlinkpod"
>Catalyst</a> applications.</p>

<p>Using a form takes only a few lines of code,
so it&#39;s not necessary to have a <a href="../../../Catalyst.html" class="podlinkpod"
>Catalyst</a> base controller,
although you could make a base controller for FormHandler if you&#39;re doing more than the basics.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="A_Controller_Example"
>A Controller Example</a></h2>

<p>The following example uses chained dispatching.
The &#39;form&#39; method is called by both the create and edit actions.</p>

<pre>   package BookDB::Controller::Borrower;

   use Moose;
   BEGIN { extends &#39;Catalyst::Controller&#39; }

   use BookDB::Form::Borrower;

   sub borrower_base : Chained PathPart(&#39;borrower&#39;) CaptureArgs(0) { }

   sub list : Chained(&#39;borrower_base&#39;) PathPart(&#39;list&#39;) Args(0) {
      my ( $self, $c ) = @_;
      my $borrowers = [ $c-&#62;model(&#39;DB::Borrower&#39;)-&#62;all ];
      my @columns = ( &#39;name&#39;, &#39;email&#39; );
      $c-&#62;stash( borrowers =&#62; $borrowers, columns =&#62; \@columns,
                 template =&#62; &#39;borrower/list.tt&#39; );
   }

   sub add : Chained(&#39;borrower_base&#39;) PathPart(&#39;add&#39;) Args(0) {
      my ( $self, $c ) = @_;
      # Create the empty borrower row for the form
      $c-&#62;stash( borrower =&#62; $c-&#62;model(&#39;DB::Borrower&#39;)-&#62;new_result({}) );
      return $self-&#62;form($c);
   }

   sub item : Chained(&#39;borrower_base&#39;) PathPart(&#39;&#39;) CaptureArgs(1) {
      my ( $self, $c, $borrower_id ) = @_;
      $c-&#62;stash( borrower =&#62; $c-&#62;model(&#39;DB::Borrower&#39;)-&#62;find($borrower_id) );
   }

   sub edit : Chained(&#39;item&#39;) PathPart(&#39;edit&#39;) Args(0) {
      my ( $self, $c ) = @_;
      return $self-&#62;form($c);
   }

   sub form {
      my ( $self, $c ) = @_;

      my $form = BookDB::Form::Borrower-&#62;new;
      $c-&#62;stash( form =&#62; $form, template =&#62; &#39;borrower/form.tt&#39; );
      return unless $form-&#62;process( item =&#62; $c-&#62;stash-&#62;{borrower},
         params =&#62; $c-&#62;req-&#62;parameters );
      $c-&#62;res-&#62;redirect( $c-&#62;uri_for($self-&#62;action_for(&#39;list&#39;)) );
   }

   sub delete : Chained(&#39;item&#39;) PathPart(&#39;delete&#39;) Args(0) {
      my ( $self, $c ) = @_;

      $c-&#62;stash-&#62;{borrower}-&#62;delete;
      $c-&#62;res-&#62;redirect( $c-&#62;uri_for($c-&#62;action_for(&#39;list&#39;)) );
   }

   1;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Another_way_to_set_up_your_form"
>Another way to set up your form</a></h2>

<p>If you are setting the schema or other form attributes (such as the user_id, or other attributes) on your form you could create a base controller that would set these in the form on each call using <a href="../../../Catalyst/Component/InstancePerContext.html" class="podlinkpod"
>Catalyst::Component::InstancePerContext</a>, or set them in a base Chained method.</p>

<pre>   sub book_base : Chained PathPart(&#39;book&#39;) CaptureArgs(0) {
      my ( $self, $c ) = @_;
      my $form = MyApp::Form-&#62;new;
      $form-&#62;schema( $c-&#62;model(&#39;DB&#39;)-&#62;schema );
      $form-&#62;params( $c-&#62;req-&#62;parameters );
      $form-&#62;user_id( $c-&#62;user-&#62;id );
      $c-&#62;stash( form =&#62; $form );
   }</pre>

<p>Then you could just pass in the item_id when the form is processed.</p>

<pre>   return unless $c-&#62;stash-&#62;{form}-&#62;process( item_id =&#62; $id );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Putting_a_form_in_a_Moose_attribute"
>Putting a form in a Moose attribute</a></h2>

<p>You can also put your form in a Moose attribute in the controller.</p>

<pre>    package MyApp::Controller::Book;
    use Moose;
    BEGIN { extends &#39;Catalyst::Controller&#39;; }
    use MyApp::Form::Book;
    has &#39;edit_form&#39; =&#62; ( isa =&#62; &#39;MyApp::Form::Book&#39;, is =&#62; &#39;rw&#39;,
       lazy =&#62; 1, default =&#62; sub { MyApp::Form::Book-&#62;new } );</pre>

<p>Then you can process the form in your actions with <code>$self-&#62;edit_form-&#62;process( params =&#62; $c-&#62;req-&#62;body_parameters );</code> or <code>my $result = $self-&#62;edit_form-&#62;run( params =&#62; $c-&#62;req-&#62;body_parameters );</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Using_HTML::FillInForm"
>Using HTML::FillInForm</a></h2>

<p>If you want to use <a href="../../../HTML/FillInForm.html" class="podlinkpod"
>HTML::FillInForm</a> to fill in values instead of doing it in directly in a template using either the field or the form &#39;fif&#39; methods, you can use <a href="../../../Catalyst/View/FillInForm.html" class="podlinkpod"
>Catalyst::View::FillInForm</a> on your view class:</p>

<pre>    package MyApp::View::TT;
    use Moose;
    with &#39;Catalyst::View::FillInForm&#39;;
    ....
    1;</pre>

<p>and set the &#39;fif&#39; hash in the &#39;fillinform&#39; stash variable:</p>

<pre>    $self-&#62;form-&#62;process( ... );
    $c-&#62;stash( fillinform =&#62; $self-&#62;form-&#62;fif );
    return unless $form-&#62;validated;</pre>

<p>When the &#39;fillinform&#39; stash variable is set, HTML::FillInForm will automatically be used by your view to fill in the form values. This can be very helpful when you want to build your forms by hand, or when you have legacy forms that you&#39;re just trying to hook up to FormHandler.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="The_Catalyst_context"
>The Catalyst context</a></h2>

<p>FormHandler has a &#39;ctx&#39; attribute that can be used to set the Catalyst context (or anything you want, really). But if you can avoid passing in the context, you should do so, because you&#39;re mixing up your MVC and it makes it much more difficult to test your forms. But if you need to do it, you can:</p>

<pre>    my $form = MyApp::Form-&#62;new( ctx =&#62; $c );</pre>

<p>Usually you should prefer to add new attributes to your form:</p>

<pre>    package MyApp::Form;
    use HTML::FormHandler::Moose;
    extends &#39;HTML::FormHandler&#39;;

    has &#39;user_id&#39; =&#62; ( is =&#62; &#39;rw&#39; );
    has &#39;hostname&#39; =&#62; ( is =&#62; &#39;rw&#39; );
    has &#39;captcha_store&#39; =&#62; ( is =&#62; &#39;rw&#39; );
    ....
    1;</pre>

<p>Then just pass the attributes in on new:</p>

<pre>    my $form =&#62; MyApp::Form-&#62;new( user_id =&#62; $c-&#62;user-&#62;id, hostname =&#62; $c-&#62;req-&#62;host,
        captcha_store =&#62; $c-&#62;{session}-&#62;{captcha} );</pre>

<p>Or set them using accessors:</p>

<pre>    $form-&#62;user_id( $c-&#62;user-&#62;id );
    $form-&#62;hostname( $c-&#62;req-&#62;host );
    $form-&#62;captcha_store( $c-&#62;{session}-&#62;{captcha} );</pre>

<p>Then you can access these attributes in your form validation methods:</p>

<pre>    sub validate_selection {
       my ( $self, $field ) = @_;
       if( $field-&#62;value eq &#39;something&#39; &#38;&#38; $self-&#62;hostname eq &#39;something_else&#39; )
       {
          $field-&#62;add_error(&#34;some error message&#34; );
       }
    }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>FormHandler Contributors - see HTML::FormHandler</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2013 by Gerda Shank.</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
