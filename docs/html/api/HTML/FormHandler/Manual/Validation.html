<html><head><title>HTML::FormHandler::Manual::Validation</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:18 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#Field_attributes_for_validation'>Field attributes for validation</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#required%2C_required_when'>required, required_when</a>
    <li class='indexItem indexItem2'><a href='#range_start%2C_range_end'>range_start, range_end</a>
    <li class='indexItem indexItem2'><a href='#unique'>unique</a>
    <li class='indexItem indexItem2'><a href='#validate_when_empty'>validate_when_empty</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Validation_methods'>Validation methods</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#validate_method'>validate_method</a>
    <li class='indexItem indexItem2'><a href='#validate_%3Cfield_name%3E'>validate_&#60;field_name&#62;</a>
    <li class='indexItem indexItem2'><a href='#form_validate_method'>form validate method</a>
    <li class='indexItem indexItem2'><a href='#field_validate_method'>field validate method</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Apply_Actions%3A_Filters%2C_transformations%2C_and_constraints'>Apply Actions: Filters, transformations, and constraints</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Moose_types'>Moose types</a>
    <li class='indexItem indexItem2'><a href='#transform'>transform</a>
    <li class='indexItem indexItem2'><a href='#%27check%27_regex'>&#39;check&#39; regex</a>
    <li class='indexItem indexItem2'><a href='#%27check%27_arrayref_(matches)'>&#39;check&#39; arrayref (matches)</a>
    <li class='indexItem indexItem2'><a href='#%27check%27_coderef'>&#39;check&#39; coderef</a>
    <li class='indexItem indexItem2'><a href='#message'>message</a>
    <li class='indexItem indexItem2'><a href='#actions_in_a_field_class'>actions in a field class</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Dependency'>Dependency</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>HTML::FormHandler::Manual::Validation - validating fields</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 0.40028</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p><a href="../../../HTML/FormHandler/Manual.html" class="podlinkpod"
>Manual Index</a></p>

<p>There are many options for validating fields in FormHandler.
Some validation is from field attributes,
some from form or field methods,
some from &#39;apply&#39; actions on the fields.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Field_attributes_for_validation"
>Field attributes for validation</a></h1>

<p>Each individual field may have additional attributes that relate to validation,
which are not documented here.
See the individual field documentation,
linked from <a href="../../../HTML/FormHandler/Manual/Fields.html" class="podlinkpod"
>HTML::FormHandler::Manual::Fields</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="required,_required_when"
>required,
required_when</a></h2>

<p>Setting the &#39;required&#39; flag on a field initiates a check for the existence of some value.
If the field does not have a value,
the &#39;required&#39; error message is issued.</p>

<pre>   has_field &#39;section&#39; =&#62; ( required =&#62; 1,
       messages =&#62; { required =&#62; &#39;Please provide a section&#39; } );</pre>

<p>Note that a required flag on a subfield -- a field inside a compound field or repeatable field -- does not cause the containing field to be required. You need to set &#39;required&#39; all the way up, if that&#39;s the behavior that you want.</p>

<p>If a field is empty and *not* required, no other field validation will be performed unless the &#39;validate_when_empty&#39; flag (see below) is set. The form&#39;s &#39;validate&#39; method, however, will always be called.</p>

<p>There is also the &#39;required_when&#39; attribute, which works the same way as the &#39;when&#39; key on the apply actions.</p>

<pre>    has_field &#39;fee&#39; =&#62; ( required_when =&#62; { &#39;fie&#39; =&#62; 2 } );</pre>

<p>When a &#39;required&#39; or &#39;required_when&#39; check fails, a &#39;missing&#39; flag is set in the result:</p>

<pre>    if ( $field-&#62;missing ) { ... }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="range_start,_range_end"
>range_start, range_end</a></h2>

<p>Starting and ending range for number fields.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="unique"
>unique</a></h2>

<p>Attribute used by the DBIC model to check for uniqueness.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="validate_when_empty"
>validate_when_empty</a></h2>

<p>If its &#39;validate_when_empty&#39; flag is set to a true value, then a field will always undergo validation when its form is processed, even when that field is empty.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Validation_methods"
>Validation methods</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="validate_method"
>validate_method</a></h2>

<p>You can provide a validation method for a field by setting a coderef with &#39;validate_method&#39;.</p>

<pre>    has_field &#39;fox&#39; =&#62; ( validate_method =&#62; \&#38;check_fox );
    sub check_fox {
        my $self = shift; # self is the fox field
        unless( $self-&#62;value eq .... ) {
            $self-&#62;add_error(&#39;....&#39;);
        }
    }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="validate_&#60;field_name&#62;"
>validate_&#60;field_name&#62;</a></h2>

<p>If you provide a &#39;validate_&#60;field_name&#62;&#39; method it will be automatically used.</p>

<pre>    has_field &#39;cat&#39;;
    sub validate_cat {
        my ( $self, $field ) = @_; # self is the form
        unless ( $field-&#62;value eq  ... ) {
            $field-&#62;add_error( &#39;...&#39; );
        }
    }</pre>

<p>If the field name has periods in it, they should be replaced with underscores.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="form_validate_method"
>form validate method</a></h2>

<p>A form validation method can be used to do cross-validation or validation checks that need information from more than one field.</p>

<pre>    sub validate {
        my $self = shift;
        $self-&#62;field(&#39;foo&#39;)-&#62;add_error(&#39;....&#39;)
            if( $self-&#62;field(&#39;foo&#39;)-&#62;value eq &#39;..&#39; &#38;&#38;
                    $self-&#62;field(&#39;bar&#39;)-&#62;value eq &#39;..&#39; );
    }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="field_validate_method"
>field validate method</a></h2>

<p>You can create a custom field to contain a commonly used validation. The validation in a custom field can be done with &#39;apply&#39; or by using a &#39;validate&#39; method.</p>

<pre>    package MyApp::Form::Field::Custom;
    use HTML::FormHandler::Moose;
    extends &#39;HTML::FormHandler::Field&#39;; # or a subclass of Field

    sub validate {
        ....
    }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Apply_Actions:_Filters,_transformations,_and_constraints"
>Apply Actions: Filters, transformations, and constraints</a></h1>

<p>The actions in the &#39;apply&#39; array (stored in the &#39;actions&#39; attribute) will be performed in the order they are specified, allowing fine-grained control over inflation and validation. You can check constraints after transformations and vice versa. You can weave all three types of actions in any order you need.</p>

<p>The two valid &#39;apply&#39; array elements are 1) Moose types and 2) hashrefs with one of three keys: &#39;check&#39;, &#39;transform&#39;, and &#39;type&#39;. The hashrefs will usually also have an additional key, &#39;message&#39;, with a string, array or coderef providing an error message, which is localized.</p>

<p>The &#39;check&#39; key can point to a regex, arrayref of strings, or coderef. The value of the &#39;transform&#39; key should be a coderef. The value of the &#39;type&#39; key is a Moose type.</p>

<p>In addition to the check and type keys, you can provide a &#39;when&#39; key to only perform this validation when a particular field is a particular value:</p>

<pre>    has_field &#39;fee&#39;;
    has_field &#39;fie&#39; =&#62; ( apply =&#62; [
        { when =&#62; { fee =&#62; 1 }, check =&#62; qr/when/, message =&#62; &#39;Wrong fie&#39; },
    ]);
    has_field &#39;fo&#39;;
    has_field &#39;fum_comp&#39; =&#62; ( type =&#62; &#39;Compound&#39; );
    has_field &#39;fum_comp.one&#39;;
    has_field &#39;fum_comp.two&#39; =&#62; ( apply =&#62; [
        { when =&#62; { &#39;+fee&#39; =&#62; [1,2,3] }, check =&#62; qr/when/, message =&#62; &#39;Wrong two&#39; },
    ]);</pre>

<p>The field name key in the &#39;when&#39; hashref is assumed to be a field at the same &#34;level&#34; as this field (i.e. a sibling field in a compound). If you want to specify a field name from the form, prepend the name with a &#39;+&#39;.</p>

<p>The &#39;when&#39; hashref can contain multiple key/value pairs. This simply extends its test across multiple fields; all fields named in the hashref&#39;s keys must match their respective values in order for the overall &#39;when&#39; test to pass.</p>

<p>Transformations and coercions are called in an eval to catch the errors. Warnings are trapped in a sigwarn handler.</p>

<p>See also <a href="../../../HTML/FormHandler/Field.html" class="podlinkpod"
>HTML::FormHandler::Field</a> and <a href="../../../HTML/FormHandler/Validate.html" class="podlinkpod"
>HTML::FormHandler::Validate</a>. See <a href="../../../HTML/FormHandler/Manual/Inflation/Deflation.html" class="podlinkpod"
>HTML::FormHandler::Manual::Inflation::Deflation</a> for information on inflation and deflation.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Moose_types"
>Moose types</a></h2>

<p>Moose types can be used to do both constraints and transformations. If a coercion exists it will be applied, resulting in a transformation. After coercing, the result is checked. You can use type constraints from <a href="../../../MooseX/Types.html" class="podlinkpod"
>MooseX::Types</a> libraries or defined using <a href="../../../Moose/Util/TypeConstraints.html" class="podlinkpod"
>Moose::Util::TypeConstraints</a>.</p>

<p>FormHandler supplies a library of Moose types in <a href="../../../HTML/FormHandler/Types.html" class="podlinkpod"
>HTML::FormHandler::Types</a>.</p>

<pre>    use HTML::FormHandler::Types (&#39;NotAllDigits&#39;);
    has_field &#39;foo&#39; =&#62; ( apply =&#62; [ NotAllDigits ] );</pre>

<p>You can create your own library of types, too. Or you can create a type constraint in the form:</p>

<pre>  use Moose::Util::TypeConstraints;
  subtype &#39;GreaterThan10&#39;
     =&#62; as &#39;Int&#39;
     =&#62; where { $_ &#62; 10 }
     =&#62; message { &#34;This number ($_) is not greater than 10&#34; };

  has_field &#39;text_gt&#39; =&#62; ( apply=&#62; [ &#39;GreaterThan10&#39; ] );</pre>

<p>Moose types can also be used for their coercions to do transformations.</p>

<pre>  subtype &#39;MyInt&#39;
      =&#62; as &#39;Int&#39;;
  coerce &#39;MyInt&#39;
      =&#62; from &#39;MyStr&#39;
      =&#62; via { return $1 if /(\d+)/ };</pre>

<p>You can also use the &#39;type&#39; keyword with a Moose type if you want to change the message:</p>

<pre>    has_field &#39;text_gt&#39; =&#62; ( apply =&#62; [
        { type =&#62; &#39;GreaterThan10&#39;,
          message =&#62; &#39;Number is too small&#39; } ] );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="transform"
>transform</a></h2>

<p>A &#39;transform&#39; changes the format of a field&#39;s value, and does not need a message. It takes a coderef.</p>

<pre>   has_field &#39;another_field&#39; =&#62; (
      apply =&#62; [ { transform =&#62; sub{ sprintf &#39;&#60;%.1g&#62;&#39;, $_[0] } } ]
   );</pre>

<p>Note that transformed values are not displayed in the HTML form unless the &#39;fif_from_value&#39; flag is set. The transformed values are saved to the database or returned in <code>$form-&#62;value</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="&#39;check&#39;_regex"
>&#39;check&#39; regex</a></h2>

<p>Checks that field value matches the regex.</p>

<pre>   has_field &#39;some_field&#39; =&#62; (
      apply =&#62; [ { check =&#62; qr/aaa/, message =&#62; &#39;Must contain aaa&#39; } ],
   );</pre>

<p>You can use regex libraries like <a href="../../../Regexp/Common.html" class="podlinkpod"
>Regexp::Common</a> too:</p>

<pre>    use Regexp::Common (&#39;URI&#39;);
    ...
    has_field &#39;my_url&#39; =&#62; ( apply =&#62; [
        { check =&#62; qr/$RE{URI}{HTTP}/,
           message =&#62; &#39;Invalid URL&#39; } ] );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="&#39;check&#39;_arrayref_(matches)"
>&#39;check&#39; arrayref (matches)</a></h2>

<p>Provide an arrayref of strings to match against.</p>

<pre>   has_field &#39;set_error&#39; =&#62; (
      apply =&#62; [
         { check   =&#62; [ &#39;abc&#39;, &#39;bbb&#39; ],
            message =&#62; &#39;Must be &#34;aaa&#34; or &#34;bbb&#34;&#39; }
      ]
   );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="&#39;check&#39;_coderef"
>&#39;check&#39; coderef</a></h2>

<p>Provide a validation function to check. A &#39;check&#39; coderef will be passed the current value of the field and should return true or false. Note that the field is passed in as the second argument, to allow simple functions to work properly.</p>

<pre>   has_field &#39;callback_pass&#39; =&#62; (
      apply =&#62; [
         { check =&#62; \&#38;check_callback_pass,
             message =&#62; &#39;Must contain number greater than 10&#39;, }
       ]
   );
   sub check_callback_pass {
       my ( $value, $field ) = @_;
       if( $value =~ /(\d+)/ ) {
           return $1 &#62; 10;
       }
   }</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="message"
>message</a></h2>

<p>The message for the above checks can also be an arrayref or coderef. The arrayref is useful for localized messages. You can also provide error messages for Moose types.</p>

<pre>   has_field &#39;message_sub&#39; =&#62; (
      apply =&#62; [
         { check   =&#62; [ &#39;abc&#39; ],
            message =&#62; \&#38;err_message }
      ]
   );
   sub err_message {
       my ($value, $field ) = @_;
       return $field-&#62;name . &#39;: Must be &#34;abc&#34;&#39;;
   }
   has_field &#39;message_arrayref&#39; =&#62; (
      apply =&#62; [ { check =&#62; qr/aaa/,
          message =&#62; [&#39;Must contain [_1]&#39;, &#39;aaa&#39;] } ],
   );
   has_field &#39;my_moose_type_field&#39; =&#62; (
      apply =&#62; [ { type =&#62; SomeType,
         message =&#62; &#39;Invalid ...&#39; } ] );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="actions_in_a_field_class"
>actions in a field class</a></h2>

<p>To declare actions inside a field class use <a href="../../../HTML/FormHandler/Moose.html" class="podlinkpod"
>HTML::FormHandler::Moose</a> and &#39;apply&#39; sugar:</p>

<pre>   package MyApp::Field::Test;
   use HTML::FormHandler::Moose;
   extends &#39;HTML::FormHandler::Field;

   apply [ &#39;SomeConstraint&#39;, { check =&#62; ..., message =&#62; .... } ];

   1;</pre>

<p>Actions specified with apply are cumulative. Actions may be specified in field classes and additional actions added in the &#39;has_field&#39; declaration.</p>

<p>You can see examples of field classes with &#39;apply&#39; actions in the source for <a href="../../../HTML/FormHandler/Field/Money.html" class="podlinkpod"
>HTML::FormHandler::Field::Money</a> and <a href="../../../HTML/FormHandler/Field/Email.html" class="podlinkpod"
>HTML::FormHandler::Field::Email</a>, and in t/constraints.t.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Dependency"
>Dependency</a></h1>

<p>The &#39;dependency&#39; attribute is an array of arrays of field names. During validation, if any field in a given group has a value that matches the pattern /\S/ (non-blank), the &#39;required&#39; flag is set for all of the fields in the group.</p>

<pre>   has &#39;+dependency&#39; =&#62; ( default =&#62; sub {
            [
               [&#39;address&#39;, &#39;city&#39;, &#39;state&#39;, &#39;zip&#39;],
               [&#39;cc_no&#39;, &#39;cc_expires&#39;],
            ],
        },
    );</pre>

<p>You can also use the &#39;required_when&#39; flag to do something similar.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>FormHandler Contributors - see HTML::FormHandler</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2013 by Gerda Shank.</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
