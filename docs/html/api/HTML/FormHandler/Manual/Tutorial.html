<html><head><title>HTML::FormHandler::Manual::Tutorial</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:18 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#Using_HTML%3A%3AFormHandler_with_Catalyst'>Using HTML::FormHandler with Catalyst</a>
  <li class='indexItem indexItem1'><a href='#Installation'>Installation</a>
  <li class='indexItem indexItem1'><a href='#Use_the_Tutorial_application'>Use the Tutorial application</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Create_an_HTML%3A%3AFormHandler_form'>Create an HTML::FormHandler form</a>
    <li class='indexItem indexItem2'><a href='#Connect_HTML%3A%3AFormHandler_to_your_controller'>Connect HTML::FormHandler to your controller</a>
    <li class='indexItem indexItem2'><a href='#Add_Action_to_Display_and_Save_the_Form'>Add Action to Display and Save the Form</a>
    <li class='indexItem indexItem2'><a href='#Render_the_form'>Render the form</a>
    <li class='indexItem indexItem2'><a href='#Alternative_hand-built_Template_for_the_form_(optional)'>Alternative hand-built Template for the form (optional)</a>
    <li class='indexItem indexItem2'><a href='#Add_links_to_access_create_and_update_actions'>Add links to access create and update actions</a>
    <li class='indexItem indexItem2'><a href='#Test_the_HTML%3A%3AFormHandler_Create_Form'>Test the HTML::FormHandler Create Form</a>
    <li class='indexItem indexItem2'><a href='#Add_additional_attributes_to_your_form%27s_fields'>Add additional attributes to your form&#39;s fields</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#HTML%3A%3AFormHandler_Validation'>HTML::FormHandler Validation</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Add_customized_validation'>Add customized validation</a>
    <li class='indexItem indexItem2'><a href='#Check_out_the_validation'>Check out the validation</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>HTML::FormHandler::Manual::Tutorial - how to use FormHandler with Catalyst</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 0.40028</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p><a href="../../../HTML/FormHandler/Manual.html" class="podlinkpod"
>Manual Index</a></p>

<p>A tutorial for beginners to <a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Using_HTML::FormHandler_with_Catalyst"
>Using HTML::FormHandler with Catalyst</a></h1>

<p>This tutorial demonstrates how you can use <a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a> to manage forms,
validate form input,
and interface your forms with the database.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Installation"
>Installation</a></h1>

<p>Use CPAN to install <a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Use_the_Tutorial_application"
>Use the Tutorial application</a></h1>

<p>We&#39;ll use the files that were created in the <a href="../../../Catalyst/Manual/Tutorial.html" class="podlinkpod"
>Catalyst::Manual::Tutorial</a>,
in order to concentrate on just the bits where HTML::FormHandler is useful.
You can download a tar file of the tutorial files from the Catalyst code repository.
(See <a href="../../../Catalyst/Manual/Tutorial/Intro.html" class="podlinkpod"
>Catalyst::Manual::Tutorial::Intro</a>.)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Create_an_HTML::FormHandler_form"
>Create an HTML::FormHandler form</a></h2>

<p>Untar the tutorial and make a lib/MyApp/Form directory.
In that directory create the file Book.pm.</p>

<pre>   package MyApp::Form::Book;

   use HTML::FormHandler::Moose;
   extends &#39;HTML::FormHandler::Model::DBIC&#39;;

   has &#39;+item_class&#39; =&#62; ( default =&#62; &#39;Book&#39; );
   has_field &#39;title&#39; =&#62; ( type =&#62; &#39;Text&#39; );
   has_field &#39;rating&#39; =&#62; ( type =&#62; &#39;Integer&#39; );
   has_field &#39;authors&#39; =&#62; ( type =&#62; &#39;Multiple&#39;, label_column =&#62; &#39;last_name&#39; );
   has_field &#39;submit&#39; =&#62; ( type =&#62; &#39;Submit&#39;, value =&#62; &#39;Submit&#39; );

   no HTML::FormHandler::Moose;
   1;</pre>

<p>This is your Form class. The form initializes the &#39;item_class&#39; to the source name of your DBIx::Class result class. The form&#39;s fields are defined with the &#39;has_field&#39; sugar, or in a &#39;field_list&#39;. The names of the fields should match a column, relationship, or other accessor in your DBIx::Class result class.</p>

<p>The basic fields have only a &#39;type&#39;, such as &#39;Text&#39;, or &#39;Integer&#39;. These types are actually the names of <a href="../../../HTML/FormHandler/Field.html" class="podlinkpod"
>HTML::FormHandler::Field</a> classes. &#39;Text&#39; and &#39;Integer&#39; are types that are provided by HTML::FormHandler, in <a href="../../../HTML/FormHandler/Field/Text.html" class="podlinkpod"
>HTML::FormHandler::Field::Text</a> and <a href="../../../HTML/FormHandler/Field/Integer.html" class="podlinkpod"
>HTML::FormHandler::Field::Integer</a>.</p>

<p>The &#39;Multiple&#39; type will allow you to easily create a multiple select list from the &#39;authors&#39; relationship. The &#39;label_column&#39; attribute must be defined because the column in the &#39;authors&#39; table which is used to create the select list does not have the default column name (&#39;name&#39;).</p>

<p>The &#39;submit&#39; field is necessary if you are going to use FormHandler to render your form. It wouldn&#39;t be necessary for hand-built templates or HTML.</p>

<p>Eventually you will want to create your own field classes, but for this simple form the default types are adequate.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Connect_HTML::FormHandler_to_your_controller"
>Connect HTML::FormHandler to your controller</a></h2>

<p>Edit lib/MyApp/Controller/Books.pm. Add use Moose:</p>

<pre>    use Moose;
    BEGIN { extends &#39;Catalyst::Controller&#39; }
    use MyApp::Form::Book;</pre>

<p>Create an attribute to hold your form:</p>

<pre>   has &#39;form&#39; =&#62; ( isa =&#62; &#39;MyApp::Form::Book&#39;, is =&#62; &#39;rw&#39;,
       lazy =&#62; 1, default =&#62; sub { MyApp::Form::Book-&#62;new } );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Add_Action_to_Display_and_Save_the_Form"
>Add Action to Display and Save the Form</a></h2>

<p>In <code>lib/MyApp/Controller/Books.pm</code> add the following method:</p>

<pre>    sub edit : Local {
        my ( $self, $c, $book_id ) = @_;

        $c-&#62;stash( template =&#62; &#39;books/edit.tt2&#39;,
                   form =&#62; $self-&#62;form );

        # Validate and insert/update database
        return unless $self-&#62;form-&#62;process( item_id =&#62; $book_id,
           params =&#62; $c-&#62;req-&#62;parameters,
           schema =&#62; $c-&#62;model(&#39;DB&#39;)-&#62;schema );

        # Form validated, return to the books list
        $c-&#62;flash-&#62;{status_msg} = &#39;Book saved&#39;;
        $c-&#62;res-&#62;redirect($c-&#62;uri_for(&#39;list&#39;));
    }</pre>

<p>This will handle both creating new books, and updating old books. If $book_id is undefined, then HTML::FormHandler will create a new book from your form. If you pass in a DBIx::Class row object instead of a primary key, you don&#39;t need to specify the schema.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Render_the_form"
>Render the form</a></h2>

<p>Save a copy of <code>root/src/books/edit.tt2</code> and create a new file that contains only:</p>

<pre>   [% form.render %]</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Alternative_hand-built_Template_for_the_form_(optional)"
>Alternative hand-built Template for the form (optional)</a></h2>

<p>Although the automatic rendering works well, sometimes it&#39;s necessary to hand build HTML. This section contains an example of a Template Toolkit template that may be used to display a FormHandler form.</p>

<p>In some cases, you might want to use the rendering for just the field and build custom divs or tables or whatever around it:</p>

<pre>  &#60;div class=&#34;mycustomclass&#34;&#62;
  [% form.render_field(&#39;book&#39;) %]
  &#60;/div&#62;</pre>

<p>If you don&#39;t want to play with HTML at this point, you can skip ahead to the next section.</p>

<p>You could also use TT macros to do pretty sophisticated template generation. But for now, we&#39;ll stick to a straightforward TT template:</p>

<p>Delete the single statement in <code>root/src/books/edit.tt2</code>, and enter or copy the following:</p>

<pre>   [% META title = &#39;Book Form&#39; %]

   [% FOR field IN form.error_fields %]
     [% FOR error IN field.errors %]
       &#60;p&#62;&#60;span class=&#34;error&#34; id=&#34;error&#34;&#62;
          [% field.label _ &#39;: &#39; _ error %] &#60;/span&#62;&#60;/p&#62;
     [% END %]
   [% END %]

   &#60;form name=&#34;[% form.name %]&#34;
         action=&#34;[% c.uri_for(&#39;edit&#39;, form.item_id) %]&#34;
         method=&#34;post&#34;&#62;
   &#60;p&#62;
   [% f = form.field(&#39;title&#39;) %]
   &#60;label class=&#34;label&#34; for=&#34;[% f.name %]&#34;&#62;[% f.label %]:&#60;/label&#62;
   &#60;input type=&#34;text&#34; name=&#34;[% f.name %]&#34; id=&#34;[% f.name %]&#34; value=&#34;[% f.fif %]&#34;&#62;
   &#60;/p&#62;
   &#60;p&#62;
   [% f = form.field(&#39;rating&#39;) %]
   &#60;label class=&#34;label&#34; for=&#34;[% f.name %]&#34;&#62;[% f.label %]:&#60;/label&#62;
   &#60;input type=&#34;text&#34; name=&#34;[% f.name %]&#34; id=&#34;[% f.name %]&#34; %] value=&#34;[% f.fif %]&#34;&#62;
   &#60;/p&#62;
   &#60;p&#62;
   [% f = form.field(&#39;authors&#39;) %]
   &#60;label class=&#34;label&#34; for=&#34;[% f.name %]&#34;&#62;[% f.label %]:&#60;/label&#62;
   &#60;select name=&#34;[% f.name %]&#34; multiple=&#34;multiple&#34; size=&#34;[% f.size %]&#34;&#62;
     [% FOR option IN f.options %]
       &#60;option value=&#34;[% option.value %]&#34;
         [% FOREACH selval IN f.fif %]
             [% IF selval == option.value %]selected=&#34;selected&#34;[% END %]
         [% END %]&#62;
       [% option.label | html %]&#60;/option&#62;
     [% END %]
   &#60;/select&#62;
   &#60;/p&#62;
   &#60;input class=&#34;button&#34; name=&#34;submit&#34; type=&#34;submit&#34; value=&#34;Submit&#34; /&#62;
   &#60;/form&#62;

   &#60;p&#62;&#60;a href=&#34;[% c.uri_for(&#39;list&#39;) %]&#34;&#62;Return to book list&#60;/a&#62;&#60;/p&#62;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Add_links_to_access_create_and_update_actions"
>Add links to access create and update actions</a></h2>

<p>Add a link to root/src/books/list.tt2 to allow you to edit an existing book, by changing the last &#60;td&#62; cell in the book list:</p>

<pre>   &#60;td&#62;
      &#60;a href=&#34;[% c.uri_for(&#39;delete&#39;, book.id) %]&#34;&#62;Delete&#60;/a&#62;|
      &#60;a href=&#34;[% c.uri_for(&#39;edit&#39;, book.id) %]&#34;&#62;Edit&#60;/a&#62;
   &#60;/td&#62;</pre>

<p>Change the link to create a book at the bottom of the file:</p>

<pre>    &#60;p&#62;
      &#60;a href=&#34;[% c.uri_for(&#39;edit&#39;) %]&#34;&#62;Create book&#60;/a&#62;
    &#60;/p&#62;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Test_the_HTML::FormHandler_Create_Form"
>Test the <a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a> Create Form</a></h2>

<p>Start up the server for MyApp:</p>

<pre>    $ script/myapp_server.pl</pre>

<p>(You&#39;ll need to login with test01/mypass if you&#39;re using the packaged tutorial.) Click the new &#34;Create book&#34; link at the bottom to display the form. Fill in the fields and click submit. You should be returned to the Book List page with a &#34;Book saved&#34; message.</p>

<p>Magic! A new book has been created and saved to the database with very little code in your controller.</p>

<p>Click on the &#39;edit&#39; links, and edit the existing books. Changes should be saved and displayed properly. Try to add an alphabetic character to the rating field. You should get an error message.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Add_additional_attributes_to_your_form&#39;s_fields"
>Add additional attributes to your form&#39;s fields</a></h2>

<p>We&#39;ll add a couple of &#39;label&#39; attributes to the fields:</p>

<pre>   has_field &#39;title&#39; =&#62; ( type =&#62; &#39;Text&#39;, label =&#62; &#39;Title of a Book&#39; );
   has_field &#39;rating&#39; =&#62; ( type =&#62; &#39;Integer&#39;, label =&#62; &#39;Rating (1-5)&#39; );
   has_field &#39;authors&#39; =&#62; ( type =&#62; &#39;Multiple&#39;, label_column =&#62; &#39;last_name&#39; );</pre>

<p>If you want a new attribute in your fields, it&#39;s very easy to add it to your custom Field classes.</p>

<pre>   package MyApp::Form::Field::Extra;
   use Moose;
   extends &#39;HTML::FormHandler::Field&#39;;

   has &#39;my_attribute&#39; =&#62; ( isa =&#62; Str, is =&#62; &#39;ro&#39; );

   1;</pre>

<p>Now if your Field classes inherit from this, you can have a &#39;my_attribute&#39; attribute for all your fields. Or use a Moose role instead of inheritance.</p>

<p>You can also add attributes to the base FormHandler field class using Moose. This technique is described in <a href="../../../HTML/FormHandler/Manual/Cookbook.html" class="podlinkpod"
>HTML::FormHandler::Manual::Cookbook</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="HTML::FormHandler_Validation"
><a href="../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a> Validation</a></h1>

<p>Now we&#39;ll add more validation to ensure that users are entering correct data.</p>

<p>Update the fields in the form file:</p>

<pre>   has_field &#39;title&#39; =&#62; ( type =&#62; &#39;Text&#39;, label =&#62; &#39;Title of a Book&#39;,
      required =&#62; 1, size =&#62; 40, minlength =&#62; 5 );
   has_field &#39;rating&#39; =&#62; ( type =&#62; &#39;Integer&#39;, label =&#62; &#39;Rating (1-5)&#39;,
      required =&#62; 1, messages =&#62; { required =&#62; &#39;You must rate the book&#39; },
      range_start =&#62; 1, range_end =&#62; 5 );
   has_field &#39;authors&#39; =&#62; ( type =&#62; &#39;Multiple&#39;, label_column =&#62; &#39;last_name&#39;,
      required =&#62; 1 );</pre>

<p>We&#39;ve made all the fields required. We added &#39;size&#39; and &#39;minlength&#39; attributes to the &#39;title&#39; field. These are attributes of the &#39;Text&#39; Field, which will use them to validate. We&#39;ve added &#39;range_start&#39; and &#39;range_end&#39; attributes to the &#39;rating&#39; field. Numbers entered in the form will be checked to make sure they fall within the defined range. (Another option would have been to use the &#39;IntRange&#39; field type, which makes it easy to create a select list of numbers.)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Add_customized_validation"
>Add customized validation</a></h2>

<p>You can create a Field class for validation that will be performed on more than one field, but it is easy to perform custom validation on a per-field basis.</p>

<p>This form doesn&#39;t really require any customized validation, so we&#39;ll add a silly field constraint. Add the following to the form:</p>

<pre>   sub validate_title {
      my ( $self, $field ) = @_;
      $field-&#62;add_error(&#34;The word \&#39;Rainbows\&#39; is not allowed in titles&#34;)
         if ( $field-&#62;value =~ /Rainbows/ );
   }</pre>

<p>You can also apply Moose constraints and transforms. Validation can also be performed in a form &#39;validate_&#60;field_name&#39; method, in a &#39;validate_model&#39; routine, and in a custom field class. You can validate that the field is unique, or use a dependency list to make more fields required if one is updated.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Check_out_the_validation"
>Check out the validation</a></h2>

<p>Restart the development server, login, and try adding books with various errors: title length less than 5 or more than 40, rating above 5, leaving out a particular field. Create a book with &#39;Rainbows&#39; in the title.</p>

<p>You should get error messages for every error.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>FormHandler Contributors - see HTML::FormHandler</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2013 by Gerda Shank.</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
