<html><head><title>HTML::FormHandler::TraitFor::Model::DBIC</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:18 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#DBIC_Relationships'>DBIC Relationships</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#belongs_to'>belongs_to</a>
    <li class='indexItem indexItem2'><a href='#many_to_many'>many_to_many</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#schema'>schema</a>
    <li class='indexItem indexItem2'><a href='#validate_model'>validate_model</a>
    <li class='indexItem indexItem2'><a href='#update_model'>update_model</a>
    <li class='indexItem indexItem2'><a href='#lookup_options'>lookup_options</a>
    <li class='indexItem indexItem2'><a href='#init_value'>init_value</a>
    <li class='indexItem indexItem2'><a href='#validate_unique'>validate_unique</a>
    <li class='indexItem indexItem2'><a href='#source'>source</a>
    <li class='indexItem indexItem2'><a href='#resultset'>resultset</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Attributes'>Attributes</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>HTML::FormHandler::TraitFor::Model::DBIC - model role that interfaces with DBIx::Class</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 0.28</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>Subclass your form from HTML::FormHandler::Model::DBIC:</p>

<pre>    package MyApp::Form::User;
    use HTML::FormHandler::Moose;
    extends &#39;HTML::FormHandler::Model::DBIC&#39;;</pre>

<p>or apply as a role to FormHandler class:</p>

<pre>   package MyApp::Form::User;
   use HTML::FormHandler::Moose;
   extends &#39;HTML::FormHandler&#39;;
   with &#39;HTML::FormHandler::TraitFor::Model::DBIC&#39;;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This is a separate <a href="../../../../DBIx/Class.html" class="podlinkpod"
>DBIx::Class</a> model role for <a href="../../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a>. It will handle normal DBIC column accessors and a number of DBIC relationships. It will save form fields automatically to the database. The distribution contains a form generator (<a href="../../../../HTML/FormHandler/Generator/DBIC.html" class="podlinkpod"
>HTML::FormHandler::Generator::DBIC</a>). An example application can be found on github at http://github.com/gshank/formhandler-example.</p>

<p><a href="../../../../HTML/FormHandler/TraitFor/DBICFields.html" class="podlinkpod"
>HTML::FormHandler::TraitFor::DBICFields</a> can be used to auto-generate forms from a DBIC result.</p>

<pre>    my $book = $schema-&#62;resultset(&#39;Book&#39;)-&#62;find(1);
    my $form = HTML::FormHandler::Model::DBIC-&#62;new_with_traits(
       traits =&#62; [&#39;HTML::FormHandler::TraitFor::DBICFields&#39;],
       field_list =&#62; [ &#39;submit&#39; =&#62; { type =&#62; &#39;Submit&#39;, value =&#62; &#39;Save&#39;, order =&#62; 99 } ],
       item =&#62; $book );</pre>

<p>This model supports using DBIx::Class result_source accessors just as if they were standard columns. Forms that need to do custom updating usually will subclass or use an &#39;around&#39; method modifier on the &#39;update_model&#39; method.</p>

<p>There are two ways to get a valid DBIC model. The first way is to set:</p>

<pre>   item_id (primary key)
   item_class (source name)
   schema</pre>

<p>The &#39;item_class&#39; is usually set in the form class:</p>

<pre>    # Associate this form with a DBIx::Class result class
    has &#39;+item_class&#39; =&#62; ( default =&#62; &#39;User&#39; ); # &#39;User&#39; is the DBIC source_name</pre>

<p>The &#39;item_id&#39; and &#39;schema&#39; must be passed in when the form is used in your controller.</p>

<pre>   $form-&#62;process( item_id =&#62; $id, schema =&#62; $c-&#62;model(&#39;DB&#39;)-&#62;schema,
                   params =&#62; $c-&#62;req-&#62;params );</pre>

<p>If the item_id is not defined, then a new record will be created.</p>

<p>The second way is to pass in a DBIx::Class row, or &#39;item&#39;;</p>

<pre>   $form-&#62;process( item =&#62; $row, params =&#62; $c-&#62;req-&#62;params );</pre>

<p>The &#39;item_id&#39;, &#39;item_class&#39;, and &#39;schema&#39; will be derived from the &#39;item&#39;. For a new row (such as on a &#39;create&#39; ), you can use new_result:</p>

<pre>   my $item = $c-&#62;model(&#39;DB::Book&#39;)-&#62;new_result({});
   $form-&#62;process( item =&#62; $item, params =&#62; $c-&#62;req-&#62;params );</pre>

<p>The accessor names of the fields in your form should match column, relationship, or accessor names in your DBIx::Class result source. Usually the field name and accessor are the same, but they may be different.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DBIC_Relationships"
>DBIC Relationships</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="belongs_to"
>belongs_to</a></h2>

<p>Single Select fields will handle &#39;belongs_to&#39; relationships, where the related table is used to construct a selection list from the database.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="many_to_many"
>many_to_many</a></h2>

<p>Multiple Select fields use a &#39;many_to_many&#39; pseudo-relation to retrieve the selection list from the database.</p>

<pre>   has_field &#39;roles&#39; =&#62; (
      type =&#62; &#39;Multiple&#39;,
      label_column =&#62; &#39;role&#39;,
   );</pre>

<p>You need to supply &#39;label_column&#39; to indicate which column should be used as label.</p>

<p>A Compound field can represent a single relation. A Repeatable field will map onto a multiple relationship.</p>

<p>More information is available from:</p>

<p><a href="../../../../HTML/FormHandler.html" class="podlinkpod"
>HTML::FormHandler</a></p>

<p><a href="../../../../HTML/FormHandler/Manual.html" class="podlinkpod"
>HTML::FormHandler::Manual</a></p>

<p><a href="../../../../HTML/FormHandler/Field.html" class="podlinkpod"
>HTML::FormHandler::Field</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="schema"
>schema</a></h2>

<p>Stores the schema that is either passed in, created from the model name in the controller, or created from the Catalyst context and the item_class in the plugin.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="validate_model"
>validate_model</a></h2>

<p>The place to put validation that requires database-specific lookups. Subclass this method in your form. Validation of unique fields is called from this method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="update_model"
>update_model</a></h2>

<p>Updates the database. If you want to do some extra database processing (such as updating a related table) this is the method to subclass in your form.</p>

<p>This routine allows the use of non-database (non-column, non-relationship) accessors in your result source class. It identifies form fields as column, relationship, select, multiple, or other. Column and other fields are processed and update is called on the row. Then relationships are processed.</p>

<p>If the row doesn&#39;t exist (no primary key or row object was passed in), then a row is created.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="lookup_options"
>lookup_options</a></h2>

<p>This method is used with &#34;Single&#34; and &#34;Multiple&#34; field select lists (&#34;single&#34;, &#34;filter&#34;, and &#34;multi&#34; relationships). It returns an array reference of key/value pairs for the column passed in. The column name defined in $field-&#62;label_column will be used as the label. The default label_column is &#34;name&#34;. The labels are sorted by Perl&#39;s cmp sort.</p>

<p>If there is an &#34;active&#34; column then only active values are included, except if the form (item) has currently selected the inactive item. This allows existing records that reference inactive items to still have those as valid select options. The inactive labels are formatted with brackets to indicate in the select list that they are inactive.</p>

<p>The active column name is determined by calling: $active_col = $form-&#62;can( &#39;active_column&#39; ) ? $form-&#62;active_column : $field-&#62;active_column;</p>

<p>This allows setting the name of the active column globally if your tables are consistantly named (all lookup tables have the same column name to indicate they are active), or on a per-field basis.</p>

<p>The column to use for sorting the list is specified with &#34;sort_column&#34;. The currently selected values in a Multiple list are grouped at the top (by the Multiple field class).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="init_value"
>init_value</a></h2>

<p>This method sets a field&#39;s value (for $field-&#62;value).</p>

<p>This method is not called if a method &#34;init_value_$field_name&#34; is found in the form class - that method is called instead.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="validate_unique"
>validate_unique</a></h2>

<p>For fields that are marked &#34;unique&#34;, checks the database for uniqueness. The unique constraints registered in the DBIC result source (see <a href="../../../../DBIx/Class/ResultSource.html#add_unique_constraint" class="podlinkpod"
>&#34;add_unique_constraint&#34; in DBIx::Class::ResultSource</a>) will also be inspected for uniqueness unless the field&#39;s &#39;unique&#39; attribute is set to false. Alternatively, you can use the <code>unique_constraints</code> attribute to limit uniqueness checking to only a select group of unique constraints. Error messages can be specified in the <code>unique_messages</code> attribute. Here&#39;s an example where you might want to specify a unique widget name for a given department:</p>

<pre>   has &#39;+unique_constraints&#39; =&#62; ( default =&#62; sub { [&#39;department_widget_name&#39;] } );
   has &#39;+unique_messages&#39; =&#62; (
      default =&#62; sub {
         { department_widget_name =&#62; &#34;Please choose a unique widget name for this department&#34; };
      }
   );</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="source"
>source</a></h2>

<p>Returns a DBIx::Class::ResultSource object for this Result Class.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="resultset"
>resultset</a></h2>

<p>This method returns a resultset from the &#34;item_class&#34; specified in the form (<code>$schema-&#62;resultset( $form-&#62;item_class )</code>)</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Attributes"
>Attributes</a></h1>

<dl>
<dt><a name="schema"
>schema</a></dt>

<dd>
<dt><a name="source_name"
>source_name</a></dt>

<dd>
<dt><a name="unique_constraints"
>unique_constraints</a></dt>

<dd>
<dt><a name="unique_messages"
>unique_messages</a></dt>

<dd>
<dt><a name="ru_flags"
>ru_flags</a></dt>

<dd>
<p><a href="../../../../DBIx/Class/ResultSet/RecursiveUpdate.html" class="podlinkpod"
>DBIx::Class::ResultSet::RecursiveUpdate</a> is used to interface with <a href="../../../../DBIx/Class.html" class="podlinkpod"
>DBIx::Class</a>. By default, the flag &#39;unknown_params_ok&#39; is passed in. The &#39;ru_flags&#39; attribute is a hashref, and also provides &#39;set_ru_flag&#39;.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>FormHandler Contributors - see HTML::FormHandler</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2013 by Gerda Shank.</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
