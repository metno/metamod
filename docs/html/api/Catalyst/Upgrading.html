<html><head><title>Catalyst::Upgrading</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:03 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#Upgrading_to_Catalyst_5.90040'>Upgrading to Catalyst 5.90040</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Catalyst%3A%3APlugin%3A%3AUnicode%3A%3AEncoding_is_now_core'>Catalyst::Plugin::Unicode::Encoding is now core</a>
    <li class='indexItem indexItem2'><a href='#basic_async_and_event_loop_support'>basic async and event loop support</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Upgrading_to_Catalyst_5.90030'>Upgrading to Catalyst 5.90030</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Regex_dispatch_type_is_deprecated.'>Regex dispatch type is deprecated.</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Upgrading_to_Catalyst_5.9'>Upgrading to Catalyst 5.9</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Upgrading_the_FastCGI_Engine'>Upgrading the FastCGI Engine</a>
    <li class='indexItem indexItem2'><a href='#Upgrading_the_mod_perl_%2F_Apache_Engines'>Upgrading the mod_perl / Apache Engines</a>
    <li class='indexItem indexItem2'><a href='#Upgrading_the_HTTP_Engine'>Upgrading the HTTP Engine</a>
    <li class='indexItem indexItem2'><a href='#Upgrading_the_CGI_Engine'>Upgrading the CGI Engine</a>
    <li class='indexItem indexItem2'><a href='#Upgrading_Catalyst%3A%3AEngine%3A%3AHTTP%3A%3APrefork'>Upgrading Catalyst::Engine::HTTP::Prefork</a>
    <li class='indexItem indexItem2'><a href='#Upgrading_the_PSGI_Engine'>Upgrading the PSGI Engine</a>
    <li class='indexItem indexItem2'><a href='#Engines_which_are_known_to_be_broken'>Engines which are known to be broken</a>
    <li class='indexItem indexItem2'><a href='#Engines_with_unknown_status'>Engines with unknown status</a>
    <li class='indexItem indexItem2'><a href='#Plack_functionality'>Plack functionality</a>
    <li class='indexItem indexItem2'><a href='#Tests_in_5.9'>Tests in 5.9</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Upgrading_to_Catalyst_5.80'>Upgrading to Catalyst 5.80</a>
  <li class='indexItem indexItem1'><a href='#Moose_features'>Moose features</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Application_class_roles'>Application class roles</a>
    <li class='indexItem indexItem2'><a href='#Controller_actions_in_Moose_roles'>Controller actions in Moose roles</a>
    <li class='indexItem indexItem2'><a href='#Using_Moose_in_Components'>Using Moose in Components</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Known_backwards_compatibility_breakages'>Known backwards compatibility breakages</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Applications_in_a_single_file'>Applications in a single file</a>
    <li class='indexItem indexItem2'><a href='#Issues_with_Class%3A%3AC3'>Issues with Class::C3</a>
    <li class='indexItem indexItem2'><a href='#Components_which_inherit_from_Moose%3A%3AObject_before_Catalyst%3A%3AComponent'>Components which inherit from Moose::Object before Catalyst::Component</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#use_Moose_in_MyApp'>use Moose in MyApp</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#Anonymous_closures_installed_directly_into_the_symbol_table'>Anonymous closures installed directly into the symbol table</a>
    <li class='indexItem indexItem2'><a href='#Hooking_into_application_setup'>Hooking into application setup</a>
    <li class='indexItem indexItem2'><a href='#Components_with_a_new_method_which_returns_false'>Components with a new method which returns false</a>
    <li class='indexItem indexItem2'><a href='#__PACKAGE__-%3Emk_accessor(%27meta%27)%3B'>__PACKAGE__-&#62;mk_accessor(&#39;meta&#39;);</a>
    <li class='indexItem indexItem2'><a href='#Class%3A%3AData%3A%3AInheritable_side_effects'>Class::Data::Inheritable side effects</a>
    <li class='indexItem indexItem2'><a href='#Extending_Catalyst%3A%3ARequest_or_other_classes_in_an_ad_hoc_manner_using_mk_accessors'>Extending Catalyst::Request or other classes in an ad hoc manner using mk_accessors</a>
    <li class='indexItem indexItem2'><a href='#Confused_multiple_inheritance_with_Catalyst%3A%3AComponent%3A%3ACOMPONENT'>Confused multiple inheritance with Catalyst::Component::COMPONENT</a>
    <li class='indexItem indexItem2'><a href='#Development_server_relying_on_environment_variables'>Development server relying on environment variables</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#WARNINGS'>WARNINGS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Actions_in_your_application_class'>Actions in your application class</a>
    <li class='indexItem indexItem2'><a href='#%3A%3A%5BMVC%5D%3A%3A_naming_scheme'>::[MVC]:: naming scheme</a>
    <li class='indexItem indexItem2'><a href='#Catalyst%3A%3ABase'>Catalyst::Base</a>
    <li class='indexItem indexItem2'><a href='#Methods_in_Catalyst%3A%3ADispatcher'>Methods in Catalyst::Dispatcher</a>
    <li class='indexItem indexItem2'><a href='#Class_files_with_names_that_don%27t_correspond_to_the_packages_they_define'>Class files with names that don&#39;t correspond to the packages they define</a>
    <li class='indexItem indexItem2'><a href='#%24c-%3Eplugin_method'>$c-&#62;plugin method</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Catalyst::Upgrading - Instructions for upgrading to the latest Catalyst</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_to_Catalyst_5.90040"
>Upgrading to Catalyst 5.90040</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Catalyst::Plugin::Unicode::Encoding_is_now_core"
>Catalyst::Plugin::Unicode::Encoding is now core</a></h2>

<p>The previously stand alone Unicode support module <a href="../Catalyst/Plugin/Unicode/Encoding.html" class="podlinkpod"
>Catalyst::Plugin::Unicode::Encoding</a> has been brought into core as a default plugin.
Going forward,
all you need is to add a configuration setting for the encoding type.
For example:</p>

<pre>    package Myapp::Web;

    use Catalyst;

    __PACKAGE__-&#62;config( encoding =&#62; &#39;UTF-8&#39; );</pre>

<p>Please note that this is different from the old stand alone plugin which applied <code>UTF-8</code> encoding by default (that is, if you did not set an explicit <code>encoding</code> configuration value, it assumed you wanted UTF-8). In order to preserve backwards compatibility you will need to explicitly turn it on via the configuration setting. THIS MIGHT CHANGE IN THE FUTURE, so please consider starting to test your application with proper UTF-8 support and remove all those crappy hacks you munged into the code because you didn&#39;t know the Plugin existed :)</p>

<p>For people that are using the Plugin, you will note a startup warning suggesting that you can remove it from the plugin list. When you do so, please remember to add the configuration setting, since you can no longer rely on the default being UTF-8. We&#39;ll add it for you if you continue to use the stand alone plugin and we detect this, but this backwards compatibility shim will likely be removed in a few releases (trying to clean up the codebase after all).</p>

<p>If you have trouble with any of this, please bring it to the attention of the Catalyst maintainer group.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="basic_async_and_event_loop_support"
>basic async and event loop support</a></h2>

<p>This version of <a href="../Catalyst.html" class="podlinkpod"
>Catalyst</a> offers some support for using <a href="../AnyEvent.html" class="podlinkpod"
>AnyEvent</a> and <a href="../IO/Async.html" class="podlinkpod"
>IO::Async</a> event loops in your application. These changes should work fine for most applications however if you are already trying to perform some streaming, minor changes in this area of the code might affect your functionality. Please see <a href="../Catalyst/Response%5Cwrite_fh.html" class="podlinkpod"
>Catalyst::Response\write_fh</a> for more and for a basic example.</p>

<p>We consider this feature experimental. We will try not to break it, but we reserve the right to make necessary changes to fix major issues that people run into when the use this functionality in the wild.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_to_Catalyst_5.90030"
>Upgrading to Catalyst 5.90030</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Regex_dispatch_type_is_deprecated."
>Regex dispatch type is deprecated.</a></h2>

<p>The Regex dispatchtype (<a href="../Catalyst/DispatchType/Regex.html" class="podlinkpod"
>Catalyst::DispatchType::Regex</a>) has been deprecated.</p>

<p>You are encouraged to move your application to Chained dispatch (<a href="../Catalyst/DispatchType/Chained.html" class="podlinkpod"
>Catalyst::DispatchType::Chained</a>).</p>

<p>If you cannot do so, please add a dependency to Catalyst::DispatchType::Regex to your application&#39;s Makefile.PL</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_to_Catalyst_5.9"
>Upgrading to Catalyst 5.9</a></h1>

<p>The major change is that <a href="../Plack.html" class="podlinkpod"
>Plack</a>, a toolkit for using the <a href="../PSGI.html" class="podlinkpod"
>PSGI</a> specification, now replaces most of the subclasses of <a href="../Catalyst/Engine.html" class="podlinkpod"
>Catalyst::Engine</a>. If you are using one of the standard subclasses of <a href="../Catalyst/Engine.html" class="podlinkpod"
>Catalyst::Engine</a> this should be a straightforward upgrade for you. It was a design goal for this release to preserve as much backwards compatibility as possible. However, since <a href="../Plack.html" class="podlinkpod"
>Plack</a> is different from <a href="../Catalyst/Engine.html" class="podlinkpod"
>Catalyst::Engine</a>, it is possible that differences exist for edge cases. Therefore, we recommend that care be taken with this upgrade and that testing should be greater than would be the case with a minor point update. Please inform the Catalyst developers of any problems so that we can fix them and incorporate tests.</p>

<p>It is highly recommended that you become familiar with the <a href="../Plack.html" class="podlinkpod"
>Plack</a> ecosystem and documentation. Being able to take advantage of <a href="../Plack.html" class="podlinkpod"
>Plack</a> development and middleware is a major bonus to this upgrade. Documentation about how to take advantage of <a href="../Plack/Middleware.html" class="podlinkpod"
>Plack::Middleware</a> by writing your own <code>.psgi</code> file is contained in <a href="../Catalyst/PSGI.html" class="podlinkpod"
>Catalyst::PSGI</a>.</p>

<p>If you have created a custom subclass of <a href="Catalyst:Engine" class="podlinkurl"
>Catalyst:Engine</a>, you will need to convert it to be a subclass of <a href="../Plack/Handler.html" class="podlinkpod"
>Plack::Handler</a>.</p>

<p>If you are using the <a href="../Plack.html" class="podlinkpod"
>Plack</a> engine, <a href="../Catalyst/Engine/PSGI.html" class="podlinkpod"
>Catalyst::Engine::PSGI</a>, this new release supersedes that code.</p>

<p>If you are using a subclass of <a href="../Catalyst/Engine.html" class="podlinkpod"
>Catalyst::Engine</a> that is aimed at nonstandard or internal/testing uses, such as <a href="../Catalyst/Engine/Embeddable.html" class="podlinkpod"
>Catalyst::Engine::Embeddable</a>, you should still be able to continue using that engine.</p>

<p>Advice for specific subclasses of <a href="../Catalyst/Engine.html" class="podlinkpod"
>Catalyst::Engine</a> follows:</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_the_FastCGI_Engine"
>Upgrading the FastCGI Engine</a></h2>

<p>No upgrade is needed if your myapp_fastcgi.pl script is already upgraded to use <a href="../Catalyst/Script/FastCGI.html" class="podlinkpod"
>Catalyst::Script::FastCGI</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_the_mod_perl_/_Apache_Engines"
>Upgrading the mod_perl / Apache Engines</a></h2>

<p>The engines that are built upon the various iterations of mod_perl, <a href="../Catalyst/Engine/Apache/MP13.html" class="podlinkpod"
>Catalyst::Engine::Apache::MP13</a> (for mod_perl 1, and Apache 1.x) and <a href="../Catalyst/Engine/Apache2/MP20.html" class="podlinkpod"
>Catalyst::Engine::Apache2::MP20</a> (for mod_perl 2, and Apache 2.x), should be seamless upgrades and will work using using <a href="../Plack/Handler/Apache1.html" class="podlinkpod"
>Plack::Handler::Apache1</a> or <a href="../Plack/Handler/Apache2.html" class="podlinkpod"
>Plack::Handler::Apache2</a> as required.</p>

<p><a href="../Catalyst/Engine/Apache2/MP19.html" class="podlinkpod"
>Catalyst::Engine::Apache2::MP19</a>, however, is no longer supported, as Plack does not support mod_perl version 1.99. This is unlikely to be a problem for anyone, as 1.99 was a brief beta-test release for mod_perl 2, and all users of mod_perl 1.99 are encouraged to upgrade to a supported release of Apache 2 and mod_perl 2.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_the_HTTP_Engine"
>Upgrading the HTTP Engine</a></h2>

<p>The default development server that comes with the <a href="../Catalyst.html" class="podlinkpod"
>Catalyst</a> distribution should continue to work as expected with no changes as long as your <code>myapp_server</code> script is upgraded to use <a href="../Catalyst/Script/HTTP.html" class="podlinkpod"
>Catalyst::Script::HTTP</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_the_CGI_Engine"
>Upgrading the CGI Engine</a></h2>

<p>If you were using <a href="../Catalyst/Engine/CGI.html" class="podlinkpod"
>Catalyst::Engine::CGI</a> there is no upgrade needed if your myapp_cgi.pl script is already upgraded to use <a href="../Catalyst/Script/CGI.html" class="podlinkpod"
>Catalyst::Script::CGI</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_Catalyst::Engine::HTTP::Prefork"
>Upgrading Catalyst::Engine::HTTP::Prefork</a></h2>

<p>If you were using <a href="../Catalyst/Engine/HTTP/Prefork.html" class="podlinkpod"
>Catalyst::Engine::HTTP::Prefork</a> then <a href="../Starman.html" class="podlinkpod"
>Starman</a> is automatically loaded. You should (at least) change your <code>Makefile.PL</code> to depend on Starman.</p>

<p>You can regenerate your <code>myapp_server.pl</code> script with <code>catalyst.pl</code> and implement a <code>MyApp::Script::Server</code> class that looks like this:</p>

<pre>    package MyApp::Script::Server;
    use Moose;
    use namespace::autoclean;

    extends &#39;CatalystX::Script::Server::Starman&#39;;

    1;</pre>

<p>This takes advantage of the new script system, and will add a number of options to the standard server script as extra options are added by Starman.</p>

<p>More information about these options can be seen at <a href="../CatalystX/Script/Server/Starman.html#SYNOPSIS" class="podlinkpod"
>&#34;SYNOPSIS&#34; in CatalystX::Script::Server::Starman</a>.</p>

<p>An alternate route to implement this functionality is to write a simple .psgi file for your application, and then use the <a href="../plackup.html" class="podlinkpod"
>plackup</a> utility to start the server.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_the_PSGI_Engine"
>Upgrading the PSGI Engine</a></h2>

<p>If you were using <a href="../Catalyst/Engine/PSGI.html" class="podlinkpod"
>Catalyst::Engine::PSGI</a>, this new release supersedes this engine in supporting <a href="../Plack.html" class="podlinkpod"
>Plack</a>. By default the Engine is now always <a href="../Plack.html" class="podlinkpod"
>Plack</a>. As a result, you can remove the dependency on <a href="../Catalyst/Engine/PSGI.html" class="podlinkpod"
>Catalyst::Engine::PSGI</a> in your <code>Makefile.PL</code>.</p>

<p>Applications that were using <a href="../Catalyst/Engine/PSGI.html" class="podlinkpod"
>Catalyst::Engine::PSGI</a> previously should entirely continue to work in this release with no changes.</p>

<p>However, if you have an <code>app.psgi</code> script, then you no longer need to specify the PSGI engine. Instead, the <a href="../Catalyst.html" class="podlinkpod"
>Catalyst</a> application class now has a new method <code>psgi_app</code> which returns a <a href="../PSGI.html" class="podlinkpod"
>PSGI</a> compatible coderef which you can wrap in the middleware of your choice.</p>

<p>Catalyst will use the .psgi for your application if it is located in the <code>home</code> directory of the application.</p>

<p>For example, if you were using <a href="../Catalyst/Engine/PSGI.html" class="podlinkpod"
>Catalyst::Engine::PSGI</a> in the past, you will have written (or generated) a <code>script/myapp.psgi</code> file similar to this one:</p>

<pre>    use Plack::Builder;
    use MyCatalytApp;

    MyCatalystApp-&#62;setup_engine(&#39;PSGI&#39;);

    builder {
        enable ... # enable your desired middleware
        sub { MyCatalystApp-&#62;run(@_) };
    };</pre>

<p>Instead, you now say:</p>

<pre>    use Plack::Builder;
    use MyCatalystApp;

    builder {
        enable ... #enable your desired middleware
        MyCatalystApp-&#62;psgi_app;
    };</pre>

<p>In the simplest case:</p>

<pre>    MyCatalystApp-&#62;setup_engine(&#39;PSGI&#39;);
    my $app = sub { MyCatalystApp-&#62;run(@_) }</pre>

<p>becomes</p>

<pre>    my $app = MyCatalystApp-&#62;psgi_app(@_);</pre>

<p><b>NOT</b>:</p>

<pre>    my $app = sub { MyCatalystApp-&#62;psgi_app(@_) };
    # If you make ^^ this mistake, your app won&#39;t work, and will confuse the hell out of you!</pre>

<p>You can now move <code>script/myapp.psgi</code> to <code>myapp.psgi</code>, and the built-in Catalyst scripts and your test suite will start using your .psgi file.</p>

<p><b>NOTE:</b> If you rename your .psgi file without these modifications, then any tests run via <a href="../Catalyst/Test.html" class="podlinkpod"
>Catalyst::Test</a> will not be compatible with the new release, and will result in the development server starting, rather than the expected test running.</p>

<p><b>NOTE:</b> If you are directly accessing <code>$c-&#62;req-&#62;env</code> to get the PSGI environment then this accessor is moved to <code>$c-&#62;engine-&#62;env</code>, you will need to update your code.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Engines_which_are_known_to_be_broken"
>Engines which are known to be broken</a></h2>

<p>The following engines <b>DO NOT</b> work as of Catalyst version 5.9. The core team will be happy to work with the developers and/or users of these engines to help them port to the new Plack/Engine system, but for now, applications which are currently using these engines <b>WILL NOT</b> run without modification to the engine code.</p>

<dl>
<dt><a name="Catalyst::Engine::Wx"
>Catalyst::Engine::Wx</a></dt>

<dd>
<dt><a name="Catalyst::Engine::Zeus"
>Catalyst::Engine::Zeus</a></dt>

<dd>
<dt><a name="Catalyst::Engine::JobQueue::POE"
>Catalyst::Engine::JobQueue::POE</a></dt>

<dd>
<dt><a name="Catalyst::Engine::XMPP2"
>Catalyst::Engine::XMPP2</a></dt>

<dd>
<dt><a name="Catalyst::Engine::SCGI"
>Catalyst::Engine::SCGI</a></dt>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Engines_with_unknown_status"
>Engines with unknown status</a></h2>

<p>The following engines are untested or have unknown compatibility. Reports are highly encouraged:</p>

<dl>
<dt><a name="Catalyst::Engine::Mojo"
>Catalyst::Engine::Mojo</a></dt>

<dd>
<dt><a name="Catalyst::Engine::Server_(marked_as_Deprecated)"
>Catalyst::Engine::Server (marked as Deprecated)</a></dt>

<dd>
<dt><a name="Catalyst::Engine::HTTP::POE_(marked_as_Deprecated)"
>Catalyst::Engine::HTTP::POE (marked as Deprecated)</a></dt>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Plack_functionality"
>Plack functionality</a></h2>

<p>See <a href="../Catalyst/PSGI.html" class="podlinkpod"
>Catalyst::PSGI</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Tests_in_5.9"
>Tests in 5.9</a></h2>

<p>Tests should generally work the same in Catalyst 5.9, but there are some differences.</p>

<p>Previously, if using <a href="../Catalyst/Test.html" class="podlinkpod"
>Catalyst::Test</a> and doing local requests (against a local server), if the application threw an exception then this exception propagated into the test.</p>

<p>This behavior has been removed, and now a 500 response will be returned to the test. This change standardizes behavior, so that local test requests behave similarly to remote requests.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Upgrading_to_Catalyst_5.80"
>Upgrading to Catalyst 5.80</a></h1>

<p>Most applications and plugins should run unaltered on Catalyst 5.80.</p>

<p>However, a lot of refactoring work has taken place, and several changes have been made which could cause incompatibilities. If your application or plugin is using deprecated code, or relying on side effects, then you could have issues upgrading to this release.</p>

<p>Most issues found with existing components have been easy to solve. This document provides a complete description of behavior changes which may cause compatibility issues, and of new Catalyst warnings which might be unclear.</p>

<p>If you think you have found an upgrade-related issue which is not covered in this document, please email the Catalyst list to discuss the problem.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Moose_features"
>Moose features</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Application_class_roles"
>Application class roles</a></h2>

<p>You can only apply method modifiers after the application&#39;s <code>-&#62;setup</code> method has been called. This means that modifiers will not work with methods run during the call to <code>-&#62;setup</code>.</p>

<p>See <a href="../Catalyst/Manual/ExtendingCatalyst.html" class="podlinkpod"
>Catalyst::Manual::ExtendingCatalyst</a> for more information about using <a href="../Moose.html" class="podlinkpod"
>Moose</a> in your applications.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Controller_actions_in_Moose_roles"
>Controller actions in Moose roles</a></h2>

<p>You can use <a href="../MooseX/MethodAttributes/Role.html" class="podlinkpod"
>MooseX::MethodAttributes::Role</a> if you want to declare actions inside Moose roles.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Using_Moose_in_Components"
>Using Moose in Components</a></h2>

<p>The correct way to use Moose in a component in a both forward and backwards compatible way is:</p>

<pre>    package TestApp::Controller::Root;
    use Moose;
    BEGIN { extends &#39;Catalyst::Component&#39; }; # Or ::Controller, or whatever</pre>

<p>See <a href="#Components_which_inherit_from_Moose%3A%3AObject_before_Catalyst%3A%3AComponent" class="podlinkpod"
>&#34;Components which inherit from Moose::Object before Catalyst::Component&#34;</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Known_backwards_compatibility_breakages"
>Known backwards compatibility breakages</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Applications_in_a_single_file"
>Applications in a single file</a></h2>

<p>Applications must be in their own file, and loaded at compile time. This issue generally only affects the tests of CPAN distributions. Your application will fail if you try to define an application inline in a block, and use plugins which supply a <code> new </code> method, then use that application latter in tests within the same file.</p>

<p>This is due to the fact that Catalyst is inlining a new method on your application class allowing it to be compatible with Moose. The method used to do this changed in 5.80004 to avoid the possibility of reporting an &#39;Unknown Error&#39; if your application failed to compile.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Issues_with_Class::C3"
>Issues with Class::C3</a></h2>

<p>Catalyst 5.80 uses the <a href="../Algorithm/C3.html" class="podlinkpod"
>Algorithm::C3</a> method dispatch order. This is built into Perl 5.10, and comes via <a href="../Class/C3.html" class="podlinkpod"
>Class::C3</a> for Perl 5.8. This replaces <a href="../NEXT.html" class="podlinkpod"
>NEXT</a> with <a href="../Class/C3/Adopt/NEXT.html" class="podlinkpod"
>Class::C3::Adopt::NEXT</a>, forcing all components to resolve methods using C3, rather than the unpredictable dispatch order of <a href="../NEXT.html" class="podlinkpod"
>NEXT</a>.</p>

<p>This issue manifests itself by your application failing to start due to an error message about having a non-linear @ISA.</p>

<p>The Catalyst plugin most often causing this is <a href="../Catalyst/Plugin/Session/Store/FastMmap.html" class="podlinkpod"
>Catalyst::Plugin::Session::Store::FastMmap</a> - if you are using this plugin and see issues, then please upgrade your plugins, as it has been fixed. Note that Makefile.PL in the distribution will warn about known incompatible components.</p>

<p>This issue can, however, be found in your own application - the only solution is to go through each base class of the class the error was reported against, until you identify the ones in conflict, and resolve them.</p>

<p>To be able to generate a linear @ISA, the list of superclasses for each class must be resolvable using the C3 algorithm. Unfortunately, when superclasses are being used as mixins (to add functionality used in your class), and with multiple inheritance, it is easy to get this wrong.</p>

<p>Most common is the case of:</p>

<pre>    package Component1; # Note, this is the common case
    use base qw/Class::Accessor::Fast Class::Data::Inheritable/;

    package Component2; # Accidentally saying it this way causes a failure
    use base qw/Class::Data::Inheritable Class::Accessor::Fast/;

    package GoesBang;
    use base qw/Component1 Component2/;</pre>

<p>Any situation like this will cause your application to fail to start.</p>

<p>For additional documentation about this issue, and how to resolve it, see <a href="../Class/C3/Adopt/NEXT.html" class="podlinkpod"
>Class::C3::Adopt::NEXT</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Components_which_inherit_from_Moose::Object_before_Catalyst::Component"
>Components which inherit from Moose::Object before Catalyst::Component</a></h2>

<p>Moose components which say:</p>

<pre>    package TestApp::Controller::Example;
    use Moose;
    extends qw/Moose::Object Catalyst::Component/;</pre>

<p>to use the constructor provided by Moose, while working (if you do some hacks with the <code> BUILDARGS </code> method), will not work with Catalyst 5.80 as <code>Catalyst::Component</code> inherits from <code>Moose::Object</code>, and so <code> @ISA </code> fails to linearize.</p>

<p>The correct way to use Moose in a component in a both forward and backwards compatible way is:</p>

<pre>    package TestApp::Controller::Root;
    use Moose;
    BEGIN { extends &#39;Catalyst::Component&#39; }; # Or ::Controller, or whatever</pre>

<p>Note that the <code> extends </code> declaration needs to occur in a begin block for <a href="../attributes.html" class="podlinkpod"
>attributes</a> to operate correctly.</p>

<p>This way you do not inherit directly from <code>Moose::Object</code> yourself. Having components which do not inherit their constructor from <code>Catalyst::Component</code> is <b>unsupported</b>, and has never been recommended, therefore you&#39;re on your own if you&#39;re using this technique. You&#39;ll need to detect the version of Catalyst your application is running, and deal with it appropriately.</p>

<p>You also don&#39;t get the <a href="../Moose/Object.html" class="podlinkpod"
>Moose::Object</a> constructor, and therefore attribute initialization will not work as normally expected. If you want to use Moose attributes, then they need to be made lazy to correctly initialize.</p>

<p>Note that this only applies if your component needs to maintain component backwards compatibility for Catalyst versions before 5.71001 - in 5.71001 attributes work as expected, and the BUILD method is called normally (although BUILDARGS is not).</p>

<p>If you depend on Catalyst 5.8, then <b>all</b> Moose features work as expected.</p>

<p>You will also see this issue if you do the following:</p>

<pre>    package TestApp::Controller::Example;
    use Moose;
    use base &#39;Catalyst::Controller&#39;;</pre>

<p>as <code> use base </code> appends to @ISA.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="use_Moose_in_MyApp"
>use Moose in MyApp</a></h3>

<p>Similar to the above, this will also fail:</p>

<pre>    package MyApp;
    use Moose;
    use Catalyst qw/
      ConfigLoader
    /;
    __PACKAGE__-&#62;setup;</pre>

<p>If you need to use Moose in your application class (e.g. for method modifiers etc.) then the correct technique is:</p>

<pre>    package MyApp;
    use Moose;
    use Catalyst;

    extends &#39;Catalyst&#39;;

    __PACKAGE__-&#62;config( name =&#62; &#39;MyApp&#39; );
    __PACKAGE__-&#62;setup(qw/
        ConfigLoader
    /);</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Anonymous_closures_installed_directly_into_the_symbol_table"
>Anonymous closures installed directly into the symbol table</a></h2>

<p>If you have any code which installs anonymous subroutine references directly into the symbol table, you may encounter breakages. The simplest solution is to use <a href="../Sub/Name.html" class="podlinkpod"
>Sub::Name</a> to name the subroutine. Example:</p>

<pre>    # Original code, likely to break:
    my $full_method_name = join(&#39;::&#39;, $package_name, $method_name);
    *$full_method_name = sub { ... };

    # Fixed Code
    use Sub::Name &#39;subname&#39;;
    my $full_method_name = join(&#39;::&#39;,$package_name, $method_name);
    *$full_method_name = subname $full_method_name, sub { ... };</pre>

<p>Additionally, you can take advantage of Catalyst&#39;s use of <a href="../Class/MOP.html" class="podlinkpod"
>Class::MOP</a> and install the closure using the appropriate metaclass. Example:</p>

<pre>    use Class::MOP;
    my $metaclass = Moose::Meta::Class-&#62;initialize($package_name);
    $metaclass-&#62;add_method($method_name =&#62; sub { ... });</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Hooking_into_application_setup"
>Hooking into application setup</a></h2>

<p>To execute code during application start-up, the following snippet in MyApp.pm used to work:</p>

<pre>    sub setup {
        my ($class, @args) = @_;
        $class-&#62;NEXT::setup(@args);
        ... # things to do after the actual setup
    }</pre>

<p>With Catalyst 5.80 this won&#39;t work anymore, because Catalyst no longer uses NEXT.pm for method resolution. The functionality was only ever originally operational as <a href="../NEXT.html" class="podlinkpod"
>NEXT</a> remembers what methods have already been called, and will not call them again.</p>

<p>Using this now causes infinite recursion between MyApp::setup and Catalyst::setup, due to other backwards compatibility issues related to how plugin setup works. Moose method modifiers like <code>before|after|around setup =&#62; sub { ... };</code> also will not operate correctly on the setup method.</p>

<p>The right way to do it is this:</p>

<pre>    after setup_finalize =&#62; sub {
        ... # things to do after the actual setup
    };</pre>

<p>The setup_finalize hook was introduced as a way to avoid this issue.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Components_with_a_new_method_which_returns_false"
>Components with a new method which returns false</a></h2>

<p>Previously, if you had a component which inherited from Catalyst::COMPONENT, but overrode the new method to return false, then your class&#39;s configuration would be blessed into a hash on your behalf, and this would be returned from the COMPONENT method.</p>

<p>This behavior makes no sense, and so has been removed. Implementing your own <code> new </code> method in components is <b>highly</b> discouraged. Instead, you should inherit the new method from Catalyst::Component, and use Moose&#39;s BUILD functionality and/or Moose attributes to perform any construction work necessary for your class.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="__PACKAGE__-&#62;mk_accessor(&#39;meta&#39;);"
>__PACKAGE__-&#62;mk_accessor(&#39;meta&#39;);</a></h2>

<p>Won&#39;t work due to a limitation of <a href="../Moose.html" class="podlinkpod"
>Moose</a>. This is currently being fixed inside Moose.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Class::Data::Inheritable_side_effects"
>Class::Data::Inheritable side effects</a></h2>

<p>Previously, writing to a class data accessor would copy the accessor method down into your package.</p>

<p>This behavior has been removed. While the class data is still stored per-class, it is stored on the metaclass of the class defining the accessor.</p>

<p>Therefore anything relying on the side effect of the accessor being copied down will be broken.</p>

<p>The following test demonstrates the problem:</p>

<pre>    {
        package BaseClass;
        use base qw/Class::Data::Inheritable/;
        __PACKAGE__-&#62;mk_classdata(&#39;foo&#39;);
    }

    {
        package Child;
        use base qw/BaseClass/;
    }

    BaseClass-&#62;foo(&#39;base class&#39;);
    Child-&#62;foo(&#39;sub class&#39;);

    use Test::More;
    isnt(BaseClass-&#62;can(&#39;foo&#39;), Child-&#62;can(&#39;foo&#39;));</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Extending_Catalyst::Request_or_other_classes_in_an_ad_hoc_manner_using_mk_accessors"
>Extending Catalyst::Request or other classes in an ad hoc manner using mk_accessors</a></h2>

<p>Previously, it was possible to add additional accessors to Catalyst::Request (or other classes) by calling the mk_accessors class method.</p>

<p>This is no longer supported - users should make a subclass of the class whose behavior they would like to change, rather than globally polluting the Catalyst objects.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Confused_multiple_inheritance_with_Catalyst::Component::COMPONENT"
>Confused multiple inheritance with Catalyst::Component::COMPONENT</a></h2>

<p>Previously, Catalyst&#39;s COMPONENT method would delegate to the method on the right hand side, which could then delegate back again with NEXT. This is poor practice, and in addition, makes no sense with C3 method dispatch order, and is therefore no longer supported.</p>

<p>If a COMPONENT method is detected in the inheritance hierarchy to the right hand side of Catalyst::Component::COMPONENT, then the following warning message will be emitted:</p>

<pre>    There is a COMPONENT method resolving after Catalyst::Component
    in ${next_package}.</pre>

<p>The correct fix is to re-arrange your class&#39;s inheritance hierarchy so that the COMPONENT method you would like to inherit is the first (left-hand most) COMPONENT method in your @ISA.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Development_server_relying_on_environment_variables"
>Development server relying on environment variables</a></h2>

<p>Previously, the development server would allow propagation of system environment variables into the request environment, this has changed with the adoption of Plack. You can use <a href="../Plack/Middleware/ForceEnv.html" class="podlinkpod"
>Plack::Middleware::ForceEnv</a> to achieve the same effect.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="WARNINGS"
>WARNINGS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Actions_in_your_application_class"
>Actions in your application class</a></h2>

<p>Having actions in your application class will now emit a warning at application startup as this is deprecated. It is highly recommended that these actions are moved into a MyApp::Controller::Root (as demonstrated by the scaffold application generated by catalyst.pl).</p>

<p>This warning, also affects tests. You should move actions in your test, creating a myTest::Controller::Root, like the following example:</p>

<pre>    package MyTest::Controller::Root;

    use strict;
    use warnings;

    use parent &#39;Catalyst::Controller&#39;;

    __PACKAGE__-&#62;config(namespace =&#62; &#39;&#39;);

    sub action : Local {
        my ( $self, $c ) = @_;
        $c-&#62;do_something; 
    }

    1;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="::[MVC]::_naming_scheme"
>::[MVC]:: naming scheme</a></h2>

<p>Having packages called MyApp::[MVC]::XX is deprecated and can no longer be generated by catalyst.pl</p>

<p>This is still supported, but it is recommended that you rename your application components to Model/View/Controller.</p>

<p>A warning will be issued at application startup if the ::[MVC]:: naming scheme is in use.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Catalyst::Base"
>Catalyst::Base</a></h2>

<p>Any code using <a href="../Catalyst/Base.html" class="podlinkpod"
>Catalyst::Base</a> will now emit a warning; this module will be removed in a future release.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Methods_in_Catalyst::Dispatcher"
>Methods in Catalyst::Dispatcher</a></h2>

<p>The following methods in Catalyst::Dispatcher are implementation details, which may change in the 5.8X release series, and therefore their use is highly deprecated.</p>

<dl>
<dt><a name="tree"
>tree</a></dt>

<dd>
<dt><a name="dispatch_types"
>dispatch_types</a></dt>

<dd>
<dt><a name="registered_dispatch_types"
>registered_dispatch_types</a></dt>

<dd>
<dt><a name="method_action_class"
>method_action_class</a></dt>

<dd>
<dt><a name="action_hash"
>action_hash</a></dt>

<dd>
<dt><a name="container_hash"
>container_hash</a></dt>
</dl>

<p>The first time one of these methods is called, a warning will be emitted:</p>

<pre>    Class $class is calling the deprecated method Catalyst::Dispatcher::$public_method_name,
    this will be removed in Catalyst 5.9</pre>

<p>You should <b>NEVER</b> be calling any of these methods from application code.</p>

<p>Plugin authors and maintainers whose plugins currently call these methods should change to using the public API, or, if you do not feel the public API adequately supports your use case, please email the development list to discuss what API features you need so that you can be appropriately supported.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Class_files_with_names_that_don&#39;t_correspond_to_the_packages_they_define"
>Class files with names that don&#39;t correspond to the packages they define</a></h2>

<p>In this version of Catalyst, if a component is loaded from disk, but no symbols are defined in that component&#39;s name space after it is loaded, this warning will be issued:</p>

<pre>    require $class was successful but the package is not defined.</pre>

<p>This is to protect against confusing bugs caused by mistyping package names, and will become a fatal error in a future version.</p>

<p>Please note that &#39;inner packages&#39; (via <a href="../Devel/InnerPackage.html" class="podlinkpod"
>Devel::InnerPackage</a>) are still fully supported; this warning is only issued when component file naming does not map to <b>any</b> of the packages defined within that component.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$c-&#62;plugin_method"
>$c-&#62;plugin method</a></h2>

<p>Calling the plugin method is deprecated, and calling it at run time is <b>highly deprecated</b>.</p>

<p>Instead you are recommended to use <a href="../Catalyst/Model/Adaptor.html" class="podlinkpod"
>Catalyst::Model::Adaptor</a> or similar to compose the functionality you need outside of the main application name space.</p>

<p>Calling the plugin method will not be supported past Catalyst 5.81.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
