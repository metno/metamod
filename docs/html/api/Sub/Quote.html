<html><head><title>Sub::Quote</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:27 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#SUBROUTINES'>SUBROUTINES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#quote_sub'>quote_sub</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#options'>options</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#unquote_sub'>unquote_sub</a>
    <li class='indexItem indexItem2'><a href='#quoted_from_sub'>quoted_from_sub</a>
    <li class='indexItem indexItem2'><a href='#inlinify'>inlinify</a>
    <li class='indexItem indexItem2'><a href='#capture_unroll'>capture_unroll</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CAVEATS'>CAVEATS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#return'>return</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Sub::Quote - efficient generation of subroutines via string eval</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre> package Silly;

 use Sub::Quote qw(quote_sub unquote_sub quoted_from_sub);

 quote_sub &#39;Silly::kitty&#39;, q{ print &#34;meow&#34; };

 quote_sub &#39;Silly::doggy&#39;, q{ print &#34;woof&#34; };

 my $sound = 0;

 quote_sub &#39;Silly::dagron&#39;,
   q{ print ++$sound % 2 ? &#39;burninate&#39; : &#39;roar&#39; },
   { &#39;$sound&#39; =&#62; \$sound };</pre>

<p>And elsewhere:</p>

<pre> Silly-&#62;kitty;  # meow
 Silly-&#62;doggy;  # woof
 Silly-&#62;dagron; # burninate
 Silly-&#62;dagron; # roar
 Silly-&#62;dagron; # burninate</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This package provides performant ways to generate subroutines from strings.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SUBROUTINES"
>SUBROUTINES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="quote_sub"
>quote_sub</a></h2>

<pre> my $coderef = quote_sub &#39;Foo::bar&#39;, q{ print $x++ . &#34;\n&#34; }, { &#39;$x&#39; =&#62; \0 };</pre>

<p>Arguments: ?$name, $code, ?\%captures, ?\%options</p>

<p><code>$name</code> is the subroutine where the coderef will be installed.</p>

<p><code>$code</code> is a string that will be turned into code.</p>

<p><code>\%captures</code> is a hashref of variables that will be made available to the code. See the <a href="#SYNOPSIS" class="podlinkpod"
>&#34;SYNOPSIS&#34;</a>&#39;s <code>Silly::dagron</code> for an example using captures.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="options"
>options</a></h3>

<ul>
<li>no_install
<p><b>Boolean</b>. Set this option to not install the generated coderef into the passed subroutine name on undefer.</p>
</li>
</ul>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="unquote_sub"
>unquote_sub</a></h2>

<pre> my $coderef = unquote_sub $sub;</pre>

<p>Forcibly replace subroutine with actual code. Note that for performance reasons all quoted subs declared so far will be globally unquoted/parsed in a single eval. This means that if you have a syntax error in one of your quoted subs you may find out when some other sub is unquoted.</p>

<p>If $sub is not a quoted sub, this is a no-op.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="quoted_from_sub"
>quoted_from_sub</a></h2>

<pre> my $data = quoted_from_sub $sub;

 my ($name, $code, $captures, $compiled_sub) = @$data;</pre>

<p>Returns original arguments to quote_sub, plus the compiled version if this sub has already been unquoted.</p>

<p>Note that $sub can be either the original quoted version or the compiled version for convenience.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="inlinify"
>inlinify</a></h2>

<pre> my $prelude = capture_unroll {
   &#39;$x&#39; =&#62; 1,
   &#39;$y&#39; =&#62; 2,
 };

 my $inlined_code = inlinify q{
   my ($x, $y) = @_;

   print $x + $y . &#34;\n&#34;;
 }, &#39;$x, $y&#39;, $prelude;</pre>

<p>Takes a string of code, a string of arguments, a string of code which acts as a &#34;prelude&#34;, and a <b>Boolean</b> representing whether or not to localize the arguments.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="capture_unroll"
>capture_unroll</a></h2>

<pre> my $prelude = capture_unroll {
   &#39;$x&#39; =&#62; 1,
   &#39;$y&#39; =&#62; 2,
 };</pre>

<p>Generates a snippet of code which is suitable to be used as a prelude for <a href="#inlinify" class="podlinkpod"
>&#34;inlinify&#34;</a>. The keys are the names of the variables and the values are (duh) the values. Note that references work as values.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAVEATS"
>CAVEATS</a></h1>

<p>Much of this is just string-based code-generation, and as a result, a few caveats apply.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="return"
>return</a></h2>

<p>Calling <code>return</code> from a quote_sub&#39;ed sub will not likely do what you intend. Instead of returning from the code you defined in <code>quote_sub</code>, it will return from the overall function it is composited into.</p>

<p>So when you pass in:</p>

<pre>   quote_sub q{  return 1 if $condition; $morecode }</pre>

<p>It might turn up in the intended context as follows:</p>

<pre>  sub foo {

    &#60;important code a&#62;
    do {
      return 1 if $condition;
      $morecode
    };
    &#60;important code b&#62;

  }</pre>

<p>Which will obviously return from foo, when all you meant to do was return from the code context in quote_sub and proceed with running important code b.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
