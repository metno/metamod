<html><head><title>MetamodWeb::Utils::CollectionBasket</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.30,
  using Pod::Simple::PullParser v3.30,
  under Perl v5.014002 at Mon Jun  1 13:07:52 2015 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS%2FMETHODS'>FUNCTIONS/METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Eadd_dataste(%24ds_id)'>$basket-&#62;add_dataste($ds_id)</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Parameters'>Parameters</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Efind_data_locations(_%7Bfimex_%3D%3E_%24bool%7D_)'>$basket-&#62;find_data_locations( {fimex =&#62; $bool} )</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Options'>Options</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Eempty_basket()'>$basket-&#62;empty_basket()</a>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Eremove_datasets(%40remove_ids)'>$basket-&#62;remove_datasets(@remove_ids)</a>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Ecalculate_size()'>$basket-&#62;calculate_size()</a>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Enum_files()'>$basket-&#62;num_files()</a>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Efiles()'>$basket-&#62;files()</a>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Efile_info(%24dataset)'>$basket-&#62;file_info($dataset)</a>
    <li class='indexItem indexItem2'><a href='#%24basket-%3Eupdate_basket()'>$basket-&#62;update_basket()</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_build_dataset_ids()'>$self-&#62;_build_dataset_ids()</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Ehuman_readable_size(%24size)'>$self-&#62;human_readable_size($size)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Emax_size()'>$self-&#62;max_size()</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Emax_files()'>$self-&#62;max_files()</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Elist_download_scripts()'>$self-&#62;list_download_scripts()</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Eadd_user_msg()'>$self-&#62;add_user_msg()</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
  <li class='indexItem indexItem1'><a href='#POD_ERRORS'>POD ERRORS</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>MetamodWeb::Utils::CollectionBasket - The class responsible for implementing the collection basket.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This class implements the actual collection basket.
That is it implements a basket of datasets that the user can later download.</p>

<p>This class is responsible for handling all the interaction with the underlying storage mechanism,
whether it is in a cookie or on the server.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS/METHODS"
>FUNCTIONS/METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;add_dataste($ds_id)"
>$basket-&#62;add_dataste($ds_id)</a></h2>

<p>Add a new level 1 or level 2 dataset to the collection basket.
In the case of adding a level 1 dataset it will add level 2 datasets that match the current search criteria AND have <code>data_file_location</code> set.
In addition it will only try to added (max basket size - current basket size) files to the basket for efficiency reason.</p>

<p>If the level 1 dataset has no children but has wmsinfo,
the parent dataset will be added instead.
(work in progress)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Parameters"
>Parameters</a></h3>

<dl>
<dt><a name="$ds_id"
>$ds_id</a></dt>

<dd>
<p>The ds_id of the dataset to add.</p>
</dd>
</dl>

<p>Return the number of datasets to that was added to the collection basket.
Returns undef if for some reason no dataset could not be added,
or number of files added if successful.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;find_data_locations(_{fimex_=&#62;_$bool}_)"
>$basket-&#62;find_data_locations( {fimex =&#62; $bool} )</a></h2>

<p>Returns ref to list of file locations (may be fewer than # of items in basket,
possibly none)</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Options"
>Options</a></h3>

<dl>
<dt><a name="fimex"
>fimex</a></dt>

<dd>
<p>If set,
use OPeNDAP URL instead of HTTPServer</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;empty_basket()"
>$basket-&#62;empty_basket()</a></h2>

<p>Make the basket empty,
i.e.
remove all datasets from the basket.</p>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns 1;</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;remove_datasets(@remove_ids)"
>$basket-&#62;remove_datasets(@remove_ids)</a></h2>

<p>Remove a list of dataset ids from the basket.</p>

<dl>
<dt><a name="@remove_ids"
>@remove_ids</a></dt>

<dd>
<p>A list of ds_ids that should be removed from the collection basket.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns 1.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;calculate_size()"
>$basket-&#62;calculate_size()</a></h2>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>The size of all the files in the collection basket in bytes.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;num_files()"
>$basket-&#62;num_files()</a></h2>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns the number of files in the basket currently.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;files()"
>$basket-&#62;files()</a></h2>

<p>Returns an array reference with information about all the files in the collection basket.
Each element in the array is a hash reference; see file_info() for a list of keys.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;file_info($dataset)"
>$basket-&#62;file_info($dataset)</a></h2>

<p>Get the file information from a dataset object.</p>

<dl>
<dt><a name="$dataset"
>$dataset</a></dt>

<dd>
<p>A <code>DBIx::Class</code> row object for a dataset.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>A hash reference with file information for the dataset.
The hash reference has the following keys (more may be added later):</p>

<dl>
<dt><a name="name"
>name</a></dt>

<dd>
<dt><a name="ds_id"
>ds_id</a></dt>

<dd>
<dt><a name="data_file_location"
>data_file_location</a></dt>

<dd>
<dt><a name="data_file_size"
>data_file_size</a></dt>

<dd>
<dt><a name="wms_url"
>wms_url</a></dt>

<dd>
<dt><a name="distribution"
>distribution</a></dt>

<dd>
<dt><a name="HTTPServer"
>HTTPServer</a></dt>

<dd>
<dt><a name="OPENDAP"
>OPENDAP</a></dt>

<dd>
<p>Returns false if the dataset does not have a &#39;data_file_location&#39; as part of the metadata.</p>
</dd>
</dl>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$basket-&#62;update_basket()"
>$basket-&#62;update_basket()</a></h2>

<p>Update the basket in the current storage format.
This will either be setting a cookie or it means updating the collection basket in the database.</p>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns 1</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_build_dataset_ids()"
>$self-&#62;_build_dataset_ids()</a></h2>

<p>Initialise the <code>dataset_ids</code> attribute on object construction.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;human_readable_size($size)"
>$self-&#62;human_readable_size($size)</a></h2>

<p>Wrapper for <code>Metamod::Utils::human_readable_size()</code>.
Only exists to make that function easily available in templates.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;max_size()"
>$self-&#62;max_size()</a></h2>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>The maximum total size of the basket in bytes.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;max_files()"
>$self-&#62;max_files()</a></h2>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>The maximum number of files allowed in the basket.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;list_download_scripts()"
>$self-&#62;list_download_scripts()</a></h2>

<p>Get list of download scripts from config</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;add_user_msg()"
>$self-&#62;add_user_msg()</a></h2>

<p>Blah blah blah</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>GPLv2 <a href="http://www.gnu.org/licenses/gpl-2.0.html" class="podlinkurl"
>http://www.gnu.org/licenses/gpl-2.0.html</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="POD_ERRORS"
>POD ERRORS</a></h1>

<p>Hey!
<b>The above document had some coding errors,
which are explained below:</b></p>

<dl>
<dt><a name="Around_line_489:"
>Around line 489:</a></dt>

<dd>
<p>You forgot a &#39;=back&#39; before &#39;=head2&#39;</p>
</dd>
</dl>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
