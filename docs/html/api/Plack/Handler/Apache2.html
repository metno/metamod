<html><head><title>Plack::Handler::Apache2</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:25 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CREATING_CUSTOM_HANDLER'>CREATING CUSTOM HANDLER</a>
  <li class='indexItem indexItem1'><a href='#STARTUP_FILE'>STARTUP FILE</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#CONTRIBUTORS'>CONTRIBUTORS</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Plack::Handler::Apache2 - Apache 2.0 mod_perl handler to run PSGI application</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  # in your httpd.conf
  &#60;Location /&#62;
  SetHandler perl-script
  PerlResponseHandler Plack::Handler::Apache2
  PerlSetVar psgi_app /path/to/app.psgi
  &#60;/Location&#62;

  # Optionally preload your apps in startup
  PerlPostConfigRequire /etc/httpd/startup.pl</pre>

<p>See <a href="#STARTUP_FILE" class="podlinkpod"
>&#34;STARTUP FILE&#34;</a> for more details on writing a <code>startup.pl</code>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This is a mod_perl handler module to run any PSGI application with mod_perl on Apache 2.x.</p>

<p>If you want to run PSGI applications <i>behind</i> Apache instead of using mod_perl, see <a href="../../Plack/Handler/FCGI.html" class="podlinkpod"
>Plack::Handler::FCGI</a> to run with FastCGI, or use standalone HTTP servers such as <a href="../../Starman.html" class="podlinkpod"
>Starman</a> or <a href="../../Starlet.html" class="podlinkpod"
>Starlet</a> proxied with mod_proxy.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CREATING_CUSTOM_HANDLER"
>CREATING CUSTOM HANDLER</a></h1>

<p>If you want to create a custom handler that loads or creates PSGI applications using other means than loading from <code>.psgi</code> files, you can create your own handler class and use <code>call_app</code> class method to run your application.</p>

<pre>  package My::ModPerl::Handler;
  use Plack::Handler::Apache2;

  sub get_app {
    # magic!
  }

  sub handler {
    my $r = shift;
    my $app = get_app();
    Plack::Handler::Apache2-&#62;call_app($r, $app);
  }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="STARTUP_FILE"
>STARTUP FILE</a></h1>

<p>See <a href="http://perl.apache.org/docs/2.0/user/handlers/server.html#Startup_File" class="podlinkurl"
>http://perl.apache.org/docs/2.0/user/handlers/server.html#Startup_File</a> for information on the <code>startup.pl</code> file for preloading perl modules and your apps.</p>

<p>Some things to keep in mind when writing this file:</p>

<ul>
<li>multiple init phases
<p>You have to check that <a href="../../Apache2/ServerUtil.html#restart_count" class="podlinkpod"
>&#34;restart_count&#34; in Apache2::ServerUtil</a> is <code>&#62; 1</code>, otherwise your app will load twice and the env vars you set with <a href="http://perl.apache.org/docs/2.0/user/config/config.html#C_PerlSetEnv_" class="podlinkurl"
>PerlSetEnv</a> will not be available when your app is loading the first time.</p>

<p>Use the example below as a template.</p>
</li>

<li><code>@INC</code>
<p>The <code>startup.pl</code> file is a good place to add entries to your <code>@INC</code>. Use <a href="../../lib.html" class="podlinkpod"
>lib</a> to add entries, they can be in your app or <code>.psgi</code> as well, but if your modules are in a <a href="../../local/lib.html" class="podlinkpod"
>local::lib</a> or some such, you will need to add the path for anything to load.</p>

<p>Alternately, if you follow the example below, you can use:</p>

<pre>    PerlSetEnv PERL5LIB /some/path</pre>

<p>or</p>

<pre>    PerlSwitches -I/some/path</pre>

<p>in your <code>httpd.conf</code>, which will also work.</p>
</li>

<li>loading errors
<p>Any exceptions thrown in your <code>startup.pl</code> will stop Apache from starting at all.</p>

<p>You probably don&#39;t want a stray syntax error to bring your whole server down in a shared or development environment, in which case it&#39;s a good idea to wrap the <a href="#preload" class="podlinkpod"
>&#34;preload&#34;</a> call in an eval, using something like this:</p>

<pre>    require Plack::Handler::Apache2;

    my @psgis = (&#39;/path/to/app1.psgi&#39;, &#39;/path/to/app2.psgi&#39;);

    foreach my $psgi (@psgis) {
        eval {
            Plack::Handler::Apache2-&#62;preload($psgi); 1;
        } or do {
            my $error = $@ || &#39;Unknown Error&#39;;
            # STDERR goes to the error_log
            print STDERR &#34;Failed to load psgi &#39;$psgi&#39;: $error\n&#34;;
        };
    }</pre>
</li>

<li>dynamically loaded modules
<p>Some modules load their dependencies at runtime via e.g. <a href="../../Class/Load.html" class="podlinkpod"
>Class::Load</a>. These modules will not get preloaded into your parent process by just including the app/module you are using.</p>

<p>As an optimization, you can dump <code>%INC</code> from a request to see if you are using any such modules and preload them in your <code>startup.pl</code>.</p>

<p>Another method is dumping the difference between the <code>%INC</code> on process start and process exit. You can use something like this to accomplish this:</p>

<pre>    my $start_inc = { %INC };

    END {
        my @m;
        foreach my $m (keys %INC) {
            push @m, $m unless exists $start_inc-&#62;{$m};
        }

        if (@m) {
            # STDERR goes to the error_log
            print STDERR &#34;The following modules need to be preloaded:\n&#34;;
            print STDERR &#34;$_\n&#34; for @m;
        }
    }</pre>
</li>
</ul>

<p>Here is an example <code>startup.pl</code>:</p>

<pre>    #!/usr/bin/env perl

    use strict;
    use warnings;
    use Apache2::ServerUtil ();

    BEGIN {
        return unless Apache2::ServerUtil::restart_count() &#62; 1;

        require lib;
        lib-&#62;import(&#39;/path/to/my/perl/libs&#39;);

        require Plack::Handler::Apache2;

        my @psgis = (&#39;/path/to/app1.psgi&#39;, &#39;/path/to/app2.psgi&#39;);
        foreach my $psgi (@psgis) {
            Plack::Handler::Apache2-&#62;preload($psgi);
        }
    }

    1; # file must return true!</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Tatsuhiko Miyagawa</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONTRIBUTORS"
>CONTRIBUTORS</a></h1>

<p>Paul Driver</p>

<p>&#198;var Arnfj&#246;r&#240; Bjarmason</p>

<p>Rafael Kitover</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../Plack.html" class="podlinkpod"
>Plack</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
