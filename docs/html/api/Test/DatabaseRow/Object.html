<html><head><title>Test::DatabaseRow::Object</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:27 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Accessors'>Accessors</a>
    <li class='indexItem indexItem2'><a href='#Methods'>Methods</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Test::DatabaseRow::Object - examine database rows</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use Test::More tests =&#62; 1;
  use Test::DatabaseRow::Object;
 
  # setup the test
  my $tdr = Test::DatabaseRow::Object-&#62;new(
    sql_and_bind =&#62; &#34;SELECT * FROM contacts WHERE cid = &#39;123&#39;&#34;,
    tests        =&#62; [ name =&#62; &#34;trelane&#34; ],
  );

  # do the test and get a result back
  my $result_object = $tdr-&#62;tests_ok();

  # have those results render to Test::Builder
  $result_object-&#62;pass_to_test_builder(&#34;my database test&#34;);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module provides the underlying functionality of <code>Test::DatabaseRow</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Accessors"
>Accessors</a></h2>

<p>These are the read only accessors of the object. They may be (optionally) set at object creation time by passing their name and value to the constructor.</p>

<p>Each accessor may be queried by prefixing its name with the <code>has_</code> to determine if it has been set or not.</p>

<dl>
<dt><a name="db_results"
>db_results</a></dt>

<dd>
<p>An arrayref of hashrefs, each representing a row returned from the database. Each key in the hashref should be the column name and the value the corresponding field&#39;s value. This datastructure is identical to that.</p>

<p>If this accessor is not passed then it will be populated on first use by executing the contents of <code>sql_and_bind</code> against the passed <code>dbh</code>.</p>

<dt><a name="sql_and_bind"
>sql_and_bind</a></dt>

<dd>
<p>The SQL and bind variables to execute if no results were passed into the db_results hash. This should be an arrayref containing the SQL as the first element and the bind values as further values.</p>

<p>This accessor will automatically coerce a simple scalar passed in into a single</p>

<p>If this accessor is not passed then it will be populated on first use by building SQL from the <code>where</code> and <code>table</code> accessors.</p>

<dt><a name="dbh"
>dbh</a></dt>

<dd>
<p>The database handle used to execute the SQL statement in <code>sql_and_bind</code> if no <code>db_results</code> were passed.</p>

<dt><a name="table"
>table</a></dt>

<dd>
<p>The table name used to build the SQL query if no value is passed to <code>sql_and_bind</code>. String.</p>

<dt><a name="where"
>where</a></dt>

<dd>
<p>The data structure used to build the where clause of the SQL query if no value is passed to &#60;sql_and_bind&#62;.</p>

<p>This accessor value should be a hashref of hashrefs, with the outer keys being the SQL comparison operator, the inner keys being the field names and the inner values being the values to match against. For example:</p>

<pre>  { 
    &#39;=&#39;    =&#62; { first =&#62; &#34;Fred&#34;, last =&#62; &#34;Flintstone&#34;, },
    &#39;like&#39; =&#62; { address =&#62; &#34;%Bedrock%&#34; },
  }</pre>

<p>Values of <code>undef</code> will automatically converted into checks for NULLs.</p>

<p>This accessor automatically coerces array refs that are passed into a pure equals hashref. For example:</p>

<pre>  [ foo =&#62; &#34;bar&#34;, bazz =&#62; &#34;buzz&#34; ]</pre>

<p>Will be coerced into:</p>

<pre>  { &#34;=&#34; =&#62; { foo =&#62; &#34;bar&#34;, bazz =&#62; &#34;buzz&#34; } }</pre>

<p>See <a href="../../Test/DatabaseRow.html#where" class="podlinkpod"
>&#34;where&#34; in Test::DatabaseRow</a> for a more detailed explanation.</p>

<dt><a name="verbose"
>verbose</a></dt>

<dd>
<p>Truth value, default false. Controls if the diagnostic messages printed during <code>row_ok</code> on failure contain details of the SQL executed or not.</p>

<dt><a name="force_utf8"
>force_utf8</a></dt>

<dd>
<p>Truth value, default false. Controls if the utf8 flag should be turned on on values returned from the database. See <a href="../../Test/DatabaseRow.html#utf8_hacks" class="podlinkpod"
>&#34;utf8 hacks&#34; in Test::DatabaseRow</a> for why this might be important.</p>

<p>This flag only effects data that this module places into <code>db_resutls</code>. If you manually populate this accessor this flag will have no effect.</p>

<dt><a name="tests"
>tests</a></dt>

<dd>
<p>If set, enables specified tests on the first element of <code>db_results</code> when <code>row_ok</code> is called.</p>

<p>This accessor value should be a hashref of hashrefs, with the outer keys being the Perl comparison operator, the inner keys being the field names and the inner values being the values to test against. For example:</p>

<pre>  { 
    &#39;eq&#39; =&#62; { first =&#62; &#34;Fred&#34;, last =&#62; &#34;Flintstone&#34;, },
    &#39;=~&#39; =&#62; { address =&#62; &#34;%Bedrock%&#34; },
  }</pre>

<p>This accessor automatically coerces array refs that are passed into a hashref structure, converting things that look like strings into <code>eq</code> tests, things that look like numbers into <code>==</code> tests and things that are references to regular expressions into <code>=~</code> tests. Foe example:</p>

<pre>  [ num =&#62; 123, letters =&#62; &#34;abc&#34;, kinda =&#62; qr/substring/ ]</pre>

<p>Will be coerced into</p>

<pre>  {
    &#39;==&#39; =&#62; { num =&#62; 123, },
    &#39;eq&#39; =&#62; { letters =&#62; &#34;abc&#34;, },
    &#39;=~&#39; =&#62; { kinda =&#62; qr/substring/ },
  }</pre>

<p>See <a href="../../Test/DatabaseRow.html#tests" class="podlinkpod"
>&#34;tests&#34; in Test::DatabaseRow</a> for a more detailed explanation.</p>

<dt><a name="check_all_rows"
>check_all_rows</a></dt>

<dd>
<p>Boolean to determine if we should test all rows (during <code>db_results_ok</code> and <code>test_ok</code>) or just check the first row. Default true.</p>

<dt><a name="results"
>results</a></dt>

<dd>
<p>If set, enable tests to check the number of rows we returned by <code>db_results</code> is exactly this value when <code>row_ok</code> is called. Integer.</p>

<dt><a name="max_results"
>max_results</a></dt>

<dd>
<p>If set, enable tests to check the number of rows we returned by <code>db_results</code> is at most this value when <code>row_ok</code> is called. Integer.</p>

<dt><a name="min_results"
>min_results</a></dt>

<dd>
<p>If set, enable tests to check the number of rows we returned by <code>db_results</code> is at least this value when <code>row_ok</code> is called. Integer.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Methods"
>Methods</a></h2>

<dl>
<dt><a name="new(...)"
>new(...)</a></dt>

<dd>
<p>Simple constructor. Passing arguments to the constructor sets the values of the accessors.</p>

<dt><a name="number_of_results_ok"
>number_of_results_ok</a></dt>

<dd>
<p>Returns a Test::DatabaseRow::Result that represents if the number of results in <code>db_results</code> match the requirements for the number of results.</p>

<dt><a name="row_at_index_ok(_$row_index_)"
>row_at_index_ok( $row_index )</a></dt>

<dd>
<p>Returns a Test::DatabaseRow::Result that represents if the element corresponding to the passed row index in <code>db_results</code> match the tests defined in <code>tests</code>.</p>

<dt><a name="db_results_ok"
>db_results_ok</a></dt>

<dd>
<p>Returns a Test::DatabaseRow::Result that represents if all elements in <code>db_results</code> match the tests defined in <code>tests</code>.</p>

<dt><a name="test_ok"
>test_ok</a></dt>

<dd>
<p>Returns a Test::DatabaseRow::Result that represents if the number of results in <code>db_results</code> match the requirements for the number of results and all elements in <code>db_results</code> match the tests defined in <code>tests</code>.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<p>Bugs (and requests for new features) can be reported though the CPAN RT system: <a href="http://rt.cpan.org/NoAuth/ReportBug.html?Queue=Test-DatabaseRow" class="podlinkurl"
>http://rt.cpan.org/NoAuth/ReportBug.html?Queue=Test-DatabaseRow</a></p>

<p>Alternatively, you can simply fork this project on github and send me pull requests. Please see &#60;http://github.com/2shortplanks/Test-DatabaseRow&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Written by Mark Fowler <b>mark@twoshortplanks.com</b></p>

<p>Copyright Profero 2003, 2004. Copyright Mark Fowler 2011.</p>

<p>Some code taken from <b>Test::Builder</b>, written by Michael Schwern. Some code taken from <b>Regexp::Common</b>, written by Damian Conway. Neither objected to its inclusion in this module.</p>

<p>Some code taken from <b>Lingua::EN::Numbers::Ordinate</b>, written by Sean M. Burke.</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../Test/DatabaseRow/Object.html" class="podlinkpod"
>Test::DatabaseRow::Object</a>, <a href="../../Test/DatabaseRow/Result.html" class="podlinkpod"
>Test::DatabaseRow::Result</a>, <a href="../../Test/More.html" class="podlinkpod"
>Test::More</a>, <a href="../../DBI.html" class="podlinkpod"
>DBI</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
