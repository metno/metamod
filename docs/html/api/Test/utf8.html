<html><head><title>Test::utf8</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:28 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Validity_Tests'>Validity Tests</a>
    <li class='indexItem indexItem2'><a href='#String_Characteristic_Tests'>String Characteristic Tests</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT'>COPYRIGHT</a>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Test::utf8 - handy utf8 tests</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  # check the string is good
  is_valid_string($string);   # check the string is valid
  is_sane_utf8($string);      # check not double encoded

  # check the string has certain attributes
  is_flagged_utf8($string1);   # has utf8 flag set
  is_within_ascii($string2);   # only has ascii chars in it
  isnt_within_ascii($string3); # has chars outside the ascii range
  is_within_latin_1($string4); # only has latin-1 chars in it
  isnt_within_ascii($string5); # has chars outside the latin-1 range</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module is a collection of tests useful for dealing with utf8 strings in Perl.</p>

<p>This module has two types of tests: The validity tests check if a string is valid and not corrupt, whereas the characteristics tests will check that string has a given set of characteristics.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Validity_Tests"
>Validity Tests</a></h2>

<dl>
<dt><a name="is_valid_string($string,_$testname)"
>is_valid_string($string, $testname)</a></dt>

<dd>
<p>Checks if the string is &#34;valid&#34;, i.e. this passes and returns true unless the internal utf8 flag hasn&#39;t been set on scalar that isn&#39;t made up of a valid utf-8 byte sequence.</p>

<p>This should <i>never</i> happen and, in theory, this test should always pass. Unless you (or a module you use) goes monkeying around inside a scalar using Encode&#39;s private functions or XS code you shouldn&#39;t ever end up in a situation where you&#39;ve got a corrupt scalar. But if you do, and you do, then this function should help you detect the problem.</p>

<p>To be clear, here&#39;s an example of the error case this can detect:</p>

<pre>  my $mark = &#34;Mark&#34;;
  my $leon = &#34;L\x{e9}on&#34;;
  is_valid_string($mark);  # passes, not utf-8
  is_valid_string($leon);  # passes, not utf-8

  my $iloveny = &#34;I \x{2665} NY&#34;;
  is_valid_string($iloveny);      # passes, proper utf-8

  my $acme = &#34;L\x{c3}\x{a9}on&#34;;
  Encode::_utf8_on($acme);      # (please don&#39;t do things like this)
  is_valid_string($acme);       # passes, proper utf-8 byte sequence upgraded

  Encode::_utf8_on($leon);      # (this is why you don&#39;t do things like this)
  is_valid_string($leon);       # fails! the byte \x{e9} isn&#39;t valid utf-8</pre>

<dt><a name="is_sane_utf8($string,_$name)"
>is_sane_utf8($string, $name)</a></dt>

<dd>
<p>This test fails if the string contains something that looks like it might be dodgy utf8, i.e. containing something that looks like the multi-byte sequence for a latin-1 character but perl hasn&#39;t been instructed to treat as such. Strings that are not utf8 always automatically pass.</p>

<p>Some examples may help:</p>

<pre>  # This will pass as it&#39;s a normal latin-1 string
  is_sane_utf8(&#34;Hello L\x{e9}eon&#34;);

  # this will fail because the \x{c3}\x{a9} looks like the
  # utf8 byte sequence for e-acute
  my $string = &#34;Hello L\x{c3}\x{a9}on&#34;;
  is_sane_utf8($string);

  # this will pass because the utf8 is correctly interpreted as utf8
  Encode::_utf8_on($string)
  is_sane_utf8($string);</pre>

<p>Obviously this isn&#39;t a hundred percent reliable. The edge case where this will fail is where you have <code>\x{c2}</code> (which is &#34;LATIN CAPITAL LETTER WITH CIRCUMFLEX&#34;) or <code>\x{c3}</code> (which is &#34;LATIN CAPITAL LETTER WITH TILDE&#34;) followed by one of the latin-1 punctuation symbols.</p>

<pre>  # a capital letter A with tilde surrounded by smart quotes
  # this will fail because it&#39;ll see the &#34;\x{c2}\x{94}&#34; and think
  # it&#39;s actually the utf8 sequence for the end smart quote
  is_sane_utf8(&#34;\x{93}\x{c2}\x{94}&#34;);</pre>

<p>However, since this hardly comes up this test is reasonably reliable in most cases. Still, care should be applied in cases where dynamic data is placed next to latin-1 punctuation to avoid false negatives.</p>

<p>There exists two situations to cause this test to fail; The string contains utf8 byte sequences and the string hasn&#39;t been flagged as utf8 (this normally means that you got it from an external source like a C library; When Perl needs to store a string internally as utf8 it does it&#39;s own encoding and flagging transparently) or a utf8 flagged string contains byte sequences that when translated to characters themselves look like a utf8 byte sequence. The test diagnostics tells you which is the case.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="String_Characteristic_Tests"
>String Characteristic Tests</a></h2>

<p>These routines allow you to check the range of characters in a string. Note that these routines are blind to the actual encoding perl internally uses to store the characters, they just check if the string contains only characters that can be represented in the named encoding:</p>

<dl>
<dt><a name="is_within_ascii"
>is_within_ascii</a></dt>

<dd>
<p>Tests that a string only contains characters that are in the ASCII charecter set.</p>

<dt><a name="is_within_latin_1"
>is_within_latin_1</a></dt>

<dd>
<p>Tests that a string only contains characters that are in latin-1.</p>
</dd>
</dl>

<p>Simply check if a scalar is or isn&#39;t flagged as utf8 by perl&#39;s internals:</p>

<dl>
<dt><a name="is_flagged_utf8($string,_$name)"
>is_flagged_utf8($string, $name)</a></dt>

<dd>
<p>Passes if the string is flagged by perl&#39;s internals as utf8, fails if it&#39;s not.</p>

<dt><a name="isnt_flagged_utf8($string,$name)"
>isnt_flagged_utf8($string,$name)</a></dt>

<dd>
<p>The opposite of <code>is_flagged_utf8</code>, passes if and only if the string isn&#39;t flagged as utf8 by perl&#39;s internals.</p>

<p>Note: you can refer to this function as <code>isn&#39;t_flagged_utf8</code> if you really want to.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Written by Mark Fowler <b>mark@twoshortplanks.com</b></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright Mark Fowler 2004,2012. All rights reserved.</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<p>None known. Please report any to me via the CPAN RT system. See http://rt.cpan.org/ for more details.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../Test/DoubleEncodedEntities.html" class="podlinkpod"
>Test::DoubleEncodedEntities</a> for testing for double encoded HTML entities.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
