<html><head><title>Test::Differences</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:27 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#EXPORT'>EXPORT</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#OPTIONS'>OPTIONS</a>
  <li class='indexItem indexItem1'><a href='#DIFF_STYLES'>DIFF STYLES</a>
  <li class='indexItem indexItem1'><a href='#DEPLOYING'>DEPLOYING</a>
  <li class='indexItem indexItem1'><a href='#LIMITATIONS'>LIMITATIONS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Test_or_Test%3A%3AMore'>Test or Test::More</a>
    <li class='indexItem indexItem2'><a href='#Exporting'>Exporting</a>
    <li class='indexItem indexItem2'><a href='#Unicode'>Unicode</a>
    <li class='indexItem indexItem2'><a href='#Data%3A%3ADumper_and_older_Perls.'>Data::Dumper and older Perls.</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#MAINTAINER'>MAINTAINER</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Test::Differences - Test strings and data structures and show differences if not ok</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>0.61</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>   use Test;    ## Or use Test::More
   use Test::Differences;

   eq_or_diff $got,  &#34;a\nb\nc\n&#34;,   &#34;testing strings&#34;;
   eq_or_diff \@got, [qw( a b c )], &#34;testing arrays&#34;;

   ## Passing options:
   eq_or_diff $got, $expected, $name, { context =&#62; 300 };  ## options

   ## Using with DBI-like data structures

   use DBI;

   ... open connection &#38; prepare statement and @expected_... here...

   eq_or_diff $sth-&#62;fetchall_arrayref, \@expected_arrays  &#34;testing DBI arrays&#34;;
   eq_or_diff $sth-&#62;fetchall_hashref,  \@expected_hashes, &#34;testing DBI hashes&#34;;

   ## To force textual or data line numbering (text lines are numbered 1..):
   eq_or_diff_text ...;
   eq_or_diff_data ...;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="EXPORT"
>EXPORT</a></h1>

<p>This module exports three test functions and four diff-style functions:</p>

<ul>
<li>Test functions
<ul>
<li><code>eq_or_diff</code></li>

<li><code>eq_or_diff_data</code></li>

<li><code>eq_or_diff_text</code></li>
</ul>
</li>

<li>Diff style functions
<ul>
<li><code>table_diff</code> (the default)</li>

<li><code>unified_diff</code></li>

<li><code>oldstyle_diff</code></li>

<li><code>context_diff</code></li>
</ul>
</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>When the code you&#39;re testing returns multiple lines, records or data structures and they&#39;re just plain wrong, an equivalent to the Unix <code>diff</code> utility may be just what&#39;s needed. Here&#39;s output from an example test script that checks two text documents and then two (trivial) data structures:</p>

<pre> t/99example....1..3
 not ok 1 - differences in text
 #     Failed test ((eval 2) at line 14)
 #     +---+----------------+----------------+
 #     | Ln|Got             |Expected        |
 #     +---+----------------+----------------+
 #     |  1|this is line 1  |this is line 1  |
 #     *  2|this is line 2  |this is line b  *
 #     |  3|this is line 3  |this is line 3  |
 #     +---+----------------+----------------+
 not ok 2 - differences in whitespace
 #     Failed test ((eval 2) at line 20)
 #     +---+------------------+------------------+
 #     | Ln|Got               |Expected          |
 #     +---+------------------+------------------+
 #     |  1|        indented  |        indented  |
 #     *  2|        indented  |\tindented        *
 #     |  3|        indented  |        indented  |
 #     +---+------------------+------------------+
 not ok 3
 #     Failed test ((eval 2) at line 22)
 #     +----+-------------------------------------+----------------------------+
 #     | Elt|Got                                  |Expected                    |
 #     +----+-------------------------------------+----------------------------+
 #     *   0|bless( [                             |[                           *
 #     *   1|  &#39;Move along, nothing to see here&#39;  |  &#39;Dry, humorless message&#39;  *
 #     *   2|], &#39;Test::Builder&#39; )                 |]                           *
 #     +----+-------------------------------------+----------------------------+
 # Looks like you failed 3 tests of 3.</pre>

<p>eq_or_diff_...() compares two strings or (limited) data structures and either emits an ok indication or a side-by-side diff. Test::Differences is designed to be used with Test.pm and with Test::Simple, Test::More, and other Test::Builder based testing modules. As the SYNOPSIS shows, another testing module must be used as the basis for your test suite.</p>

<p>These functions assume that you are presenting it with &#34;flat&#34; records, looking like:</p>

<pre>   - scalars composed of record-per-line
   - arrays of scalars,
   - arrays of arrays of scalars,
   - arrays of hashes containing only scalars</pre>

<p>All of these are flattened in to single strings which are then compared for differences. Differently data structures can be compared, as long as they flatten identically.</p>

<p>All other data structures are run through Data::Dumper first. This is a bit dangerous, as some versions of perl shipped with Data::Dumpers that could do the oddest things with unexpected, like core dump. Only as of 5.8.0 does Data::Dumper sort hash keys, which is necessary for HASH dumps to be fully predictable. This will be changed when this bites somebody or I get some free time.</p>

<p><code>eq_or_diff()</code> starts counting records at 0 unless you pass it two text strings:</p>

<pre>   eq_or_diff $a, $b;   ## First line is line number 1
   eq_or_diff @a, @b;   ## First element is element 0
   eq_or_diff $a, @b;   ## First line/element is element 0</pre>

<p>If you want to force a first record number of 0, use <code>eq_or_diff_data</code>. If you want to force a first record number of 1, use <code>eq_or_diff_text</code>. I chose this over passing in an options hash because it&#39;s clearer and simpler this way. YMMV.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONS"
>OPTIONS</a></h1>

<p>The options to <code>eq_or_diff</code> give some fine-grained control over the output.</p>

<ul>
<li><code>context</code>
<p>This allows you to control the amount of context shown:</p>

<pre>   eq_or_diff $got, $expected, $name, { context =&#62; 50000 };</pre>

<p>will show you lots and lots of context. Normally, eq_or_diff() uses some heuristics to determine whether to show 3 lines of context (like a normal unified diff) or 25 lines.</p>
</li>

<li><code>data_type</code>
<p><code>text</code> or <code>data</code>. See <code>eq_or_diff_text</code> and <code>eq_or_diff_data</code> to understand this. You can usually ignore this.</p>
</li>

<li><code>Sortkeys</code>
<p>If passed, whatever value is added is used as the argument for <a href="../Data/Dumper.html" class="podlinkpod"
>Data::Dumper</a> Sortkeys option. See the <a href="../Data/Dumper.html" class="podlinkpod"
>Data::Dumper</a> docs to understand how you can control the Sortkeys behavior.</p>
</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DIFF_STYLES"
>DIFF STYLES</a></h1>

<p>For extremely long strings, a table diff can wrap on your screen and be hard to read. If you are comfortable with different diff formats, you can switch to a format more suitable for your data. These are the four formats supported by the <a href="../Text/Diff.html" class="podlinkpod"
>Text::Diff</a> module and are set with the following functions:</p>

<ul>
<li><code>table_diff</code> (the default)</li>

<li><code>unified_diff</code></li>

<li><code>oldstyle_diff</code></li>

<li><code>context_diff</code></li>
</ul>

<p>You can run the following to understand the different diff output styles:</p>

<pre> use Test::More &#39;no_plan&#39;;
 use Test::Differences;

 my $long_string = join &#39;&#39; =&#62; 1..40;

 TODO: {
     local $TODO = &#39;Testing diff styles&#39;;

     # this is the default and does not need to explicitly set unless you need
     # to reset it back from another diff type
     table_diff;
     eq_or_diff $long_string, &#34;-$long_string&#34;, &#39;table diff&#39;;

     unified_diff;
     eq_or_diff $long_string, &#34;-$long_string&#34;, &#39;unified diff&#39;;

     context_diff;
     eq_or_diff $long_string, &#34;-$long_string&#34;, &#39;context diff&#39;;

     oldstyle_diff;
     eq_or_diff $long_string, &#34;-$long_string&#34;, &#39;oldstyle diff&#39;;
 }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DEPLOYING"
>DEPLOYING</a></h1>

<p>There are several basic ways of deploying Test::Differences requiring more or less labor by you or your users.</p>

<ul>
<li>Fallback to <code>is_deeply</code>.
<p>This is your best option if you want this module to be optional.</p>

<pre> use Test::More;
 BEGIN {
     if (!eval q{ use Test::Differences; 1 }) {
         *eq_or_diff = \&#38;is_deeply;
     }
 }</pre>
</li>

<li>
<pre> eval &#34;use Test::Differences&#34;;</pre>

<p>If you want to detect the presence of Test::Differences on the fly, something like the following code might do the trick for you:</p>

<pre>    use Test qw( !ok );   ## get all syms *except* ok

    eval &#34;use Test::Differences&#34;;
    use Data::Dumper;

    sub ok {
        goto &#38;eq_or_diff if defined &#38;eq_or_diff &#38;&#38; @_ &#62; 1;
        @_ = map ref $_ ? Dumper( @_ ) : $_, @_;
        goto Test::&#38;ok;
    }

    plan tests =&#62; 1;

    ok &#34;a&#34;, &#34;b&#34;;</pre>
</li>

<li>PREREQ_PM =&#62; { .... &#34;Test::Differences&#34; =&#62; 0, ... }
<p>This method will let CPAN and CPANPLUS users download it automatically. It will discomfit those users who choose/have to download all packages manually.</p>
</li>

<li>t/lib/Test/Differences.pm, t/lib/Text/Diff.pm, ...
<p>By placing Test::Differences and its prerequisites in the t/lib directory, you avoid forcing your users to download the Test::Differences manually if they aren&#39;t using CPAN or CPANPLUS.</p>

<p>If you put a <code>use lib &#34;t/lib&#34;;</code> in the top of each test suite before the <code>use Test::Differences;</code>, <code>make test</code> should work well.</p>

<p>You might want to check once in a while for new Test::Differences releases if you do this.</p>
</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LIMITATIONS"
>LIMITATIONS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Test_or_Test::More"
><code>Test</code> or <code>Test::More</code></a></h2>

<p>This module &#34;mixes in&#34; with Test.pm or any of the test libraries based on Test::Builder (Test::Simple, Test::More, etc). It does this by peeking to see whether Test.pm or Test/Builder.pm is in %INC, so if you are not using one of those, it will print a warning and play dumb by not emitting test numbers (or incrementing them). If you are using one of these, it should interoperate nicely.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Exporting"
>Exporting</a></h2>

<p>Exports all 3 functions by default (and by design). Use</p>

<pre>    use Test::Differences ();</pre>

<p>to suppress this behavior if you don&#39;t like the namespace pollution.</p>

<p>This module will not override functions like ok(), is(), is_deeply(), etc. If it did, then you could <code>eval &#34;use Test::Differences qw( is_deeply );&#34;</code> to get automatic upgrading to diffing behaviors without the <code>sub my_ok</code> shown above. Test::Differences intentionally does not provide this behavior because this would mean that Test::Differences would need to emulate every popular test module out there, which would require far more coding and maintenance that I&#39;m willing to do. Use the eval and my_ok deployment shown above if you want some level of automation.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Unicode"
>Unicode</a></h2>

<p>Perls before 5.6.0 don&#39;t support characters &#62; 255 at all, and 5.6.0 seems broken. This means that you might get odd results using perl5.6.0 with unicode strings.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Data::Dumper_and_older_Perls."
><code>Data::Dumper</code> and older Perls.</a></h2>

<p>Relies on Data::Dumper (for now), which, prior to perl5.8, will not always report hashes in the same order. <code> $Data::Dumper::SortKeys </code> <i>is</i> set to 1, so on more recent versions of Data::Dumper, this should not occur. Check CPAN to see if it&#39;s been peeled out of the main perl distribution and backported. Reported by Ilya Martynov &#60;ilya@martynov.org&#62;, although the SortKeys &#34;future perfect&#34; workaround has been set in anticipation of a new Data::Dumper for a while. Note that the two hashes should report the same here:</p>

<pre>    not ok 5
    #     Failed test (t/ctrl/05-home.t at line 51)
    # +----+------------------------+----+------------------------+
    # | Elt|Got                     | Elt|Expected                |
    # +----+------------------------+----+------------------------+
    # |   0|{                       |   0|{                       |
    # |   1|  &#39;password&#39; =&#62; &#39;&#39;,     |   1|  &#39;password&#39; =&#62; &#39;&#39;,     |
    # *   2|  &#39;method&#39; =&#62; &#39;login&#39;,  *    |                        |
    # |   3|  &#39;ctrl&#39; =&#62; &#39;home&#39;,     |   2|  &#39;ctrl&#39; =&#62; &#39;home&#39;,     |
    # |    |                        *   3|  &#39;method&#39; =&#62; &#39;login&#39;,  *
    # |   4|  &#39;email&#39; =&#62; &#39;test&#39;     |   4|  &#39;email&#39; =&#62; &#39;test&#39;     |
    # |   5|}                       |   5|}                       |
    # +----+------------------------+----+------------------------+</pre>

<p>Data::Dumper also overlooks the difference between</p>

<pre>    $a[0] = \$a[1];
    $a[1] = \$a[0];   # $a[0] = \$a[1]</pre>

<p>and</p>

<pre>    $x = \$y;
    $y = \$x;
    @a = ( $x, $y );  # $a[0] = \$y, not \$a[1]</pre>

<p>The former involves two scalars, the latter 4: $x, $y, and @a[0,1]. This was carefully explained to me in words of two syllables or less by Yves Orton &#60;demerphq@hotmail.com&#62;. The plan to address this is to allow you to select Data::Denter or some other module of your choice as an option.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<pre>    Barrie Slaymaker &#60;barries@slaysys.com&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="MAINTAINER"
>MAINTAINER</a></h1>

<pre>    Curtis &#34;Ovid&#34; Poe &#60;ovid@cpan.org&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>Copyright 2001-2008 Barrie Slaymaker, All Rights Reserved.</p>

<p>You may use this software under the terms of the GNU public license, any version, or the Artistic license.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
