<html><head><title>MooseX::Daemonize::Core</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:22 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Important_Notes'>Important Notes</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#ATTRIBUTES'>ATTRIBUTES</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <li class='indexItem indexItem1'><a href='#STUFF_YOU_SHOULD_READ'>STUFF YOU SHOULD READ</a>
  <li class='indexItem indexItem1'><a href='#ENVIRONMENT_VARIABLES'>ENVIRONMENT VARIABLES</a>
  <li class='indexItem indexItem1'><a href='#DEPENDENCIES'>DEPENDENCIES</a>
  <li class='indexItem indexItem1'><a href='#INCOMPATIBILITIES'>INCOMPATIBILITIES</a>
  <li class='indexItem indexItem1'><a href='#BUGS_AND_LIMITATIONS'>BUGS AND LIMITATIONS</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#LICENCE_AND_COPYRIGHT'>LICENCE AND COPYRIGHT</a>
  <li class='indexItem indexItem1'><a href='#DISCLAIMER_OF_WARRANTY'>DISCLAIMER OF WARRANTY</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>MooseX::Daemonize::Core - A Role with the core daemonization features</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  package My::Daemon;
  use Moose;

  with &#39;MooseX::Daemonize::Core&#39;;

  sub start {
      my $self = shift;
      # daemonize me ...
      $self-&#62;daemonize;
      # return from the parent,...
      return unless $self-&#62;is_daemon;
      # but continue on in the child (daemon)
  }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This is the basic daemonization Role, it provides a few methods (see below) and the minimum features needed to properly daemonize your code.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Important_Notes"
>Important Notes</a></h2>

<p>None of the methods in this role will exit the parent process for you, it only forks and detaches your child (daemon) process. It is your responsibility to exit the parent process in some way.</p>

<p>There is no PID or PID file management in this role, that is your responsibility (see some of the other roles in this distro for that).</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ATTRIBUTES"
>ATTRIBUTES</a></h1>

<dl>
<dt><a name="is_daemon_(is_=_rw,_isa_=&#62;_Bool)&#62;"
><i>is_daemon (is =</i> rw, isa =&#62; Bool)&#62;</a></dt>

<dd>
<p>This attribute is used to signal if we are within the daemon process or not.</p>

<dt><a name="no_double_fork_(is_=_rw,_isa_=&#62;_Bool)&#62;"
><i>no_double_fork (is =</i> rw, isa =&#62; Bool)&#62;</a></dt>

<dd>
<p>Setting this attribute to true will cause this method to not perform the typical double-fork, which is extra added protection from your process accidentally aquiring a controlling terminal. More information can be found above, and by Googling &#34;double fork daemonize&#34;.</p>

<p>If you the double-fork behavior off, you might want to enable the <i>ignore_zombies</i>.</p>

<dt><a name="ignore_zombies_(is_=_rw,_isa_=&#62;_Bool)&#62;"
><i>ignore_zombies (is =</i> rw, isa =&#62; Bool)&#62;</a></dt>

<dd>
<p>Setting this attribute to a true value will result in setting the <code>$SIG{CHLD}</code> handler to <code>IGNORE</code>. This tells perl to clean up zombie processes. By default, and for the most part you don&#39;t <i>need</i> it, only when you turn off the double fork behavior (with the <i>no_double_fork</i> attribute) do you sometimes want this behavior.</p>

<dt><a name="dont_close_all_files_(is_=_rw,_isa_=&#62;_Bool)&#62;"
><i>dont_close_all_files (is =</i> rw, isa =&#62; Bool)&#62;</a></dt>

<dd>
<p>Setting this attribute to true will cause it to skip closing all the filehandles. This is useful if you are opening things like sockets and such in the pre-fork.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<dl>
<dt><a name="daemon_fork_(?%options)"
><b>daemon_fork (?%options)</b></a></dt>

<dd>
<p>This forks off the child process to be daemonized. Just as with the built in fork, it returns the child pid to the parent process, 0 to the child process. It will also set the is_daemon flag appropriately.</p>

<p>The <code>%options</code> argument remains for backwards compatability, but it is suggested that you use the attributes listed above instead.</p>

<dt><a name="daemon_detach_(?%options)"
><b>daemon_detach (?%options)</b></a></dt>

<dd>
<p>This detaches the new child process from the terminal by doing the following things.</p>

<p>The <code>%options</code> argument remains for backwards compatability, but it is suggested that you use the attributes listed above instead.</p>

<dl>
<dt><a name="Becomes_a_session_leader"
>Becomes a session leader</a></dt>

<dd>
<p>This detaches the program from the controlling terminal, it is accomplished by calling POSIX::setsid.</p>

<dt><a name="Performing_the_double-fork"
>Performing the double-fork</a></dt>

<dd>
<p>See below for information on how to change this part of the process.</p>

<dt><a name="Changes_the_current_working_directory_to_&#34;/&#34;"
>Changes the current working directory to &#34;/&#34;</a></dt>

<dd>
<p>This is standard daemon behavior, if you want a different working directory then simply change it later in your daemons code.</p>

<dt><a name="Clears_the_file_creation_mask."
>Clears the file creation mask.</a></dt>

<dd>
<dt><a name="Closes_all_open_file_descriptors."
>Closes all open file descriptors.</a></dt>

<dd>
<p>See the <i>dont_close_all_files</i> attribute for information on how to change this part of the process.</p>

<dt><a name="Reopen_STDERR,_STDOUT_&#38;_STDIN_to_/dev/null"
>Reopen STDERR, STDOUT &#38; STDIN to /dev/null</a></dt>

<dd>
<p>This behavior can be controlled slightly though the MX_DAEMON_STDERR and MX_DAEMON_STDOUT environment variables. It will look for a filename in either of these variables and redirect STDOUT and/or STDERR to those files. This is useful for debugging and/or testing purposes.</p>

<p><b>NOTE</b></p>

<p>If called from within the parent process (the is_daemon flag is set to false), this method will simply return and do nothing.</p>

<dt><a name="daemonize_(?%options)"
><b>daemonize (?%options)</b></a></dt>

<dd>
<p>This will simply call <code>daemon_fork</code> followed by <code>daemon_detach</code>.</p>

<p>The <code>%options</code> argument remains for backwards compatability, but it is suggested that you use the attributes listed above instead.</p>

<dt><a name="meta()"
>meta()</a></dt>

<dd>
<p>The <code>meta()</code> method from <a href="../../Class/MOP/Class.html" class="podlinkpod"
>Class::MOP::Class</a></p>
</dd>
</dl>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="STUFF_YOU_SHOULD_READ"
>STUFF YOU SHOULD READ</a></h1>

<dl>
<dt><a name="Note_about_double_fork"
>Note about double fork</a></dt>

<dd>
<p>Taken from <a href="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66012" class="podlinkurl"
>http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66012</a> in a comment entitled <i>The second fork _is_ necessary by Jonathan Bartlett</i>, it is not the definitive statement on the issue, but it&#39;s clear and well written enough so I decided to reproduce it here.</p>

<pre>  The first fork accomplishes two things - allow the shell to return,
  and allow you to do a setsid().

  The setsid() removes yourself from your controlling terminal. You
  see, before, you were still listed as a job of your previous process,
  and therefore the user might accidentally send you a signal. setsid()
  gives you a new session, and removes the existing controlling terminal.

  The problem is, you are now a session leader. As a session leader, if
  you open a file descriptor that is a terminal, it will become your
  controlling terminal (oops!). Therefore, the second fork makes you NOT
  be a session leader. Only session leaders can acquire a controlling
  terminal, so you can open up any file you wish without worrying that
  it will make you a controlling terminal.

  So - first fork - allow shell to return, and permit you to call setsid()

  Second fork - prevent you from accidentally reacquiring a controlling
  terminal.</pre>

<p>That said, you don&#39;t always want this to be the behavior, so you are free to specify otherwise using the <i>no_double_fork</i> attribute.</p>

<dt><a name="Note_about_zombies"
>Note about zombies</a></dt>

<dd>
<p>Doing the double fork (see above) tends to get rid of your zombies since by the time you have double forked your daemon process is then owned by the init process. However, sometimes the double-fork is more than you really need, and you want to keep your daemon processes a little closer to you. In this case you have to watch out for zombies, you can avoid then by just setting the <i>ignore_zombies</i> attribute (see above).</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ENVIRONMENT_VARIABLES"
>ENVIRONMENT VARIABLES</a></h1>

<p>These variables are best just used for debugging and/or testing, but not used for actual logging. For that, you should reopen STDOUT/ERR on your own.</p>

<dl>
<dt><a name="MX_DAEMON_STDOUT"
><b>MX_DAEMON_STDOUT</b></a></dt>

<dd>
<p>A filename to redirect the daemon STDOUT to.</p>

<dt><a name="MX_DAEMON_STDERR"
><b>MX_DAEMON_STDERR</b></a></dt>

<dd>
<p>A filename to redirect the daemon STDERR to.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DEPENDENCIES"
>DEPENDENCIES</a></h1>

<p><a href="../../Moose/Role.html" class="podlinkpod"
>Moose::Role</a>, <a href="../../POSIX.html" class="podlinkpod"
>POSIX</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="INCOMPATIBILITIES"
>INCOMPATIBILITIES</a></h1>

<p>None reported.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS_AND_LIMITATIONS"
>BUGS AND LIMITATIONS</a></h1>

<p>No bugs have been reported.</p>

<p>Please report any bugs or feature requests to <code>bug-acme-dahut-call@rt.cpan.org</code>, or through the web interface at <a href="http://rt.cpan.org" class="podlinkurl"
>http://rt.cpan.org</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../Proc/Daemon.html" class="podlinkpod"
>Proc::Daemon</a></p>

<p>This code is based <b>HEAVILY</b> on <a href="../../Proc/Daemon.html" class="podlinkpod"
>Proc::Daemon</a>, we originally depended on it, but we needed some more flexibility, so instead we just stole the code.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Stevan Little <code>&#60;stevan.little@iinteractive.com&#62;</code></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENCE_AND_COPYRIGHT"
>LICENCE AND COPYRIGHT</a></h1>

<p>Copyright (c) 2007-2011, Chris Prather <code>&#60;perigrin@cpan.org&#62;</code>. All rights reserved.</p>

<p>Portions heavily borrowed from <a href="../../Proc/Daemon.html" class="podlinkpod"
>Proc::Daemon</a> which is copyright Earl Hood.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="../../perlartistic.html" class="podlinkpod"
>perlartistic</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DISCLAIMER_OF_WARRANTY"
>DISCLAIMER OF WARRANTY</a></h1>

<p>BECAUSE THIS SOFTWARE IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY FOR THE SOFTWARE, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE SOFTWARE &#34;AS IS&#34; WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH YOU. SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR, OR CORRECTION.</p>

<p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR REDISTRIBUTE THE SOFTWARE AS PERMITTED BY THE ABOVE LICENCE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE SOFTWARE (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER SOFTWARE), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
