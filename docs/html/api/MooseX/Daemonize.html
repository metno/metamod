<html><head><title>MooseX::Daemonize</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:22 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#WARNING'>WARNING</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#CAVEATS'>CAVEATS</a>
  <li class='indexItem indexItem1'><a href='#ATTRIBUTES'>ATTRIBUTES</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Daemon_Control_Methods'>Daemon Control Methods</a>
    <li class='indexItem indexItem2'><a href='#Pidfile_Handling_Methods'>Pidfile Handling Methods</a>
    <li class='indexItem indexItem2'><a href='#Signal_Handling_Methods'>Signal Handling Methods</a>
    <li class='indexItem indexItem2'><a href='#Exit_Code_Methods'>Exit Code Methods</a>
    <li class='indexItem indexItem2'><a href='#Introspection'>Introspection</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#DEPENDENCIES'>DEPENDENCIES</a>
  <li class='indexItem indexItem1'><a href='#INCOMPATIBILITIES'>INCOMPATIBILITIES</a>
  <li class='indexItem indexItem1'><a href='#BUGS_AND_LIMITATIONS'>BUGS AND LIMITATIONS</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#THANKS'>THANKS</a>
  <li class='indexItem indexItem1'><a href='#LICENCE_AND_COPYRIGHT'>LICENCE AND COPYRIGHT</a>
  <li class='indexItem indexItem1'><a href='#DISCLAIMER_OF_WARRANTY'>DISCLAIMER OF WARRANTY</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>MooseX::Daemonize - Role for daemonizing your Moose based application</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="WARNING"
>WARNING</a></h1>

<p>The maintainers of this module now recommend using <a href="../Daemon/Control.html" class="podlinkpod"
>Daemon::Control</a> instead.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    package My::Daemon;
    use Moose;

    with qw(MooseX::Daemonize);

    # ... define your class ....

    after start =&#62; sub {
        my $self = shift;
        return unless $self-&#62;is_daemon;
        # your daemon code here ...
    };

    # then in your script ...

    my $daemon = My::Daemon-&#62;new_with_options();

    my ($command) = @{$daemon-&#62;extra_argv}
    defined $command || die &#34;No command specified&#34;;

    $daemon-&#62;start   if $command eq &#39;start&#39;;
    $daemon-&#62;status  if $command eq &#39;status&#39;;
    $daemon-&#62;restart if $command eq &#39;restart&#39;;
    $daemon-&#62;stop    if $command eq &#39;stop&#39;;

    warn($daemon-&#62;status_message);
    exit($daemon-&#62;exit_code);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Often you want to write a persistant daemon that has a pid file, and responds appropriately to Signals. This module provides a set of basic roles as an infrastructure to do that.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAVEATS"
>CAVEATS</a></h1>

<p>When going into background MooseX::Daemonize closes all open file handles. This may interfere with you logging because it may also close the log file handle you want to write to. To prevent this you can either defer opening the log file until after start. Alternatively, use can use the &#39;dont_close_all_files&#39; option either from the command line or in your .sh script.</p>

<p>Assuming you want to use Log::Log4perl for example you could expand the MooseX::Daemonize example above like this.</p>

<pre>    after start =&#62; sub {
        my $self = shift;
        return unless $self-&#62;is_daemon;
        Log::Log4perl-&#62;init(\$log4perl_config);
        my $logger = Log::Log4perl-&#62;get_logger();
        $logger-&#62;info(&#34;Daemon started&#34;);
        # your daemon code here ...
    };</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ATTRIBUTES"
>ATTRIBUTES</a></h1>

<p>This list includes attributes brought in from other roles as well we include them here for ease of documentation. All of these attributes are settable though <a href="../MooseX/Getopt.html" class="podlinkpod"
>MooseX::Getopt</a>&#39;s command line handling, with the exception of <code>is_daemon</code>.</p>

<dl>
<dt><a name="progname_Path::Class::Dir_|_Str"
><i>progname Path::Class::Dir | Str</i></a></dt>

<dd>
<p>The name of our daemon, defaults to <code>$package_name =~ s/::/_/</code>;</p>

<dt><a name="pidbase_Path::Class::Dir_|_Str"
><i>pidbase Path::Class::Dir | Str</i></a></dt>

<dd>
<p>The base for our PID, defaults to <code>/var/run/</code></p>

<dt><a name="basedir_Path::Class::Dir_|_Str"
><i>basedir Path::Class::Dir | Str</i></a></dt>

<dd>
<p>The directory we chdir to; defaults to <code>/</code>.</p>

<dt><a name="pidfile_MooseX::Daemonize::Pid::File_|_Str"
><i>pidfile MooseX::Daemonize::Pid::File | Str</i></a></dt>

<dd>
<p>The file we store our PID in, defaults to <code>$pidbase/$progname.pid</code></p>

<dt><a name="foreground_Bool"
><i>foreground Bool</i></a></dt>

<dd>
<p>If true, the process won&#39;t background. Useful for debugging. This option can be set via Getopt&#39;s -f.</p>

<dt><a name="no_double_fork_Bool"
><i>no_double_fork Bool</i></a></dt>

<dd>
<p>If true, the process will not perform the typical double-fork, which is extra added protection from your process accidentally aquiring a controlling terminal. More information can be found by Googling &#34;double fork daemonize&#34;.</p>

<dt><a name="ignore_zombies_Bool"
><i>ignore_zombies Bool</i></a></dt>

<dd>
<p>If true, the process will not clean up zombie processes. Normally you don&#39;t want this.</p>

<dt><a name="dont_close_all_files_Bool"
><i>dont_close_all_files Bool</i></a></dt>

<dd>
<p>If true, the objects open filehandles will not be closed when daemonized. Normally you don&#39;t want this.</p>

<dt><a name="is_daemon_Bool"
><i>is_daemon Bool</i></a></dt>

<dd>
<p>If true, the process is the backgrounded daemon process, if false it is the parent process. This is useful for example in an <code>after &#39;start&#39; =</code> sub { }&#62; block.</p>

<p><b>NOTE:</b> This option is explicitly <b>not</b> available through <a href="../MooseX/Getopt.html" class="podlinkpod"
>MooseX::Getopt</a>.</p>

<dt><a name="stop_timeout"
><i>stop_timeout</i></a></dt>

<dd>
<p>Number of seconds to wait for the process to stop, before trying harder to kill it. Defaults to 2 seconds.</p>
</dd>
</dl>

<p>These are the internal attributes, which are not available through MooseX::Getopt.</p>

<dl>
<dt><a name="exit_code_Int"
><i>exit_code Int</i></a></dt>

<dd>
<dt><a name="status_message_Str"
><i>status_message Str</i></a></dt>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Daemon_Control_Methods"
>Daemon Control Methods</a></h2>

<p>These methods can be used to control the daemon behavior. Every effort has been made to have these methods DWIM (Do What I Mean), so that you can focus on just writing the code for your daemon.</p>

<p>Extending these methods is best done with the <a href="../Moose.html" class="podlinkpod"
>Moose</a> method modifiers, such as <code>before</code>, <code>after</code> and <code>around</code>.</p>

<dl>
<dt><a name="start"
><b>start</b></a></dt>

<dd>
<p>Setup a pidfile, fork, then setup the signal handlers.</p>

<dt><a name="stop"
><b>stop</b></a></dt>

<dd>
<p>Stop the process matching the pidfile, and unlinks the pidfile.</p>

<dt><a name="restart"
><b>restart</b></a></dt>

<dd>
<p>Literally this is:</p>

<pre>    $self-&#62;stop();
    $self-&#62;start();</pre>

<dt><a name="status"
><b>status</b></a></dt>

<dd>
<dt><a name="shutdown"
><b>shutdown</b></a></dt>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Pidfile_Handling_Methods"
>Pidfile Handling Methods</a></h2>

<dl>
<dt><a name="init_pidfile"
><b>init_pidfile</b></a></dt>

<dd>
<p>This method will create a <a href="../MooseX/Daemonize/Pid/File.html" class="podlinkpod"
>MooseX::Daemonize::Pid::File</a> object and tell it to store the PID in the file <code>$pidbase/$progname.pid</code>.</p>

<dt><a name="check"
><b>check</b></a></dt>

<dd>
<p>This checks to see if the daemon process is currently running by checking the pidfile.</p>

<dt><a name="get_pid"
><b>get_pid</b></a></dt>

<dd>
<p>Returns the PID of the daemon process.</p>

<dt><a name="save_pid"
><b>save_pid</b></a></dt>

<dd>
<p>Write the pidfile.</p>

<dt><a name="remove_pid"
><b>remove_pid</b></a></dt>

<dd>
<p>Removes the pidfile.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Signal_Handling_Methods"
>Signal Handling Methods</a></h2>

<dl>
<dt><a name="setup_signals"
><b>setup_signals</b></a></dt>

<dd>
<p>Setup the signal handlers, by default it only sets up handlers for SIGINT and SIGHUP. If you wish to add more signals just use the <code>after</code> method modifier and add them.</p>

<dt><a name="handle_sigint"
><b>handle_sigint</b></a></dt>

<dd>
<p>Handle a INT signal, by default calls <code>$self-</code>stop()&#62;</p>

<dt><a name="handle_sighup"
><b>handle_sighup</b></a></dt>

<dd>
<p>Handle a HUP signal. By default calls <code>$self-</code>restart()&#62;</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Exit_Code_Methods"
>Exit Code Methods</a></h2>

<p>These are overriable constant methods used for setting the exit code.</p>

<dl>
<dt><a name="OK"
>OK</a></dt>

<dd>
<p>Returns 0.</p>

<dt><a name="ERROR"
>ERROR</a></dt>

<dd>
<p>Returns 1.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Introspection"
>Introspection</a></h2>

<dl>
<dt><a name="meta()"
>meta()</a></dt>

<dd>
<p>The <code>meta()</code> method from <a href="../Class/MOP/Class.html" class="podlinkpod"
>Class::MOP::Class</a></p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DEPENDENCIES"
>DEPENDENCIES</a></h1>

<p><a href="../Moose.html" class="podlinkpod"
>Moose</a>, <a href="../MooseX/Getopt.html" class="podlinkpod"
>MooseX::Getopt</a>, <a href="../MooseX/Types/Path/Class.html" class="podlinkpod"
>MooseX::Types::Path::Class</a> and <a href="../POSIX.html" class="podlinkpod"
>POSIX</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="INCOMPATIBILITIES"
>INCOMPATIBILITIES</a></h1>

<p>None reported. Although obviously this will not work on Windows.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS_AND_LIMITATIONS"
>BUGS AND LIMITATIONS</a></h1>

<p>No bugs have been reported.</p>

<p>Please report any bugs or feature requests to <code>bug-acme-dahut-call@rt.cpan.org</code>, or through the web interface at <a href="http://rt.cpan.org" class="podlinkurl"
>http://rt.cpan.org</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../Daemon/Control.html" class="podlinkpod"
>Daemon::Control</a>, <a href="../Proc/Daemon.html" class="podlinkpod"
>Proc::Daemon</a>, <a href="../Daemon/Generic.html" class="podlinkpod"
>Daemon::Generic</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<p>Chris Prather <code>&#60;chris@prather.org</code></p>

<p>Stevan Little <code>&#60;stevan.little@iinteractive.com&#62;</code></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="THANKS"
>THANKS</a></h1>

<p>Mike Boyko, Matt S. Trout, Stevan Little, Brandon Black, Ash Berlin and the #moose denzians</p>

<p>Some bug fixes sponsored by Takkle Inc.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENCE_AND_COPYRIGHT"
>LICENCE AND COPYRIGHT</a></h1>

<p>Copyright (c) 2007-2011, Chris Prather <code>&#60;chris@prather.org&#62;</code>. Some rights reserved.</p>

<p>This module is free software; you can redistribute it and/or modify it under the same terms as Perl itself. See <a href="../perlartistic.html" class="podlinkpod"
>perlartistic</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DISCLAIMER_OF_WARRANTY"
>DISCLAIMER OF WARRANTY</a></h1>

<p>BECAUSE THIS SOFTWARE IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY FOR THE SOFTWARE, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER PARTIES PROVIDE THE SOFTWARE &#34;AS IS&#34; WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE SOFTWARE IS WITH YOU. SHOULD THE SOFTWARE PROVE DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR, OR CORRECTION.</p>

<p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR REDISTRIBUTE THE SOFTWARE AS PERMITTED BY THE ABOVE LICENCE, BE LIABLE TO YOU FOR DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE SOFTWARE (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE SOFTWARE TO OPERATE WITH ANY OTHER SOFTWARE), EVEN IF SUCH HOLDER OR OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
