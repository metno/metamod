<html><head><title>namespace::clean</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:22 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Keeping_packages_clean'>Keeping packages clean</a>
    <li class='indexItem indexItem2'><a href='#Explicitly_removing_functions_when_your_scope_is_compiled'>Explicitly removing functions when your scope is compiled</a>
    <li class='indexItem indexItem2'><a href='#Moose'>Moose</a>
    <li class='indexItem indexItem2'><a href='#Cleaning_other_packages'>Cleaning other packages</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#clean_subroutines'>clean_subroutines</a>
    <li class='indexItem indexItem2'><a href='#import'>import</a>
    <li class='indexItem indexItem2'><a href='#unimport'>unimport</a>
    <li class='indexItem indexItem2'><a href='#get_class_store'>get_class_store</a>
    <li class='indexItem indexItem2'><a href='#get_functions'>get_functions</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#IMPLEMENTATION_DETAILS'>IMPLEMENTATION DETAILS</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#THANKS'>THANKS</a>
  <li class='indexItem indexItem1'><a href='#AUTHORS'>AUTHORS</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>namespace::clean - Keep imports and functions out of your namespace</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  package Foo;
  use warnings;
  use strict;

  use Carp qw(croak);   # &#39;croak&#39; will be removed

  sub bar { 23 }        # &#39;bar&#39; will be removed

  # remove all previously defined functions
  use namespace::clean;

  sub baz { bar() }     # &#39;baz&#39; still defined, &#39;bar&#39; still bound

  # begin to collection function names from here again
  no namespace::clean;

  sub quux { baz() }    # &#39;quux&#39; will be removed

  # remove all functions defined after the &#39;no&#39; unimport
  use namespace::clean;

  # Will print: &#39;No&#39;, &#39;No&#39;, &#39;Yes&#39; and &#39;No&#39;
  print +(__PACKAGE__-&#62;can(&#39;croak&#39;) ? &#39;Yes&#39; : &#39;No&#39;), &#34;\n&#34;;
  print +(__PACKAGE__-&#62;can(&#39;bar&#39;)   ? &#39;Yes&#39; : &#39;No&#39;), &#34;\n&#34;;
  print +(__PACKAGE__-&#62;can(&#39;baz&#39;)   ? &#39;Yes&#39; : &#39;No&#39;), &#34;\n&#34;;
  print +(__PACKAGE__-&#62;can(&#39;quux&#39;)  ? &#39;Yes&#39; : &#39;No&#39;), &#34;\n&#34;;

  1;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Keeping_packages_clean"
>Keeping packages clean</a></h2>

<p>When you define a function, or import one, into a Perl package, it will naturally also be available as a method. This does not per se cause problems, but it can complicate subclassing and, for example, plugin classes that are included via multiple inheritance by loading them as base classes.</p>

<p>The <code>namespace::clean</code> pragma will remove all previously declared or imported symbols at the end of the current package&#39;s compile cycle. Functions called in the package itself will still be bound by their name, but they won&#39;t show up as methods on your class or instances.</p>

<p>By unimporting via <code>no</code> you can tell <code>namespace::clean</code> to start collecting functions for the next <code>use namespace::clean;</code> specification.</p>

<p>You can use the <code>-except</code> flag to tell <code>namespace::clean</code> that you don&#39;t want it to remove a certain function or method. A common use would be a module exporting an <code>import</code> method along with some functions:</p>

<pre>  use ModuleExportingImport;
  use namespace::clean -except =&#62; [qw( import )];</pre>

<p>If you just want to <code>-except</code> a single sub, you can pass it directly. For more than one value you have to use an array reference.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Explicitly_removing_functions_when_your_scope_is_compiled"
>Explicitly removing functions when your scope is compiled</a></h2>

<p>It is also possible to explicitly tell <code>namespace::clean</code> what packages to remove when the surrounding scope has finished compiling. Here is an example:</p>

<pre>  package Foo;
  use strict;

  # blessed NOT available

  sub my_class {
      use Scalar::Util qw( blessed );
      use namespace::clean qw( blessed );

      # blessed available
      return blessed shift;
  }

  # blessed NOT available</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Moose"
>Moose</a></h2>

<p>When using <code>namespace::clean</code> together with <a href="../Moose.html" class="podlinkpod"
>Moose</a> you want to keep the installed <code>meta</code> method. So your classes should look like:</p>

<pre>  package Foo;
  use Moose;
  use namespace::clean -except =&#62; &#39;meta&#39;;
  ...</pre>

<p>Same goes for <a href="../Moose/Role.html" class="podlinkpod"
>Moose::Role</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Cleaning_other_packages"
>Cleaning other packages</a></h2>

<p>You can tell <code>namespace::clean</code> that you want to clean up another package instead of the one importing. To do this you have to pass in the <code>-cleanee</code> option like this:</p>

<pre>  package My::MooseX::namespace::clean;
  use strict;

  use namespace::clean (); # no cleanup, just load

  sub import {
      namespace::clean-&#62;import(
        -cleanee =&#62; scalar(caller),
        -except  =&#62; &#39;meta&#39;,
      );
  }</pre>

<p>If you don&#39;t care about <code>namespace::clean</code>s discover-and-<code>-except</code> logic, and just want to remove subroutines, try <a href="#clean_subroutines" class="podlinkpod"
>&#34;clean_subroutines&#34;</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="clean_subroutines"
>clean_subroutines</a></h2>

<p>This exposes the actual subroutine-removal logic.</p>

<pre>  namespace::clean-&#62;clean_subroutines($cleanee, qw( subA subB ));</pre>

<p>will remove <code>subA</code> and <code>subB</code> from <code>$cleanee</code>. Note that this will remove the subroutines <b>immediately</b> and not wait for scope end. If you want to have this effect at a specific time (e.g. <code>namespace::clean</code> acts on scope compile end) it is your responsibility to make sure it runs at that time.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="import"
>import</a></h2>

<p>Makes a snapshot of the current defined functions and installs a <a href="../B/Hooks/EndOfScope.html" class="podlinkpod"
>B::Hooks::EndOfScope</a> hook in the current scope to invoke the cleanups.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="unimport"
>unimport</a></h2>

<p>This method will be called when you do a</p>

<pre>  no namespace::clean;</pre>

<p>It will start a new section of code that defines functions to clean up.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_class_store"
>get_class_store</a></h2>

<p>This returns a reference to a hash in a passed package containing information about function names included and excluded from removal.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="get_functions"
>get_functions</a></h2>

<p>Takes a class as argument and returns all currently defined functions in it as a hash reference with the function name as key and a typeglob reference to the symbol as value.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="IMPLEMENTATION_DETAILS"
>IMPLEMENTATION DETAILS</a></h1>

<p>This module works through the effect that a</p>

<pre>  delete $SomePackage::{foo};</pre>

<p>will remove the <code>foo</code> symbol from <code>$SomePackage</code> for run time lookups (e.g., method calls) but will leave the entry alive to be called by already resolved names in the package itself. <code>namespace::clean</code> will restore and therefor in effect keep all glob slots that aren&#39;t <code>CODE</code>.</p>

<p>A test file has been added to the perl core to ensure that this behaviour will be stable in future releases.</p>

<p>Just for completeness sake, if you want to remove the symbol completely, use <code>undef</code> instead.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../B/Hooks/EndOfScope.html" class="podlinkpod"
>B::Hooks::EndOfScope</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="THANKS"
>THANKS</a></h1>

<p>Many thanks to Matt S Trout for the inspiration on the whole idea.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHORS"
>AUTHORS</a></h1>

<ul>
<li>Robert &#39;phaylon&#39; Sedlacek &#60;rs@474.at&#62;</li>

<li>Florian Ragwitz &#60;rafl@debian.org&#62;</li>

<li>Jesse Luehrs &#60;doy@tozt.net&#62;</li>

<li>Peter Rabbitson &#60;ribasushi@cpan.org&#62;</li>

<li>Father Chrysostomos &#60;sprout@cpan.org&#62;</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2011 by <a href="#AUTHORS" class="podlinkpod"
>&#34;AUTHORS&#34;</a></p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
