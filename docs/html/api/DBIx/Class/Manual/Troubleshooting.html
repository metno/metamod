<html><head><title>DBIx::Class::Manual::Troubleshooting</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:15 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%22Can%27t_locate_storage_blabla%22'>&#34;Can&#39;t locate storage blabla&#34;</a>
    <li class='indexItem indexItem2'><a href='#Tracing_SQL'>Tracing SQL</a>
    <li class='indexItem indexItem2'><a href='#Can%27t_locate_method_result_source_instance'>Can&#39;t locate method result_source_instance</a>
    <li class='indexItem indexItem2'><a href='#Can%27t_get_last_insert_ID_under_Postgres_with_serial_primary_keys'>Can&#39;t get last insert ID under Postgres with serial primary keys</a>
    <li class='indexItem indexItem2'><a href='#Can%27t_locate_object_method_%22source_name%22_via_package'>Can&#39;t locate object method &#34;source_name&#34; via package</a>
    <li class='indexItem indexItem2'><a href='#syntax_error_at_or_near_%22%3Csomething%3E%22_...'>syntax error at or near &#34;&#60;something&#62;&#34; ...</a>
    <li class='indexItem indexItem2'><a href='#column_%22foo_DESC%22_does_not_exist_...'>column &#34;foo DESC&#34; does not exist ...</a>
    <li class='indexItem indexItem2'><a href='#Perl_Performance_Issues_on_Red_Hat_Systems'>Perl Performance Issues on Red Hat Systems</a>
    <li class='indexItem indexItem2'><a href='#Excessive_Memory_Allocation_with_TEXT%2FBLOB%2Fetc._Columns_and_Large_LongReadLen'>Excessive Memory Allocation with TEXT/BLOB/etc. Columns and Large LongReadLen</a>
  </ul>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBIx::Class::Manual::Troubleshooting - Got a problem?
Shoot it.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="&#34;Can&#39;t_locate_storage_blabla&#34;"
>&#34;Can&#39;t locate storage blabla&#34;</a></h2>

<p>You&#39;re trying to make a query on a non-connected schema.
Make sure you got the current resultset from $schema-&#62;resultset(&#39;Artist&#39;) on a schema object you got back from connect().</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Tracing_SQL"
>Tracing SQL</a></h2>

<p>The <code>DBIC_TRACE</code> environment variable controls SQL tracing,
so to see what is happening try</p>

<pre>  export DBIC_TRACE=1</pre>

<p>Alternatively use the <code>storage-&#62;debug</code> class method:-</p>

<pre>  $schema-&#62;storage-&#62;debug(1);</pre>

<p>To send the output somewhere else set debugfh:-</p>

<pre>  $schema-&#62;storage-&#62;debugfh(IO::File-&#62;new(&#39;/tmp/trace.out&#39;, &#39;w&#39;);</pre>

<p>Alternatively you can do this with the environment variable, too:-</p>

<pre>  export DBIC_TRACE=&#34;1=/tmp/trace.out&#34;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Can&#39;t_locate_method_result_source_instance"
>Can&#39;t locate method result_source_instance</a></h2>

<p>For some reason the table class in question didn&#39;t load fully, so the ResultSource object for it hasn&#39;t been created. Debug this class in isolation, then try loading the full schema again.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Can&#39;t_get_last_insert_ID_under_Postgres_with_serial_primary_keys"
>Can&#39;t get last insert ID under Postgres with serial primary keys</a></h2>

<p>Older <a href="../../../DBI.html" class="podlinkpod"
>DBI</a> and <a href="../../../DBD/Pg.html" class="podlinkpod"
>DBD::Pg</a> versions do not handle <code>last_insert_id</code> correctly, causing code that uses auto-incrementing primary key columns to fail with a message such as:</p>

<pre>  Can&#39;t get last insert id at /.../DBIx/Class/Row.pm line 95</pre>

<p>In particular the RHEL 4 and FC3 Linux distributions both ship with combinations of <a href="../../../DBI.html" class="podlinkpod"
>DBI</a> and <a href="../../../DBD/Pg.html" class="podlinkpod"
>DBD::Pg</a> modules that do not work correctly.</p>

<p><a href="../../../DBI.html" class="podlinkpod"
>DBI</a> version 1.50 and <a href="../../../DBD/Pg.html" class="podlinkpod"
>DBD::Pg</a> 1.43 are known to work.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Can&#39;t_locate_object_method_&#34;source_name&#34;_via_package"
>Can&#39;t locate object method &#34;source_name&#34; via package</a></h2>

<p>There&#39;s likely a syntax error in the table class referred to elsewhere in this error message. In particular make sure that the package declaration is correct. For example, for a schema <code> MySchema </code> you need to specify a fully qualified namespace: <code> package MySchema::MyTable; </code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="syntax_error_at_or_near_&#34;&#60;something&#62;&#34;_..."
>syntax error at or near &#34;&#60;something&#62;&#34; ...</a></h2>

<p>This can happen if you have a relation whose name is a word reserved by your database, e.g. &#34;user&#34;:</p>

<pre>  package My::Schema::User;
  ...
  __PACKAGE__-&#62;table(&#39;users&#39;);
  __PACKAGE__-&#62;add_columns(qw/ id name /);
  __PACKAGE__-&#62;set_primary_key(&#39;id&#39;);
  ...
  1;

  package My::Schema::ACL;
  ...
  __PACKAGE__-&#62;table(&#39;acl&#39;);
  __PACKAGE__-&#62;add_columns(qw/ user_id /);
  __PACKAGE__-&#62;belongs_to( &#39;user&#39; =&#62; &#39;My::Schema::User&#39;, &#39;user_id&#39; );
  ...
  1;

  $schema-&#62;resultset(&#39;ACL&#39;)-&#62;search(
    {},
    {
      join =&#62; [qw/ user /],
      &#39;+select&#39; =&#62; [ &#39;user.name&#39; ]
    }
  );</pre>

<p>The SQL generated would resemble something like:</p>

<pre>  SELECT me.user_id, user.name FROM acl me
  JOIN users user ON me.user_id = user.id</pre>

<p>If, as is likely, your database treats &#34;user&#34; as a reserved word, you&#39;d end up with the following errors:</p>

<p>1) syntax error at or near &#34;.&#34; - due to &#34;user.name&#34; in the SELECT clause</p>

<p>2) syntax error at or near &#34;user&#34; - due to &#34;user&#34; in the JOIN clause</p>

<p>The solution is to enable quoting - see <a href="../../../DBIx/Class/Manual/Cookbook.html#Setting_quoting_for_the_generated_SQL" class="podlinkpod"
>&#34;Setting quoting for the generated SQL&#34; in DBIx::Class::Manual::Cookbook</a> for details.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="column_&#34;foo_DESC&#34;_does_not_exist_..."
>column &#34;foo DESC&#34; does not exist ...</a></h2>

<p>This can happen if you are still using the obsolete order hack, and also happen to turn on SQL-quoting.</p>

<pre>  $rs-&#62;search( {}, { order_by =&#62; [ &#39;name DESC&#39; ] } );</pre>

<p>Since <a href="../../../DBIx/Class.html" class="podlinkpod"
>DBIx::Class</a> &#62;= 0.08100 and <a href="../../../SQL/Abstract.html" class="podlinkpod"
>SQL::Abstract</a> &#62;= 1.50 the above should be written as:</p>

<pre>  $rs-&#62;search( {}, { order_by =&#62; { -desc =&#62; &#39;name&#39; } } );</pre>

<p>For more ways to express order clauses refer to <a href="../../../SQL/Abstract.html#ORDER_BY_CLAUSES" class="podlinkpod"
>&#34;ORDER BY CLAUSES&#34; in SQL::Abstract</a></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Perl_Performance_Issues_on_Red_Hat_Systems"
>Perl Performance Issues on Red Hat Systems</a></h2>

<p>There is a problem with slow performance of certain DBIx::Class operations using the system perl on some Fedora and Red Hat Enterprise Linux system (as well as their derivative distributions such as Centos, White Box and Scientific Linux).</p>

<p>Distributions affected include Fedora 5 through to Fedora 8 and RHEL5 upto and including RHEL5 Update 2. Fedora 9 (which uses perl 5.10) has never been affected - this is purely a perl 5.8.8 issue.</p>

<p>As of September 2008 the following packages are known to be fixed and so free of this performance issue (this means all Fedora and RHEL5 systems with full current updates will not be subject to this problem):-</p>

<pre>  Fedora 8     - perl-5.8.8-41.fc8
  RHEL5        - perl-5.8.8-15.el5_2.1</pre>

<p>This issue is due to perl doing an exhaustive search of blessed objects under certain circumstances. The problem shows up as performance degradation exponential to the number of <a href="../../../DBIx/Class.html" class="podlinkpod"
>DBIx::Class</a> result objects in memory, so can be unnoticeable with certain data sets, but with huge performance impacts on other datasets.</p>

<p>A pair of tests for susceptibility to the issue and performance effects of the bless/overload problem can be found in the <a href="../../../DBIx/Class.html" class="podlinkpod"
>DBIx::Class</a> test suite, in the <code>t/99rh_perl_perf_bug.t</code> file.</p>

<p>Further information on this issue can be found in <a href="https://bugzilla.redhat.com/show_bug.cgi?id=379791" class="podlinkurl"
>https://bugzilla.redhat.com/show_bug.cgi?id=379791</a>, <a href="https://bugzilla.redhat.com/show_bug.cgi?id=460308" class="podlinkurl"
>https://bugzilla.redhat.com/show_bug.cgi?id=460308</a> and <a href="http://rhn.redhat.com/errata/RHBA-2008-0876.html" class="podlinkurl"
>http://rhn.redhat.com/errata/RHBA-2008-0876.html</a></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Excessive_Memory_Allocation_with_TEXT/BLOB/etc._Columns_and_Large_LongReadLen"
>Excessive Memory Allocation with TEXT/BLOB/etc. Columns and Large LongReadLen</a></h2>

<p>It has been observed, using <a href="../../../DBD/ODBC.html" class="podlinkpod"
>DBD::ODBC</a>, that creating a <a href="../../../DBIx/Class/Row.html" class="podlinkpod"
>DBIx::Class::Row</a> object which includes a column of data type TEXT/BLOB/etc. will allocate LongReadLen bytes. This allocation does not leak, but if LongReadLen is large in size, and many such result objects are created, e.g. as the output of a ResultSet query, the memory footprint of the Perl interpreter can grow very large.</p>

<p>The solution is to use the smallest practical value for LongReadLen.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
