<html><head><title>DBIx::Class::Storage::DBI::Sybase::ASE</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:16 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#connect_call_blob_setup'>connect_call_blob_setup</a>
    <li class='indexItem indexItem2'><a href='#connect_call_datetime_setup'>connect_call_datetime_setup</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#Schema%3A%3ALoader_Support'>Schema::Loader Support</a>
  <li class='indexItem indexItem1'><a href='#FreeTDS'>FreeTDS</a>
  <li class='indexItem indexItem1'><a href='#INSERTS_WITH_PLACEHOLDERS'>INSERTS WITH PLACEHOLDERS</a>
  <li class='indexItem indexItem1'><a href='#TRANSACTIONS'>TRANSACTIONS</a>
  <li class='indexItem indexItem1'><a href='#MAXIMUM_CONNECTIONS'>MAXIMUM CONNECTIONS</a>
  <li class='indexItem indexItem1'><a href='#DATES'>DATES</a>
  <li class='indexItem indexItem1'><a href='#LIMITED_QUERIES'>LIMITED QUERIES</a>
  <li class='indexItem indexItem1'><a href='#TEXT%2FIMAGE_COLUMNS'>TEXT/IMAGE COLUMNS</a>
  <li class='indexItem indexItem1'><a href='#BULK_API'>BULK API</a>
  <li class='indexItem indexItem1'><a href='#COMPUTED_COLUMNS'>COMPUTED COLUMNS</a>
  <li class='indexItem indexItem1'><a href='#TIMESTAMP_COLUMNS'>TIMESTAMP COLUMNS</a>
  <li class='indexItem indexItem1'><a href='#TODO'>TODO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBIx::Class::Storage::DBI::Sybase::ASE - Sybase ASE SQL Server support for DBIx::Class</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>This subclass supports <a href="../../../../../DBD/Sybase.html" class="podlinkpod"
>DBD::Sybase</a> for real (non-Microsoft) Sybase databases.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>If your version of Sybase does not support placeholders,
then your storage will be reblessed to <a href="../../../../../DBIx/Class/Storage/DBI/Sybase/ASE/NoBindVars.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Sybase::ASE::NoBindVars</a>.
You can also enable that driver explicitly,
see the documentation for more details.</p>

<p>With this driver there is unfortunately no way to get the <code>last_insert_id</code> without doing a <code>SELECT MAX(col)</code>.
This is done safely in a transaction (locking the table.) See <a href="#INSERTS_WITH_PLACEHOLDERS" class="podlinkpod"
>&#34;INSERTS WITH PLACEHOLDERS&#34;</a>.</p>

<p>A recommended <a href="../../../../../DBIx/Class/Storage/DBI.html#connect_info" class="podlinkpod"
>connect_info</a> setting:</p>

<pre>  on_connect_call =&#62; [[&#39;datetime_setup&#39;], [&#39;blob_setup&#39;, log_on_update =&#62; 0]]</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="connect_call_blob_setup"
>connect_call_blob_setup</a></h2>

<p>Used as:</p>

<pre>  on_connect_call =&#62; [ [ &#39;blob_setup&#39;, log_on_update =&#62; 0 ] ]</pre>

<p>Does <code>$dbh-&#62;{syb_binary_images} = 1;</code> to return <code>IMAGE</code> data as raw binary instead of as a hex string.</p>

<p>Recommended.</p>

<p>Also sets the <code>log_on_update</code> value for blob write operations. The default is <code>1</code>, but <code>0</code> is better if your database is configured for it.</p>

<p>See <a href="../../../../../DBD/Sybase.html#Handling_IMAGE%2FTEXT_data_with_syb_ct_get_data()%2Fsyb_ct_send_data()" class="podlinkpod"
>&#34;Handling_IMAGE/TEXT_data_with_syb_ct_get_data()/syb_ct_send_data()&#34; in DBD::Sybase</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="connect_call_datetime_setup"
>connect_call_datetime_setup</a></h2>

<p>Used as:</p>

<pre>  on_connect_call =&#62; &#39;datetime_setup&#39;</pre>

<p>In <a href="../../../../../DBIx/Class/Storage/DBI.html#connect_info" class="podlinkpod"
>connect_info</a> to set:</p>

<pre>  $dbh-&#62;syb_date_fmt(&#39;ISO_strict&#39;); # output fmt: 2004-08-21T14:36:48.080Z
  $dbh-&#62;do(&#39;set dateformat mdy&#39;);   # input fmt:  08/13/1979 18:08:55.080</pre>

<p>This works for both <code>DATETIME</code> and <code>SMALLDATETIME</code> columns, note that <code>SMALLDATETIME</code> columns only have minute precision.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="Schema::Loader_Support"
>Schema::Loader Support</a></h1>

<p>As of version <code>0.05000</code>, <a href="../../../../../DBIx/Class/Schema/Loader.html" class="podlinkpod"
>DBIx::Class::Schema::Loader</a> should work well with most versions of Sybase ASE.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FreeTDS"
>FreeTDS</a></h1>

<p>This driver supports <a href="../../../../../DBD/Sybase.html" class="podlinkpod"
>DBD::Sybase</a> compiled against FreeTDS (<a href="http://www.freetds.org/" class="podlinkurl"
>http://www.freetds.org/</a>) to the best of our ability, however it is recommended that you recompile <a href="../../../../../DBD/Sybase.html" class="podlinkpod"
>DBD::Sybase</a> against the Sybase Open Client libraries. They are a part of the Sybase ASE distribution:</p>

<p>The Open Client FAQ is here: <a href="http://www.isug.com/Sybase_FAQ/ASE/section7.html" class="podlinkurl"
>http://www.isug.com/Sybase_FAQ/ASE/section7.html</a>.</p>

<p>Sybase ASE for Linux (which comes with the Open Client libraries) may be downloaded here: <a href="http://response.sybase.com/forms/ASE_Linux_Download" class="podlinkurl"
>http://response.sybase.com/forms/ASE_Linux_Download</a>.</p>

<p>To see if you&#39;re using FreeTDS run:</p>

<pre>  perl -MDBI -le &#39;my $dbh = DBI-&#62;connect($dsn, $user, $pass); print $dbh-&#62;{syb_oc_version}&#39;</pre>

<p>It is recommended to set <code>tds version</code> for your ASE server to <code>5.0</code> in <code>/etc/freetds/freetds.conf</code>.</p>

<p>Some versions or configurations of the libraries involved will not support placeholders, in which case the storage will be reblessed to <a href="../../../../../DBIx/Class/Storage/DBI/Sybase/ASE/NoBindVars.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Sybase::ASE::NoBindVars</a>.</p>

<p>In some configurations, placeholders will work but will throw implicit type conversion errors for anything that&#39;s not expecting a string. In such a case, the <code>auto_cast</code> option from <a href="../../../../../DBIx/Class/Storage/DBI/AutoCast.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::AutoCast</a> is automatically set, which you may enable on connection with <a href="../../../../../DBIx/Class/Storage/DBI/AutoCast.html#connect_call_set_auto_cast" class="podlinkpod"
>connect_call_set_auto_cast</a>. The type info for the <code>CAST</code>s is taken from the <a href="../../../../../DBIx/Class/ResultSource.html#data_type" class="podlinkpod"
>&#34;data_type&#34; in DBIx::Class::ResultSource</a> definitions in your Result classes, and are mapped to a Sybase type (if it isn&#39;t already) using a mapping based on <a href="../../../../../SQL/Translator.html" class="podlinkpod"
>SQL::Translator</a>.</p>

<p>In other configurations, placeholders will work just as they do with the Sybase Open Client libraries.</p>

<p>Inserts or updates of TEXT/IMAGE columns will <b>NOT</b> work with FreeTDS.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="INSERTS_WITH_PLACEHOLDERS"
>INSERTS WITH PLACEHOLDERS</a></h1>

<p>With placeholders enabled, inserts are done in a transaction so that there are no concurrency issues with getting the inserted identity value using <code>SELECT MAX(col)</code>, which is the only way to get the <code>IDENTITY</code> value in this mode.</p>

<p>In addition, they are done on a separate connection so that it&#39;s possible to have active cursors when doing an insert.</p>

<p>When using <code>DBIx::Class::Storage::DBI::Sybase::ASE::NoBindVars</code> transactions are unnecessary and not used, as there are no concurrency issues with <code>SELECT @@IDENTITY</code> which is a session variable.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TRANSACTIONS"
>TRANSACTIONS</a></h1>

<p>Due to limitations of the TDS protocol and <a href="../../../../../DBD/Sybase.html" class="podlinkpod"
>DBD::Sybase</a>, you cannot begin a transaction while there are active cursors, nor can you use multiple active cursors within a transaction. An active cursor is, for example, a <a href="../../../../../DBIx/Class/ResultSet.html" class="podlinkpod"
>ResultSet</a> that has been executed using <code>next</code> or <code>first</code> but has not been exhausted or <a href="../../../../../DBIx/Class/ResultSet.html#reset" class="podlinkpod"
>reset</a>.</p>

<p>For example, this will not work:</p>

<pre>  $schema-&#62;txn_do(sub {
    my $rs = $schema-&#62;resultset(&#39;Book&#39;);
    while (my $row = $rs-&#62;next) {
      $schema-&#62;resultset(&#39;MetaData&#39;)-&#62;create({
        book_id =&#62; $row-&#62;id,
        ...
      });
    }
  });</pre>

<p>This won&#39;t either:</p>

<pre>  my $first_row = $large_rs-&#62;first;
  $schema-&#62;txn_do(sub { ... });</pre>

<p>Transactions done for inserts in <code>AutoCommit</code> mode when placeholders are in use are not affected, as they are done on an extra database handle.</p>

<p>Some workarounds:</p>

<ul>
<li>use <a href="../../../../../DBIx/Class/Storage/DBI/Replicated.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated</a></li>

<li><a href="../../../../../DBIx/Class/Schema.html#connect" class="podlinkpod"
>connect</a> another <a href="../../../../../DBIx/Class/Schema.html" class="podlinkpod"
>Schema</a></li>

<li>load the data from your cursor with <a href="../../../../../DBIx/Class/ResultSet.html#all" class="podlinkpod"
>&#34;all&#34; in DBIx::Class::ResultSet</a></li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="MAXIMUM_CONNECTIONS"
>MAXIMUM CONNECTIONS</a></h1>

<p>The TDS protocol makes separate connections to the server for active statements in the background. By default the number of such connections is limited to 25, on both the client side and the server side.</p>

<p>This is a bit too low for a complex <a href="../../../../../DBIx/Class.html" class="podlinkpod"
>DBIx::Class</a> application, so on connection the client side setting is set to <code>256</code> (see <a href="../../../../../DBD/Sybase.html#maxConnect" class="podlinkpod"
>&#34;maxConnect&#34; in DBD::Sybase</a>.) You can override it to whatever setting you like in the DSN.</p>

<p>See <a href="http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sag1/html/sag1/sag1272.htm" class="podlinkurl"
>http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sag1/html/sag1/sag1272.htm</a> for information on changing the setting on the server side.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DATES"
>DATES</a></h1>

<p>See <a href="#connect_call_datetime_setup" class="podlinkpod"
>&#34;connect_call_datetime_setup&#34;</a> to setup date formats for <a href="../../../../../DBIx/Class/InflateColumn/DateTime.html" class="podlinkpod"
>DBIx::Class::InflateColumn::DateTime</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LIMITED_QUERIES"
>LIMITED QUERIES</a></h1>

<p>Because ASE does not have a good way to limit results in SQL that works for all types of queries, the limit dialect is set to <a href="../../../../../SQL/Abstract/Limit.html#GenericSubQ" class="podlinkpod"
>GenericSubQ</a>.</p>

<p>Fortunately, ASE and <a href="../../../../../DBD/Sybase.html" class="podlinkpod"
>DBD::Sybase</a> support cursors properly, so when <a href="../../../../../SQL/Abstract/Limit.html#GenericSubQ" class="podlinkpod"
>GenericSubQ</a> is too slow you can use the <a href="../../../../../DBIx/Class/ResultSet.html#software_limit" class="podlinkpod"
>software_limit</a> <a href="../../../../../DBIx/Class/ResultSet.html" class="podlinkpod"
>DBIx::Class::ResultSet</a> attribute to simulate limited queries by skipping over records.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TEXT/IMAGE_COLUMNS"
>TEXT/IMAGE COLUMNS</a></h1>

<p><a href="../../../../../DBD/Sybase.html" class="podlinkpod"
>DBD::Sybase</a> compiled with FreeTDS will <b>NOT</b> allow you to insert or update <code>TEXT/IMAGE</code> columns.</p>

<p>Setting <code>$dbh-&#62;{LongReadLen}</code> will also not work with FreeTDS use either:</p>

<pre>  $schema-&#62;storage-&#62;dbh-&#62;do(&#34;SET TEXTSIZE $bytes&#34;);</pre>

<p>or</p>

<pre>  $schema-&#62;storage-&#62;set_textsize($bytes);</pre>

<p>instead.</p>

<p>However, the <code>LongReadLen</code> you pass in <a href="../../../../../DBIx/Class/Storage/DBI.html#connect_info" class="podlinkpod"
>connect_info</a> is used to execute the equivalent <code>SET TEXTSIZE</code> command on connection.</p>

<p>See <a href="#connect_call_blob_setup" class="podlinkpod"
>&#34;connect_call_blob_setup&#34;</a> for a <a href="../../../../../DBIx/Class/Storage/DBI.html#connect_info" class="podlinkpod"
>connect_info</a> setting you need to work with <code>IMAGE</code> columns.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BULK_API"
>BULK API</a></h1>

<p>The experimental <a href="../../../../../DBD/Sybase.html" class="podlinkpod"
>DBD::Sybase</a> Bulk API support is used for <a href="../../../../../DBIx/Class/ResultSet.html#populate" class="podlinkpod"
>populate</a> in <b>void</b> context, in a transaction on a separate connection.</p>

<p>To use this feature effectively, use a large number of rows for each <a href="../../../../../DBIx/Class/ResultSet.html#populate" class="podlinkpod"
>populate</a> call, eg.:</p>

<pre>  while (my $rows = $data_source-&#62;get_100_rows()) {
    $rs-&#62;populate($rows);
  }</pre>

<p><b>NOTE:</b> the <a href="../../../../../DBIx/Class/ResultSource.html#add_columns" class="podlinkpod"
>add_columns</a> calls in your <code>Result</code> classes <b>must</b> list columns in database order for this to work. Also, you may have to unset the <code>LANG</code> environment variable before loading your app, as <code>BCP -Y</code> is not yet supported in DBD::Sybase .</p>

<p>When inserting IMAGE columns using this method, you&#39;ll need to use <a href="#connect_call_blob_setup" class="podlinkpod"
>&#34;connect_call_blob_setup&#34;</a> as well.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COMPUTED_COLUMNS"
>COMPUTED COLUMNS</a></h1>

<p>If you have columns such as:</p>

<pre>  created_dtm AS getdate()</pre>

<p>represent them in your Result classes as:</p>

<pre>  created_dtm =&#62; {
    data_type =&#62; undef,
    default_value =&#62; \&#39;getdate()&#39;,
    is_nullable =&#62; 0,
    inflate_datetime =&#62; 1,
  }</pre>

<p>The <code>data_type</code> must exist and must be <code>undef</code>. Then empty inserts will work on tables with such columns.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TIMESTAMP_COLUMNS"
>TIMESTAMP COLUMNS</a></h1>

<p><code>timestamp</code> columns in Sybase ASE are not really timestamps, see: <a href="http://dba.fyicenter.com/Interview-Questions/SYBASE/The_timestamp_datatype_in_Sybase_.html" class="podlinkurl"
>http://dba.fyicenter.com/Interview-Questions/SYBASE/The_timestamp_datatype_in_Sybase_.html</a>.</p>

<p>They should be defined in your Result classes as:</p>

<pre>  ts =&#62; {
    data_type =&#62; &#39;timestamp&#39;,
    is_nullable =&#62; 0,
    inflate_datetime =&#62; 0,
  }</pre>

<p>The <code>&#60;inflate_datetime =</code> 0&#62;&#62; is necessary if you use <a href="../../../../../DBIx/Class/InflateColumn/DateTime.html" class="podlinkpod"
>DBIx::Class::InflateColumn::DateTime</a>, and most people do, and still want to be able to read these values.</p>

<p>The values will come back as hexadecimal.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TODO"
>TODO</a></h1>

<ul>
<li>Transitions to AutoCommit=0 (starting a transaction) mode by exhausting any active cursors, using eager cursors.</li>

<li>Real limits and limited counts using stored procedures deployed on startup.</li>

<li>Blob update with a LIKE query on a blob, without invalidating the WHERE condition.</li>

<li>bulk_insert using prepare_cached (see comments.)</li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>See <a href="../../../../../DBIx/Class.html#AUTHOR" class="podlinkpod"
>&#34;AUTHOR&#34; in DBIx::Class</a> and <a href="../../../../../DBIx/Class.html#CONTRIBUTORS" class="podlinkpod"
>&#34;CONTRIBUTORS&#34; in DBIx::Class</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>You may distribute this code under the same terms as Perl itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
