<html><head><title>DBIx::Class::Storage::DBI::Replicated</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:16 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#NOTES'>NOTES</a>
  <li class='indexItem indexItem1'><a href='#REQUIREMENTS'>REQUIREMENTS</a>
  <li class='indexItem indexItem1'><a href='#ATTRIBUTES'>ATTRIBUTES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#schema'>schema</a>
    <li class='indexItem indexItem2'><a href='#pool_type'>pool_type</a>
    <li class='indexItem indexItem2'><a href='#pool_args'>pool_args</a>
    <li class='indexItem indexItem2'><a href='#balancer_type'>balancer_type</a>
    <li class='indexItem indexItem2'><a href='#balancer_args'>balancer_args</a>
    <li class='indexItem indexItem2'><a href='#pool'>pool</a>
    <li class='indexItem indexItem2'><a href='#balancer'>balancer</a>
    <li class='indexItem indexItem2'><a href='#master'>master</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#ATTRIBUTES_IMPLEMENTING_THE_DBIx%3A%3AStorage%3A%3ADBI_INTERFACE'>ATTRIBUTES IMPLEMENTING THE DBIx::Storage::DBI INTERFACE</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#read_handler'>read_handler</a>
    <li class='indexItem indexItem2'><a href='#write_handler'>write_handler</a>
    <li class='indexItem indexItem2'><a href='#around%3A_connect_info'>around: connect_info</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#BUILDARGS'>BUILDARGS</a>
    <li class='indexItem indexItem2'><a href='#_build_master'>_build_master</a>
    <li class='indexItem indexItem2'><a href='#_build_pool'>_build_pool</a>
    <li class='indexItem indexItem2'><a href='#_build_balancer'>_build_balancer</a>
    <li class='indexItem indexItem2'><a href='#_build_write_handler'>_build_write_handler</a>
    <li class='indexItem indexItem2'><a href='#_build_read_handler'>_build_read_handler</a>
    <li class='indexItem indexItem2'><a href='#around%3A_connect_replicants'>around: connect_replicants</a>
    <li class='indexItem indexItem2'><a href='#all_storages'>all_storages</a>
    <li class='indexItem indexItem2'><a href='#execute_reliably_(%24coderef%2C_%3F%40args)'>execute_reliably ($coderef, ?@args)</a>
    <li class='indexItem indexItem2'><a href='#set_reliable_storage'>set_reliable_storage</a>
    <li class='indexItem indexItem2'><a href='#set_balanced_storage'>set_balanced_storage</a>
    <li class='indexItem indexItem2'><a href='#connected'>connected</a>
    <li class='indexItem indexItem2'><a href='#ensure_connected'>ensure_connected</a>
    <li class='indexItem indexItem2'><a href='#limit_dialect'>limit_dialect</a>
    <li class='indexItem indexItem2'><a href='#quote_char'>quote_char</a>
    <li class='indexItem indexItem2'><a href='#name_sep'>name_sep</a>
    <li class='indexItem indexItem2'><a href='#set_schema'>set_schema</a>
    <li class='indexItem indexItem2'><a href='#debug'>debug</a>
    <li class='indexItem indexItem2'><a href='#debugobj'>debugobj</a>
    <li class='indexItem indexItem2'><a href='#debugfh'>debugfh</a>
    <li class='indexItem indexItem2'><a href='#debugcb'>debugcb</a>
    <li class='indexItem indexItem2'><a href='#disconnect'>disconnect</a>
    <li class='indexItem indexItem2'><a href='#cursor_class'>cursor_class</a>
    <li class='indexItem indexItem2'><a href='#cursor'>cursor</a>
    <li class='indexItem indexItem2'><a href='#unsafe'>unsafe</a>
    <li class='indexItem indexItem2'><a href='#disable_sth_caching'>disable_sth_caching</a>
    <li class='indexItem indexItem2'><a href='#lag_behind_master'>lag_behind_master</a>
    <li class='indexItem indexItem2'><a href='#is_replicating'>is_replicating</a>
    <li class='indexItem indexItem2'><a href='#connect_call_datetime_setup'>connect_call_datetime_setup</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#GOTCHAS'>GOTCHAS</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBIx::Class::Storage::DBI::Replicated - BETA Replicated database support</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>The Following example shows how to change an existing $schema to a replicated storage type,
add some replicated (read-only) databases,
and perform reporting tasks.</p>

<p>You should set the &#39;storage_type attribute to a replicated type.
You should also define your arguments,
such as which balancer you want and any arguments that the Pool object should get.</p>

<pre>  my $schema = Schema::Class-&#62;clone;
  $schema-&#62;storage_type( [&#39;::DBI::Replicated&#39;, {balancer=&#62;&#39;::Random&#39;}] );
  $schema-&#62;connection(...);</pre>

<p>Next, you need to add in the Replicants. Basically this is an array of arrayrefs, where each arrayref is database connect information. Think of these arguments as what you&#39;d pass to the &#39;normal&#39; $schema-&#62;connect method.</p>

<pre>  $schema-&#62;storage-&#62;connect_replicants(
    [$dsn1, $user, $pass, \%opts],
    [$dsn2, $user, $pass, \%opts],
    [$dsn3, $user, $pass, \%opts],
  );</pre>

<p>Now, just use the $schema as you normally would. Automatically all reads will be delegated to the replicants, while writes to the master.</p>

<pre>  $schema-&#62;resultset(&#39;Source&#39;)-&#62;search({name=&#62;&#39;etc&#39;});</pre>

<p>You can force a given query to use a particular storage using the search attribute &#39;force_pool&#39;. For example:</p>

<pre>  my $rs = $schema-&#62;resultset(&#39;Source&#39;)-&#62;search(undef, {force_pool=&#62;&#39;master&#39;});</pre>

<p>Now $rs will force everything (both reads and writes) to use whatever was setup as the master storage. &#39;master&#39; is hardcoded to always point to the Master, but you can also use any Replicant name. Please see: <a href="../../../../DBIx/Class/Storage/DBI/Replicated/Pool.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated::Pool</a> and the replicants attribute for more.</p>

<p>Also see transactions and <a href="#execute_reliably" class="podlinkpod"
>&#34;execute_reliably&#34;</a> for alternative ways to force read traffic to the master. In general, you should wrap your statements in a transaction when you are reading and writing to the same tables at the same time, since your replicants will often lag a bit behind the master.</p>

<p>If you have a multi-statement read only transaction you can force it to select a random server in the pool by:</p>

<pre>  my $rs = $schema-&#62;resultset(&#39;Source&#39;)-&#62;search( undef,
    { force_pool =&#62; $db-&#62;storage-&#62;read_handler-&#62;next_storage }
  );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Warning: This class is marked BETA. This has been running a production website using MySQL native replication as its backend and we have some decent test coverage but the code hasn&#39;t yet been stressed by a variety of databases. Individual DBs may have quirks we are not aware of. Please use this in first development and pass along your experiences/bug fixes.</p>

<p>This class implements replicated data store for DBI. Currently you can define one master and numerous slave database connections. All write-type queries (INSERT, UPDATE, DELETE and even LAST_INSERT_ID) are routed to master database, all read-type queries (SELECTs) go to the slave database.</p>

<p>Basically, any method request that <a href="../../../../DBIx/Class/Storage/DBI.html" class="podlinkpod"
>DBIx::Class::Storage::DBI</a> would normally handle gets delegated to one of the two attributes: <a href="#read_handler" class="podlinkpod"
>&#34;read_handler&#34;</a> or to <a href="#write_handler" class="podlinkpod"
>&#34;write_handler&#34;</a>. Additionally, some methods need to be distributed to all existing storages. This way our storage class is a drop in replacement for <a href="../../../../DBIx/Class/Storage/DBI.html" class="podlinkpod"
>DBIx::Class::Storage::DBI</a>.</p>

<p>Read traffic is spread across the replicants (slaves) occurring to a user selected algorithm. The default algorithm is random weighted.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NOTES"
>NOTES</a></h1>

<p>The consistency between master and replicants is database specific. The Pool gives you a method to validate its replicants, removing and replacing them when they fail/pass predefined criteria. Please make careful use of the ways to force a query to run against Master when needed.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="REQUIREMENTS"
>REQUIREMENTS</a></h1>

<p>Replicated Storage has additional requirements not currently part of <a href="../../../../DBIx/Class.html" class="podlinkpod"
>DBIx::Class</a>. See <a href="../../../../DBIx/Class/Optional/Dependencies.html" class="podlinkpod"
>DBIx::Class::Optional::Dependencies</a> for more details.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ATTRIBUTES"
>ATTRIBUTES</a></h1>

<p>This class defines the following attributes.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="schema"
>schema</a></h2>

<p>The underlying <a href="../../../../DBIx/Class/Schema.html" class="podlinkpod"
>DBIx::Class::Schema</a> object this storage is attaching</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="pool_type"
>pool_type</a></h2>

<p>Contains the classname which will instantiate the <a href="#pool" class="podlinkpod"
>&#34;pool&#34;</a> object. Defaults to: <a href="../../../../DBIx/Class/Storage/DBI/Replicated/Pool.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated::Pool</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="pool_args"
>pool_args</a></h2>

<p>Contains a hashref of initialized information to pass to the Balancer object. See <a href="../../../../DBIx/Class/Storage/DBI/Replicated/Pool.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated::Pool</a> for available arguments.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="balancer_type"
>balancer_type</a></h2>

<p>The replication pool requires a balance class to provider the methods for choose how to spread the query load across each replicant in the pool.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="balancer_args"
>balancer_args</a></h2>

<p>Contains a hashref of initialized information to pass to the Balancer object. See <a href="../../../../DBIx/Class/Storage/DBI/Replicated/Balancer.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated::Balancer</a> for available arguments.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="pool"
>pool</a></h2>

<p>Is a <a href="../../../../DBIx/Class/Storage/DBI/Replicated/Pool.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated::Pool</a> or derived class. This is a container class for one or more replicated databases.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="balancer"
>balancer</a></h2>

<p>Is a <a href="../../../../DBIx/Class/Storage/DBI/Replicated/Balancer.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated::Balancer</a> or derived class. This is a class that takes a pool (<a href="../../../../DBIx/Class/Storage/DBI/Replicated/Pool.html" class="podlinkpod"
>DBIx::Class::Storage::DBI::Replicated::Pool</a>)</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="master"
>master</a></h2>

<p>The master defines the canonical state for a pool of connected databases. All the replicants are expected to match this databases state. Thus, in a classic Master / Slaves distributed system, all the slaves are expected to replicate the Master&#39;s state as quick as possible. This is the only database in the pool of databases that is allowed to handle write traffic.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ATTRIBUTES_IMPLEMENTING_THE_DBIx::Storage::DBI_INTERFACE"
>ATTRIBUTES IMPLEMENTING THE DBIx::Storage::DBI INTERFACE</a></h1>

<p>The following methods are delegated all the methods required for the <a href="../../../../DBIx/Class/Storage/DBI.html" class="podlinkpod"
>DBIx::Class::Storage::DBI</a> interface.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="read_handler"
>read_handler</a></h2>

<p>Defines an object that implements the read side of <a href="../../../../BIx/Class/Storage/DBI.html" class="podlinkpod"
>BIx::Class::Storage::DBI</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="write_handler"
>write_handler</a></h2>

<p>Defines an object that implements the write side of <a href="../../../../BIx/Class/Storage/DBI.html" class="podlinkpod"
>BIx::Class::Storage::DBI</a>, as well as methods that don&#39;t write or read that can be called on only one storage, methods that return a <code>$dbh</code>, and any methods that don&#39;t make sense to run on a replicant.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="around:_connect_info"
>around: connect_info</a></h2>

<p>Preserves master&#39;s <code>connect_info</code> options (for merging with replicants.) Also sets any Replicated-related options from connect_info, such as <code>pool_type</code>, <code>pool_args</code>, <code>balancer_type</code> and <code>balancer_args</code>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<p>This class defines the following methods.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BUILDARGS"
>BUILDARGS</a></h2>

<p><a href="../../../../DBIx/Class/Schema.html" class="podlinkpod"
>DBIx::Class::Schema</a> when instantiating its storage passed itself as the first argument. So we need to massage the arguments a bit so that all the bits get put into the correct places.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_build_master"
>_build_master</a></h2>

<p>Lazy builder for the <a href="#master" class="podlinkpod"
>&#34;master&#34;</a> attribute.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_build_pool"
>_build_pool</a></h2>

<p>Lazy builder for the <a href="#pool" class="podlinkpod"
>&#34;pool&#34;</a> attribute.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_build_balancer"
>_build_balancer</a></h2>

<p>Lazy builder for the <a href="#balancer" class="podlinkpod"
>&#34;balancer&#34;</a> attribute. This takes a Pool object so that the balancer knows which pool it&#39;s balancing.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_build_write_handler"
>_build_write_handler</a></h2>

<p>Lazy builder for the <a href="#write_handler" class="podlinkpod"
>&#34;write_handler&#34;</a> attribute. The default is to set this to the <a href="#master" class="podlinkpod"
>&#34;master&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_build_read_handler"
>_build_read_handler</a></h2>

<p>Lazy builder for the <a href="#read_handler" class="podlinkpod"
>&#34;read_handler&#34;</a> attribute. The default is to set this to the <a href="#balancer" class="podlinkpod"
>&#34;balancer&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="around:_connect_replicants"
>around: connect_replicants</a></h2>

<p>All calls to connect_replicants needs to have an existing $schema tacked onto top of the args, since <a href="../../../../DBIx/Storage/DBI.html" class="podlinkpod"
>DBIx::Storage::DBI</a> needs it, and any <code>connect_info</code> options merged with the master, with replicant opts having higher priority.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="all_storages"
>all_storages</a></h2>

<p>Returns an array of of all the connected storage backends. The first element in the returned array is the master, and the remainings are each of the replicants.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="execute_reliably_($coderef,_?@args)"
>execute_reliably ($coderef, ?@args)</a></h2>

<p>Given a coderef, saves the current state of the <a href="#read_handler" class="podlinkpod"
>&#34;read_handler&#34;</a>, forces it to use reliable storage (e.g. sets it to the master), executes a coderef and then restores the original state.</p>

<p>Example:</p>

<pre>  my $reliably = sub {
    my $name = shift @_;
    $schema-&#62;resultset(&#39;User&#39;)-&#62;create({name=&#62;$name});
    my $user_rs = $schema-&#62;resultset(&#39;User&#39;)-&#62;find({name=&#62;$name});
    return $user_rs;
  };

  my $user_rs = $schema-&#62;storage-&#62;execute_reliably($reliably, &#39;John&#39;);</pre>

<p>Use this when you must be certain of your database state, such as when you just inserted something and need to get a resultset including it, etc.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_reliable_storage"
>set_reliable_storage</a></h2>

<p>Sets the current $schema to be &#39;reliable&#39;, that is all queries, both read and write are sent to the master</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_balanced_storage"
>set_balanced_storage</a></h2>

<p>Sets the current $schema to be use the &#60;/balancer&#62; for all reads, while all writes are sent to the master only</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="connected"
>connected</a></h2>

<p>Check that the master and at least one of the replicants is connected.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ensure_connected"
>ensure_connected</a></h2>

<p>Make sure all the storages are connected.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="limit_dialect"
>limit_dialect</a></h2>

<p>Set the limit_dialect for all existing storages</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="quote_char"
>quote_char</a></h2>

<p>Set the quote_char for all existing storages</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="name_sep"
>name_sep</a></h2>

<p>Set the name_sep for all existing storages</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_schema"
>set_schema</a></h2>

<p>Set the schema object for all existing storages</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debug"
>debug</a></h2>

<p>set a debug flag across all storages</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debugobj"
>debugobj</a></h2>

<p>set a debug object</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debugfh"
>debugfh</a></h2>

<p>set a debugfh object</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debugcb"
>debugcb</a></h2>

<p>set a debug callback</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="disconnect"
>disconnect</a></h2>

<p>disconnect everything</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="cursor_class"
>cursor_class</a></h2>

<p>set cursor class on all storages, or return master&#39;s</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="cursor"
>cursor</a></h2>

<p>set cursor class on all storages, or return master&#39;s, alias for <a href="#cursor_class" class="podlinkpod"
>&#34;cursor_class&#34;</a> above.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="unsafe"
>unsafe</a></h2>

<p>sets the <a href="../../../../DBIx/Class/Storage/DBI.html#unsafe" class="podlinkpod"
>&#34;unsafe&#34; in DBIx::Class::Storage::DBI</a> option on all storages or returns master&#39;s current setting</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="disable_sth_caching"
>disable_sth_caching</a></h2>

<p>sets the <a href="../../../../DBIx/Class/Storage/DBI.html#disable_sth_caching" class="podlinkpod"
>&#34;disable_sth_caching&#34; in DBIx::Class::Storage::DBI</a> option on all storages or returns master&#39;s current setting</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="lag_behind_master"
>lag_behind_master</a></h2>

<p>returns the highest Replicant <a href="../../../../DBIx/Class/Storage/DBI.html#lag_behind_master" class="podlinkpod"
>&#34;lag_behind_master&#34; in DBIx::Class::Storage::DBI</a> setting</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="is_replicating"
>is_replicating</a></h2>

<p>returns true if all replicants return true for <a href="../../../../DBIx/Class/Storage/DBI.html#is_replicating" class="podlinkpod"
>&#34;is_replicating&#34; in DBIx::Class::Storage::DBI</a></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="connect_call_datetime_setup"
>connect_call_datetime_setup</a></h2>

<p>calls <a href="../../../../DBIx/Class/Storage/DBI.html#connect_call_datetime_setup" class="podlinkpod"
>&#34;connect_call_datetime_setup&#34; in DBIx::Class::Storage::DBI</a> for all storages</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="GOTCHAS"
>GOTCHAS</a></h1>

<p>Due to the fact that replicants can lag behind a master, you must take care to make sure you use one of the methods to force read queries to a master should you need realtime data integrity. For example, if you insert a row, and then immediately re-read it from the database (say, by doing $row-&#62;discard_changes) or you insert a row and then immediately build a query that expects that row to be an item, you should force the master to handle reads. Otherwise, due to the lag, there is no certainty your data will be in the expected state.</p>

<p>For data integrity, all transactions automatically use the master storage for all read and write queries. Using a transaction is the preferred and recommended method to force the master to handle all read queries.</p>

<p>Otherwise, you can force a single query to use the master with the &#39;force_pool&#39; attribute:</p>

<pre>  my $row = $resultset-&#62;search(undef, {force_pool=&#62;&#39;master&#39;})-&#62;find($pk);</pre>

<p>This attribute will safely be ignore by non replicated storages, so you can use the same code for both types of systems.</p>

<p>Lastly, you can use the <a href="#execute_reliably" class="podlinkpod"
>&#34;execute_reliably&#34;</a> method, which works very much like a transaction.</p>

<p>For debugging, you can turn replication on/off with the methods <a href="#set_reliable_storage" class="podlinkpod"
>&#34;set_reliable_storage&#34;</a> and <a href="#set_balanced_storage" class="podlinkpod"
>&#34;set_balanced_storage&#34;</a>, however this operates at a global level and is not suitable if you have a shared Schema object being used by multiple processes, such as on a web application server. You can get around this limitation by using the Schema clone method.</p>

<pre>  my $new_schema = $schema-&#62;clone;
  $new_schema-&#62;set_reliable_storage;

  ## $new_schema will use only the Master storage for all reads/writes while
  ## the $schema object will use replicated storage.</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<pre>  John Napiorkowski &#60;john.napiorkowski@takkle.com&#62;</pre>

<p>Based on code originated by:</p>

<pre>  Norbert Csongr&#65533;di &#60;bert@cpan.org&#62;
  Peter Sikl&#65533;si &#60;einon@einon.hu&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>You may distribute this code under the same terms as Perl itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
