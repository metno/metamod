<html><head><title>DBIx::Class::InflateColumn::DateTime</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:15 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#register_column'>register_column</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#USAGE_NOTES'>USAGE NOTES</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#CONTRIBUTORS'>CONTRIBUTORS</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBIx::Class::InflateColumn::DateTime - Auto-create DateTime objects from date and datetime columns.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>Load this component and then declare one or more columns to be of the datetime,
timestamp or date datatype.</p>

<pre>  package Event;
  use base &#39;DBIx::Class::Core&#39;;

  __PACKAGE__-&#62;load_components(qw/InflateColumn::DateTime/);
  __PACKAGE__-&#62;add_columns(
    starts_when =&#62; { data_type =&#62; &#39;datetime&#39; }
    create_date =&#62; { data_type =&#62; &#39;date&#39; }
  );</pre>

<p>Then you can treat the specified column as a <a href="../../../DateTime.html" class="podlinkpod"
>DateTime</a> object.</p>

<pre>  print &#34;This event starts the month of &#34;.
    $event-&#62;starts_when-&#62;month_name();</pre>

<p>If you want to set a specific timezone and locale for that field, use:</p>

<pre>  __PACKAGE__-&#62;add_columns(
    starts_when =&#62; { data_type =&#62; &#39;datetime&#39;, timezone =&#62; &#34;America/Chicago&#34;, locale =&#62; &#34;de_DE&#34; }
  );</pre>

<p>If you want to inflate no matter what data_type your column is, use inflate_datetime or inflate_date:</p>

<pre>  __PACKAGE__-&#62;add_columns(
    starts_when =&#62; { data_type =&#62; &#39;varchar&#39;, inflate_datetime =&#62; 1 }
  );

  __PACKAGE__-&#62;add_columns(
    starts_when =&#62; { data_type =&#62; &#39;varchar&#39;, inflate_date =&#62; 1 }
  );</pre>

<p>It&#39;s also possible to explicitly skip inflation:</p>

<pre>  __PACKAGE__-&#62;add_columns(
    starts_when =&#62; { data_type =&#62; &#39;datetime&#39;, inflate_datetime =&#62; 0 }
  );</pre>

<p>NOTE: Don&#39;t rely on <code>InflateColumn::DateTime</code> to parse date strings for you. The column is set directly for any non-references and <code>InflateColumn::DateTime</code> is completely bypassed. Instead, use an input parser to create a DateTime object. For instance, if your user input comes as a &#39;YYYY-MM-DD&#39; string, you can use <code>DateTime::Format::ISO8601</code> thusly:</p>

<pre>  use DateTime::Format::ISO8601;
  my $dt = DateTime::Format::ISO8601-&#62;parse_datetime(&#39;YYYY-MM-DD&#39;);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module figures out the type of DateTime::Format::* class to inflate/deflate with based on the type of DBIx::Class::Storage::DBI::* that you are using. If you switch from one database to a different one your code should continue to work without modification (though note that this feature is new as of 0.07, so it may not be perfect yet - bug reports to the list very much welcome).</p>

<p>If the data_type of a field is <code>date</code>, <code>datetime</code> or <code>timestamp</code> (or a derivative of these datatypes, e.g. <code>timestamp with timezone</code>), this module will automatically call the appropriate parse/format method for deflation/inflation as defined in the storage class. For instance, for a <code>datetime</code> field the methods <code>parse_datetime</code> and <code>format_datetime</code> would be called on deflation/inflation. If the storage class does not provide a specialized inflator/deflator, <code>[parse|format]_datetime</code> will be used as a fallback. See <a href="../../../DateTime/Format.html" class="podlinkpod"
>DateTime::Format</a> for more information on date formatting.</p>

<p>For more help with using components, see <a href="../../../DBIx/Class/Manual/Component.html#USING" class="podlinkpod"
>&#34;USING&#34; in DBIx::Class::Manual::Component</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="register_column"
>register_column</a></h2>

<p>Chains with the <a href="../../../DBIx/Class/Row.html#register_column" class="podlinkpod"
>&#34;register_column&#34; in DBIx::Class::Row</a> method, and sets up datetime columns appropriately. This would not normally be directly called by end users.</p>

<p>In the case of an invalid date, <a href="../../../DateTime.html" class="podlinkpod"
>DateTime</a> will throw an exception. To bypass these exceptions and just have the inflation return undef, use the <code>datetime_undef_if_invalid</code> option in the column info:</p>

<pre>    &#34;broken_date&#34;,
    {
        data_type =&#62; &#34;datetime&#34;,
        default_value =&#62; &#39;0000-00-00&#39;,
        is_nullable =&#62; 1,
        datetime_undef_if_invalid =&#62; 1
    }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="USAGE_NOTES"
>USAGE NOTES</a></h1>

<p>If you have a datetime column with an associated <code>timezone</code>, and subsequently create/update this column with a DateTime object in the <a href="../../../DateTime/TimeZone/Floating.html" class="podlinkpod"
>DateTime::TimeZone::Floating</a> timezone, you will get a warning (as there is a very good chance this will not have the result you expect). For example:</p>

<pre>  __PACKAGE__-&#62;add_columns(
    starts_when =&#62; { data_type =&#62; &#39;datetime&#39;, timezone =&#62; &#34;America/Chicago&#34; }
  );

  my $event = $schema-&#62;resultset(&#39;EventTZ&#39;)-&#62;create({
    starts_at =&#62; DateTime-&#62;new(year=&#62;2007, month=&#62;12, day=&#62;31, ),
  });</pre>

<p>The warning can be avoided in several ways:</p>

<dl>
<dt><a name="Fix_your_broken_code"
>Fix your broken code</a></dt>

<dd>
<p>When calling <code>set_time_zone</code> on a Floating DateTime object, the timezone is simply set to the requested value, and <b>no time conversion takes place</b>. It is always a good idea to be supply explicit times to the database:</p>

<pre>  my $event = $schema-&#62;resultset(&#39;EventTZ&#39;)-&#62;create({
    starts_at =&#62; DateTime-&#62;new(year=&#62;2007, month=&#62;12, day=&#62;31, time_zone =&#62; &#34;America/Chicago&#34; ),
  });</pre>

<dt><a name="Suppress_the_check_on_per-column_basis"
>Suppress the check on per-column basis</a></dt>

<dd>
<pre>  __PACKAGE__-&#62;add_columns(
    starts_when =&#62; { data_type =&#62; &#39;datetime&#39;, timezone =&#62; &#34;America/Chicago&#34;, floating_tz_ok =&#62; 1 }
  );</pre>

<dt><a name="Suppress_the_check_globally"
>Suppress the check globally</a></dt>

<dd>
<p>Set the environment variable DBIC_FLOATING_TZ_OK to some true value.</p>
</dd>
</dl>

<p>Putting extra attributes like timezone, locale or floating_tz_ok into extra =&#62; {} has been <b>DEPRECATED</b> because this gets you into trouble using <a href="../../../DBIx/Class/Schema/Versioned.html" class="podlinkpod"
>DBIx::Class::Schema::Versioned</a>. Instead put it directly into the columns definition like in the examples above. If you still use the old way you&#39;ll see a warning - please fix your code then!</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<dl>
<dt><a 
>More information about the add_columns method, and column metadata, can be found in the documentation for <a href="../../../DBIx/Class/ResultSource.html" class="podlinkpod"
>DBIx::Class::ResultSource</a>.</a></dt>

<dd>
<dt><a name="Further_discussion_of_problems_inherent_to_the_Floating_timezone:_Floating_DateTimes_and_$dt-&#62;set_time_zone"
>Further discussion of problems inherent to the Floating timezone: <a href="../../../DateTime.html#Floating_DateTimes" class="podlinkpod"
>Floating DateTimes</a> and <a href="../../../DateTime.html#%22Set%22_Methods" class="podlinkpod"
>$dt-&#62;set_time_zone</a></a></dt>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Matt S. Trout &#60;mst@shadowcatsystems.co.uk&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONTRIBUTORS"
>CONTRIBUTORS</a></h1>

<p>Aran Deltac &#60;bluefeet@cpan.org&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>You may distribute this code under the same terms as Perl itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
