<html><head><title>DBIx::Class::Ordered</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:16 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#AUTO_UPDATE'>AUTO UPDATE</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#position_column'>position_column</a>
    <li class='indexItem indexItem2'><a href='#grouping_column'>grouping_column</a>
    <li class='indexItem indexItem2'><a href='#null_position_value'>null_position_value</a>
    <li class='indexItem indexItem2'><a href='#siblings'>siblings</a>
    <li class='indexItem indexItem2'><a href='#previous_siblings'>previous_siblings</a>
    <li class='indexItem indexItem2'><a href='#next_siblings'>next_siblings</a>
    <li class='indexItem indexItem2'><a href='#previous_sibling'>previous_sibling</a>
    <li class='indexItem indexItem2'><a href='#first_sibling'>first_sibling</a>
    <li class='indexItem indexItem2'><a href='#next_sibling'>next_sibling</a>
    <li class='indexItem indexItem2'><a href='#last_sibling'>last_sibling</a>
    <li class='indexItem indexItem2'><a href='#move_previous'>move_previous</a>
    <li class='indexItem indexItem2'><a href='#move_next'>move_next</a>
    <li class='indexItem indexItem2'><a href='#move_first'>move_first</a>
    <li class='indexItem indexItem2'><a href='#move_last'>move_last</a>
    <li class='indexItem indexItem2'><a href='#move_to'>move_to</a>
    <li class='indexItem indexItem2'><a href='#move_to_group'>move_to_group</a>
    <li class='indexItem indexItem2'><a href='#insert'>insert</a>
    <li class='indexItem indexItem2'><a href='#update'>update</a>
    <li class='indexItem indexItem2'><a href='#delete'>delete</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#METHODS_FOR_EXTENDING_ORDERED'>METHODS FOR EXTENDING ORDERED</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#_position_from_value'>_position_from_value</a>
    <li class='indexItem indexItem2'><a href='#_position_value'>_position_value</a>
    <li class='indexItem indexItem2'><a href='#_initial_position_value'>_initial_position_value</a>
    <li class='indexItem indexItem2'><a href='#_next_position_value'>_next_position_value</a>
    <li class='indexItem indexItem2'><a href='#_shift_siblings'>_shift_siblings</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#CAVEATS'>CAVEATS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Resultset_Methods'>Resultset Methods</a>
    <li class='indexItem indexItem2'><a href='#Race_Condition_on_Insert'>Race Condition on Insert</a>
    <li class='indexItem indexItem2'><a href='#Multiple_Moves'>Multiple Moves</a>
    <li class='indexItem indexItem2'><a href='#Default_Values'>Default Values</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBIx::Class::Ordered - Modify the position of objects in an ordered list.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>Create a table for your ordered data.</p>

<pre>  CREATE TABLE items (
    item_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    position INTEGER NOT NULL
  );</pre>

<p>Optionally, add one or more columns to specify groupings, allowing you to maintain independent ordered lists within one table:</p>

<pre>  CREATE TABLE items (
    item_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    position INTEGER NOT NULL,
    group_id INTEGER NOT NULL
  );</pre>

<p>Or even</p>

<pre>  CREATE TABLE items (
    item_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    position INTEGER NOT NULL,
    group_id INTEGER NOT NULL,
    other_group_id INTEGER NOT NULL
  );</pre>

<p>In your Schema or DB class add &#34;Ordered&#34; to the top of the component list.</p>

<pre>  __PACKAGE__-&#62;load_components(qw( Ordered ... ));</pre>

<p>Specify the column that stores the position number for each row.</p>

<pre>  package My::Item;
  __PACKAGE__-&#62;position_column(&#39;position&#39;);</pre>

<p>If you are using one grouping column, specify it as follows:</p>

<pre>  __PACKAGE__-&#62;grouping_column(&#39;group_id&#39;);</pre>

<p>Or if you have multiple grouping columns:</p>

<pre>  __PACKAGE__-&#62;grouping_column([&#39;group_id&#39;, &#39;other_group_id&#39;]);</pre>

<p>That&#39;s it, now you can change the position of your objects.</p>

<pre>  #!/use/bin/perl
  use My::Item;

  my $item = My::Item-&#62;create({ name=&#62;&#39;Matt S. Trout&#39; });
  # If using grouping_column:
  my $item = My::Item-&#62;create({ name=&#62;&#39;Matt S. Trout&#39;, group_id=&#62;1 });

  my $rs = $item-&#62;siblings();
  my @siblings = $item-&#62;siblings();

  my $sibling;
  $sibling = $item-&#62;first_sibling();
  $sibling = $item-&#62;last_sibling();
  $sibling = $item-&#62;previous_sibling();
  $sibling = $item-&#62;next_sibling();

  $item-&#62;move_previous();
  $item-&#62;move_next();
  $item-&#62;move_first();
  $item-&#62;move_last();
  $item-&#62;move_to( $position );
  $item-&#62;move_to_group( &#39;groupname&#39; );
  $item-&#62;move_to_group( &#39;groupname&#39;, $position );
  $item-&#62;move_to_group( {group_id=&#62;&#39;groupname&#39;, &#39;other_group_id=&#62;&#39;othergroupname&#39;} );
  $item-&#62;move_to_group( {group_id=&#62;&#39;groupname&#39;, &#39;other_group_id=&#62;&#39;othergroupname&#39;}, $position );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module provides a simple interface for modifying the ordered position of DBIx::Class objects.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTO_UPDATE"
>AUTO UPDATE</a></h1>

<p>All of the move_* methods automatically update the rows involved in the query. This is not configurable and is due to the fact that if you move a record it always causes other records in the list to be updated.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="position_column"
>position_column</a></h2>

<pre>  __PACKAGE__-&#62;position_column(&#39;position&#39;);</pre>

<p>Sets and retrieves the name of the column that stores the positional value of each record. Defaults to &#34;position&#34;.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="grouping_column"
>grouping_column</a></h2>

<pre>  __PACKAGE__-&#62;grouping_column(&#39;group_id&#39;);</pre>

<p>This method specifies a column to limit all queries in this module by. This effectively allows you to have multiple ordered lists within the same table.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="null_position_value"
>null_position_value</a></h2>

<pre>  __PACKAGE__-&#62;null_position_value(undef);</pre>

<p>This method specifies a value of <a href="#position_column" class="podlinkpod"
>&#34;position_column&#34;</a> which <b>would never be assigned to a row</b> during normal operation. When a row is moved, its position is set to this value temporarily, so that any unique constraints can not be violated. This value defaults to 0, which should work for all cases except when your positions do indeed start from 0.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="siblings"
>siblings</a></h2>

<pre>  my $rs = $item-&#62;siblings();
  my @siblings = $item-&#62;siblings();</pre>

<p>Returns an <b>ordered</b> resultset of all other objects in the same group excluding the one you called it on.</p>

<p>The ordering is a backwards-compatibility artifact - if you need a resultset with no ordering applied use <a href="#_siblings" class="podlinkpod"
>&#34;_siblings&#34;</a></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="previous_siblings"
>previous_siblings</a></h2>

<pre>  my $prev_rs = $item-&#62;previous_siblings();
  my @prev_siblings = $item-&#62;previous_siblings();</pre>

<p>Returns a resultset of all objects in the same group positioned before the object on which this method was called.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="next_siblings"
>next_siblings</a></h2>

<pre>  my $next_rs = $item-&#62;next_siblings();
  my @next_siblings = $item-&#62;next_siblings();</pre>

<p>Returns a resultset of all objects in the same group positioned after the object on which this method was called.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="previous_sibling"
>previous_sibling</a></h2>

<pre>  my $sibling = $item-&#62;previous_sibling();</pre>

<p>Returns the sibling that resides one position back. Returns 0 if the current object is the first one.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="first_sibling"
>first_sibling</a></h2>

<pre>  my $sibling = $item-&#62;first_sibling();</pre>

<p>Returns the first sibling object, or 0 if the first sibling is this sibling.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="next_sibling"
>next_sibling</a></h2>

<pre>  my $sibling = $item-&#62;next_sibling();</pre>

<p>Returns the sibling that resides one position forward. Returns 0 if the current object is the last one.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="last_sibling"
>last_sibling</a></h2>

<pre>  my $sibling = $item-&#62;last_sibling();</pre>

<p>Returns the last sibling, or 0 if the last sibling is this sibling.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="move_previous"
>move_previous</a></h2>

<pre>  $item-&#62;move_previous();</pre>

<p>Swaps position with the sibling in the position previous in the list. Returns 1 on success, and 0 if the object is already the first one.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="move_next"
>move_next</a></h2>

<pre>  $item-&#62;move_next();</pre>

<p>Swaps position with the sibling in the next position in the list. Returns 1 on success, and 0 if the object is already the last in the list.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="move_first"
>move_first</a></h2>

<pre>  $item-&#62;move_first();</pre>

<p>Moves the object to the first position in the list. Returns 1 on success, and 0 if the object is already the first.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="move_last"
>move_last</a></h2>

<pre>  $item-&#62;move_last();</pre>

<p>Moves the object to the last position in the list. Returns 1 on success, and 0 if the object is already the last one.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="move_to"
>move_to</a></h2>

<pre>  $item-&#62;move_to( $position );</pre>

<p>Moves the object to the specified position. Returns 1 on success, and 0 if the object is already at the specified position.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="move_to_group"
>move_to_group</a></h2>

<pre>  $item-&#62;move_to_group( $group, $position );</pre>

<p>Moves the object to the specified position of the specified group, or to the end of the group if $position is undef. 1 is returned on success, and 0 is returned if the object is already at the specified position of the specified group.</p>

<p>$group may be specified as a single scalar if only one grouping column is in use, or as a hashref of column =&#62; value pairs if multiple grouping columns are in use.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="insert"
>insert</a></h2>

<p>Overrides the DBIC insert() method by providing a default position number. The default will be the number of rows in the table +1, thus positioning the new record at the last position.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="update"
>update</a></h2>

<p>Overrides the DBIC update() method by checking for a change to the position and/or group columns. Movement within a group or to another group is handled by repositioning the appropriate siblings. Position defaults to the end of a new group if it has been changed to undef.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="delete"
>delete</a></h2>

<p>Overrides the DBIC delete() method by first moving the object to the last position, then deleting it, thus ensuring the integrity of the positions.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS_FOR_EXTENDING_ORDERED"
>METHODS FOR EXTENDING ORDERED</a></h1>

<p>You would want to override the methods below if you use sparse (non-linear) or non-numeric position values. This can be useful if you are working with preexisting non-normalised position data, or if you need to work with materialized path columns.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_position_from_value"
>_position_from_value</a></h2>

<pre>  my $num_pos = $item-&#62;_position_from_value ( $pos_value )</pre>

<p>Returns the <b>absolute numeric position</b> of an object with a <b>position value</b> set to <code>$pos_value</code>. By default simply returns <code>$pos_value</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_position_value"
>_position_value</a></h2>

<pre>  my $pos_value = $item-&#62;_position_value ( $pos )</pre>

<p>Returns the <b>value</b> of <a href="#position_column" class="podlinkpod"
>&#34;position_column&#34;</a> of the object at numeric position <code>$pos</code>. By default simply returns <code>$pos</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_initial_position_value"
>_initial_position_value</a></h2>

<pre>  __PACKAGE__-&#62;_initial_position_value(0);</pre>

<p>This method specifies a <b>value</b> of <a href="#position_column" class="podlinkpod"
>&#34;position_column&#34;</a> which is assigned to the first inserted element of a group, if no value was supplied at insertion time. All subsequent values are derived from this one by <a href="#_next_position_value" class="podlinkpod"
>&#34;_next_position_value&#34;</a> below. Defaults to 1.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_next_position_value"
>_next_position_value</a></h2>

<pre>  my $new_value = $item-&#62;_next_position_value ( $position_value )</pre>

<p>Returns a position <b>value</b> that would be considered <code>next</code> with regards to <code>$position_value</code>. Can be pretty much anything, given that <code>$position_value &#60; $new_value</code> where <code>&#60;</code> is the SQL comparison operator (usually works fine on strings). The default method expects <code>$position_value</code> to be numeric, and returns <code>$position_value + 1</code></p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="_shift_siblings"
>_shift_siblings</a></h2>

<pre>  $item-&#62;_shift_siblings ($direction, @between)</pre>

<p>Shifts all siblings with <b>positions values</b> in the range @between (inclusive) by one position as specified by $direction (left if &#60; 0, right if &#62; 0). By default simply increments/decrements each <a href="#position_column" class="podlinkpod"
>&#34;position_column&#34;</a> value by 1, doing so in a way as to not violate any existing constraints.</p>

<p>Note that if you override this method and have unique constraints including the <a href="#position_column" class="podlinkpod"
>&#34;position_column&#34;</a> the shift is not a trivial task. Refer to the implementation source of the default method for more information.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CAVEATS"
>CAVEATS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Resultset_Methods"
>Resultset Methods</a></h2>

<p>Note that all Insert/Create/Delete overrides are happening on <a href="../../DBIx/Class/Row.html" class="podlinkpod"
>DBIx::Class::Row</a> methods only. If you use the <a href="../../DBIx/Class/ResultSet.html" class="podlinkpod"
>DBIx::Class::ResultSet</a> versions of <a href="../../DBIx/Class/ResultSet.html#update" class="podlinkpod"
>update</a> or <a href="../../DBIx/Class/ResultSet.html#delete" class="podlinkpod"
>delete</a>, all logic present in this module will be bypassed entirely (possibly resulting in a broken order-tree). Instead always use the <a href="../../DBIx/Class/ResultSet.html#update_all" class="podlinkpod"
>update_all</a> and <a href="../../DBIx/Class/ResultSet.html#delete_all" class="podlinkpod"
>delete_all</a> methods, which will invoke the corresponding <a href="../../DBIx/Class/Row.html" class="podlinkpod"
>row</a> method on every member of the given resultset.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Race_Condition_on_Insert"
>Race Condition on Insert</a></h2>

<p>If a position is not specified for an insert, a position will be chosen based either on <a href="#_initial_position_value" class="podlinkpod"
>&#34;_initial_position_value&#34;</a> or <a href="#_next_position_value" class="podlinkpod"
>&#34;_next_position_value&#34;</a>, depending if there are already some items in the current group. The space of time between the necessary selects and insert introduces a race condition. Having unique constraints on your position/group columns, and using transactions (see <a href="../../DBIx/Class/Storage.html#txn_do" class="podlinkpod"
>&#34;txn_do&#34; in DBIx::Class::Storage</a>) will prevent such race conditions going undetected.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Multiple_Moves"
>Multiple Moves</a></h2>

<p>Be careful when issuing move_* methods to multiple objects. If you&#39;ve pre-loaded the objects then when you move one of the objects the position of the other object will not reflect their new value until you reload them from the database - see <a href="../../DBIx/Class/Row.html#discard_changes" class="podlinkpod"
>&#34;discard_changes&#34; in DBIx::Class::Row</a>.</p>

<p>There are times when you will want to move objects as groups, such as changing the parent of several objects at once - this directly conflicts with this problem. One solution is for us to write a ResultSet class that supports a parent() method, for example. Another solution is to somehow automagically modify the objects that exist in the current object&#39;s result set to have the new position value.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Default_Values"
>Default Values</a></h2>

<p>Using a database defined default_value on one of your group columns could result in the position not being assigned correctly.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<pre> Original code framework
   Aran Deltac &#60;bluefeet@cpan.org&#62;

 Constraints support and code generalisation
   Peter Rabbitson &#60;ribasushi@cpan.org&#62;</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>You may distribute this code under the same terms as Perl itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
