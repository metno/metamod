<html><head><title>DBIx::Class::Storage</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:16 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#new'>new</a>
    <li class='indexItem indexItem2'><a href='#set_schema'>set_schema</a>
    <li class='indexItem indexItem2'><a href='#connected'>connected</a>
    <li class='indexItem indexItem2'><a href='#disconnect'>disconnect</a>
    <li class='indexItem indexItem2'><a href='#ensure_connected'>ensure_connected</a>
    <li class='indexItem indexItem2'><a href='#throw_exception'>throw_exception</a>
    <li class='indexItem indexItem2'><a href='#txn_do'>txn_do</a>
    <li class='indexItem indexItem2'><a href='#txn_begin'>txn_begin</a>
    <li class='indexItem indexItem2'><a href='#txn_commit'>txn_commit</a>
    <li class='indexItem indexItem2'><a href='#txn_rollback'>txn_rollback</a>
    <li class='indexItem indexItem2'><a href='#svp_begin'>svp_begin</a>
    <li class='indexItem indexItem2'><a href='#svp_release'>svp_release</a>
    <li class='indexItem indexItem2'><a href='#svp_rollback'>svp_rollback</a>
    <li class='indexItem indexItem2'><a href='#txn_scope_guard'>txn_scope_guard</a>
    <li class='indexItem indexItem2'><a href='#sql_maker'>sql_maker</a>
    <li class='indexItem indexItem2'><a href='#debug'>debug</a>
    <li class='indexItem indexItem2'><a href='#debugfh'>debugfh</a>
    <li class='indexItem indexItem2'><a href='#debugobj'>debugobj</a>
    <li class='indexItem indexItem2'><a href='#debugcb'>debugcb</a>
    <li class='indexItem indexItem2'><a href='#cursor_class'>cursor_class</a>
    <li class='indexItem indexItem2'><a href='#deploy'>deploy</a>
    <li class='indexItem indexItem2'><a href='#connect_info'>connect_info</a>
    <li class='indexItem indexItem2'><a href='#select'>select</a>
    <li class='indexItem indexItem2'><a href='#insert'>insert</a>
    <li class='indexItem indexItem2'><a href='#update'>update</a>
    <li class='indexItem indexItem2'><a href='#delete'>delete</a>
    <li class='indexItem indexItem2'><a href='#select_single'>select_single</a>
    <li class='indexItem indexItem2'><a href='#columns_info_for'>columns_info_for</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#ENVIRONMENT_VARIABLES'>ENVIRONMENT VARIABLES</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#DBIC_TRACE'>DBIC_TRACE</a>
    <li class='indexItem indexItem2'><a href='#DBIC_TRACE_PROFILE'>DBIC_TRACE_PROFILE</a>
    <li class='indexItem indexItem2'><a href='#DBIX_CLASS_STORAGE_DBI_DEBUG'>DBIX_CLASS_STORAGE_DBI_DEBUG</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR_AND_CONTRIBUTORS'>AUTHOR AND CONTRIBUTORS</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBIx::Class::Storage - Generic Storage Handler</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>A base implementation of common Storage methods.
For specific information about <a href="../../DBI.html" class="podlinkpod"
>DBI</a>-based storage,
see <a href="../../DBIx/Class/Storage/DBI.html" class="podlinkpod"
>DBIx::Class::Storage::DBI</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="new"
>new</a></h2>

<p>Arguments: $schema</p>

<p>Instantiates the Storage object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="set_schema"
>set_schema</a></h2>

<p>Used to reset the schema class or object which owns this storage object,
such as during <a href="../../DBIx/Class/Schema.html#clone" class="podlinkpod"
>&#34;clone&#34; in DBIx::Class::Schema</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="connected"
>connected</a></h2>

<p>Returns true if we have an open storage connection,
false if it is not (yet) open.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="disconnect"
>disconnect</a></h2>

<p>Closes any open storage connection unconditionally.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="ensure_connected"
>ensure_connected</a></h2>

<p>Initiate a connection to the storage if one isn&#39;t already open.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="throw_exception"
>throw_exception</a></h2>

<p>Throws an exception - croaks.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="txn_do"
>txn_do</a></h2>

<dl>
<dt><a name="Arguments:_$coderef,_@coderef_args?"
>Arguments: <code>$coderef</code>,
@coderef_args?</a></dt>

<dd>
<dt><a name="Return_Value:_The_return_value_of_$coderef"
>Return Value: The return value of $coderef</a></dt>
</dl>

<p>Executes <code>$coderef</code> with (optional) arguments <code>@coderef_args</code> atomically,
returning its result (if any).
If an exception is caught,
a rollback is issued and the exception is rethrown.
If the rollback fails,
(i.e.
throws an exception) an exception is thrown that includes a &#34;Rollback failed&#34; message.</p>

<p>For example,</p>

<pre>  my $author_rs = $schema-&#62;resultset(&#39;Author&#39;)-&#62;find(1);
  my @titles = qw/Night Day It/;

  my $coderef = sub {
    # If any one of these fails, the entire transaction fails
    $author_rs-&#62;create_related(&#39;books&#39;, {
      title =&#62; $_
    }) foreach (@titles);

    return $author-&#62;books;
  };

  my $rs;
  try {
    $rs = $schema-&#62;txn_do($coderef);
  } catch {
    my $error = shift;
    # Transaction failed
    die &#34;something terrible has happened!&#34;
      if ($error =~ /Rollback failed/);          # Rollback failed

    deal_with_failed_transaction();
  };</pre>

<p>In a nested transaction (calling txn_do() from within a txn_do() coderef) only the outermost transaction will issue a <a href="#txn_commit" class="podlinkpod"
>&#34;txn_commit&#34;</a>, and txn_do() can be called in void, scalar and list context and it will behave as expected.</p>

<p>Please note that all of the code in your coderef, including non-DBIx::Class code, is part of a transaction. This transaction may fail out halfway, or it may get partially double-executed (in the case that our DB connection failed halfway through the transaction, in which case we reconnect and restart the txn). Therefore it is best that any side-effects in your coderef are idempotent (that is, can be re-executed multiple times and get the same result), and that you check up on your side-effects in the case of transaction failure.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="txn_begin"
>txn_begin</a></h2>

<p>Starts a transaction.</p>

<p>See the preferred <a href="#txn_do" class="podlinkpod"
>&#34;txn_do&#34;</a> method, which allows for an entire code block to be executed transactionally.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="txn_commit"
>txn_commit</a></h2>

<p>Issues a commit of the current transaction.</p>

<p>It does <i>not</i> perform an actual storage commit unless there&#39;s a DBIx::Class transaction currently in effect (i.e. you called <a href="#txn_begin" class="podlinkpod"
>&#34;txn_begin&#34;</a>).</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="txn_rollback"
>txn_rollback</a></h2>

<p>Issues a rollback of the current transaction. A nested rollback will throw a <a href="../../DBIx/Class/Storage/NESTED_ROLLBACK_EXCEPTION.html" class="podlinkpod"
>DBIx::Class::Storage::NESTED_ROLLBACK_EXCEPTION</a> exception, which allows the rollback to propagate to the outermost transaction.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="svp_begin"
>svp_begin</a></h2>

<p>Arguments: $savepoint_name?</p>

<p>Created a new savepoint using the name provided as argument. If no name is provided, a random name will be used.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="svp_release"
>svp_release</a></h2>

<p>Arguments: $savepoint_name?</p>

<p>Release the savepoint provided as argument. If none is provided, release the savepoint created most recently. This will implicitly release all savepoints created after the one explicitly released as well.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="svp_rollback"
>svp_rollback</a></h2>

<p>Arguments: $savepoint_name?</p>

<p>Rollback to the savepoint provided as argument. If none is provided, rollback to the savepoint created most recently. This will implicitly release all savepoints created after the savepoint we rollback to.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="txn_scope_guard"
>txn_scope_guard</a></h2>

<p>An alternative way of transaction handling based on <a href="../../DBIx/Class/Storage/TxnScopeGuard.html" class="podlinkpod"
>DBIx::Class::Storage::TxnScopeGuard</a>:</p>

<pre> my $txn_guard = $storage-&#62;txn_scope_guard;

 $row-&#62;col1(&#34;val1&#34;);
 $row-&#62;update;

 $txn_guard-&#62;commit;</pre>

<p>If an exception occurs, or the guard object otherwise leaves the scope before <code>$txn_guard-&#62;commit</code> is called, the transaction will be rolled back by an explicit <a href="#txn_rollback" class="podlinkpod"
>&#34;txn_rollback&#34;</a> call. In essence this is akin to using a <a href="#txn_begin" class="podlinkpod"
>&#34;txn_begin&#34;</a>/<a href="#txn_commit" class="podlinkpod"
>&#34;txn_commit&#34;</a> pair, without having to worry about calling <a href="#txn_rollback" class="podlinkpod"
>&#34;txn_rollback&#34;</a> at the right places. Note that since there is no defined code closure, there will be no retries and other magic upon database disconnection. If you need such functionality see <a href="#txn_do" class="podlinkpod"
>&#34;txn_do&#34;</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="sql_maker"
>sql_maker</a></h2>

<p>Returns a <code>sql_maker</code> object - normally an object of class <code>DBIx::Class::SQLMaker</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debug"
>debug</a></h2>

<p>Causes trace information to be emitted on the <a href="#debugobj" class="podlinkpod"
>&#34;debugobj&#34;</a> object. (or <code>STDERR</code> if <a href="#debugobj" class="podlinkpod"
>&#34;debugobj&#34;</a> has not specifically been set).</p>

<p>This is the equivalent to setting <a href="#DBIC_TRACE" class="podlinkpod"
>&#34;DBIC_TRACE&#34;</a> in your shell environment.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debugfh"
>debugfh</a></h2>

<p>Set or retrieve the filehandle used for trace/debug output. This should be an IO::Handle compatible object (only the <code>print</code> method is used. Initially set to be STDERR - although see information on the <a href="../../DBIC_TRACE.html" class="podlinkpod"
>DBIC_TRACE</a> environment variable.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debugobj"
>debugobj</a></h2>

<p>Sets or retrieves the object used for metric collection. Defaults to an instance of <a href="../../DBIx/Class/Storage/Statistics.html" class="podlinkpod"
>DBIx::Class::Storage::Statistics</a> that is compatible with the original method of using a coderef as a callback. See the aforementioned Statistics class for more information.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="debugcb"
>debugcb</a></h2>

<p>Sets a callback to be executed each time a statement is run; takes a sub reference. Callback is executed as $sub-&#62;($op, $info) where $op is SELECT/INSERT/UPDATE/DELETE and $info is what would normally be printed.</p>

<p>See <a href="#debugobj" class="podlinkpod"
>&#34;debugobj&#34;</a> for a better way.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="cursor_class"
>cursor_class</a></h2>

<p>The cursor class for this Storage object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="deploy"
>deploy</a></h2>

<p>Deploy the tables to storage (CREATE TABLE and friends in a SQL-based Storage class). This would normally be called through <a href="../../DBIx/Class/Schema.html#deploy" class="podlinkpod"
>&#34;deploy&#34; in DBIx::Class::Schema</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="connect_info"
>connect_info</a></h2>

<p>The arguments of <code>connect_info</code> are always a single array reference, and are Storage-handler specific.</p>

<p>This is normally accessed via <a href="../../DBIx/Class/Schema.html#connection" class="podlinkpod"
>&#34;connection&#34; in DBIx::Class::Schema</a>, which encapsulates its argument list in an arrayref before calling <code>connect_info</code> here.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="select"
>select</a></h2>

<p>Handle a select statement.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="insert"
>insert</a></h2>

<p>Handle an insert statement.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="update"
>update</a></h2>

<p>Handle an update statement.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="delete"
>delete</a></h2>

<p>Handle a delete statement.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="select_single"
>select_single</a></h2>

<p>Performs a select, fetch and return of data - handles a single row only.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="columns_info_for"
>columns_info_for</a></h2>

<p>Returns metadata for the given source&#39;s columns. This is *deprecated*, and will be removed before 1.0. You should be specifying the metadata yourself if you need it.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="ENVIRONMENT_VARIABLES"
>ENVIRONMENT VARIABLES</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DBIC_TRACE"
>DBIC_TRACE</a></h2>

<p>If <code>DBIC_TRACE</code> is set then trace information is produced (as when the <a href="#debug" class="podlinkpod"
>&#34;debug&#34;</a> method is set).</p>

<p>If the value is of the form <code>1=/path/name</code> then the trace output is written to the file <code>/path/name</code>.</p>

<p>This environment variable is checked when the storage object is first created (when you call connect on your schema). So, run-time changes to this environment variable will not take effect unless you also re-connect on your schema.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DBIC_TRACE_PROFILE"
>DBIC_TRACE_PROFILE</a></h2>

<p>If <code>DBIC_TRACE_PROFILE</code> is set, <a href="../../DBIx/Class/Storage/Debug/PrettyPrint.html" class="podlinkpod"
>DBIx::Class::Storage::Debug::PrettyPrint</a> will be used to format the output from <code>DBIC_TRACE</code>. The value it is set to is the <code>profile</code> that it will be used. If the value is a filename the file is read with <a href="../../Config/Any.html" class="podlinkpod"
>Config::Any</a> and the results are used as the configuration for tracing. See <a href="../../SQL/Abstract/Tree.html#new" class="podlinkpod"
>&#34;new&#34; in SQL::Abstract::Tree</a> for what that structure should look like.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="DBIX_CLASS_STORAGE_DBI_DEBUG"
>DBIX_CLASS_STORAGE_DBI_DEBUG</a></h2>

<p>Old name for DBIC_TRACE</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../DBIx/Class/Storage/DBI.html" class="podlinkpod"
>DBIx::Class::Storage::DBI</a> - reference storage implementation using SQL::Abstract and DBI.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR_AND_CONTRIBUTORS"
>AUTHOR AND CONTRIBUTORS</a></h1>

<p>See <a href="../../DBIx/Class.html#AUTHOR" class="podlinkpod"
>AUTHOR</a> and <a href="../../DBIx/Class.html#CONTRIBUTORS" class="podlinkpod"
>CONTRIBUTORS</a> in DBIx::Class</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>You may distribute this code under the same terms as Perl itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
