<html><head><title>Net::Server::PreFork</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:23 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#SAMPLE_CODE'>SAMPLE CODE</a>
  <li class='indexItem indexItem1'><a href='#COMMAND_LINE_ARGUMENTS'>COMMAND LINE ARGUMENTS</a>
  <li class='indexItem indexItem1'><a href='#CONFIGURATION_FILE'>CONFIGURATION FILE</a>
  <li class='indexItem indexItem1'><a href='#PROCESS_FLOW'>PROCESS FLOW</a>
  <li class='indexItem indexItem1'><a href='#HOOKS'>HOOKS</a>
  <li class='indexItem indexItem1'><a href='#HOT_DEPLOY'>HOT DEPLOY</a>
  <li class='indexItem indexItem1'><a href='#BUGS'>BUGS</a>
  <li class='indexItem indexItem1'><a href='#TO_DO'>TO DO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#THANKS'>THANKS</a>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Net::Server::PreFork - Net::Server personality</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    use base qw(Net::Server::PreFork);

    sub process_request {
        #...code...
    }

    __PACKAGE__-&#62;run();</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Please read the pod on Net::Server and Net::Server::PreForkSimple first. This module is a personality, or extension, or sub class, of the Net::Server::PreForkSimple class which is a sub class of Net::Server. See <a href="../../Net/Server/PreForkSimple.html" class="podlinkpod"
>Net::Server::PreForkSimple</a>.</p>

<p>This personality binds to one or more ports and then forks <code>min_servers</code> child process. The server will make sure that at any given time there are <code>min_spare_servers</code> available to receive a client request, up to <code>max_servers</code>. Each of these children will process up to <code>max_requests</code> client connections. This type is good for a heavily hit site, and should scale well for most applications. (Multi port accept is accomplished using flock to serialize the children).</p>

<p>At this time, it does not appear that this module will pass tests on Win32 systems. Any ideas or patches for making the tests pass would be welcome.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SAMPLE_CODE"
>SAMPLE CODE</a></h1>

<p>Please see the sample listed in Net::Server.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COMMAND_LINE_ARGUMENTS"
>COMMAND LINE ARGUMENTS</a></h1>

<p>In addition to the command line arguments of the Net::Server base class and the Net::Server::PreForkSimple parent class, Net::Server::PreFork contains several other configurable parameters. You really should also see <a href="../../Net/Server/PreForkSimple.html" class="podlinkpod"
>Net::Server::PreForkSimple</a>.</p>

<pre>    Key                 Value                   Default
    min_servers         \d+                     5
    min_spare_servers   \d+                     2
    max_spare_servers   \d+                     10
    max_servers         \d+                     50
    max_requests        \d+                     1000

    serialize           (flock|semaphore
                         |pipe|none)            undef
    # serialize defaults to flock on multi_port or on Solaris
    lock_file           &#34;filename&#34;              File::Temp::tempfile or POSIX::tmpnam

    check_for_dead      \d+                     30
    check_for_waiting   \d+                     10

    max_dequeue         \d+                     undef
    check_for_dequeue   \d+                     undef

    child_communication 1                       undef</pre>

<dl>
<dt><a name="min_servers"
>min_servers</a></dt>

<dd>
<p>The minimum number of servers to keep running.</p>

<dt><a name="min_spare_servers"
>min_spare_servers</a></dt>

<dd>
<p>The minimum number of servers to have waiting for requests. Minimum and maximum numbers should not be set to close to each other or the server will fork and kill children too often.</p>

<dt><a name="max_spare_servers"
>max_spare_servers</a></dt>

<dd>
<p>The maximum number of servers to have waiting for requests. See <i>min_spare_servers</i>.</p>

<dt><a name="max_servers"
>max_servers</a></dt>

<dd>
<p>The maximum number of child servers to start. This does not apply to dequeue processes.</p>

<dt><a name="check_for_waiting"
>check_for_waiting</a></dt>

<dd>
<p>Seconds to wait before checking to see if we can kill off some waiting servers.</p>

<dt><a name="check_for_spawn"
>check_for_spawn</a></dt>

<dd>
<p>Seconds between checking to see if we need to spawn more children</p>

<dt><a name="min_child_ttl"
>min_child_ttl</a></dt>

<dd>
<p>Minimum number of seconds between starting children and killing a child process</p>

<dt><a name="child_communication"
>child_communication</a></dt>

<dd>
<p>Enable child communication to parent via unix sockets. If set to true, will let children write to the socket contained in $self-&#62;{&#39;server&#39;}-&#62;{&#39;parent_sock&#39;}. The parent will be notified through child_is_talking_hook where the first argument is the socket to the child. The child&#39;s socket is stored in $self-&#62;{&#39;server&#39;}-&#62;{&#39;children&#39;}-&#62;{$child_pid}-&#62;{&#39;sock&#39;}.</p>

<dt><a name="serialize"
>serialize</a></dt>

<dd>
<p>See the documentation under <a href="../../Net/Server/PreForkSimple.html" class="podlinkpod"
>Net::Server::PreForkSimple</a>.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONFIGURATION_FILE"
>CONFIGURATION FILE</a></h1>

<p><code>Net::Server::PreFork</code> allows for the use of a configuration file to read in server parameters. The format of this conf file is simple key value pairs. Comments and white space are ignored.</p>

<pre>    #-------------- file test.conf --------------

    ### server information
    min_servers   20
    max_servers   80
    min_spare_servers 10
    min_spare_servers 15

    max_requests  1000

    ### user and group to become
    user        somebody
    group       everybody

    ### logging ?
    log_file    /var/log/server.log
    log_level   3
    pid_file    /tmp/server.pid

    ### access control
    allow       .+\.(net|com)
    allow       domain\.com
    deny        a.+

    ### background the process?
    background  1

    ### ports to bind
    host        127.0.0.1
    port        localhost:20204
    port        20205

    ### reverse lookups ?
    # reverse_lookups on

    ### enable child communication ?
    # child_communication

    #-------------- file test.conf --------------</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="PROCESS_FLOW"
>PROCESS FLOW</a></h1>

<p>Process flow follows Net::Server until the loop phase. At this point <code>min_servers</code> are forked and wait for connections. When a child accepts a connection, finishs processing a client, or exits, it relays that information to the parent, which keeps track and makes sure there are enough children to fulfill <code>min_servers</code>, <code>min_spare_servers</code>, <code>max_spare_servers</code>, and <code>max_servers</code>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="HOOKS"
>HOOKS</a></h1>

<p>The PreFork server has the following hooks in addition to the hooks provided by PreForkSimple. See <a href="../../Net/Server/PreForkSimple.html" class="podlinkpod"
>Net::Server::PreForkSimple</a>.</p>

<dl>
<dt><a name="$self-&#62;run_n_children_hook()"
><code>$self-&#62;run_n_children_hook()</code></a></dt>

<dd>
<p>This hook occurs at the top of run_n_children which is called each time the server goes to start more child processes. This gives the parent to do a little of its own accountting (as desired). Idea for this hook came from James FitzGibbon.</p>

<dt><a name="$self-&#62;parent_read_hook()"
><code>$self-&#62;parent_read_hook()</code></a></dt>

<dd>
<p>This hook occurs any time that the parent reads information from the child. The line from the child is sent as an argument.</p>

<dt><a name="$self-&#62;child_is_talking_hook()"
><code>$self-&#62;child_is_talking_hook()</code></a></dt>

<dd>
<p>This hook occurs if child_communication is true and the child has written to $self-&#62;{&#39;server&#39;}-&#62;{&#39;parent_sock&#39;}. The first argument will be the open socket to the child.</p>

<dt><a name="$self-&#62;idle_loop_hook()"
><code>$self-&#62;idle_loop_hook()</code></a></dt>

<dd>
<p>This hook is called in every pass through the main process wait loop, every <code>check_for_waiting</code> seconds. The first argument is a reference to an array of file descriptors that can be read at the moment.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="HOT_DEPLOY"
>HOT DEPLOY</a></h1>

<p>Since version 2.000, the PreFork server has accepted the TTIN and TTOU signals. When a TTIN is received, the min and max_servers are increased by 1. If a TTOU signal is received the min max_servers are decreased by 1. This allows for adjusting the number of handling processes without having to restart the server.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BUGS"
>BUGS</a></h1>

<p>Tests don&#39;t seem to work on Win32. Any ideas or patches would be welcome.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="TO_DO"
>TO DO</a></h1>

<p>See <a href="../../Net/Server.html" class="podlinkpod"
>Net::Server</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Paul T. Seamons paul@seamons.com</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="THANKS"
>THANKS</a></h1>

<p>See <a href="../../Net/Server.html" class="podlinkpod"
>Net::Server</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p>Please see also <a href="../../Net/Server/Fork.html" class="podlinkpod"
>Net::Server::Fork</a>, <a href="../../Net/Server/INET.html" class="podlinkpod"
>Net::Server::INET</a>, <a href="../../Net/Server/PreForkSimple.html" class="podlinkpod"
>Net::Server::PreForkSimple</a>, <a href="../../Net/Server/MultiType.html" class="podlinkpod"
>Net::Server::MultiType</a>, <a href="../../Net/Server/Single.html" class="podlinkpod"
>Net::Server::Single</a> <a href="../../Net/Server/SIG.html" class="podlinkpod"
>Net::Server::SIG</a> <a href="../../Net/Server/Daemonize.html" class="podlinkpod"
>Net::Server::Daemonize</a> <a href="../../Net/Server/Proto.html" class="podlinkpod"
>Net::Server::Proto</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
