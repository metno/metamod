<html><head><title>Metamod::OAI::DataProvider</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Fri Apr  4 12:00:05 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#FUNCTIONS%2FMETHODS'>FUNCTIONS/METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%24self-%3Esupports_sets()'>$self-&#62;supports_sets()</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Eidentifier_exists(%24identifier)'>$self-&#62;identifier_exists($identifier)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Eget_record(%24identifier%2C_%24format)'>$self-&#62;get_record($identifier, $format)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Eget_records(%24format%2C_%24from%2C_%24until%2C_%24set%2C_%24resumption_token)'>$self-&#62;get_records($format, $from, $until, $set, $resumption_token)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3Eget_identifiers(%24format%2C_%24from%2C_%24until%2C_%24set%2C_%24resumption_token)'>$self-&#62;get_identifiers($format, $from, $until, $set, $resumption_token)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_convert_date(%24datestamp)'>$self-&#62;_convert_date($datestamp)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_oai_record(%24identifier%2C_%24dataset%2C_%24format)'>$self-&#62;_oai_record($identifier, $dataset, $format)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_oai_record_header(%24identifier%2C_%24dataset%2C_%24format)'>$self-&#62;_oai_record_header($identifier, $dataset, $format)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_get_metadata(%24dataset%2C_%24format)'>$self-&#62;_get_metadata($dataset, $format)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_base_resultset()'>$self-&#62;_base_resultset()</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_search_datasets(%24from%2C_%24until%2C_%24set)'>$self-&#62;_search_datasets($from, $until, $set)</a>
    <li class='indexItem indexItem2'><a href='#%24self-%3E_validate_metadata(%24format%2C_%24xml_dom)'>$self-&#62;_validate_metadata($format, $xml_dom)</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Metamod::OAI::DataProvider - Data provider for OAI-PMH server</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module provides a layer between the OAI-PMH server and the metadata repository.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FUNCTIONS/METHODS"
>FUNCTIONS/METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;supports_sets()"
>$self-&#62;supports_sets()</a></h2>

<p>Check if the data repository supports sets.</p>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns 1 if the data repository supports sets.
False otherwise.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;identifier_exists($identifier)"
>$self-&#62;identifier_exists($identifier)</a></h2>

<p>Check if a identifier exists in data repository.</p>

<dl>
<dt><a name="$identifier"
>$identifier</a></dt>

<dd>
<p>The identifier to check.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns 1 if the identifier exists in the data repository.
False otherwise.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;get_record($identifier,_$format)"
>$self-&#62;get_record($identifier,
$format)</a></h2>

<p>Get a single record from the repository.</p>

<dl>
<dt><a name="$format"
>$format</a></dt>

<dd>
<p>The format that the metadata for the record should be in.</p>

<dt><a name="$identifier"
>$identifier</a></dt>

<dd>
<p>The OAI identifier for the record.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>If the record is found it returns a hash reference with the keys &#39;identifier&#39; and &#39;datestamp&#39;.
If the dataset has been deleted or the metadata for the record is not valid it will also contain the key &#39;status&#39;.
If the dataset has not been deleted and the metadata is valid it will contain the key &#39;metadata&#39; with a XML DOM object as value.</p>

<p>If the record cannot be found it returns false.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;get_records($format,_$from,_$until,_$set,_$resumption_token)"
>$self-&#62;get_records($format,
$from,
$until,
$set,
$resumption_token)</a></h2>

<p>Get all the metadata records in the repository that match the specified criteria.</p>

<dl>
<dt><a name="$format"
>$format</a></dt>

<dd>
<p>The metadata format that should be used for the metadata.</p>

<dt><a name="$from"
>$from</a></dt>

<dd>
<dt><a name="$until"
>$until</a></dt>

<dd>
<dt><a name="$set"
>$set</a></dt>

<dd>
<dt><a name="$resumption_token"
>$resumption_token</a></dt>

<dd>
<dt><a name="return"
>return</a></dt>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;get_identifiers($format,_$from,_$until,_$set,_$resumption_token)"
>$self-&#62;get_identifiers($format,
$from,
$until,
$set,
$resumption_token)</a></h2>

<p>Get a list of record headers without metadata that match the specified criteria.</p>

<dl>
<dt><a name="$format"
>$format</a></dt>

<dd>
<dt><a name="$from"
>$from</a></dt>

<dd>
<dt><a name="$until"
>$until</a></dt>

<dd>
<dt><a name="$set"
>$set</a></dt>

<dd>
<dt><a name="$resumption_token"
>$resumption_token</a></dt>

<dd>
<dt><a name="return"
>return</a></dt>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_convert_date($datestamp)"
>$self-&#62;_convert_date($datestamp)</a></h2>

<p>Convert a datestamp into the format that is used by OAI-PMH.</p>

<dl>
<dt><a name="$datestamp"
>$datestamp</a></dt>

<dd>
<p>A datestamp string on the format YYYY-MM-DD HH:MM:SS</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>A datestamp string on the format YYYY-MM-DDTHH:MM:SSZ.
Dies if the datestamp argument does not have the correct format.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_oai_record($identifier,_$dataset,_$format)"
>$self-&#62;_oai_record($identifier,
$dataset,
$format)</a></h2>

<p>Get the data from a dataset that is required for a OAI-PMH record.</p>

<dl>
<dt><a name="$identifier"
>$identifier</a></dt>

<dd>
<p>The identifier of the record.</p>

<dt><a name="$dataset"
>$dataset</a></dt>

<dd>
<p>A <code>DBIx::Class</code> row object for the dataset.</p>

<dt><a name="$format"
>$format</a></dt>

<dd>
<p>The metadata format for the dataset.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>A hash reference representing the OAI-PMH record.
The record has the keys &#39;identifier&#39; and &#39;datestamp&#39;.
In addition it will have the key &#39;metadata&#39; if the dataset is not deleted and the metadata is valid (in the case of metadata validation).
If the dataset is deleted or it contains invalid metadata (in the case of metadata validation) it will have the key &#39;status&#39;.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_oai_record_header($identifier,_$dataset,_$format)"
>$self-&#62;_oai_record_header($identifier,
$dataset,
$format)</a></h2>

<p>Get the data from a dataset that is required for building a OAI-PMH header.</p>

<dl>
<dt><a name="$identifier"
>$identifier</a></dt>

<dd>
<p>The identifier of the record.</p>

<dt><a name="$dataset"
>$dataset</a></dt>

<dd>
<p>A <code>DBIx::Class</code> row object for the dataset.</p>

<dt><a name="$format"
>$format</a></dt>

<dd>
<p>The metadata format for the dataset.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>A hash reference representing the OAI-PMH header.
The header has the keys &#39;identifier&#39; and &#39;datestamp&#39;.
If the dataset is deleted or it contains invalid metadata (in the case of metadata validation) it will have the key &#39;status&#39;.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_get_metadata($dataset,_$format)"
>$self-&#62;_get_metadata($dataset,
$format)</a></h2>

<p>Get the metadata for a dataset in the correct format.
Must be eval-ed</p>

<dl>
<dt><a name="$dataset"
>$dataset</a></dt>

<dd>
<p>A <code>DBIx::Class</code> row object to the dataset.</p>

<dt><a name="$format"
>$format</a></dt>

<dd>
<p>The format name as a string.
This must be one of the format availble metadata formats.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns the metadata in the correct XML format as a XML dom object.
Dies if the specified format is not among the list of supported formats.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_base_resultset()"
>$self-&#62;_base_resultset()</a></h2>

<p>Get the base DBIx::Class results to use for searching.
The reason we use a base resultset instead of the dataset resultset directly is since only level 1 datasets are exported and depending on configuration only a subset of the level 1 datasets.</p>

<dl>
<dt><a name="return"
>return</a></dt>

<dd>
<p>A DBIx::Class resultset with the necessary filters in place.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_search_datasets($from,_$until,_$set)"
>$self-&#62;_search_datasets($from,
$until,
$set)</a></h2>

<p>Search the metadata repository for datasets that match the specified conditions.</p>

<dl>
<dt><a name="$from"
>$from</a></dt>

<dd>
<p>A datestamp on the form &#39;YYYY-MM-DDTHH:MM:SST.
Only datasets with a ds_datestamp larger or equal to this is returned.</p>

<dt><a name="$until"
>$until</a></dt>

<dd>
<p>A datestamp on the form &#39;YYYY-MM-DDTHH:MM:SST.
Only datasets with a ds_datestamp less or equal to this is returned.</p>

<dt><a name="$set"
>$set</a></dt>

<dd>
<p>A string with a ownertag.
Only datasets matching the ownertag is returned.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>A DBIx::Class resultset with the correct conditions applied.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$self-&#62;_validate_metadata($format,_$xml_dom)"
>$self-&#62;_validate_metadata($format,
$xml_dom)</a></h2>

<p>Validate that the metadata follows a specific metadata format.</p>

<dl>
<dt><a name="$format"
>$format</a></dt>

<dd>
<p>The name of the format to check the file against.</p>

<dt><a name="$xml_dom"
>$xml_dom</a></dt>

<dd>
<p>A XML DOM object as returned by XML::LibXML.</p>

<dt><a name="$dataset"
>$dataset</a></dt>

<dd>
<p>A DBIx::Class row object to the dataset.</p>

<dt><a name="return"
>return</a></dt>

<dd>
<p>Returns true if the metadata is valid or if no XSD file is registered for the format.
False if the format is not valid.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>&#195;&#152;ystein Torget,
&#60;oysteint@met.no&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>GPLv2 <a href="http://www.gnu.org/licenses/gpl-2.0.html" class="podlinkurl"
>http://www.gnu.org/licenses/gpl-2.0.html</a></p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
