<html><head><title>Moose::Cookbook::Basics::Person_BUILDARGSAndBUILD</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:21 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#MORE_CONSIDERATIONS'>MORE CONSIDERATIONS</a>
  <li class='indexItem indexItem1'><a href='#CONCLUSION'>CONCLUSION</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Moose::Cookbook::Basics::Person_BUILDARGSAndBUILD - Using BUILDARGS and BUILD to hook into object construction</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 2.0604</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  package Person;

  has &#39;ssn&#39; =&#62; (
      is        =&#62; &#39;ro&#39;,
      isa       =&#62; &#39;Str&#39;,
      predicate =&#62; &#39;has_ssn&#39;,
  );

  has &#39;country_of_residence&#39; =&#62; (
      is      =&#62; &#39;ro&#39;,
      isa     =&#62; &#39;Str&#39;,
      default =&#62; &#39;usa&#39;
  );

  has &#39;first_name&#39; =&#62; (
      is  =&#62; &#39;ro&#39;,
      isa =&#62; &#39;Str&#39;,
  );

  has &#39;last_name&#39; =&#62; (
      is  =&#62; &#39;ro&#39;,
      isa =&#62; &#39;Str&#39;,
  );

  around BUILDARGS =&#62; sub {
      my $orig = shift;
      my $class = shift;

      if ( @_ == 1 &#38;&#38; ! ref $_[0] ) {
          return $class-&#62;$orig(ssn =&#62; $_[0]);
      }
      else {
          return $class-&#62;$orig(@_);
      }
  };

  sub BUILD {
      my $self = shift;

      if ( $self-&#62;country_of_residence eq &#39;usa&#39; ) {
          die &#39;Cannot create a Person who lives in the USA without an ssn.&#39;
              unless $self-&#62;has_ssn;
      }
  }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This recipe demonstrates the use of <code>BUILDARGS</code> and <code>BUILD</code>. By defining these methods, we can hook into the object construction process without overriding <code>new</code>.</p>

<p>The <code>BUILDARGS</code> method is called <i>before</i> an object has been created. It is called as a class method, and receives all of the parameters passed to the <code>new</code> method. It is expected to do something with these arguments and return a hash reference. The keys of the hash must be attribute <code>init_arg</code>s.</p>

<p>The primary purpose of <code>BUILDARGS</code> is to allow a class to accept something other than named arguments. In the case of our <code>Person</code> class, we are allowing it to be called with a single argument, a social security number:</p>

<pre>  my $person = Person-&#62;new(&#39;123-45-6789&#39;);</pre>

<p>The key part of our <code>BUILDARGS</code> is this conditional:</p>

<pre>      if ( @_ == 1 &#38;&#38; ! ref $_[0] ) {
          return $class-&#62;$orig(ssn =&#62; $_[0]);
      }</pre>

<p>By default, Moose constructors accept a list of key-value pairs, or a hash reference. We need to make sure that <code>$_[0]</code> is not a reference before assuming it is a social security number.</p>

<p>We call the original <code>BUILDARGS</code> method to handle all the other cases. You should always do this in your own <code>BUILDARGS</code> methods, since <a href="../../../Moose/Object.html" class="podlinkpod"
>Moose::Object</a> provides its own <code>BUILDARGS</code> method that handles hash references and a list of key-value pairs.</p>

<p>The <code>BUILD</code> method is called <i>after</i> the object is constructed, but before it is returned to the caller. The <code>BUILD</code> method provides an opportunity to check the object state as a whole. This is a good place to put logic that cannot be expressed as a type constraint on a single attribute.</p>

<p>In the <code>Person</code> class, we need to check the relationship between two attributes, <code>ssn</code> and <code>country_of_residence</code>. We throw an exception if the object is not logically consistent.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="MORE_CONSIDERATIONS"
>MORE CONSIDERATIONS</a></h1>

<p>This recipe is made significantly simpler because all of the attributes are read-only. If the <code>country_of_residence</code> attribute were settable, we would need to check that a Person had an <code>ssn</code> if the new country was <code>usa</code>. This could be done with a <code>before</code> modifier.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CONCLUSION"
>CONCLUSION</a></h1>

<p>We have repeatedly discouraged overriding <code>new</code> in Moose classes. This recipe shows how you can use <code>BUILDARGS</code> and <code>BUILD</code> to hook into object construction without overriding <code>new</code>.</p>

<p>The <code>BUILDARGS</code> method lets us expand on Moose&#39;s built-in parameter handling for constructors. The <code>BUILD</code> method lets us implement logical constraints across the whole object after it is created.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Moose is maintained by the Moose Cabal, along with the help of many contributors. See <a href="../../../Moose.html#CABAL" class="podlinkpod"
>&#34;CABAL&#34; in Moose</a> and <a href="../../../Moose.html#CONTRIBUTORS" class="podlinkpod"
>&#34;CONTRIBUTORS&#34; in Moose</a> for details.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2012 by Infinity Interactive, Inc..</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
