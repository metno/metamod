<html><head><title>Moose::Manual::Construction</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:21 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#WHERE%27S_THE_CONSTRUCTOR%3F'>WHERE&#39;S THE CONSTRUCTOR?</a>
  <li class='indexItem indexItem1'><a href='#OBJECT_CONSTRUCTION_AND_ATTRIBUTES'>OBJECT CONSTRUCTION AND ATTRIBUTES</a>
  <li class='indexItem indexItem1'><a href='#OBJECT_CONSTRUCTION_HOOKS'>OBJECT CONSTRUCTION HOOKS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#BUILDARGS'>BUILDARGS</a>
    <li class='indexItem indexItem2'><a href='#BUILD'>BUILD</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#BUILD_and_parent_classes'>BUILD and parent classes</a>
    </ul>
  </ul>
  <li class='indexItem indexItem1'><a href='#OBJECT_DESTRUCTION'>OBJECT DESTRUCTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Error_Handling_During_Destruction'>Error Handling During Destruction</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Moose::Manual::Construction - Object construction (and destruction) with Moose</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 2.0604</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="WHERE&#39;S_THE_CONSTRUCTOR?"
>WHERE&#39;S THE CONSTRUCTOR?</a></h1>

<p><b>Do not define a <code>new()</code> method for your classes!</b></p>

<p>When you <code>use Moose</code> in your class,
your class becomes a subclass of <a href="../../Moose/Object.html" class="podlinkpod"
>Moose::Object</a>.
The <a href="../../Moose/Object.html" class="podlinkpod"
>Moose::Object</a> provides a <code>new()</code> method for your class.
If you follow our recommendations in <a href="../../Moose/Manual/BestPractices.html" class="podlinkpod"
>Moose::Manual::BestPractices</a> and make your class immutable,
then you actually get a class-specific <code>new()</code> method &#34;inlined&#34; in your class.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OBJECT_CONSTRUCTION_AND_ATTRIBUTES"
>OBJECT CONSTRUCTION AND ATTRIBUTES</a></h1>

<p>The Moose-provided constructor accepts a hash or hash reference of named parameters matching your attributes (actually,
matching their <code>init_arg</code>s).
This is just another way in which Moose keeps you from worrying <i>how</i> classes are implemented.
Simply define a class and you&#39;re ready to start creating objects!</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OBJECT_CONSTRUCTION_HOOKS"
>OBJECT CONSTRUCTION HOOKS</a></h1>

<p>Moose lets you hook into object construction.
You can validate an object&#39;s state,
do logging,
customize construction from parameters which do not match your attributes,
or maybe allow non-hash(ref) constructor arguments.
You can do this by creating <code>BUILD</code> and/or <code>BUILDARGS</code> methods.</p>

<p>If these methods exist in your class,
Moose will arrange for them to be called as part of the object construction process.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BUILDARGS"
>BUILDARGS</a></h2>

<p>The <code>BUILDARGS</code> method is called as a class method <i>before</i> an object is created.
It will receive all of the arguments that were passed to <code>new()</code> <i>as-is</i>,
and is expected to return a hash reference.
This hash reference will be used to construct the object,
so it should contain keys matching your attributes&#39; names (well,
<code>init_arg</code>s).</p>

<p>One common use for <code>BUILDARGS</code> is to accommodate a non-hash(ref) calling style.
For example,
we might want to allow our Person class to be called with a single argument of a social security number,
<code>Person-&#62;new($ssn)</code>.</p>

<p>Without a <code>BUILDARGS</code> method,
Moose will complain,
because it expects a hash or hash reference.
We can use the <code>BUILDARGS</code> method to accommodate this calling style:</p>

<pre>  around BUILDARGS =&#62; sub {
      my $orig  = shift;
      my $class = shift;

      if ( @_ == 1 &#38;&#38; !ref $_[0] ) {
          return $class-&#62;$orig( ssn =&#62; $_[0] );
      }
      else {
          return $class-&#62;$orig(@_);
      }
  };</pre>

<p>Note the call to <code>$class-&#62;$orig</code>. This will call the default <code>BUILDARGS</code> in <a href="../../Moose/Object.html" class="podlinkpod"
>Moose::Object</a>. This method takes care of distinguishing between a hash reference and a plain hash for you.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BUILD"
>BUILD</a></h2>

<p>The <code>BUILD</code> method is called <i>after</i> an object is created. There are several reasons to use a <code>BUILD</code> method. One of the most common is to check that the object state is valid. While we can validate individual attributes through the use of types, we can&#39;t validate the state of a whole object that way.</p>

<pre>  sub BUILD {
      my $self = shift;

      if ( $self-&#62;country_of_residence eq &#39;USA&#39; ) {
          die &#39;All US residents must have an SSN&#39;
              unless $self-&#62;has_ssn;
      }
  }</pre>

<p>Another use of a <code>BUILD</code> method could be for logging or tracking object creation.</p>

<pre>  sub BUILD {
      my $self = shift;

      debug( &#39;Made a new person - SSN = &#39;, $self-&#62;ssn, );
  }</pre>

<p>The <code>BUILD</code> method is called with the hash reference of the parameters passed to the constructor (after munging by <code>BUILDARGS</code>). This gives you a chance to do something with parameters that do not represent object attributes.</p>

<pre>  sub BUILD {
      my $self = shift;
      my $args = shift;

      $self-&#62;add_friend(
          My::User-&#62;new(
              user_id =&#62; $args-&#62;{user_id},
          )
      );
  }</pre>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="BUILD_and_parent_classes"
>BUILD and parent classes</a></h3>

<p>The interaction between multiple <code>BUILD</code> methods in an inheritance hierarchy is different from normal Perl methods. <b>You should never call <code>$self-&#62;SUPER::BUILD</code></b>, nor should you ever apply a method modifier to <code>BUILD</code>.</p>

<p>Moose arranges to have all of the <code>BUILD</code> methods in a hierarchy called when an object is constructed, <i>from parents to children</i>. This might be surprising at first, because it reverses the normal order of method inheritance.</p>

<p>The theory behind this is that <code>BUILD</code> methods can only be used for increasing specialization of a class&#39;s constraints, so it makes sense to call the least specific <code>BUILD</code> method first. Also, this is how Perl 6 does it.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OBJECT_DESTRUCTION"
>OBJECT DESTRUCTION</a></h1>

<p>Moose provides a hook for object destruction with the <code>DEMOLISH</code> method. As with <code>BUILD</code>, you should never explicitly call <code>$self-&#62;SUPER::DEMOLISH</code>. Moose will arrange for all of the <code>DEMOLISH</code> methods in your hierarchy to be called, from most to least specific.</p>

<p>Each <code>DEMOLISH</code> method is called with a single argument.</p>

<p>In most cases, Perl&#39;s built-in garbage collection is sufficient, and you won&#39;t need to provide a <code>DEMOLISH</code> method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Error_Handling_During_Destruction"
>Error Handling During Destruction</a></h2>

<p>The interaction of object destruction and Perl&#39;s global <code>$@</code> and <code>$?</code> variables can be very confusing.</p>

<p>Moose always localizes <code>$?</code> when an object is being destroyed. This means that if you explicitly call <code>exit</code>, that exit code will be preserved even if an object&#39;s destructor makes a system call.</p>

<p>Moose also preserves <code>$@</code> against any <code>eval</code> calls that may happen during object destruction. However, if an object&#39;s <code>DEMOLISH</code> method actually dies, Moose explicitly rethrows that error.</p>

<p>If you do not like this behavior, you will have to provide your own <code>DESTROY</code> method and use that instead of the one provided by <a href="../../Moose/Object.html" class="podlinkpod"
>Moose::Object</a>. You can do this to preserve <code>$@</code> <i>and</i> capture any errors from object destruction by creating an error stack.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Moose is maintained by the Moose Cabal, along with the help of many contributors. See <a href="../../Moose.html#CABAL" class="podlinkpod"
>&#34;CABAL&#34; in Moose</a> and <a href="../../Moose.html#CONTRIBUTORS" class="podlinkpod"
>&#34;CONTRIBUTORS&#34; in Moose</a> for details.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2012 by Infinity Interactive, Inc..</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
