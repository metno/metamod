<html><head><title>Moose::Manual::Delegation</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:21 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#VERSION'>VERSION</a>
  <li class='indexItem indexItem1'><a href='#WHAT_IS_DELEGATION%3F'>WHAT IS DELEGATION?</a>
  <li class='indexItem indexItem1'><a href='#DEFINING_A_MAPPING'>DEFINING A MAPPING</a>
  <li class='indexItem indexItem1'><a href='#NATIVE_DELEGATION'>NATIVE DELEGATION</a>
  <li class='indexItem indexItem1'><a href='#CURRYING'>CURRYING</a>
  <li class='indexItem indexItem1'><a href='#MISSING_ATTRIBUTES'>MISSING ATTRIBUTES</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Moose::Manual::Delegation - Attribute delegation</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="VERSION"
>VERSION</a></h1>

<p>version 2.0604</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="WHAT_IS_DELEGATION?"
>WHAT IS DELEGATION?</a></h1>

<p>Delegation is a feature that lets you create &#34;proxy&#34; methods that do nothing more than call some other method on an attribute.
This lets you simplify a complex set of &#34;has-a&#34; relationships and present a single unified API from one class.</p>

<p>With delegation,
consumers of a class don&#39;t need to know about all the objects it contains,
reducing the amount of API they need to learn.</p>

<p>Delegations are defined as a mapping between one or more methods provided by the &#34;real&#34; class (the delegatee),
and a set of corresponding methods in the delegating class.
The delegating class can re-use the method names provided by the delegatee or provide its own names.</p>

<p>Delegation is also a great way to wrap an existing class,
especially a non-Moose class or one that is somehow hard (or impossible) to subclass.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DEFINING_A_MAPPING"
>DEFINING A MAPPING</a></h1>

<p>Moose offers a number of options for defining a delegation&#39;s mapping,
ranging from simple to complex.</p>

<p>The simplest form is to simply specify a list of methods:</p>

<pre>  package Website;

  use Moose;

  has &#39;uri&#39; =&#62; (
      is      =&#62; &#39;ro&#39;,
      isa     =&#62; &#39;URI&#39;,
      handles =&#62; [qw( host path )],
  );</pre>

<p>With this definition, we can call <code>$website-&#62;host</code> and it &#34;just works&#34;. Under the hood, Moose will call <code>$website-&#62;uri-&#62;host</code> for you. Note that <code>$website</code> is not automatically passed to the <code>host</code> method; the invocant is <code>$website-&#62;uri</code>.</p>

<p>We can also define a mapping as a hash reference. This allows you to rename methods as part of the mapping:</p>

<pre>  package Website;

  use Moose;

  has &#39;uri&#39; =&#62; (
      is      =&#62; &#39;ro&#39;,
      isa     =&#62; &#39;URI&#39;,
      handles =&#62; {
          hostname =&#62; &#39;host&#39;,
          path     =&#62; &#39;path&#39;,
      },
  );</pre>

<p>In this example, we&#39;ve created a <code>$website-&#62;hostname</code> method, rather than using <code>URI.pm</code>&#39;s name, <code>host</code>.</p>

<p>These two mapping forms are the ones you will use most often. The remaining methods are a bit more complex.</p>

<pre>  has &#39;uri&#39; =&#62; (
      is      =&#62; &#39;ro&#39;,
      isa     =&#62; &#39;URI&#39;,
      handles =&#62; qr/^(?:host|path|query.*)/,
  );</pre>

<p>This is similar to the array version, except it uses the regex to match against all the methods provided by the delegatee. In order for this to work, you must provide an <code>isa</code> parameter for the attribute, and it must be a class. Moose uses this to introspect the delegatee class and determine what methods it provides.</p>

<p>You can use a role name as the value of <code>handles</code>:</p>

<pre>  has &#39;uri&#39; =&#62; (
      is      =&#62; &#39;ro&#39;,
      isa     =&#62; &#39;URI&#39;,
      handles =&#62; &#39;HasURI&#39;,
  );</pre>

<p>Moose will introspect the role to determine what methods it provides and create a mapping for each of those methods.</p>

<p>Finally, you can also provide a sub reference to <i>generate</i> a mapping. You probably won&#39;t need this version often (if ever). See the <a href="../../Moose.html" class="podlinkpod"
>Moose</a> docs for more details on exactly how this works.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NATIVE_DELEGATION"
>NATIVE DELEGATION</a></h1>

<p>Native delegations allow you to delegate to standard Perl data structures as if they were objects.</p>

<pre>  has &#39;queue&#39; =&#62; (
      traits  =&#62; [&#39;Array&#39;],
      isa     =&#62; &#39;ArrayRef[Item]&#39;,
      default =&#62; sub { [ ] },
      handles =&#62; {
          add_item  =&#62; &#39;push&#39;,
          next_item =&#62; &#39;shift&#39;,
      },
  )</pre>

<p>The <code>Array</code> trait in the <code>traits</code> parameter tells Moose that you would like to use the set of Array helpers. Moose will then create <code>add_item</code> and <code>next_item</code> methods that &#34;just work&#34;. Behind the scenes <code>add_item</code> is something like</p>

<pre>  sub add_item {
      my ($self, @items) = @_;

      for my $item (@items) {
          $Item_TC-&#62;validate($item);
      }

      push @{ $self-&#62;queue }, @items;
  }</pre>

<p>Moose includes the following traits for native delegation:</p>

<ul>
<li><a href="../../Moose/Meta/Attribute/Native/Trait/Array.html" class="podlinkpod"
>Array</a></li>

<li><a href="../../Moose/Meta/Attribute/Native/Trait/Bool.html" class="podlinkpod"
>Bool</a></li>

<li><a href="../../Moose/Meta/Attribute/Native/Trait/Code.html" class="podlinkpod"
>Code</a></li>

<li><a href="../../Moose/Meta/Attribute/Native/Trait/Counter.html" class="podlinkpod"
>Counter</a></li>

<li><a href="../../Moose/Meta/Attribute/Native/Trait/Hash.html" class="podlinkpod"
>Hash</a></li>

<li><a href="../../Moose/Meta/Attribute/Native/Trait/Number.html" class="podlinkpod"
>Number</a></li>

<li><a href="../../Moose/Meta/Attribute/Native/Trait/String.html" class="podlinkpod"
>String</a></li>
</ul>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="CURRYING"
>CURRYING</a></h1>

<p>Currying allows you to create a method with some pre-set parameters. You can create a curried delegation method:</p>

<pre>    package Spider;
    use Moose;

    has request =&#62; (
        is      =&#62; &#39;ro&#39;
        isa     =&#62; &#39;HTTP::Request&#39;,
        handles =&#62; {
            set_user_agent =&#62; [ header =&#62; &#39;UserAgent&#39; ],
        },
    )</pre>

<p>With this definition, calling <code>$spider-&#62;set_user_agent(&#39;MyClient&#39;)</code> will call <code>$spider-&#62;request-&#62;header(&#39;UserAgent&#39;, &#39;MyClient&#39;)</code> behind the scenes.</p>

<p>Note that with currying, the currying always starts with the first parameter to a method (<code>$_[0]</code>). Any arguments you pass to the delegation come after the curried arguments.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="MISSING_ATTRIBUTES"
>MISSING ATTRIBUTES</a></h1>

<p>It is perfectly valid to delegate methods to an attribute which is not required or can be undefined. When a delegated method is called, Moose will throw a runtime error if the attribute does not contain an object.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Moose is maintained by the Moose Cabal, along with the help of many contributors. See <a href="../../Moose.html#CABAL" class="podlinkpod"
>&#34;CABAL&#34; in Moose</a> and <a href="../../Moose.html#CONTRIBUTORS" class="podlinkpod"
>&#34;CONTRIBUTORS&#34; in Moose</a> for details.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>This software is copyright (c) 2012 by Infinity Interactive, Inc..</p>

<p>This is free software; you can redistribute it and/or modify it under the same terms as the Perl 5 programming language system itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
