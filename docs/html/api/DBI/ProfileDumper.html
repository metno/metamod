<html><head><title>DBI::ProfileDumper</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:15 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#USAGE'>USAGE</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#flush_to_disk'>flush_to_disk</a>
    <li class='indexItem indexItem2'><a href='#empty'>empty</a>
    <li class='indexItem indexItem2'><a href='#filename'>filename</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#DATA_FORMAT'>DATA FORMAT</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBI::ProfileDumper - profile DBI usage and output data to a file</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>To profile an existing program using DBI::ProfileDumper,
set the DBI_PROFILE environment variable and run your program as usual.
For example,
using bash:</p>

<pre>  DBI_PROFILE=2/DBI::ProfileDumper program.pl</pre>

<p>Then analyze the generated file (<em>dbi.prof</em>) with <a href="../dbiprof.html" class="podlinkpod"
>dbiprof</a>:</p>

<pre>  dbiprof</pre>

<p>You can also activate DBI::ProfileDumper from within your code:</p>

<pre>  use DBI;

  # profile with default path (2) and output file (dbi.prof)
  $dbh-&#62;{Profile} = &#34;!Statement/DBI::ProfileDumper&#34;;

  # same thing, spelled out
  $dbh-&#62;{Profile} = &#34;!Statement/DBI::ProfileDumper/File:dbi.prof&#34;;

  # another way to say it
  use DBI::ProfileDumper;
  $dbh-&#62;{Profile} = DBI::ProfileDumper-&#62;new(
                        Path =&#62; [ &#39;!Statement&#39; ],
                        File =&#62; &#39;dbi.prof&#39; );

  # using a custom path
  $dbh-&#62;{Profile} = DBI::ProfileDumper-&#62;new(
      Path =&#62; [ &#34;foo&#34;, &#34;bar&#34; ],
      File =&#62; &#39;dbi.prof&#39;,
  );</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>DBI::ProfileDumper is a subclass of <a href="../DBI/Profile.html" class="podlinkpod"
>DBI::Profile</a> which dumps profile data to disk instead of printing a summary to your screen. You can then use <a href="../dbiprof.html" class="podlinkpod"
>dbiprof</a> to analyze the data in a number of interesting ways, or you can roll your own analysis using <a href="../DBI/ProfileData.html" class="podlinkpod"
>DBI::ProfileData</a>.</p>

<p><b>NOTE:</b> For Apache/mod_perl applications, use <a href="../DBI/ProfileDumper/Apache.html" class="podlinkpod"
>DBI::ProfileDumper::Apache</a>.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="USAGE"
>USAGE</a></h1>

<p>One way to use this module is just to enable it in your <code>$dbh</code>:</p>

<pre>  $dbh-&#62;{Profile} = &#34;1/DBI::ProfileDumper&#34;;</pre>

<p>This will write out profile data by statement into a file called <em>dbi.prof</em>. If you want to modify either of these properties, you can construct the DBI::ProfileDumper object yourself:</p>

<pre>  use DBI::ProfileDumper;
  $dbh-&#62;{Profile} = DBI::ProfileDumper-&#62;new(
      Path =&#62; [ &#39;!Statement&#39; ],
      File =&#62; &#39;dbi.prof&#39;
  );</pre>

<p>The <code>Path</code> option takes the same values as in <a href="../DBI/Profile.html" class="podlinkpod"
>DBI::Profile</a>. The <code>File</code> option gives the name of the file where results will be collected. If it already exists it will be overwritten.</p>

<p>You can also activate this module by setting the DBI_PROFILE environment variable:</p>

<pre>  $ENV{DBI_PROFILE} = &#34;!Statement/DBI::ProfileDumper&#34;;</pre>

<p>This will cause all DBI handles to share the same profiling object.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<p>The following methods are available to be called using the profile object. You can get access to the profile object from the Profile key in any DBI handle:</p>

<pre>  my $profile = $dbh-&#62;{Profile};</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="flush_to_disk"
>flush_to_disk</a></h2>

<pre>  $profile-&#62;flush_to_disk()</pre>

<p>Flushes all collected profile data to disk and empties the Data hash. Returns the filename writen to. If no profile data has been collected then the file is not written and flush_to_disk() returns undef.</p>

<p>The file is locked while it&#39;s being written. A process &#39;consuming&#39; the files while they&#39;re being written to, should rename the file first, then lock it, then read it, then close and delete it. The <code>DeleteFiles</code> option to <a href="../DBI/ProfileData.html" class="podlinkpod"
>DBI::ProfileData</a> does the right thing.</p>

<p>This method may be called multiple times during a program run.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="empty"
>empty</a></h2>

<pre>  $profile-&#62;empty()</pre>

<p>Clears the Data hash without writing to disk.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="filename"
>filename</a></h2>

<pre>  $filename = $profile-&#62;filename();</pre>

<p>Get or set the filename.</p>

<p>The filename can be specified as a CODE reference, in which case the referenced code should return the filename to be used. The code will be called with the profile object as its first argument.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DATA_FORMAT"
>DATA FORMAT</a></h1>

<p>The data format written by DBI::ProfileDumper starts with a header containing the version number of the module used to generate it. Then a block of variable declarations describes the profile. After two newlines, the profile data forms the body of the file. For example:</p>

<pre>  DBI::ProfileDumper 2.003762
  Path = [ &#39;!Statement&#39;, &#39;!MethodName&#39; ]
  Program = t/42profile_data.t

  + 1 SELECT name FROM users WHERE id = ?
  + 2 prepare
  = 1 0.0312958955764771 0.000490069389343262 0.000176072120666504 0.00140702724456787 1023115819.83019 1023115819.86576
  + 2 execute
  1 0.0312958955764771 0.000490069389343262 0.000176072120666504 0.00140702724456787 1023115819.83019 1023115819.86576
  + 2 fetchrow_hashref
  = 1 0.0312958955764771 0.000490069389343262 0.000176072120666504 0.00140702724456787 1023115819.83019 1023115819.86576
  + 1 UPDATE users SET name = ? WHERE id = ?
  + 2 prepare
  = 1 0.0312958955764771 0.000490069389343262 0.000176072120666504 0.00140702724456787 1023115819.83019 1023115819.86576
  + 2 execute
  = 1 0.0312958955764771 0.000490069389343262 0.000176072120666504 0.00140702724456787 1023115819.83019 1023115819.86576</pre>

<p>The lines beginning with <code>+</code> signs signify keys. The number after the <code>+</code> sign shows the nesting level of the key. Lines beginning with <code>=</code> are the actual profile data, in the same order as in DBI::Profile.</p>

<p>Note that the same path may be present multiple times in the data file since <code>format()</code> may be called more than once. When read by DBI::ProfileData the data points will be merged to produce a single data set for each distinct path.</p>

<p>The key strings are transformed in three ways. First, all backslashes are doubled. Then all newlines and carriage-returns are transformed into <code>\n</code> and <code>\r</code> respectively. Finally, any NULL bytes (<code>\0</code>) are entirely removed. When DBI::ProfileData reads the file the first two transformations will be reversed, but NULL bytes will not be restored.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Sam Tregar &#60;sam@tregar.com&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>Copyright (C) 2002 Sam Tregar</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl 5 itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
