<html><head><title>DBI::ProfileData</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../_grygrnw.css" media="all" >

<script type="text/javascript" src="../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:15 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#%24prof_%3D_DBI%3A%3AProfileData-%3Enew(File_%3D%3E_%22dbi.prof%22)'>$prof = DBI::ProfileData-&#62;new(File =&#62; &#34;dbi.prof&#34;)</a>
    <li class='indexItem indexItem2'><a href='#%24prof_%3D_DBI%3A%3AProfileData-%3Enew(File_%3D%3E_%22dbi.prof%22%2C_Filter_%3D%3E_sub_%7B_..._%7D)'>$prof = DBI::ProfileData-&#62;new(File =&#62; &#34;dbi.prof&#34;, Filter =&#62; sub { ... })</a>
    <li class='indexItem indexItem2'><a href='#%24prof_%3D_DBI%3A%3AProfileData-%3Enew(Files_%3D%3E_%5B_%22dbi.prof.1%22%2C_%22dbi.prof.2%22_%5D)'>$prof = DBI::ProfileData-&#62;new(Files =&#62; [ &#34;dbi.prof.1&#34;, &#34;dbi.prof.2&#34; ])</a>
    <ul   class='indexList indexList3'>
      <li class='indexItem indexItem3'><a href='#Files'>Files</a>
      <li class='indexItem indexItem3'><a href='#File'>File</a>
      <li class='indexItem indexItem3'><a href='#DeleteFiles'>DeleteFiles</a>
      <li class='indexItem indexItem3'><a href='#Filter'>Filter</a>
    </ul>
    <li class='indexItem indexItem2'><a href='#%24copy_%3D_%24prof-%3Eclone()%3B'>$copy = $prof-&#62;clone();</a>
    <li class='indexItem indexItem2'><a href='#%24header_%3D_%24prof-%3Eheader()%3B'>$header = $prof-&#62;header();</a>
    <li class='indexItem indexItem2'><a href='#%24nodes_%3D_%24prof-%3Enodes()'>$nodes = $prof-&#62;nodes()</a>
    <li class='indexItem indexItem2'><a href='#%24count_%3D_%24prof-%3Ecount()'>$count = $prof-&#62;count()</a>
    <li class='indexItem indexItem2'><a href='#%24prof-%3Esort(field_%3D%3E_%22field%22)'>$prof-&#62;sort(field =&#62; &#34;field&#34;)</a>
    <li class='indexItem indexItem2'><a href='#%24prof-%3Esort(field_%3D%3E_%22field%22%2C_reverse_%3D%3E_1)'>$prof-&#62;sort(field =&#62; &#34;field&#34;, reverse =&#62; 1)</a>
    <li class='indexItem indexItem2'><a href='#%24count_%3D_%24prof-%3Eexclude(key2_%3D%3E_%22disconnect%22)'>$count = $prof-&#62;exclude(key2 =&#62; &#34;disconnect&#34;)</a>
    <li class='indexItem indexItem2'><a href='#%24count_%3D_%24prof-%3Eexclude(key2_%3D%3E_%22disconnect%22%2C_case_sensitive_%3D%3E_1)'>$count = $prof-&#62;exclude(key2 =&#62; &#34;disconnect&#34;, case_sensitive =&#62; 1)</a>
    <li class='indexItem indexItem2'><a href='#%24count_%3D_%24prof-%3Eexclude(key1_%3D%3E_qr%2F%5ESELECT%2Fi)'>$count = $prof-&#62;exclude(key1 =&#62; qr/^SELECT/i)</a>
    <li class='indexItem indexItem2'><a href='#%24count_%3D_%24prof-%3Ematch(key2_%3D%3E_%22disconnect%22)'>$count = $prof-&#62;match(key2 =&#62; &#34;disconnect&#34;)</a>
    <li class='indexItem indexItem2'><a href='#%24count_%3D_%24prof-%3Ematch(key2_%3D%3E_%22disconnect%22%2C_case_sensitive_%3D%3E_1)'>$count = $prof-&#62;match(key2 =&#62; &#34;disconnect&#34;, case_sensitive =&#62; 1)</a>
    <li class='indexItem indexItem2'><a href='#%24count_%3D_%24prof-%3Ematch(key1_%3D%3E_qr%2F%5ESELECT%2Fi)'>$count = $prof-&#62;match(key1 =&#62; qr/^SELECT/i)</a>
    <li class='indexItem indexItem2'><a href='#%24Data_%3D_%24prof-%3EData()'>$Data = $prof-&#62;Data()</a>
    <li class='indexItem indexItem2'><a href='#%24text_%3D_%24prof-%3Eformat(%24nodes-%3E%5B0%5D)'>$text = $prof-&#62;format($nodes-&#62;[0])</a>
    <li class='indexItem indexItem2'><a href='#%24text_%3D_%24prof-%3Ereport(number_%3D%3E_10)'>$text = $prof-&#62;report(number =&#62; 10)</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>DBI::ProfileData - manipulate DBI::ProfileDumper data dumps</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>The easiest way to use this module is through the dbiprof frontend (see <a href="../dbiprof.html" class="podlinkpod"
>dbiprof</a> for details):</p>

<pre>  dbiprof --number 15 --sort count</pre>

<p>This module can also be used to roll your own profile analysis:</p>

<pre>  # load data from dbi.prof
  $prof = DBI::ProfileData-&#62;new(File =&#62; &#34;dbi.prof&#34;);

  # get a count of the records (unique paths) in the data set
  $count = $prof-&#62;count();

  # sort by longest overall time
  $prof-&#62;sort(field =&#62; &#34;longest&#34;);

  # sort by longest overall time, least to greatest
  $prof-&#62;sort(field =&#62; &#34;longest&#34;, reverse =&#62; 1);

  # exclude records with key2 eq &#39;disconnect&#39;
  $prof-&#62;exclude(key2 =&#62; &#39;disconnect&#39;);

  # exclude records with key1 matching /^UPDATE/i
  $prof-&#62;exclude(key1 =&#62; qr/^UPDATE/i);

  # remove all records except those where key1 matches /^SELECT/i
  $prof-&#62;match(key1 =&#62; qr/^SELECT/i);

  # produce a formatted report with the given number of items
  $report = $prof-&#62;report(number =&#62; 10); 

  # clone the profile data set
  $clone = $prof-&#62;clone();

  # get access to hash of header values
  $header = $prof-&#62;header();

  # get access to sorted array of nodes
  $nodes = $prof-&#62;nodes();

  # format a single node in the same style as report()
  $text = $prof-&#62;format($nodes-&#62;[0]);

  # get access to Data hash in DBI::Profile format
  $Data = $prof-&#62;Data();</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This module offers the ability to read, manipulate and format DBI::ProfileDumper profile data.</p>

<p>Conceptually, a profile consists of a series of records, or nodes, each of each has a set of statistics and set of keys. Each record must have a unique set of keys, but there is no requirement that every record have the same number of keys.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<p>The following methods are supported by DBI::ProfileData objects.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$prof_=_DBI::ProfileData-&#62;new(File_=&#62;_&#34;dbi.prof&#34;)"
>$prof = DBI::ProfileData-&#62;new(File =&#62; &#34;dbi.prof&#34;)</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$prof_=_DBI::ProfileData-&#62;new(File_=&#62;_&#34;dbi.prof&#34;,_Filter_=&#62;_sub_{_..._})"
>$prof = DBI::ProfileData-&#62;new(File =&#62; &#34;dbi.prof&#34;, Filter =&#62; sub { ... })</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$prof_=_DBI::ProfileData-&#62;new(Files_=&#62;_[_&#34;dbi.prof.1&#34;,_&#34;dbi.prof.2&#34;_])"
>$prof = DBI::ProfileData-&#62;new(Files =&#62; [ &#34;dbi.prof.1&#34;, &#34;dbi.prof.2&#34; ])</a></h2>

<p>Creates a a new DBI::ProfileData object. Takes either a single file through the File option or a list of Files in an array ref. If multiple files are specified then the header data from the first file is used.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Files"
>Files</a></h3>

<p>Reference to an array of file names to read.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="File"
>File</a></h3>

<p>Name of file to read. Takes precedence over <code>Files</code>.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="DeleteFiles"
>DeleteFiles</a></h3>

<p>If true, the files are deleted after being read.</p>

<p>Actually the files are renamed with a C.deleteme&#62; suffix before being read, and then, after reading all the files, they&#39;re all deleted together.</p>

<p>The files are locked while being read which, combined with the rename, makes it safe to &#39;consume&#39; files that are still being generated by <a href="../DBI/ProfileDumper.html" class="podlinkpod"
>DBI::ProfileDumper</a>.</p>

<h3><a class='u' href='#___top' title='click to go to top of document'
name="Filter"
>Filter</a></h3>

<p>The <code>Filter</code> parameter can be used to supply a code reference that can manipulate the profile data as it is being read. This is most useful for editing SQL statements so that slightly different statements in the raw data will be merged and aggregated in the loaded data. For example:</p>

<pre>  Filter =&#62; sub {
      my ($path_ref, $data_ref) = @_;
      s/foo = &#39;.*?&#39;/foo = &#39;...&#39;/ for @$path_ref;
  }</pre>

<p>Here&#39;s an example that performs some normalization on the SQL. It converts all numbers to <code>N</code> and all quoted strings to <code>S</code>. It can also convert digits to N within names. Finally, it summarizes long &#34;IN (...)&#34; clauses.</p>

<p>It&#39;s aggressive and simplistic, but it&#39;s often sufficient, and serves as an example that you can tailor to suit your own needs:</p>

<pre>  Filter =&#62; sub {
      my ($path_ref, $data_ref) = @_;
      local $_ = $path_ref-&#62;[0]; # whichever element contains the SQL Statement
      s/\b\d+\b/N/g;             # 42 -&#62; N
      s/\b0x[0-9A-Fa-f]+\b/N/g;  # 0xFE -&#62; N
      s/&#39;.*?&#39;/&#39;S&#39;/g;             # single quoted strings (doesn&#39;t handle escapes)
      s/&#34;.*?&#34;/&#34;S&#34;/g;             # double quoted strings (doesn&#39;t handle escapes)
      # convert names like log_20001231 into log_NNNNNNNN, controlled by $opt{n}
      s/([a-z_]+)(\d{$opt{n},})/$1.(&#39;N&#39; x length($2))/ieg if $opt{n};
      # abbreviate massive &#34;in (...)&#34; statements and similar
      s!(([NS],){100,})!sprintf(&#34;$2,{repeated %d times}&#34;,length($1)/2)!eg;
  }</pre>

<p>It&#39;s often better to perform this kinds of normalization in the DBI while the data is being collected, to avoid too much memory being used by storing profile data for many different SQL statement. See <a href="../DBI/Profile.html" class="podlinkpod"
>DBI::Profile</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$copy_=_$prof-&#62;clone();"
>$copy = $prof-&#62;clone();</a></h2>

<p>Clone a profile data set creating a new object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$header_=_$prof-&#62;header();"
>$header = $prof-&#62;header();</a></h2>

<p>Returns a reference to a hash of header values. These are the key value pairs included in the header section of the DBI::ProfileDumper data format. For example:</p>

<pre>  $header = {
    Path    =&#62; [ &#39;!Statement&#39;, &#39;!MethodName&#39; ],
    Program =&#62; &#39;t/42profile_data.t&#39;,
  };</pre>

<p>Note that modifying this hash will modify the header data stored inside the profile object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$nodes_=_$prof-&#62;nodes()"
>$nodes = $prof-&#62;nodes()</a></h2>

<p>Returns a reference the sorted nodes array. Each element in the array is a single record in the data set. The first seven elements are the same as the elements provided by DBI::Profile. After that each key is in a separate element. For example:</p>

<pre> $nodes = [
            [
              2,                      # 0, count
              0.0312958955764771,     # 1, total duration
              0.000490069389343262,   # 2, first duration
              0.000176072120666504,   # 3, shortest duration
              0.00140702724456787,    # 4, longest duration
              1023115819.83019,       # 5, time of first event
              1023115819.86576,       # 6, time of last event
              &#39;SELECT foo FROM bar&#39;   # 7, key1
              &#39;execute&#39;               # 8, key2
                                      # 6+N, keyN
            ],
                                      # ...
          ];</pre>

<p>Note that modifying this array will modify the node data stored inside the profile object.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$count_=_$prof-&#62;count()"
>$count = $prof-&#62;count()</a></h2>

<p>Returns the number of items in the profile data set.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$prof-&#62;sort(field_=&#62;_&#34;field&#34;)"
>$prof-&#62;sort(field =&#62; &#34;field&#34;)</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$prof-&#62;sort(field_=&#62;_&#34;field&#34;,_reverse_=&#62;_1)"
>$prof-&#62;sort(field =&#62; &#34;field&#34;, reverse =&#62; 1)</a></h2>

<p>Sorts data by the given field. Available fields are:</p>

<pre>  longest
  total
  count
  shortest</pre>

<p>The default sort is greatest to smallest, which is the opposite of the normal Perl meaning. This, however, matches the expected behavior of the dbiprof frontend.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$count_=_$prof-&#62;exclude(key2_=&#62;_&#34;disconnect&#34;)"
>$count = $prof-&#62;exclude(key2 =&#62; &#34;disconnect&#34;)</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$count_=_$prof-&#62;exclude(key2_=&#62;_&#34;disconnect&#34;,_case_sensitive_=&#62;_1)"
>$count = $prof-&#62;exclude(key2 =&#62; &#34;disconnect&#34;, case_sensitive =&#62; 1)</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$count_=_$prof-&#62;exclude(key1_=&#62;_qr/^SELECT/i)"
>$count = $prof-&#62;exclude(key1 =&#62; qr/^SELECT/i)</a></h2>

<p>Removes records from the data set that match the given string or regular expression. This method modifies the data in a permanent fashion - use clone() first to maintain the original data after exclude(). Returns the number of nodes left in the profile data set.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$count_=_$prof-&#62;match(key2_=&#62;_&#34;disconnect&#34;)"
>$count = $prof-&#62;match(key2 =&#62; &#34;disconnect&#34;)</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$count_=_$prof-&#62;match(key2_=&#62;_&#34;disconnect&#34;,_case_sensitive_=&#62;_1)"
>$count = $prof-&#62;match(key2 =&#62; &#34;disconnect&#34;, case_sensitive =&#62; 1)</a></h2>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$count_=_$prof-&#62;match(key1_=&#62;_qr/^SELECT/i)"
>$count = $prof-&#62;match(key1 =&#62; qr/^SELECT/i)</a></h2>

<p>Removes records from the data set that do not match the given string or regular expression. This method modifies the data in a permanent fashion - use clone() first to maintain the original data after match(). Returns the number of nodes left in the profile data set.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$Data_=_$prof-&#62;Data()"
>$Data = $prof-&#62;Data()</a></h2>

<p>Returns the same Data hash structure as seen in DBI::Profile. This structure is not sorted. The nodes() structure probably makes more sense for most analysis.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$text_=_$prof-&#62;format($nodes-&#62;[0])"
>$text = $prof-&#62;format($nodes-&#62;[0])</a></h2>

<p>Formats a single node into a human-readable block of text.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="$text_=_$prof-&#62;report(number_=&#62;_10)"
>$text = $prof-&#62;report(number =&#62; 10)</a></h2>

<p>Produces a report with the given number of items.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Sam Tregar &#60;sam@tregar.com&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>Copyright (C) 2002 Sam Tregar</p>

<p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl 5 itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
