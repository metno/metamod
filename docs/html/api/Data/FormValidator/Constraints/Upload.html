<html><head><title>Data::FormValidator::Constraints::Upload</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:04 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#BACKWARDS_COMPATIBILITY'>BACKWARDS COMPATIBILITY</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#SEE_ALSO'>SEE ALSO</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
  <li class='indexItem indexItem1'><a href='#COPYRIGHT_AND_LICENSE'>COPYRIGHT AND LICENSE</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Data::FormValidator::Constraints::Upload - Validate File Uploads</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    # Be sure to use a CGI.pm or CGI::Simple object as the form
    # input when using this constraint
    my $q = CGI-&#62;new;

    use Data::FormValidator::Constraints::Upload qw(
            file_format
            file_max_bytes
            image_max_dimensions
            image_min_dimensions
    );
    my $dfv = Data::FormValidator-&#62;check($q,$my_profile);

    # In a Data::FormValidator Profile:
    constraint_methods =&#62; {
        image_name =&#62; [
            file_format(),
            file_max_bytes(10),
            image_max_dimensions(200,200),
            image_min_dimensions(100,100),
         ],
    }</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p><b>Note:</b> This is a new module is a new addition to Data::FormValidator and is should be considered &#34;Beta&#34;.</p>

<p>These module is meant to be used in conjunction with the Data::FormValidator module to automate the task of validating uploaded files. The following validation routines are supplied.</p>

<p>To use any of them, the input data passed to Data::FormValidator must be a CGI.pm object.</p>

<dl>
<dt><a name="file_format"
>file_format</a></dt>

<dd>
<p>This function checks the format of the file, based on the MIME type if it&#39;s available, and a case-insensitive version of the file extension otherwise. By default, it tries to validate JPEG, GIF and PNG images. The params are:</p>

<pre> optional hash reference of parameters. A key named I&#60;mime_types&#62; points to
 array references of valid values.

   file_format( mime_types =&#62; [qw!image/jpeg image/gif image/png!] );</pre>

<p>Calling this function sets some meta data which can be retrieved through the <code>meta()</code> method of the Data::FormValidator::Results object. The meta data added is <code>extension</code> and <code>mime_type</code>.</p>

<p>The MIME type of the file will first be tried to figured out by using the &#60;File::MMagic&#62; module to examine the file. If that doesn&#39;t turn up a result, we&#39;ll use a MIME type from the browser if one has been provided. Otherwise, we give up. The extension we return is based on the MIME type we found, rather than trusting the one that was uploaded.</p>

<p><b>NOTE:</b> if we have to fall back to using the MIME type provided by the browser, we access it from the original <i>input</i> data and not the <i>filtered</i> data. This should only cause issue when you have used a filter to alter the type of file that was uploaded (e.g. image conversion).</p>

<dt><a name="file_max_bytes"
>file_max_bytes</a></dt>

<dd>
<p>This function checks the maximum size of an uploaded file. By default, it checks to make sure files are smaller than 1 Meg. The params are:</p>

<pre> reference to max file size in bytes

    file_max_bytes(1024), # 1 k</pre>

<p>Calling this function sets some meta data which can be retrieved through the <code>meta()</code> method of the Data::FormValidator::Results object. The meta data added is <code>bytes</code>.</p>

<dt><a name="image_max_dimensions"
>image_max_dimensions</a></dt>

<dd>
<p>This function checks to make sure an uploaded image is no longer than some maximum dimensions. The params are:</p>

<pre> reference to max pixel width
 reference to max pixel height

    image_max_dimensions(200,200),</pre>

<p>Calling this function sets some meta data which can be retrieved through the <code>meta()</code> method of the Data::FormValidator::Results object. The meta data added is <code>width</code> and <code>height</code>.</p>

<dt><a name="image_min_dimensions"
>image_min_dimensions</a></dt>

<dd>
<p>This function checks to make sure an uploaded image is longer than some minimum dimensions. The params are:</p>

<pre> reference to min pixel width
 reference to min pixel height

    image_min_dimensions(100,100),</pre>

<p>Calling this function sets some meta data which can be retrieved through the <code>meta()</code> method of the Data::FormValidator::Results object. The meta data added is <code>width</code> and <code>height</code>.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="BACKWARDS_COMPATIBILITY"
>BACKWARDS COMPATIBILITY</a></h2>

<p>An older more awkward interface to the constraints in this module is still supported. To use it, you have to load the package with &#39;validator_packages&#39;, and call each constraint in a hashref style, passing the parameters by reference. It looks like this:</p>

<pre>    validator_packages =&#62; [qw(Data::FormValidator::Constraints::Upload)],
    constraints =&#62; {
        image_name =&#62; [
            {
                constraint_method =&#62; &#39;image_max_dimensions&#39;,
                params =&#62; [\200,\200],
            }
         ],
    }</pre>

<p>I told you it was more awkward. That was before I grokked the magic of closures, which is what drives the current interface.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="../../../FileMetadata.html" class="podlinkpod"
>FileMetadata</a>, <a href="../../../Data/FormValidator.html" class="podlinkpod"
>Data::FormValidator</a>, <a href="../../../CGI.html" class="podlinkpod"
>CGI</a>, <a href="../../../perl.html" class="podlinkpod"
>perl</a></p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Mark Stosberg, &#60;mark@summersault.com&#62;</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="COPYRIGHT_AND_LICENSE"
>COPYRIGHT AND LICENSE</a></h1>

<p>Copyright 2003-2005 by Mark Stosberg</p>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
