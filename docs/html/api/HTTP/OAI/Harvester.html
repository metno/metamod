<html><head><title>HTTP::OAI::Harvester</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:18 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Static_Repository_Support'>Static Repository Support</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#FURTHER_READING'>FURTHER READING</a>
  <li class='indexItem indexItem1'><a href='#BEFORE_USING_EXAMPLES'>BEFORE USING EXAMPLES</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#METHODS'>METHODS</a>
  <li class='indexItem indexItem1'><a href='#OAI-PMH_Verbs'>OAI-PMH Verbs</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Error_Messages'>Error Messages</a>
    <li class='indexItem indexItem2'><a href='#Flow_Control'>Flow Control</a>
    <li class='indexItem indexItem2'><a href='#Methods'>Methods</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>HTTP::OAI::Harvester - Agent for harvesting from Open Archives version 1.0,
1.1,
2.0 and static (&#39;2.0s&#39;) compatible repositories</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p><code>HTTP::OAI::Harvester</code> is the harvesting front-end in the OAI-PERL library.</p>

<p>To harvest from an OAI-PMH compliant repository create an <code>HTTP::OAI::Harvester</code> object using the baseURL option and then call OAI-PMH methods to request data from the repository.
To handle version 1.0/1.1 repositories automatically you <b>must</b> request <code>Identify()</code> first.</p>

<p>It is recommended that you request an Identify from the Repository and use the <code>repository()</code> method to update the Identify object used by the harvester.</p>

<p>When making OAI requests the underlying <a href="../../HTTP/OAI/UserAgent.html" class="podlinkpod"
>HTTP::OAI::UserAgent</a> module will take care of automatic redirection (http code 302) and retry-after (http code 503).
OAI-PMH flow control (i.e.
resumption tokens) is handled transparently by <code>HTTP::OAI::Response</code>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Static_Repository_Support"
>Static Repository Support</a></h2>

<p>Static repositories are automatically and transparently supported within the existing API.
To harvest a static repository specify the repository XML file using the baseURL argument to HTTP::OAI::Harvester.
An initial request is made that determines whether the base URL specifies a static repository or a normal OAI 1.x/2.0 CGI repository.
To prevent this initial request state the OAI version using an HTTP::OAI::Identify object e.g.</p>

<pre>        $h = HTTP::OAI::Harvester-&#62;new(
                repository=&#62;HTTP::OAI::Identify-&#62;new(
                        baseURL =&#62; &#39;http://arXiv.org/oai2&#39;,
                        version =&#62; &#39;2.0&#39;,
        ));</pre>

<p>If a static repository is found the response is cached, and further requests are served by that cache. Static repositories do not support sets, and will result in a noSetHierarchy error if you try to use sets. You can determine whether the repository is static by checking the version ($ha-&#62;repository-&#62;version), which will be &#34;2.0s&#34; for static repositories.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FURTHER_READING"
>FURTHER READING</a></h1>

<p>You should refer to the Open Archives Protocol version 2.0 and other OAI documentation, available from http://www.openarchives.org/.</p>

<p>Note OAI-PMH 1.0 and 1.1 are deprecated.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="BEFORE_USING_EXAMPLES"
>BEFORE USING EXAMPLES</a></h1>

<p>In the examples I use arXiv.org&#39;s and cogprints OAI interfaces. To avoid causing annoyance to their server administrators please contact them before performing testing or large downloads (or use other, less loaded, servers for testing).</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>        use HTTP::OAI;

        my $h = new HTTP::OAI::Harvester(baseURL=&#62;&#39;http://arXiv.org/oai2&#39;);
        my $response = $h-&#62;repository($h-&#62;Identify)
        if( $response-&#62;is_error ) {
                print &#34;Error requesting Identify:\n&#34;,
                        $response-&#62;code . &#34; &#34; . $response-&#62;message, &#34;\n&#34;;
                exit;
        }

        # Note: repositoryVersion will always be 2.0, $r-&#62;version returns
        # the actual version the repository is running
        print &#34;Repository supports protocol version &#34;, $response-&#62;version, &#34;\n&#34;;

        # Version 1.x repositories don&#39;t support metadataPrefix,
        # but OAI-PERL will drop the prefix automatically
        # if an Identify was requested first (as above)
        $response = $h-&#62;ListIdentifiers(
                metadataPrefix=&#62;&#39;oai_dc&#39;,
                from=&#62;&#39;2001-02-03&#39;,
                until=&#62;&#39;2001-04-10&#39;
        );

        if( $response-&#62;is_error ) {
                die(&#34;Error harvesting: &#34; . $response-&#62;message . &#34;\n&#34;);
        }

        print &#34;responseDate =&#62; &#34;, $response-&#62;responseDate, &#34;\n&#34;,
                &#34;requestURL =&#62; &#34;, $response-&#62;requestURL, &#34;\n&#34;;

        while( my $id = $response-&#62;next ) {
                print &#34;identifier =&#62; &#34;, $id-&#62;identifier;
                # Only available from OAI 2.0 repositories
                print &#34; (&#34;, $id-&#62;datestamp, &#34;)&#34; if $id-&#62;datestamp;
                print &#34; (&#34;, $id-&#62;status, &#34;)&#34; if $id-&#62;status;
                print &#34;\n&#34;;
                # Only available from OAI 2.0 repositories
                for( $id-&#62;setSpec ) {
                        print &#34;\t&#34;, $_, &#34;\n&#34;;
                }
        }

        # Using a handler
        $response = $h-&#62;ListRecords(
                metadataPrefix=&#62;&#39;oai_dc&#39;,
                handlers=&#62;{metadata=&#62;&#39;HTTP::OAI::Metadata::OAI_DC&#39;},
        );
        while( my $rec = $response-&#62;next ) {
                print $rec-&#62;identifier, &#34;\t&#34;,
                        $rec-&#62;datestamp, &#34;\n&#34;,
                        $rec-&#62;metadata, &#34;\n&#34;;
                print join(&#39;,&#39;, @{$rec-&#62;metadata-&#62;dc-&#62;{&#39;title&#39;}}), &#34;\n&#34;;
        }
        if( $rec-&#62;is_error ) {
                die $response-&#62;message;
        }

        # Offline parsing
        $I = HTTP::OAI::Identify-&#62;new();
        $I-&#62;parse_string($content);
        $I-&#62;parse_file($fh);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<dl>
<dt><a name="HTTP::OAI::Harvester-&#62;new(_%params_)"
>HTTP::OAI::Harvester-&#62;new( %params )</a></dt>

<dd>
<p>This constructor method returns a new instance of <code>HTTP::OAI::Harvester</code>. Requires either an <a href="../../HTTP/OAI/Identify.html" class="podlinkpod"
>HTTP::OAI::Identify</a> object, which in turn must contain a baseURL, or a baseURL from which to construct an Identify object.</p>

<p>Any other parameters are passed to the <a href="../../HTTP/OAI/UserAgent.html" class="podlinkpod"
>HTTP::OAI::UserAgent</a> module, and from there to the <a href="../../LWP/UserAgent.html" class="podlinkpod"
>LWP::UserAgent</a> module.</p>

<pre>        $h = HTTP::OAI::Harvester-&#62;new(
                baseURL =&#62;      &#39;http://arXiv.org/oai2&#39;,
                resume=&#62;0, # Suppress automatic resumption
        )
        $id = $h-&#62;repository();
        $h-&#62;repository($h-&#62;Identify);

        $h = HTTP::OAI::Harvester-&#62;new(
                HTTP::OAI::Identify-&#62;new(
                        baseURL =&#62; &#39;http://arXiv.org/oai2&#39;,
        ));</pre>

<dt><a name="$h-&#62;repository()"
>$h-&#62;repository()</a></dt>

<dd>
<p>Returns and optionally sets the <a href="../../HTTP/OAI/Identify.html" class="podlinkpod"
>HTTP::OAI::Identify</a> object used by the Harvester agent.</p>

<dt><a name="$h-&#62;resume(_[1]_)"
>$h-&#62;resume( [1] )</a></dt>

<dd>
<p>If set to true (default) resumption tokens will automatically be handled by requesting the next partial list during <code>next()</code> calls.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="OAI-PMH_Verbs"
>OAI-PMH Verbs</a></h1>

<p>The 6 OAI-PMH Verbs are the requests supported by an OAI-PMH interface.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Error_Messages"
>Error Messages</a></h2>

<p>Use <code>is_success()</code> or <code>is_error()</code> on the returned object to determine whether an error occurred (see <a href="../../HTTP/OAI/Response.html" class="podlinkpod"
>HTTP::OAI::Response</a>).</p>

<p><code>code()</code> and <code>message()</code> return the error code (200 is success) and a human-readable message respectively. <a href="../../HTTP/OAI/Error.html" class="podlinkpod"
>Errors</a> returned by the repository can be retrieved using the <code>errors()</code> method:</p>

<pre>        foreach my $error ($r-&#62;errors) {
                print $error-&#62;code, &#34;\t&#34;, $error-&#62;message, &#34;\n&#34;;
        }</pre>

<p>Note: <code>is_success()</code> is true for the OAI Error Code <code>noRecordsMatch</code> (i.e. empty set), although <code>errors()</code> will still contain the OAI error.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Flow_Control"
>Flow Control</a></h2>

<p>If the response contained a <a href="../../HTTP/OAI/ResumptionToken.html" class="podlinkpod"
>resumption token</a> this can be retrieved using the $r-&#62;resumptionToken method.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Methods"
>Methods</a></h2>

<p>These methods return an object subclassed from <a href="../../HTTP/Response.html" class="podlinkpod"
>HTTP::Response</a> (where the class corresponds to the verb requested, e.g. <code>GetRecord</code> requests return an <code>HTTP::OAI::GetRecord</code> object).</p>

<dl>
<dt><a name="$r_=_$h-&#62;GetRecord(_%params_)"
>$r = $h-&#62;GetRecord( %params )</a></dt>

<dd>
<p>Get a single record from the repository identified by identifier, in format metadataPrefix.</p>

<pre>        $gr = $h-&#62;GetRecord(
                identifier      =&#62;      &#39;oai:arXiv:hep-th/0001001&#39;, # Required
                metadataPrefix  =&#62;      &#39;oai_dc&#39; # Required
        );
        $rec = $gr-&#62;next;
        die $rec-&#62;message if $rec-&#62;is_error;
        printf(&#34;%s (%s)\n&#34;, $rec-&#62;identifier, $rec-&#62;datestamp);
        $dom = $rec-&#62;metadata-&#62;dom;</pre>

<dt><a name="$r_=_$h-&#62;Identify()"
>$r = $h-&#62;Identify()</a></dt>

<dd>
<p>Get information about the repository.</p>

<pre>        $id = $h-&#62;Identify();
        print join &#39;,&#39;, $id-&#62;adminEmail;</pre>

<dt><a name="$r_=_$h-&#62;ListIdentifiers(_%params_)"
>$r = $h-&#62;ListIdentifiers( %params )</a></dt>

<dd>
<p>Retrieve the identifiers, datestamps, sets and deleted status for all records within the specified date range (from/until) and set spec (set). 1.x repositories will only return the identifier. Or, resume an existing harvest by specifying resumptionToken.</p>

<pre>        $lr = $h-&#62;ListIdentifiers(
                metadataPrefix  =&#62;      &#39;oai_dc&#39;, # Required
                from            =&#62;              &#39;2001-10-01&#39;,
                until           =&#62;              &#39;2001-10-31&#39;,
                set=&#62;&#39;physics:hep-th&#39;,
        );
        while($rec = $lr-&#62;next)
        {
                { ... do something with $rec ... }
        }
        die $lr-&#62;message if $lr-&#62;is_error;</pre>

<dt><a name="$r_=_$h-&#62;ListMetadataFormats(_%params_)"
>$r = $h-&#62;ListMetadataFormats( %params )</a></dt>

<dd>
<p>List available metadata formats. Given an identifier the repository should only return those metadata formats for which that item can be disseminated.</p>

<pre>        $lmdf = $h-&#62;ListMetadataFormats(
                identifier =&#62; &#39;oai:arXiv.org:hep-th/0001001&#39;
        );
        for($lmdf-&#62;metadataFormat) {
                print $_-&#62;metadataPrefix, &#34;\n&#34;;
        }
        die $lmdf-&#62;message if $lmdf-&#62;is_error;</pre>

<dt><a name="$r_=_$h-&#62;ListRecords(_%params_)"
>$r = $h-&#62;ListRecords( %params )</a></dt>

<dd>
<p>Return full records within the specified date range (from/until), set and metadata format. Or, specify a resumption token to resume a previous partial harvest.</p>

<pre>        $lr = $h-&#62;ListRecords(
                metadataPrefix=&#62;&#39;oai_dc&#39;, # Required
                from    =&#62;      &#39;2001-10-01&#39;,
                until   =&#62;      &#39;2001-10-01&#39;,
                set             =&#62;      &#39;physics:hep-th&#39;,
        );
        while($rec = $lr-&#62;next)
        {
                { ... do something with $rec ... }
        }
        die $lr-&#62;message if $lr-&#62;is_error;</pre>

<dt><a name="$r_=_$h-&#62;ListSets(_%params_)"
>$r = $h-&#62;ListSets( %params )</a></dt>

<dd>
<p>Return a list of sets provided by the repository. The scope of sets is undefined by OAI-PMH, so therefore may represent any subset of a collection. Optionally provide a resumption token to resume a previous partial request.</p>

<pre>        $ls = $h-&#62;ListSets();
        while($set = $ls-&#62;next)
        {
                print $set-&#62;setSpec, &#34;\n&#34;;
        }
        die $ls-&#62;message if $ls-&#62;is_error;</pre>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>These modules have been written by Tim Brody &#60;tdb01r@ecs.soton.ac.uk&#62;.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
