<html><head><title>Log::Log4perl::Layout::PatternLayout</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:20 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Quantify_placeholders'>Quantify placeholders</a>
    <li class='indexItem indexItem2'><a href='#Fine-tuning_with_curlies'>Fine-tuning with curlies</a>
    <li class='indexItem indexItem2'><a href='#Fine-tune_the_date'>Fine-tune the date</a>
    <li class='indexItem indexItem2'><a href='#Custom_cspecs'>Custom cspecs</a>
    <li class='indexItem indexItem2'><a href='#Advanced_Options'>Advanced Options</a>
    <li class='indexItem indexItem2'><a href='#Getting_rid_of_newlines'>Getting rid of newlines</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Log::Log4perl::Layout::PatternLayout - Pattern Layout</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use Log::Log4perl::Layout::PatternLayout;

  my $layout = Log::Log4perl::Layout::PatternLayout-&#62;new(
                                                   &#34;%d (%F:%L)&#62; %m&#34;);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Creates a pattern layout according to http://jakarta.apache.org/log4j/docs/api/org/apache/log4j/PatternLayout.html and a couple of Log::Log4perl-specific extensions.</p>

<p>The <code>new()</code> method creates a new PatternLayout, specifying its log format. The format string can contain a number of placeholders which will be replaced by the logging engine when it&#39;s time to log the message:</p>

<pre>    %c Category of the logging event.
    %C Fully qualified package (or class) name of the caller
    %d Current date in yyyy/MM/dd hh:mm:ss format
    %d{...} Current date in customized format (see below)
    %F File where the logging event occurred
    %H Hostname (if Sys::Hostname is available)
    %l Fully qualified name of the calling method followed by the
       callers source the file name and line number between 
       parentheses.
    %L Line number within the file where the log statement was issued
    %m The message to be logged
    %m{chomp} The message to be logged, stripped off a trailing newline
    %M Method or function where the logging request was issued
    %n Newline (OS-independent)
    %p Priority of the logging event (%p{1} shows the first letter)
    %P pid of the current process
    %r Number of milliseconds elapsed from program start to logging 
       event
    %R Number of milliseconds elapsed from last logging event to
       current logging event 
    %T A stack trace of functions called
    %x The topmost NDC (see below)
    %X{key} The entry &#39;key&#39; of the MDC (see below)
    %% A literal percent (%) sign</pre>

<p>NDC and MDC are explained in <a href="../../../Log/Log4perl.html#Nested_Diagnostic_Context_(NDC)" class="podlinkpod"
>&#34;Nested Diagnostic Context (NDC)&#34; in Log::Log4perl</a> and <a href="../../../Log/Log4perl.html#Mapped_Diagnostic_Context_(MDC)" class="podlinkpod"
>&#34;Mapped Diagnostic Context (MDC)&#34; in Log::Log4perl</a>.</p>

<p>The granularity of time values is milliseconds if Time::HiRes is available. If not, only full seconds are used.</p>

<p>Every once in a while, someone uses the &#34;%m%n&#34; pattern and additionally provides an extra newline in the log message (e.g. <code>-&#62;log(&#34;message\n&#34;)</code>. To avoid printing an extra newline in this case, the PatternLayout will chomp the message, printing only one newline. This option can be controlled by PatternLayout&#39;s <code>message_chomp_before_newline</code> option. See <a href="#Advanced_options" class="podlinkpod"
>&#34;Advanced options&#34;</a> for details.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Quantify_placeholders"
>Quantify placeholders</a></h2>

<p>All placeholders can be extended with formatting instructions, just like in <i>printf</i>:</p>

<pre>    %20c   Reserve 20 chars for the category, right-justify and fill
           with blanks if it is shorter
    %-20c  Same as %20c, but left-justify and fill the right side 
           with blanks
    %09r   Zero-pad the number of milliseconds to 9 digits
    %.8c   Specify the maximum field with and have the formatter
           cut off the rest of the value</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Fine-tuning_with_curlies"
>Fine-tuning with curlies</a></h2>

<p>Some placeholders have special functions defined if you add curlies with content after them:</p>

<pre>    %c{1}  Just show the right-most category compontent, useful in large
           class hierarchies (Foo::Baz::Bar -&#62; Bar)
    %c{2}  Just show the two right most category components
           (Foo::Baz::Bar -&#62; Baz::Bar)

    %F     Display source file including full path
    %F{1}  Just display filename
    %F{2}  Display filename and last path component (dir/test.log)
    %F{3}  Display filename and last two path components (d1/d2/test.log)

    %M     Display fully qualified method/function name
    %M{1}  Just display method name (foo)
    %M{2}  Display method name and last path component (main::foo)</pre>

<p>In this way, you&#39;re able to shrink the displayed category or limit file/path components to save space in your logs.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Fine-tune_the_date"
>Fine-tune the date</a></h2>

<p>If you&#39;re not happy with the default %d format for the date which looks like</p>

<pre>    yyyy/MM/DD HH:mm:ss</pre>

<p>(which is slightly different from Log4j which uses <code>yyyy-MM-dd HH:mm:ss,SSS</code>) you&#39;re free to fine-tune it in order to display only certain characteristics of a date, according to the SimpleDateFormat in the Java World (http://java.sun.com/j2se/1.3/docs/api/java/text/SimpleDateFormat.html):</p>

<pre>    %d{HH:mm}     &#34;23:45&#34; -- Just display hours and minutes
    %d{yy, EEEE}  &#34;02, Monday&#34; -- Just display two-digit year 
                                  and spelled-out weekday
Here&#39;s the symbols and their meaning, according to the SimpleDateFormat
specification:

    Symbol   Meaning                 Presentation     Example
    ------   -------                 ------------     -------
    G        era designator          (Text)           AD
    y        year                    (Number)         1996 
    M        month in year           (Text &#38; Number)  July &#38; 07
    d        day in month            (Number)         10
    h        hour in am/pm (1-12)    (Number)         12
    H        hour in day (0-23)      (Number)         0
    m        minute in hour          (Number)         30
    s        second in minute        (Number)         55
    E        day in week             (Text)           Tuesday
    D        day in year             (Number)         189
    a        am/pm marker            (Text)           PM
    e        epoch seconds           (Number)         1315011604

    (Text): 4 or more pattern letters--use full form, &#60; 4--use short or 
            abbreviated form if one exists. 

    (Number): the minimum number of digits. Shorter numbers are 
              zero-padded to this amount. Year is handled 
              specially; that is, if the count of &#39;y&#39; is 2, the 
              Year will be truncated to 2 digits. 

    (Text &#38; Number): 3 or over, use text, otherwise use number. </pre>

<p>There&#39;s also a bunch of pre-defined formats:</p>

<pre>    %d{ABSOLUTE}   &#34;HH:mm:ss,SSS&#34;
    %d{DATE}       &#34;dd MMM yyyy HH:mm:ss,SSS&#34;
    %d{ISO8601}    &#34;yyyy-MM-dd HH:mm:ss,SSS&#34;</pre>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Custom_cspecs"
>Custom cspecs</a></h2>

<p>First of all, &#34;cspecs&#34; is short for &#34;conversion specifiers&#34;, which is the log4j and the printf(3) term for what Mike is calling &#34;placeholders.&#34; I suggested &#34;cspecs&#34; for this part of the api before I saw that Mike was using &#34;placeholders&#34; consistently in the log4perl documentation. Ah, the joys of collaboration ;=) --kg</p>

<p>If the existing corpus of placeholders/cspecs isn&#39;t good enough for you, you can easily roll your own:</p>

<pre>    #&#39;U&#39; a global user-defined cspec     
    log4j.PatternLayout.cspec.U = sub { return &#34;UID: $&#60; &#34;}
    
    #&#39;K&#39; cspec local to appndr1                 (pid in hex)
    log4j.appender.appndr1.layout.cspec.K = sub { return sprintf &#34;%1x&#34;, $$}
    
    #and now you can use them
    log4j.appender.appndr1.layout.ConversionPattern = %K %U %m%n</pre>

<p>The benefit of this approach is that you can define and use the cspecs right next to each other in the config file.</p>

<p>If you&#39;re an API kind of person, there&#39;s also this call:</p>

<pre>    Log::Log4perl::Layout::PatternLayout::
                    add_global_cspec(&#39;Z&#39;, sub {&#39;zzzzzzzz&#39;}); #snooze?</pre>

<p>When the log message is being put together, your anonymous sub will be called with these arguments:</p>

<pre>    ($layout, $message, $category, $priority, $caller_level);
    
    layout: the PatternLayout object that called it
    message: the logging message (%m)
    category: e.g. groceries.beverages.adult.beer.schlitz
    priority: e.g. DEBUG|WARN|INFO|ERROR|FATAL
    caller_level: how many levels back up the call stack you have 
        to go to find the caller</pre>

<p>Please note that the subroutines you&#39;re defining in this way are going to be run in the <code>main</code> namespace, so be sure to fully qualify functions and variables if they&#39;re located in different packages. <i>Also make sure these subroutines aren&#39;t using Log4perl, otherwise Log4perl will enter an infinite recursion.</i></p>

<p>With Log4perl 1.20 and better, cspecs can be written with parameters in curly braces. Writing something like</p>

<pre>    log4perl.appender.Screen.layout.ConversionPattern = %U{user} %U{id} %m%n</pre>

<p>will cause the cspec function defined for %U to be called twice, once with the parameter &#39;user&#39; and then again with the parameter &#39;id&#39;, and the placeholders in the cspec string will be replaced with the respective return values.</p>

<p>The parameter value is available in the &#39;curlies&#39; entry of the first parameter passed to the subroutine (the layout object reference). So, if you wanted to map %U{xxx} to entries in the POE session hash, you&#39;d write something like:</p>

<pre>   log4perl.PatternLayout.cspec.U = sub { \
     POE::Kernel-&#62;get_active_session-&#62;get_heap()-&#62;{ $_[0]-&#62;{curlies} } }</pre>

<p><b>SECURITY NOTE</b></p>

<p>This feature means arbitrary perl code can be embedded in the config file. In the rare case where the people who have access to your config file are different from the people who write your code and shouldn&#39;t have execute rights, you might want to set</p>

<pre>    $Log::Log4perl::Config-&#62;allow_code(0);</pre>

<p>before you call init(). Alternatively you can supply a restricted set of Perl opcodes that can be embedded in the config file as described in <a href="../../../Log/Log4perl.html#Restricting_what_Opcodes_can_be_in_a_Perl_Hook" class="podlinkpod"
>&#34;Restricting what Opcodes can be in a Perl Hook&#34; in Log::Log4perl</a>.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Advanced_Options"
>Advanced Options</a></h2>

<p>The constructor of the <code>Log::Log4perl::Layout::PatternLayout</code> class takes an optional hash reference as a first argument to specify additional options in order to (ab)use it in creative ways:</p>

<pre>  my $layout = Log::Log4perl::Layout::PatternLayout-&#62;new(
    { time_function       =&#62; \&#38;my_time_func,
    }, 
    &#34;%d (%F:%L)&#62; %m&#34;);</pre>

<p>Here&#39;s a list of parameters:</p>

<dl>
<dt><a name="time_function"
>time_function</a></dt>

<dd>
<p>Takes a reference to a function returning the time for the time/date fields, either in seconds since the epoch or as an array, carrying seconds and microseconds, just like <code>Time::HiRes::gettimeofday</code> does.</p>

<dt><a name="message_chomp_before_newline"
>message_chomp_before_newline</a></dt>

<dd>
<p>If a layout contains the pattern &#34;%m%n&#34; and the message ends with a newline, PatternLayout will chomp the message, to prevent printing two newlines. If this is not desired, and you want two newlines in this case, the feature can be turned off by setting the <code>message_chomp_before_newline</code> option to a false value:</p>

<pre>  my $layout = Log::Log4perl::Layout::PatternLayout-&#62;new(
      { message_chomp_before_newline =&#62; 0
      }, 
      &#34;%d (%F:%L)&#62; %m%n&#34;);</pre>

<p>In a Log4perl configuration file, the feature can be turned off like this:</p>

<pre>    log4perl.appender.App.layout   = PatternLayout
    log4perl.appender.App.layout.ConversionPattern = %d %m%n
      # Yes, I want two newlines
    log4perl.appender.App.layout.message_chomp_before_newline = 0</pre>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Getting_rid_of_newlines"
>Getting rid of newlines</a></h2>

<p>If your code contains logging statements like</p>

<pre>      # WRONG, don&#39;t do that!
    $logger-&#62;debug(&#34;Some message\n&#34;);</pre>

<p>then it&#39;s usually best to strip the newlines from these calls. As explained in <a href="../../../Log/Log4perl.html#Logging_newlines" class="podlinkpod"
>&#34;Logging newlines&#34; in Log::Log4perl</a>, logging statements should never contain newlines, but rely on appender layouts to add necessary newlines instead.</p>

<p>If changing the code is not an option, use the special PatternLayout placeholder %m{chomp} to refer to the message excluding a trailing newline:</p>

<pre>    log4perl.appender.App.layout.ConversionPattern = %d %m{chomp}%n</pre>

<p>This will add a single newline to every message, regardless if it complies with the Log4perl newline guidelines or not (thanks to Tim Bunce for this idea).</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>Copyright 2002-2013 by Mike Schilli &#60;m@perlmeister.com&#62; and Kevin Goess &#60;cpan@goess.org&#62;.</p>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Please contribute patches to the project on Github:</p>

<pre>    http://github.com/mschilli/log4perl</pre>

<p>Send bug reports or requests for enhancements to the authors via our</p>

<p>MAILING LIST (questions, bug reports, suggestions/patches): log4perl-devel@lists.sourceforge.net</p>

<p>Authors (please contact them via the list above, not directly): Mike Schilli &#60;m@perlmeister.com&#62;, Kevin Goess &#60;cpan@goess.org&#62;</p>

<p>Contributors (in alphabetical order): Ateeq Altaf, Cory Bennett, Jens Berthold, Jeremy Bopp, Hutton Davidson, Chris R. Donnelly, Matisse Enzer, Hugh Esco, Anthony Foiani, James FitzGibbon, Carl Franks, Dennis Gregorovic, Andy Grundman, Paul Harrington, Alexander Hartmaier David Hull, Robert Jacobson, Jason Kohles, Jeff Macdonald, Markus Peter, Brett Rann, Peter Rabbitson, Erik Selberg, Aaron Straup Cope, Lars Thegler, David Viner, Mac Yang.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
