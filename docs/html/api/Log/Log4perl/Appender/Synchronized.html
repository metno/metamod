<html><head><title>Log::Log4perl::Appender::Synchronized</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="blkmagw" type="text/css" href="../../../_blkmagw.css" media="all" >
<link rel="alternate stylesheet" title="blkcynw" type="text/css" href="../../../_blkcynw.css" media="all" >
<link rel="alternate stylesheet" title="whtprpk" type="text/css" href="../../../_whtprpk.css" media="all" >
<link rel="alternate stylesheet" title="whtnavk" type="text/css" href="../../../_whtnavk.css" media="all" >
<link rel="alternate stylesheet" title="grygrnk" type="text/css" href="../../../_grygrnk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="blkgrng" type="text/css" href="../../../_blkgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >
<link rel="alternate stylesheet" title="blkbluw" type="text/css" href="../../../_blkbluw.css" media="all" >
<link rel="alternate stylesheet" title="whtpurk" type="text/css" href="../../../_whtpurk.css" media="all" >
<link rel="alternate stylesheet" title="whtgrng" type="text/css" href="../../../_whtgrng.css" media="all" >
<link rel="alternate stylesheet" title="grygrnw" type="text/css" href="../../../_grygrnw.css" media="all" >

<script type="text/javascript" src="../../../_podly.js"></script>

</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.16,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.014002 at Tue Mar 25 17:14:19 2014 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<p class="backlinktop"><b><a name="___top" href="../../../index.html" accesskey="1" title="All Documents">&lt;&lt;</a></b></p>

<div class='indexgroup'>
<ul   class='indexList indexList1'>
  <li class='indexItem indexItem1'><a href='#NAME'>NAME</a>
  <li class='indexItem indexItem1'><a href='#SYNOPSIS'>SYNOPSIS</a>
  <li class='indexItem indexItem1'><a href='#DESCRIPTION'>DESCRIPTION</a>
  <ul   class='indexList indexList2'>
    <li class='indexItem indexItem2'><a href='#Performance_tips'>Performance tips</a>
    <li class='indexItem indexItem2'><a href='#Advanced_configuration'>Advanced configuration</a>
    <li class='indexItem indexItem2'><a href='#Semaphore_user_and_group_IDs_with_mod_perl'>Semaphore user and group IDs with mod_perl</a>
  </ul>
  <li class='indexItem indexItem1'><a href='#DEVELOPMENT_NOTES'>DEVELOPMENT NOTES</a>
  <li class='indexItem indexItem1'><a href='#LICENSE'>LICENSE</a>
  <li class='indexItem indexItem1'><a href='#AUTHOR'>AUTHOR</a>
</ul>
</div>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<pre>    Log::Log4perl::Appender::Synchronized - Synchronizing other appenders</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    use Log::Log4perl qw(:easy);

    my $conf = qq(
    log4perl.category                   = WARN, Syncer
    
        # File appender (unsynchronized)
    log4perl.appender.Logfile           = Log::Log4perl::Appender::File
    log4perl.appender.Logfile.autoflush = 1
    log4perl.appender.Logfile.filename  = test.log
    log4perl.appender.Logfile.mode      = truncate
    log4perl.appender.Logfile.layout    = SimpleLayout
    
        # Synchronizing appender, using the file appender above
    log4perl.appender.Syncer            = Log::Log4perl::Appender::Synchronized
    log4perl.appender.Syncer.appender   = Logfile
);

    Log::Log4perl-&#62;init(\$conf);
    WARN(&#34;This message is guaranteed to be complete.&#34;);</pre>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>If multiple processes are using the same <code>Log::Log4perl</code> appender without synchronization, overwrites might happen. A typical scenario for this would be a process spawning children, each of which inherits the parent&#39;s Log::Log4perl configuration.</p>

<p>In most cases, you won&#39;t need an external synchronisation tool like Log::Log4perl::Appender::Synchronized at all. Log4perl&#39;s file appender, Log::Log4perl::Appender::File, for example, provides the <code>syswrite</code> mechanism for making sure that even long log lines won&#39;t interleave. Short log lines won&#39;t interleave anyway, because the operating system makes sure the line gets written before a task switch occurs.</p>

<p>In cases where you need additional synchronization, however, you can use <code>Log::Log4perl::Appender::Synchronized</code> as a gateway between your loggers and your appenders. An appender itself, <code>Log::Log4perl::Appender::Synchronized</code> just takes two additional arguments:</p>

<dl>
<dt><a name="appender"
><code>appender</code></a></dt>

<dd>
<p>Specifies the name of the appender it synchronizes access to. The appender specified must be defined somewhere in the configuration file, not necessarily before the definition of <code>Log::Log4perl::Appender::Synchronized</code>.</p>

<dt><a name="key"
><code>key</code></a></dt>

<dd>
<p>This optional argument specifies the key for the semaphore that <code>Log::Log4perl::Appender::Synchronized</code> uses internally to ensure atomic operations. It defaults to <code>_l4p</code>. If you define more than one <code>Log::Log4perl::Appender::Synchronized</code> appender, it is important to specify different keys for them, as otherwise every new <code>Log::Log4perl::Appender::Synchronized</code> appender will nuke previously defined semaphores. The maximum key length is four characters, longer keys will be truncated to 4 characters -- <code>mylongkey1</code> and <code>mylongkey2</code> are interpreted to be the same: <code>mylo</code> (thanks to David Viner &#60;dviner@yahoo-inc.com&#62; for pointing this out).</p>
</dd>
</dl>

<p><code>Log::Log4perl::Appender::Synchronized</code> uses Log::Log4perl::Util::Semaphore internally to perform locking with semaphores provided by the operating system used.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Performance_tips"
>Performance tips</a></h2>

<p>The <code>Log::Log4perl::Appender::Synchronized</code> serializes access to a protected resource globally, slowing down actions otherwise performed in parallel.</p>

<p>Unless specified otherwise, all instances of <code>Log::Log4perl::Appender::Synchronized</code> objects in the system will use the same global IPC key <code>_l4p</code>.</p>

<p>To control access to different appender instances, it often makes sense to define different keys for different synchronizing appenders. In this way, Log::Log4perl serializes access to each appender instance separately:</p>

<pre>    log4perl.category                   = WARN, Syncer1, Syncer2
    
        # File appender 1 (unsynchronized)
    log4perl.appender.Logfile1           = Log::Log4perl::Appender::File
    log4perl.appender.Logfile1.filename  = test1.log
    log4perl.appender.Logfile1.layout    = SimpleLayout
    
        # File appender 2 (unsynchronized)
    log4perl.appender.Logfile2           = Log::Log4perl::Appender::File
    log4perl.appender.Logfile2.filename  = test2.log
    log4perl.appender.Logfile2.layout    = SimpleLayout
    
        # Synchronizing appender, using the file appender above
    log4perl.appender.Syncer1            = Log::Log4perl::Appender::Synchronized
    log4perl.appender.Syncer1.appender   = Logfile1
    log4perl.appender.Syncer1.key        = l4p1

        # Synchronizing appender, using the file appender above
    log4perl.appender.Syncer2            = Log::Log4perl::Appender::Synchronized
    log4perl.appender.Syncer2.appender   = Logfile2
    log4perl.appender.Syncer2.key        = l4p2</pre>

<p>Without the <code>.key = l4p1</code> and <code>.key = l4p2</code> lines, both Synchronized appenders would be using the default <code>_l4p</code> key, causing unnecessary serialization of output written to different files.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Advanced_configuration"
>Advanced configuration</a></h2>

<p>To configure the underlying Log::Log4perl::Util::Semaphore module in a different way than with the default settings provided by Log::Log4perl::Appender::Synchronized, use the following parameters:</p>

<pre>    log4perl.appender.Syncer1.destroy  = 1
    log4perl.appender.Syncer1.mode     = sub { 0775 }
    log4perl.appender.Syncer1.uid      = hugo
    log4perl.appender.Syncer1.gid      = 100</pre>

<p>Valid options are <code>destroy</code> (Remove the semaphore on exit), <code>mode</code> (permissions on the semaphore), <code>uid</code> (uid or user name the semaphore is owned by), and <code>gid</code> (group id the semaphore is owned by),</p>

<p>Note that <code>mode</code> is usually given in octal and therefore needs to be specified as a perl sub {}, unless you want to calculate what 0755 means in decimal.</p>

<p>Changing ownership or group settings for a semaphore will obviously only work if the current user ID owns the semaphore already or if the current user is <code>root</code>. The <code>destroy</code> option causes the current process to destroy the semaphore on exit. Spawned children of the process won&#39;t inherit this behavior.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Semaphore_user_and_group_IDs_with_mod_perl"
>Semaphore user and group IDs with mod_perl</a></h2>

<p>Setting user and group IDs is especially important when the Synchronized appender is used with mod_perl. If Log4perl gets initialized by a startup handler, which runs as root, and not as the user who will later use the semaphore, the settings for uid, gid, and mode can help establish matching semaphore ownership and access rights.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DEVELOPMENT_NOTES"
>DEVELOPMENT NOTES</a></h1>

<p><code>Log::Log4perl::Appender::Synchronized</code> is a <i>composite</i> appender. Unlike other appenders, it doesn&#39;t log any messages, it just passes them on to its attached sub-appender. For this reason, it doesn&#39;t need a layout (contrary to regular appenders). If it defines none, messages are passed on unaltered.</p>

<p>Custom filters are also applied to the composite appender only. They are <i>not</i> applied to the sub-appender. Same applies to appender thresholds. This behaviour might change in the future.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="LICENSE"
>LICENSE</a></h1>

<p>Copyright 2002-2013 by Mike Schilli &#60;m@perlmeister.com&#62; and Kevin Goess &#60;cpan@goess.org&#62;.</p>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="AUTHOR"
>AUTHOR</a></h1>

<p>Please contribute patches to the project on Github:</p>

<pre>    http://github.com/mschilli/log4perl</pre>

<p>Send bug reports or requests for enhancements to the authors via our</p>

<p>MAILING LIST (questions, bug reports, suggestions/patches): log4perl-devel@lists.sourceforge.net</p>

<p>Authors (please contact them via the list above, not directly): Mike Schilli &#60;m@perlmeister.com&#62;, Kevin Goess &#60;cpan@goess.org&#62;</p>

<p>Contributors (in alphabetical order): Ateeq Altaf, Cory Bennett, Jens Berthold, Jeremy Bopp, Hutton Davidson, Chris R. Donnelly, Matisse Enzer, Hugh Esco, Anthony Foiani, James FitzGibbon, Carl Franks, Dennis Gregorovic, Andy Grundman, Paul Harrington, Alexander Hartmaier David Hull, Robert Jacobson, Jason Kohles, Jeff Macdonald, Markus Peter, Brett Rann, Peter Rabbitson, Erik Selberg, Aaron Straup Cope, Lars Thegler, David Viner, Mac Yang.</p>
<p class="backlinkbottom"><b><a name="___bottom" href="../../../index.html" title="All Documents">&lt;&lt;</a></b></p>

<!-- end doc -->

</body></html>
