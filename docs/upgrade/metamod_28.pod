=head1 Upgrading METAMOD 2.8

=head2 From version 2.7

METAMOD 2.7 was an internal release only, using Catalyst for the search interface.
Upgrading is mostly the same as 2.6.

=head2 From version 2.6

=head3 Configuration

There are several new directives which must be set in master_config. Some examples:

    APPLICATION_USER - owner of webrun directory and Apache/Catalyst processes
    CATALYST_PORT    - run Catalyst on this port (normally 3000)
    PG_CONTRIB       - Directory for PostgreSQL contrib libs
    LDAP_SERVER      - LDAP server used for authentication
    LDAP_BASE_DN     - base DN for LDAP

Also, APP_MENU should no longer include links to the standard sections of the site
(METADATA_SEARCH_URL, UPLOAD_URL) since these are now generated by Catalyst.
See app/example for more information.


Site-specific texts are no longer configured in master_config, but instead
in a custom Template Toolkit file (applic/custom/templates/custom.tt). Custom
images and CSS styles are similarly specified in applic/custom/static. Note that
applic/filelist.txt must be updated for the files being copied to target.


=head3 Database

Some minor changes to the metadata database. Suggested running ./init/createdb.sh
to recreate tables and ./scripts/import_dataset.pl to repopulate.

The userdatabase has been extensively modified, including support for login roles and
SHA1-hashed passwords. Run ./userinit/upgradeuserdb_26-28.sh to upgrade.

=head3 Installation

Generation of Apache config and init scripts are now fully automated. After running
update_target.pl you will find the following files in your target directory:

=over 4

=item etc/httpd.conf

Apache configuration, destined either for /etc/apache2/sites-available (if using DNS-based virtual hosts)
or /etc/apache2/conf.d (otherwise).

=item etc/init.d/catalyst-myapp

Init.d script to start/stop Catalyst.

=item metamodInit.sh

Script to start/stop the main METAMOD services.

=back

To install these scripts systemwide, run install_jobs.sh from the target directory.
You will need sudo permissions to execute it properly (the sudo commands are inside the script).
This will place the following symlinks to the target directory:

=over 4

=item etc/apache2/conf.d/APPLICATION_ID

=item etc/apache2/sites-available/APPLICATION_ID

Apache configuration, using either URL-based or DNS-based hosting. For the latter
it will also run a2ensite to enable it.

=item /etc/init.d/catalyst-APPLICATION_ID

Init.d script to start/stop Catalyst.

=item /etc/init.d//metamodServices-APPLICATION_ID

Actually not a symlink, but a one-line script to run metamodInit.sh as the correct user.

=back

B<Note:> The configuration system is designed to work on a freshly installed Linux.
Take care if you have already configured a site manually that it will not
conflict with the newly generated config. Installation will abort if there are existing files in /etc
with the same names. However, it is still possible if you have configured Apache manually
in /etc/apache2/sites-enabled/default that the new directives in conf.d will never be applied.
If so please remove your manual configuration to see if METAMOD will run, then reapply your
custom config one bit at a time.

=head3 Starting and testing

See the Deploying manual on how to start/stop METAMOD.
